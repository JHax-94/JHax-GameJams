!function s(r,a,c){function h(e,t){if(!a[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(l)return l(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var n=a[e]={exports:{}};r[e][0].call(n.exports,function(t){return h(r[e][1][t]||t)},n,n.exports,s,r,a,c)}return a[e].exports}for(var l="function"==typeof require&&require,t=0;t<c.length;t++)h(c[t]);return h}({1:[function(t,e,i){"use strict";function o(t){this.id=t,this.volume=1,this.muted=!0,this.loopSound=null,this.loopId=null,this.loopVol=0,this.nextLoop=null}(e.exports=o).prototype.setVolume=function(t,e){var i=this.muted;this.muted=0===t||e||!1,null!=t?this.volume=t:t=this.volume,this.loopId&&(this.loopSound&&this.muted?this.loopSound.stop():this.loopSound&&this.loopSound.id===this.loopId?(this.loopSound.setVolume(Math.max(0,Math.min(1,t*this.loopVol))),i&&this.loopSound.play()):this.muted||this.audioManager.playLoopSound(this.id,this.loopId,this.loopVol))},o.prototype.setMute=function(t){this.setVolume(null,t)},o.prototype.playLoopSound=function(t,i,o,n,s,r){var a=this.audioManager,c=a.settings.defaultFade,e=a.settings.crossFading,h=this.loopSound,l=h&&h.id;if(i=Math.max(0,Math.min(1,i||1)),this.loopId=t,this.loopVol=i,!a.muted&&!this.muted){if(t===l&&h)return h.play(i*this.volume,o,n),void(this.nextLoop&&(this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=null));if(h=null,!this.nextLoop||this.nextLoop.id!==t){var u=this;e?(this.nextLoop&&this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=a.createSound(t,this.id),this.nextLoop.load(function(t){if(t)return u.nextLoop.unload(),void(u.nextLoop=null);p(u.loopSound),f()})):(this.nextLoop=a.createSound(t,this.id),p(this.loopSound,f))}}function p(t,e){if(!t)return e&&e();t.stopping||t.stop(function(){return a.freeSound(t),t=null,e&&e()})}function d(){var e=u.loopSound=u.nextLoop;u.nextLoop=null,e&&(e.setLoop(!0,s,r),e.fade=c,e.load(function(t){if(t)return e.unload(),void(u.loopSound=null);e.play(i*u.volume,o,n)}))}function f(){u.loopSound=null,window.setTimeout(d,0)}}},{}],2:[function(t,e,i){"use strict";var o=window.AudioContext||window.webkitAudioContext,n=t("./OrderedList"),s=t("./SoundBuffered.js"),r=t("./SoundGroup.js"),a=t("./AudioChannel.js"),c=t("./ISound.js");function h(t){this.soundsById={},this.soundGroupsById={},this.permanentSounds={},this.freeSoundPool=[],this.soundArchive=new n(function(){return 1}),this.soundGroupArchive=new n(function(){return 1}),this.soundArchiveById={},this.soundGroupArchiveById={},this.usedMemory=0,this.channels={},this.audioContext=null,this.muted=!1,this.settings={audioPath:"",maxSoundGroup:500,maxUsedMemory:300,defaultFade:2,maxPlayLatency:1e3,crossFading:!1,getFileUri:function(t,e){return t+e+".mp3"},getSoundConstructor:function(){return null}};for(var e=0;e<t.length;e++){var i=t[e];this.channels[i]=new a(i)}c.prototype.audioManager=this,r.prototype.audioManager=this,a.prototype.audioManager=this}o||(console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),s=t("./Sound.js"),window.Audio||(console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),s=c)),e.exports=h,e.exports.ISound=c,h.prototype.init=function(){if(!this.audioContext&&o)for(var t in this.audioContext=new o,s.prototype.audioContext=this.audioContext,this.soundsById)this.soundsById[t].init()},h.prototype.getEmptySound=function(t,e){var i,o=this.settings.getSoundConstructor(t,e);return o?i=new o:(0<this.freeSoundPool.length?(i=this.freeSoundPool.pop()).init():i=new s,i)},h.prototype.setup=function(t){for(var e in t){var i=t[e];this.setVolume(e,i.volume,i.muted)}},h.prototype.addChannel=function(t){this.channels[t]||(this.channels[t]=new a(t))},h.prototype.setVolume=function(t,e,i){var o=this.channels[t];o&&o.setVolume(e,i)},h.prototype.setMute=function(t){for(var e in void 0===t&&(t=!this.muted),this.muted=!!t,this.channels){var i=this.channels[e];if(i.loopSound)if(t)i.loopSound.stop();else{var o=i.muted;i.muted=!0,i.setVolume(null,o)}}},h.prototype.loadSound=function(t,e){var i=this.createSound(t);return i.load(e),i},h.prototype.createSound=function(t,e){var i=this.getSound(t);return i||((i=this.soundsById[t]=this.getEmptySound(e,t)).setId(t),i)},h.prototype.createSoundPermanent=function(t,e){var i=this.getSound(t);if(i)return i;var o=this.settings.getSoundConstructor(e,t)||s;return(i=this.permanentSounds[t]=new o).setId(t),i},h.prototype.getSound=function(t){var e=this.permanentSounds[t];return e||((e=this.soundsById[t])?e:(e=this.soundArchiveById[t])?(this.soundArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundArchiveById[t],this.soundsById[t]=e):null)},h.prototype.getSoundGroup=function(t){var e=this.soundGroupsById[t];return e||((e=this.soundGroupArchiveById[t])?(this.soundGroupArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundGroupArchiveById[t],e.verifySounds(),this.soundGroupsById[t]=e):null)},h.prototype.freeSound=function(t){var e=t.id;this.soundsById[e]&&delete this.soundsById[e],this.soundArchiveById[e]&&(this.soundArchive.removeByRef(t.poolRef),t.poolRef=null,delete this.soundArchiveById[e]),t.unload(),t instanceof s&&this.freeSoundPool.push(t)},h.prototype.playLoopSound=function(t,e,i,o,n,s,r){var a=this.channels[t];if(!a)return console.warn('Channel id "'+t+'" does not exist.');a.playLoopSound(e,i,o,n,s,r)},h.prototype.stopLoopSound=function(t){var e=this,i=this.channels[t];if(!i)return console.warn('Channel id "'+t+'" does not exist.');var o=i.loopSound;i.loopId=null,o&&o.stop(function(){e.freeSound(o),i.loopSound=null})},h.prototype.stopAllLoopSounds=function(){for(var t in this.channels)this.stopLoopSound(t)},h.prototype.release=function(){var t,e,i,o=this.settings.maxSoundGroup,n=this.settings.maxUsedMemory,s={};for(t in this.channels){var r=this.channels[t];r.loopSound&&(s[r.loopSound.id]=!0)}for(t in this.soundGroupsById)(e=this.soundGroupsById[t]).poolRef=this.soundGroupArchive.add(e),this.soundGroupArchiveById[t]=e,delete this.soundGroupsById[t];for(t in this.soundsById)s[t]||((i=this.soundsById[t]).poolRef=this.soundArchive.add(i),this.soundArchiveById[t]=i,delete this.soundsById[t]);for(var a=this.soundGroupArchive.getCount();o<a&&(e=this.soundGroupArchive.popFirst());)e.poolRef=null,delete this.soundGroupArchiveById[e.id],--a;for(;this.usedMemory>n&&(i=this.soundArchive.popFirst());)i.poolRef=null,delete this.soundArchiveById[i.id],this.freeSound(i)},h.prototype.playSound=function(t,e,i,o,n){if(!this.muted){var s=this.channels[t];if(!s.muted){var r=this.getSound(e);i=i||1,(r=r||this.createSound(e,t)).play(s.volume*i,o,n)}}},h.prototype.playSoundGroup=function(t,e,i,o,n){if(!this.muted){var s=this.channels[t];if(s&&!s.muted){var r=this.getSoundGroup(e);if(!r)return console.warn('SoundGroup "'+e+'" does not exist.');i=i||1,r.play(i*s.volume,o,n)}}},h.prototype.createSoundGroup=function(t,e,i){if(!this.getSoundGroup(t)){var o=new r(t,e.id,e.vol,e.pitch,i);this.soundGroupsById[t]=o}},h.prototype.createSoundGroups=function(t,e){var i=void 0!==e&&this.channels[e].muted;for(var o in t)this.createSoundGroup(o,t[o],i)}},{"./AudioChannel.js":1,"./ISound.js":3,"./OrderedList":4,"./Sound.js":5,"./SoundBuffered.js":6,"./SoundGroup.js":7}],3:[function(t,e,i){"use strict";function o(){this.playing=!1,this.stopping=!1,this.fade=0,this.usedMemory=0,this.poolRef=null,this.id=null,this.volume=1,this.pan=0,this.loop=!1,this.pitch=0,this._loaded=!1,this._loading=!1,this._unloading=!1,this._playTriggered=0,this._onLoadQueuedCallback=[]}(e.exports=o).prototype.setId=function(t){this.id=t,this._loaded=!1},o.prototype.load=function(t){return this.id?this._loaded?t&&t(null,this):(t&&this._onLoadQueuedCallback.push(t),this._loading?void 0:(this._loading=!0,this._load())):t&&t("noId")},o.prototype._finalizeLoad=function(t){var e=this.audioManager.settings.maxPlayLatency;this._loaded=!t,this._loading=!1;for(var i=0;i<this._onLoadQueuedCallback.length;i++)this._onLoadQueuedCallback[i](t,this);if(this._onLoadQueuedCallback=[],this._unloading)return this._unloading=!1,void this.unload();this._loaded&&this._playTriggered&&((this.loop||Date.now()-this._playTriggered<e)&&this._play(),this._playTriggered=0)},o.prototype.cancelOnLoadCallbacks=function(){this._onLoadQueuedCallback=[]},o.prototype.play=function(t,e,i){if(null!=t&&this.setVolume(t),null!=e&&this.setPan(e),!this._loaded)return this._playTriggered=Date.now(),void this.load();this.loop&&this.playing?this._updatePlayPitch(i):this._play(i)},o.prototype.init=function(){},o.prototype.setVolume=function(t){this.volume=t},o.prototype.setPan=function(t){this.pan=t},o.prototype.setLoop=function(t){this.loop=t},o.prototype.setPitch=function(t){this.pitch=t},o.prototype._updatePlayPitch=function(t){},o.prototype._play=function(t){this.playing=!0,console.log('ISound play call: "'+this.id+'"')},o.prototype.stop=function(t){return this.playing=!1,t&&t()},o.prototype._load=function(){return console.log("ISound load call: "+this.id),this._finalizeLoad(null)},o.prototype.unload=function(){return this._playTriggered=0,this.setLoop(!1),this.fade=0,this.pitch=0,this.stop(),this._loading?!(this._unloading=!0):(this.audioManager.usedMemory-=this.usedMemory,this.setVolume(1),this.setPan(0),this.id=null,this._loaded=!1,!(this.usedMemory=0))}},{}],4:[function(t,e,i){"use strict";function s(t,e,i,o){this.object=t,this.previous=e,this.next=i,this.container=o}function o(t){this.count=0,this.first=null,this.last=null,this.cmpFunc=t}o.prototype.add=function(t){var e=new s(t,null,null,this);if(this.count+=1,null===this.first)return this.first=e,this.last=e;var i=this.cmpFunc(t,this.first.object);if(i<0)return e.next=this.first,this.first.previous=e,this.first=e;var o,n=this.cmpFunc(t,this.last.object);if(0<=n)return e.previous=this.last,this.last.next=e,this.last=e;if(i+n<0){for(o=this.first.next;0<=this.cmpFunc(t,o.object);)o=o.next;e.next=o,e.previous=o.previous,e.previous.next=e,o.previous=e}else{for(o=this.last.previous;this.cmpFunc(t,o.object)<0;)o=o.previous;e.previous=o,e.next=o.next,e.next.previous=e,o.next=e}return e},o.prototype.removeByRef=function(t){return!(!t||t.container!==this)&&(--this.count,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,!(t.container=null))},o.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},o.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},o.prototype.possess=function(t){return t&&t.container===this},o.prototype.popFirst=function(){var t=this.first;if(!t)return null;--this.count;var e=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,e},o.prototype.popLast=function(){var t=this.last;if(!t)return null;--this.count;var e=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,e},o.prototype.getFirst=function(){return this.first&&this.first.object},o.prototype.getLast=function(){return this.last&&this.last.object},o.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.count=0,this.first=null,this.last=null},o.prototype.getCount=function(){return this.count},o.prototype.forEach=function(t,e){for(var i=this.first;i;i=i.next)t(i.object,e)},o.prototype.forEachReverse=function(t,e){for(var i=this.last;i;i=i.previous)t(i.object,e)},o.prototype.reposition=function(t){if(t.container!==this)return this.add(t.object);var e=t.previous,i=t.next,o=t.object;for(null===i?this.last=e:i.previous=e,null===e?this.first=i:e.next=i;null!==e&&this.cmpFunc(o,e.object)<0;)e=(i=e).previous;for(;null!==i&&0<=this.cmpFunc(o,i.object);)i=(e=i).next;return null===(t.next=i)?this.last=t:i.previous=t,null===(t.previous=e)?this.first=t:e.next=t,t},e.exports=o},{}],5:[function(t,e,i){"use strict";var o=t("util").inherits,n=t("./ISound.js"),s={playAudioWhenScreenIsLocked:!1};function r(){n.call(this);var t=new Audio;t.loop=!1,t.type="audio/mpeg",this._audio=t,this.audioContext&&(this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination))}o(r,n),(e.exports=r).prototype.setVolume=function(t){this.volume=this._audio.volume=t},r.prototype.setLoop=function(t){this.loop=this._audio.loop=t},r.prototype._load=function(){var e=this;function i(t){e._finalizeLoad(t)}function o(){this.removeEventListener("canplaythrough",o),this.removeEventListener("error",n),e.usedMemory=this.duration,e.audioManager.usedMemory+=this.duration,e._finalizeLoad(null)}function n(t){this.removeEventListener("canplaythrough",o),this.removeEventListener("error",n),i(t)}function s(t){e._loading=!0,e._audio.addEventListener("canplaythrough",o),e._audio.addEventListener("error",n),e._audio.src=t,e._audio.load()}var t=this.audioManager.settings.getFileUri,r=this.audioManager.settings.audioPath;if(2<t.length)t(r,this.id,function(t,e){if(t)return i(t);s(e)});else try{var a=t(r,this.id);if(!a)return i("emptyUri");s(a)}catch(t){i(t)}},r.prototype.unload=function(){n.prototype.unload.call(this)&&(this._audio.volume=1,this._audio.src="",this._audio.load())},r.prototype._play=function(t){this._audio.volume=this.volume,this._audio.pause(),this._audio.currentTime=0,this._audio.play(s),this.playing=!0},r.prototype.stop=function(t){return this._audio.pause(),this._audio.currentTime=0,this._playTriggered=0,this.playing=!1,t&&t()}},{"./ISound.js":3,util:87}],6:[function(t,e,i){"use strict";var o=t("util").inherits,n=t("./ISound.js"),s=1e-6;function r(){n.call(this),this.buffer=null,this.source=null,this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._playPitch=0,this._fadeTimeout=null,this._onStopCallback=null,this._audioNodeReady=!1,this._loopStart=0,this._loopEnd=0,this.init()}o(r,n),(e.exports=r).prototype._createAudioNodes=function(){if(!this._audioNodeReady&&this.audioContext){var t,e=this.audioContext,i=e.createGain();t=e.createStereoPanner?e.createStereoPanner():e.createPanner(),i.connect(t),t.connect(e.destination),i.gain.value=0,this.sourceConnector=i,this.gain=i.gain,this.panNode=t,this._audioNodeReady=!0}},r.prototype._destroyAudioNodes=function(){if(this._audioNodeReady){var t=this.audioContext,e=this.panNode,i=this.sourceConnector;i.disconnect(e),e.disconnect(t.destination),this.source&&(this.source.disconnect(i),this.source.onended=null,this.source=null),this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._audioNodeReady=!1}},r.prototype.init=function(){if(this._createAudioNodes(),this.rawAudioData){var e=this,i=this.audioManager.settings.maxPlayLatency;this.audioContext.decodeAudioData(this.rawAudioData,function(t){e.buffer=t,e.usedMemory=t.duration,e.audioManager.usedMemory+=t.duration,e.rawAudioData=null,e._loaded&&e._playTriggered&&((e.loop||Date.now()-e._playTriggered<i)&&e._play(),e._playTriggered=0)},function(){console.error("decode audio failed for sound ",e.id)})}},r.prototype.setVolume=function(t){if(this.volume=t,this.playing)if(this.fade){t<=0&&(t=s);var e=this.audioContext.currentTime;this.gain.cancelScheduledValues(e),this.gain.setValueAtTime(this.gain.value||s,e),this.gain.linearRampToValueAtTime(t,e+this.fade)}else this.gain.value=t},r.prototype.setPan=function(t){this.pan=t,this.panNode&&(this.panNode.pan?this.panNode.pan.value=t:this.panNode.setPosition(t,0,.2))},r.prototype.setLoop=function(t,e,i){this.loop=!!t,this._loopStart=e||0,this._loopEnd=i||0,this.source&&this.buffer&&(this.source.loop=t,this._setLoopPoints())},r.prototype._setLoopPoints=function(){this.source.loopStart=this._loopStart||0;var t=this._loopEnd;t<0&&(t=this.buffer.duration+t),t<0&&(t=0),this.source.loopEnd=t||this.buffer.duration},r.prototype.setPitch=function(t,e){this.pitch=t,this._setPlaybackRate(e)},r.prototype._updatePlayPitch=function(t){!t&&0!==t||t===this._playPitch||(this._playPitch=t,this._setPlaybackRate(0))},r.prototype._setPlaybackRate=function(t){if(this.source){var e=Math.pow(2,(this._playPitch+this.pitch)/12);if(t){var i=this.audioContext.currentTime;this.source.playbackRate.cancelScheduledValues(i),this.source.playbackRate.setValueAtTime(this.source.playbackRate.value||s,i),this.source.playbackRate.linearRampToValueAtTime(e,i+t)}else this.source.playbackRate.value=e}},r.prototype._load=function(){var i=this;function o(t){i._finalizeLoad(t)}function n(t){i.buffer=t,i.usedMemory=t.duration,i.audioManager.usedMemory+=t.duration,i._finalizeLoad(null)}function s(t){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=function(){if(4==~~e.readyState)return 200!=~~e.status&&0!=~~e.status?o("xhrError:"+e.status):void(i.audioContext?i.audioContext.decodeAudioData(e.response,n,o):(i.rawAudioData=e.response,i._finalizeLoad(null)))},e.open("GET",t,!0),e.send()}this._createAudioNodes();var t=this.audioManager.settings.getFileUri,e=this.audioManager.settings.audioPath;if(2<t.length)t(e,this.id,function(t,e){if(t)return o(t);s(e)});else try{var r=t(e,this.id);if(!r)return o("emptyUri");s(r)}catch(t){o(t)}},r.prototype.unload=function(){n.prototype.unload.call(this)&&(this._fadeTimeout&&(this._onStopCallback=null,this._stopAndClear()),this.buffer=null,this.source&&(this.source.onended=null,this.source.stop(0),this.source=null),this._destroyAudioNodes())},r.prototype._play=function(t){if(this.buffer){this.playing=!0;var e=this.audioContext.currentTime;if(this.gain.cancelScheduledValues(e),this.fade?(this.gain.setValueAtTime(this.gain.value||s,e),this.gain.linearRampToValueAtTime(this.volume||s,e+this.fade)):this.gain.value=this.volume,this._fadeTimeout)return this._onStopCallback=null,this.source.onended=null,this.stopping=!1,window.clearTimeout(this._fadeTimeout),void(this._fadeTimeout=null);this.source&&(this.source.disconnect(this.sourceConnector),this.source.onended=null);var i=this.source=this.audioContext.createBufferSource();i.connect(this.sourceConnector);var o=this;i.onended=function(){o.playing=!1,i.onended=null,o.source=null},this._playPitch=t||0,(t||this.pitch)&&this._setPlaybackRate(0),i.loop=this.loop,i.buffer=this.buffer,this._setLoopPoints(),i.start(0)}else this._playTriggered=Date.now()},r.prototype._stopAndClear=function(){this.stopping=!1,this.source.onended=null,this.source.stop(0),this.source=null,this._fadeTimeout&&(window.clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this._onStopCallback&&(this._onStopCallback(),this._onStopCallback=null)},r.prototype.stop=function(t){if(!this.playing&&!this.stopping)return t&&t();if(this._playTriggered=0,this.stopping=!0,this.playing=!1,!this.source)return t&&t();if(this._onStopCallback=t,!this._fadeTimeout){if(this.fade){var e=this,i=this.audioContext.currentTime;return this.gain.cancelScheduledValues(i),this.gain.setValueAtTime(this.gain.value||s,i),this.gain.linearRampToValueAtTime(s,i+this.fade),void(this._fadeTimeout=window.setTimeout(function(){e._fadeTimeout=null,e._stopAndClear()},1e3*this.fade))}this._stopAndClear()}}},{"./ISound.js":3,util:87}],7:[function(t,e,i){"use strict";function o(t,e,i,o,n){this.id=t,this.soundIds=e,this.volumes=i||[],this.pitches=o||[],this.soundIndex=0,this.volIndex=0,this.pitchIndex=0,this.poolRef=null,this._ready=!1,0===this.volumes.length&&this.volumes.push(1),0===this.pitches.length&&this.pitches.push(0),n||this._createSounds()}(e.exports=o).prototype._createSounds=function(){for(var t=this.soundIds,e=0;e<t.length;e++)this.audioManager.loadSound(t[e]);this._ready=!0},o.prototype.play=function(t,e,i){if(0!==this.soundIds.length){this._ready||this._createSounds();var o=this.soundIds[this.soundIndex++],n=this.audioManager.getSound(o);if(!n)return console.warn("[Sound Group: "+this.id+"] sound id "+o+"  cannot be played.");t=t||1,i=i||0,t*=this.volumes[this.volIndex++],i+=this.pitches[this.pitchIndex++],n.play(t,e,i),this.soundIndex>=this.soundIds.length&&(this.soundIndex=0),this.volIndex>=this.volumes.length&&(this.volIndex=0),this.pitchIndex>=this.pitches.length&&(this.pitchIndex=0)}},o.prototype.verifySounds=function(){for(var t=0;t<this.soundIds.length;t++){var e=this.soundIds[t];this.audioManager.createSound(e)}}},{}],8:[function(t,e,i){e.exports={_from:"p2",_id:"p2@0.7.1",_inBundle:!1,_integrity:"sha1-JfJHTZvDptMUCh2iamfJ4RislUM=",_location:"/p2",_phantomChildren:{},_requested:{type:"tag",registry:!0,raw:"p2",name:"p2",escapedName:"p2",rawSpec:"",saveSpec:null,fetchSpec:"latest"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/p2/-/p2-0.7.1.tgz",_shasum:"25f2474d9bc3a6d3140a1da26a67c9e118ac9543",_spec:"p2",_where:"C:\\Dev\\JHax-GameJams\\LD47\\LD47",author:{name:"Stefan Hedman",email:"schteppe@gmail.com",url:"http://steffe.se"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},bundleDependencies:!1,dependencies:{"poly-decomp":"0.1.1"},deprecated:!1,description:"A JavaScript 2D physics engine.",devDependencies:{grunt:"^0.4.5","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0"},engines:{node:"*"},homepage:"https://github.com/schteppe/p2.js#readme",keywords:["p2.js","p2","physics","engine","2d"],licenses:[{type:"MIT"}],main:"./src/p2.js",name:"p2",repository:{type:"git",url:"git+https://github.com/schteppe/p2.js.git"},version:"0.7.1"}},{}],9:[function(t,e,i){"use strict";var d=t("../math/vec2");t("../utils/Utils");function o(t){this.lowerBound=d.create(),t&&t.lowerBound&&d.copy(this.lowerBound,t.lowerBound),this.upperBound=d.create(),t&&t.upperBound&&d.copy(this.upperBound,t.upperBound)}e.exports=o;var f=d.create();o.prototype.setFromPoints=function(t,e,i,o){var n=this.lowerBound,s=this.upperBound;"number"!=typeof i&&(i=0),0!==i?d.rotate(n,t[0],i):d.copy(n,t[0]),d.copy(s,n);for(var r=Math.cos(i),a=Math.sin(i),c=1;c<t.length;c++){var h=t[c];if(0!==i){var l=h[0],u=h[1];f[0]=r*l-a*u,f[1]=a*l+r*u,h=f}for(var p=0;p<2;p++)h[p]>s[p]&&(s[p]=h[p]),h[p]<n[p]&&(n[p]=h[p])}e&&(d.add(this.lowerBound,this.lowerBound,e),d.add(this.upperBound,this.upperBound,e)),o&&(this.lowerBound[0]-=o,this.lowerBound[1]-=o,this.upperBound[0]+=o,this.upperBound[1]+=o)},o.prototype.copy=function(t){d.copy(this.lowerBound,t.lowerBound),d.copy(this.upperBound,t.upperBound)},o.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);var o=t.upperBound[e];this.upperBound[e]<o&&(this.upperBound[e]=o)}},o.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,o=t.lowerBound,n=t.upperBound;return(o[0]<=i[0]&&i[0]<=n[0]||e[0]<=n[0]&&n[0]<=i[0])&&(o[1]<=i[1]&&i[1]<=n[1]||e[1]<=n[1]&&n[1]<=i[1])},o.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},o.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],o=(this.lowerBound[0]-t.from[0])*e,n=(this.upperBound[0]-t.from[0])*e,s=(this.lowerBound[1]-t.from[1])*i,r=(this.upperBound[1]-t.from[1])*i,a=Math.max(Math.max(Math.min(o,n),Math.min(s,r))),c=Math.min(Math.min(Math.max(o,n),Math.max(s,r)));return c<0||c<a?-1:a}},{"../math/vec2":32,"../utils/Utils":59}],10:[function(t,e,i){"use strict";var n=t("../math/vec2"),s=t("../objects/Body");function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}(e.exports=o).AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(t){};var r=n.create();o.boundingRadiusCheck=function(t,e){n.sub(r,t.position,e.position);var i=n.squaredLength(r),o=t.boundingRadius+e.boundingRadius;return i<=o*o},o.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},o.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:i=o.boundingRadiusCheck(t,e);break;case o.AABB:i=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},o.canCollide=function(t,e){var i=s.KINEMATIC,o=s.STATIC;return(t.type!==o||e.type!==o)&&(!(t.type===i&&e.type===o||t.type===o&&e.type===i)&&((t.type!==i||e.type!==i)&&((t.sleepState!==s.SLEEPING||e.sleepState!==s.SLEEPING)&&!(t.sleepState===s.SLEEPING&&e.type===o||e.sleepState===s.SLEEPING&&t.type===o))))},o.NAIVE=1,o.SAP=2},{"../math/vec2":32,"../objects/Body":33}],11:[function(t,e,i){"use strict";t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle");var c=t("../collision/Broadphase");t("../math/vec2");function o(){c.call(this,c.NAIVE)}(((e.exports=o).prototype=new c).constructor=o).prototype.getCollisionPairs=function(t){for(var e=t.bodies,i=this.result,o=i.length=0,n=e.length;o!==n;o++)for(var s=e[o],r=0;r<o;r++){var a=e[r];c.canCollide(s,a)&&this.boundingVolumeCheck(s,a)&&i.push(s,a)}return i},o.prototype.aabbQuery=function(t,e,i){i=i||[];for(var o=t.bodies,n=0;n<o.length;n++){var s=o[n];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&i.push(s)}return i}},{"../collision/Broadphase":10,"../math/vec2":32,"../shapes/Circle":41,"../shapes/Particle":45,"../shapes/Plane":46,"../shapes/Shape":47}],12:[function(t,e,i){"use strict";var D=t("../math/vec2"),U=D.sub,j=D.add,z=D.dot,o=(t("../utils/Utils"),t("../utils/ContactEquationPool")),n=t("../utils/FrictionEquationPool"),s=t("../utils/TupleDictionary"),r=t("../equations/Equation"),a=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),c=t("../shapes/Convex"),h=t("../shapes/Shape"),S=(t("../objects/Body"),t("../shapes/Box"));e.exports=Q;var x=D.fromValues(0,1),X=D.fromValues(0,0),W=D.fromValues(0,0),Y=D.fromValues(0,0),H=D.fromValues(0,0),K=D.fromValues(0,0),R=D.fromValues(0,0),J=D.fromValues(0,0),Z=D.fromValues(0,0),$=D.fromValues(0,0),T=D.fromValues(0,0),V=D.fromValues(0,0),N=D.fromValues(0,0),k=D.fromValues(0,0),O=D.fromValues(0,0),M=D.fromValues(0,0),I=D.fromValues(0,0),L=D.fromValues(0,0),q=D.fromValues(0,0),G=[];function Q(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new o({size:32}),this.frictionEquationPool=new n({size:64}),this.restitution=0,this.stiffness=r.DEFAULT_STIFFNESS,this.relaxation=r.DEFAULT_RELAXATION,this.frictionStiffness=r.DEFAULT_STIFFNESS,this.frictionRelaxation=r.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new s,this.contactSkinSize=.01}var l=D.create(),u=D.create();function b(t,e){D.set(t.vertices[0],.5*-e.length,-e.radius),D.set(t.vertices[1],.5*e.length,-e.radius),D.set(t.vertices[2],.5*e.length,e.radius),D.set(t.vertices[3],.5*-e.length,e.radius)}Q.prototype.bodiesOverlap=function(t,e){for(var i=l,o=u,n=0,s=t.shapes.length;n!==s;n++){var r=t.shapes[n];t.toWorldFrame(i,r.position);for(var a=0,c=e.shapes.length;a!==c;a++){var h=e.shapes[a];if(e.toWorldFrame(o,h.position),this[r.type|h.type](t,r,i,r.angle+t.angle,e,h,o,h.angle+e.angle,!0))return!0}}return!1},Q.prototype.collidedLastStep=function(t,e){var i=0|t.id,o=0|e.id;return!!this.collidingBodiesLastStep.get(i,o)},Q.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],o=i.bodyA.id,n=i.bodyB.id;this.collidingBodiesLastStep.set(o,n,!0)}for(var s=this.contactEquations,r=this.frictionEquations,a=0;a<s.length;a++)this.contactEquationPool.release(s[a]);for(a=0;a<r.length;a++)this.frictionEquationPool.release(r[a]);this.contactEquations.length=this.frictionEquations.length=0},Q.prototype.createContactEquation=function(t,e,i,o){var n=this.contactEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=o,n.restitution=this.restitution,n.firstImpact=!this.collidedLastStep(t,e),n.stiffness=this.stiffness,n.relaxation=this.relaxation,n.needsUpdate=!0,n.enabled=this.enabledEquations,n.offset=this.contactSkinSize,n},Q.prototype.createFrictionEquation=function(t,e,i,o){var n=this.frictionEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=o,n.setSlipForce(this.slipForce),n.frictionCoefficient=this.frictionCoefficient,n.relativeVelocity=this.surfaceVelocity,n.enabled=this.enabledEquations,n.needsUpdate=!0,n.stiffness=this.frictionStiffness,n.relaxation=this.frictionRelaxation,n.contactEquations.length=0,n},Q.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return D.copy(e.contactPointA,t.contactPointA),D.copy(e.contactPointB,t.contactPointB),D.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},Q.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),o=e.bodyA;e.bodyB;D.set(i.contactPointA,0,0),D.set(i.contactPointB,0,0),D.set(i.t,0,0);for(var n=0;n!==t;n++)(e=this.contactEquations[this.contactEquations.length-1-n]).bodyA===o?(D.add(i.t,i.t,e.normalA),D.add(i.contactPointA,i.contactPointA,e.contactPointA),D.add(i.contactPointB,i.contactPointB,e.contactPointB)):(D.sub(i.t,i.t,e.normalA),D.add(i.contactPointA,i.contactPointA,e.contactPointB),D.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var s=1/t;return D.scale(i.contactPointA,i.contactPointA,s),D.scale(i.contactPointB,i.contactPointB,s),D.normalize(i.t,i.t),D.rotate90cw(i.t,i.t),i},Q.prototype[h.LINE|h.CONVEX]=Q.prototype.convexLine=function(t,e,i,o,n,s,r,a,c){return!c&&0},Q.prototype[h.LINE|h.BOX]=Q.prototype.lineBox=function(t,e,i,o,n,s,r,a,c){return!c&&0};var d=new S({width:1,height:1}),f=D.create();Q.prototype[h.CAPSULE|h.CONVEX]=Q.prototype[h.CAPSULE|h.BOX]=Q.prototype.convexCapsule=function(t,e,i,o,n,s,r,a,c){var h=f;D.set(h,s.length/2,0),D.rotate(h,h,a),D.add(h,h,r);var l=this.circleConvex(n,s,h,a,t,e,i,o,c,s.radius);D.set(h,-s.length/2,0),D.rotate(h,h,a),D.add(h,h,r);var u=this.circleConvex(n,s,h,a,t,e,i,o,c,s.radius);if(c&&(l||u))return!0;var p=d;return b(p,s),this.convexConvex(t,e,i,o,n,p,r,a,c)+l+u},Q.prototype[h.CAPSULE|h.LINE]=Q.prototype.lineCapsule=function(t,e,i,o,n,s,r,a,c){return!c&&0};var A=D.create(),E=D.create(),w=new S({width:1,height:1});Q.prototype[h.CAPSULE|h.CAPSULE]=Q.prototype.capsuleCapsule=function(t,e,i,o,n,s,r,a,c){for(var h=A,l=E,u=0,p=0;p<2;p++){D.set(h,(0===p?-1:1)*e.length/2,0),D.rotate(h,h,o),D.add(h,h,i);for(var d=0;d<2;d++){D.set(l,(0===d?-1:1)*s.length/2,0),D.rotate(l,l,a),D.add(l,l,r),this.enableFrictionReduction&&(m=this.enableFriction,this.enableFriction=!1);var f=this.circleCircle(t,e,h,o,n,s,l,a,c,e.radius,s.radius);if(this.enableFrictionReduction&&(this.enableFriction=m),c&&f)return!0;u+=f}}this.enableFrictionReduction&&(m=this.enableFriction,this.enableFriction=!1);var v=w;b(v,e);var y=this.convexCapsule(t,v,i,o,n,s,r,a,c);if(this.enableFrictionReduction&&(this.enableFriction=m),c&&y)return!0;if(u+=y,this.enableFrictionReduction){var m=this.enableFriction;this.enableFriction=!1}b(v,s);var g=this.convexCapsule(n,v,r,a,t,e,i,o,c);return this.enableFrictionReduction&&(this.enableFriction=m),!(!c||!g)||(u+=g,this.enableFrictionReduction&&u&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(u)),u)},Q.prototype[h.LINE|h.LINE]=Q.prototype.lineLine=function(t,e,i,o,n,s,r,a,c){return!c&&0},Q.prototype[h.PLANE|h.LINE]=Q.prototype.planeLine=function(t,e,i,o,n,s,r,a,c){var h=X,l=W,u=Y,p=H,d=K,f=R,v=J,y=Z,m=$,g=G,b=0;D.set(h,-s.length/2,0),D.set(l,s.length/2,0),D.rotate(u,h,a),D.rotate(p,l,a),j(u,u,r),j(p,p,r),D.copy(h,u),D.copy(l,p),U(d,l,h),D.normalize(f,d),D.rotate90cw(m,f),D.rotate(y,x,o),g[0]=h,g[1]=l;for(var A=0;A<g.length;A++){var E=g[A];U(v,E,i);var w=z(v,y);if(w<0){if(c)return!0;var S=this.createContactEquation(t,n,e,s);b++,D.copy(S.normalA,y),D.normalize(S.normalA,S.normalA),D.scale(v,y,w),U(S.contactPointA,E,v),U(S.contactPointA,S.contactPointA,t.position),U(S.contactPointB,E,r),j(S.contactPointB,S.contactPointB,r),U(S.contactPointB,S.contactPointB,n.position),this.contactEquations.push(S),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S))}}return!c&&(this.enableFrictionReduction||b&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(b)),b)},Q.prototype[h.PARTICLE|h.CAPSULE]=Q.prototype.particleCapsule=function(t,e,i,o,n,s,r,a,c){return this.circleLine(t,e,i,o,n,s,r,a,c,s.radius,0)},Q.prototype[h.CIRCLE|h.LINE]=Q.prototype.circleLine=function(t,e,i,o,n,s,r,a,c,h,l){h=h||0,l=void 0!==l?l:e.radius;var u=X,p=W,d=Y,f=H,v=K,y=R,m=J,g=Z,b=$,A=T,E=V,w=N,S=k,x=O,B=G;D.set(g,-s.length/2,0),D.set(b,s.length/2,0),D.rotate(A,g,a),D.rotate(E,b,a),j(A,A,r),j(E,E,r),D.copy(g,A),D.copy(b,E),U(y,b,g),D.normalize(m,y),D.rotate90cw(v,m),U(w,i,g);var P=z(w,v);U(f,g,r),U(S,i,r);var C=l+h;if(Math.abs(P)<C){D.scale(u,v,P),U(d,i,u),D.scale(p,v,z(v,S)),D.normalize(p,p),D.scale(p,p,h),j(d,d,p);var L=z(m,d),q=z(m,g),M=z(m,b);if(q<L&&L<M){if(c)return!0;var I=this.createContactEquation(t,n,e,s);return D.scale(I.normalA,u,-1),D.normalize(I.normalA,I.normalA),D.scale(I.contactPointA,I.normalA,l),j(I.contactPointA,I.contactPointA,i),U(I.contactPointA,I.contactPointA,t.position),U(I.contactPointB,d,r),j(I.contactPointB,I.contactPointB,r),U(I.contactPointB,I.contactPointB,n.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I)),1}}B[0]=g,B[1]=b;for(var _=0;_<B.length;_++){var F=B[_];if(U(w,F,i),D.squaredLength(w)<Math.pow(C,2)){if(c)return!0;I=this.createContactEquation(t,n,e,s);return D.copy(I.normalA,w),D.normalize(I.normalA,I.normalA),D.scale(I.contactPointA,I.normalA,l),j(I.contactPointA,I.contactPointA,i),U(I.contactPointA,I.contactPointA,t.position),U(I.contactPointB,F,r),D.scale(x,I.normalA,-h),j(I.contactPointB,I.contactPointB,x),j(I.contactPointB,I.contactPointB,r),U(I.contactPointB,I.contactPointB,n.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I)),1}}return 0},Q.prototype[h.CIRCLE|h.CAPSULE]=Q.prototype.circleCapsule=function(t,e,i,o,n,s,r,a,c){return this.circleLine(t,e,i,o,n,s,r,a,c,s.radius)},Q.prototype[h.CIRCLE|h.CONVEX]=Q.prototype[h.CIRCLE|h.BOX]=Q.prototype.circleConvex=function(t,e,i,o,n,s,r,a,c,h){h="number"==typeof h?h:e.radius;for(var l=X,u=W,p=Y,d=H,f=K,v=T,y=V,m=k,g=O,b=M,A=I,E=!1,w=Number.MAX_VALUE,S=s.vertices,x=0;x!==S.length+1;x++){var B=S[x%S.length],P=S[(x+1)%S.length];if(D.rotate(l,B,a),D.rotate(u,P,a),j(l,l,r),j(u,u,r),U(p,u,l),D.normalize(d,p),D.rotate90cw(f,d),D.scale(g,f,-e.radius),j(g,g,i),_(g,s,r,a)){D.sub(b,l,g);var C=Math.abs(D.dot(b,f));C<w&&(D.copy(A,g),w=C,D.scale(m,f,C),D.add(m,m,g),E=!0)}}if(E){if(c)return!0;var L=this.createContactEquation(t,n,e,s);return D.sub(L.normalA,A,i),D.normalize(L.normalA,L.normalA),D.scale(L.contactPointA,L.normalA,h),j(L.contactPointA,L.contactPointA,i),U(L.contactPointA,L.contactPointA,t.position),U(L.contactPointB,m,r),j(L.contactPointB,L.contactPointB,r),U(L.contactPointB,L.contactPointB,n.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L)),1}if(0<h)for(x=0;x<S.length;x++){var q=S[x];if(D.rotate(y,q,a),j(y,y,r),U(v,y,i),D.squaredLength(v)<Math.pow(h,2)){if(c)return!0;L=this.createContactEquation(t,n,e,s);return D.copy(L.normalA,v),D.normalize(L.normalA,L.normalA),D.scale(L.contactPointA,L.normalA,h),j(L.contactPointA,L.contactPointA,i),U(L.contactPointA,L.contactPointA,t.position),U(L.contactPointB,y,r),j(L.contactPointB,L.contactPointB,r),U(L.contactPointB,L.contactPointB,n.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L)),1}}return 0};var v=D.create(),y=D.create(),m=D.create(),g=D.create();function _(t,e,i,o){for(var n=v,s=y,r=m,a=g,c=t,h=e.vertices,l=null,u=0;u!==h.length+1;u++){var p=h[u%h.length],d=h[(u+1)%h.length];D.rotate(n,p,o),D.rotate(s,d,o),j(n,n,i),j(s,s,i),U(r,n,c),U(a,s,c);var f=D.crossLength(r,a);if(null===l&&(l=f),f*l<=0)return;l=f}return 1}Q.prototype[h.PARTICLE|h.CONVEX]=Q.prototype[h.PARTICLE|h.BOX]=Q.prototype.particleConvex=function(t,e,i,o,n,s,r,a,c){var h=X,l=W,u=Y,p=H,d=K,f=R,v=J,y=T,m=k,g=L,b=q,A=Number.MAX_VALUE,E=!1,w=s.vertices;if(!_(i,s,r,a))return 0;if(c)return!0;for(var S=0;S!==w.length+1;S++){var x=w[S%w.length],B=w[(S+1)%w.length];D.rotate(h,x,a),D.rotate(l,B,a),j(h,h,r),j(l,l,r),U(u,l,h),D.normalize(p,u),D.rotate90cw(d,p),U(y,i,h);z(y,d);U(f,h,r),U(v,i,r),D.sub(g,h,i);var P=Math.abs(D.dot(g,d));P<A&&(A=P,D.scale(m,d,P),D.add(m,m,i),D.copy(b,d),E=!0)}if(E){var C=this.createContactEquation(t,n,e,s);return D.scale(C.normalA,b,-1),D.normalize(C.normalA,C.normalA),D.set(C.contactPointA,0,0),j(C.contactPointA,C.contactPointA,i),U(C.contactPointA,C.contactPointA,t.position),U(C.contactPointB,m,r),j(C.contactPointB,C.contactPointB,r),U(C.contactPointB,C.contactPointB,n.position),this.contactEquations.push(C),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(C)),1}return 0},Q.prototype[h.CIRCLE]=Q.prototype.circleCircle=function(t,e,i,o,n,s,r,a,c,h,l){var u=X;h=h||e.radius,l=l||s.radius;U(u,i,r);var p=h+l;if(D.squaredLength(u)>Math.pow(p,2))return 0;if(c)return!0;var d=this.createContactEquation(t,n,e,s);return U(d.normalA,r,i),D.normalize(d.normalA,d.normalA),D.scale(d.contactPointA,d.normalA,h),D.scale(d.contactPointB,d.normalA,-l),j(d.contactPointA,d.contactPointA,i),U(d.contactPointA,d.contactPointA,t.position),j(d.contactPointB,d.contactPointB,r),U(d.contactPointB,d.contactPointB,n.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1},Q.prototype[h.PLANE|h.CONVEX]=Q.prototype[h.PLANE|h.BOX]=Q.prototype.planeConvex=function(t,e,i,o,n,s,r,a,c){var h=X,l=W,u=Y,p=0;D.rotate(l,x,o);for(var d=0;d!==s.vertices.length;d++){var f=s.vertices[d];if(D.rotate(h,f,a),j(h,h,r),U(u,h,i),z(u,l)<=0){if(c)return!0;p++;var v=this.createContactEquation(t,n,e,s);U(u,h,i),D.copy(v.normalA,l);var y=z(u,v.normalA);D.scale(u,v.normalA,y),U(v.contactPointB,h,n.position),U(v.contactPointA,h,u),U(v.contactPointA,v.contactPointA,t.position),this.contactEquations.push(v),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v))}}return this.enableFrictionReduction&&this.enableFriction&&p&&this.frictionEquations.push(this.createFrictionFromAverage(p)),p},Q.prototype[h.PARTICLE|h.PLANE]=Q.prototype.particlePlane=function(t,e,i,o,n,s,r,a,c){var h=X,l=W;a=a||0,U(h,i,r),D.rotate(l,x,a);var u=z(h,l);if(0<u)return 0;if(c)return!0;var p=this.createContactEquation(n,t,s,e);return D.copy(p.normalA,l),D.scale(h,p.normalA,u),U(p.contactPointA,i,h),U(p.contactPointA,p.contactPointA,n.position),U(p.contactPointB,i,t.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1},Q.prototype[h.CIRCLE|h.PARTICLE]=Q.prototype.circleParticle=function(t,e,i,o,n,s,r,a,c){var h=X;if(U(h,r,i),D.squaredLength(h)>Math.pow(e.radius,2))return 0;if(c)return!0;var l=this.createContactEquation(t,n,e,s);return D.copy(l.normalA,h),D.normalize(l.normalA,l.normalA),D.scale(l.contactPointA,l.normalA,e.radius),j(l.contactPointA,l.contactPointA,i),U(l.contactPointA,l.contactPointA,t.position),U(l.contactPointB,r,n.position),this.contactEquations.push(l),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(l)),1};var B=new a({radius:1}),P=D.create(),C=D.create();D.create();Q.prototype[h.PLANE|h.CAPSULE]=Q.prototype.planeCapsule=function(t,e,i,o,n,s,r,a,c){var h,l=P,u=C,p=B;D.set(l,-s.length/2,0),D.rotate(l,l,a),j(l,l,r),D.set(u,s.length/2,0),D.rotate(u,u,a),j(u,u,r),p.radius=s.radius,this.enableFrictionReduction&&(h=this.enableFriction,this.enableFriction=!1);var d=this.circlePlane(n,p,l,0,t,e,i,o,c),f=this.circlePlane(n,p,u,0,t,e,i,o,c);if(this.enableFrictionReduction&&(this.enableFriction=h),c)return d||f;var v=d+f;return this.enableFrictionReduction&&v&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v},Q.prototype[h.CIRCLE|h.PLANE]=Q.prototype.circlePlane=function(t,e,i,o,n,s,r,a,c){var h=t,l=e,u=i,p=n,d=r,f=a;f=f||0;var v=X,y=W,m=Y;U(v,u,d),D.rotate(y,x,f);var g=z(y,v);if(g>l.radius)return 0;if(c)return!0;var b=this.createContactEquation(p,h,s,e);return D.copy(b.normalA,y),D.scale(b.contactPointB,b.normalA,-l.radius),j(b.contactPointB,b.contactPointB,u),U(b.contactPointB,b.contactPointB,h.position),D.scale(m,b.normalA,g),U(b.contactPointA,v,m),j(b.contactPointA,b.contactPointA,d),U(b.contactPointA,b.contactPointA,p.position),this.contactEquations.push(b),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(b)),1},Q.prototype[h.CONVEX]=Q.prototype[h.CONVEX|h.BOX]=Q.prototype[h.BOX]=Q.prototype.convexConvex=function(t,e,i,o,n,s,r,a,c,h){var l=X,u=W,p=Y,d=H,f=K,v=J,y=Z,m=$,g=0;h="number"==typeof h?h:0;if(!Q.findSeparatingAxis(e,i,o,s,r,a,l))return 0;U(y,r,i),0<z(l,y)&&D.scale(l,l,-1);var b=Q.getClosestEdge(e,o,l,!0),A=Q.getClosestEdge(s,a,l);if(-1===b||-1===A)return 0;for(var E=0;E<2;E++){var w,S=b,x=A,B=e,P=s,C=i,L=r,q=o,M=a,I=t,_=n;if(0===E)w=S,S=x,x=w,w=B,B=P,P=w,w=C,C=L,L=w,w=q,q=M,M=w,w=I,I=_,_=w;for(var F=x;F<x+2;F++){var R=P.vertices[(F+P.vertices.length)%P.vertices.length];D.rotate(u,R,M),j(u,u,L);for(var T=0,V=S-1;V<S+2;V++){var N=B.vertices[(V+B.vertices.length)%B.vertices.length],k=B.vertices[(V+1+B.vertices.length)%B.vertices.length];D.rotate(p,N,q),D.rotate(d,k,q),j(p,p,C),j(d,d,C),U(f,d,p),D.rotate90cw(m,f),D.normalize(m,m),U(y,u,p);var O=z(m,y);(V===S&&O<=h||V!==S&&O<=0)&&T++}if(3<=T){if(c)return!0;var G=this.createContactEquation(I,_,B,P);g++;N=B.vertices[S%B.vertices.length],k=B.vertices[(S+1)%B.vertices.length];D.rotate(p,N,q),D.rotate(d,k,q),j(p,p,C),j(d,d,C),U(f,d,p),D.rotate90cw(G.normalA,f),D.normalize(G.normalA,G.normalA),U(y,u,p);O=z(G.normalA,y);D.scale(v,G.normalA,O),U(G.contactPointA,u,C),U(G.contactPointA,G.contactPointA,v),j(G.contactPointA,G.contactPointA,C),U(G.contactPointA,G.contactPointA,I.position),U(G.contactPointB,u,L),j(G.contactPointB,G.contactPointB,L),U(G.contactPointB,G.contactPointB,_.position),this.contactEquations.push(G),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G))}}}return this.enableFrictionReduction&&this.enableFriction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g};var F=D.fromValues(0,0);Q.projectConvexOntoAxis=function(t,e,i,o,n){var s,r,a=null,c=null,h=F;D.rotate(h,o,-i);for(var l=0;l<t.vertices.length;l++)s=t.vertices[l],r=z(s,h),(null===a||a<r)&&(a=r),(null===c||r<c)&&(c=r);if(a<c){var u=c;c=a,a=u}var p=z(e,o);D.set(n,c+p,a+p)};var tt=D.fromValues(0,0),et=D.fromValues(0,0),it=D.fromValues(0,0),ot=D.fromValues(0,0),nt=D.fromValues(0,0),st=D.fromValues(0,0);Q.findSeparatingAxis=function(t,e,i,o,n,s,r){var a=null,c=!1,h=!1,l=tt,u=et,p=it,d=ot,f=nt,v=st;if(t instanceof S&&o instanceof S)for(var y=0;2!==y;y++){var m=t,g=i;1===y&&(m=o,g=s);for(var b=0;2!==b;b++){0===b?D.set(d,0,1):1===b&&D.set(d,1,0),0!==g&&D.rotate(d,d,g),Q.projectConvexOntoAxis(t,e,i,d,f),Q.projectConvexOntoAxis(o,n,s,d,v);var A=f,E=v;f[0]>v[0]&&(E=f,A=v,0),c=(w=E[0]-A[1])<=0,(null===a||a<w)&&(D.copy(r,d),a=w,h=c)}}else for(y=0;2!==y;y++){m=t,g=i;1===y&&(m=o,g=s);for(b=0;b!==m.vertices.length;b++){D.rotate(u,m.vertices[b],g),D.rotate(p,m.vertices[(b+1)%m.vertices.length],g),U(l,p,u),D.rotate90cw(d,l),D.normalize(d,d),Q.projectConvexOntoAxis(t,e,i,d,f),Q.projectConvexOntoAxis(o,n,s,d,v);var w;A=f,E=v;f[0]>v[0]&&(E=f,A=v,0),c=(w=E[0]-A[1])<=0,(null===a||a<w)&&(D.copy(r,d),a=w,h=c)}}return h};var p=D.fromValues(0,0),rt=D.fromValues(0,0),at=D.fromValues(0,0);Q.getClosestEdge=function(t,e,i,o){var n=p,s=rt,r=at;D.rotate(n,i,-e),o&&D.scale(n,n,-1);for(var a=-1,c=t.vertices.length,h=-1,l=0;l!==c;l++){U(s,t.vertices[(l+1)%c],t.vertices[l%c]),D.rotate90cw(r,s),D.normalize(r,r);var u=z(r,n);(-1===a||h<u)&&(a=l%c,h=u)}return a};var ct=D.create(),ht=D.create(),lt=D.create(),ut=D.create(),pt=D.create(),dt=D.create(),ft=D.create();Q.prototype[h.CIRCLE|h.HEIGHTFIELD]=Q.prototype.circleHeightfield=function(t,e,i,o,n,s,r,a,c,h){var l=s.heights,u=(h=h||e.radius,s.elementWidth),p=ht,d=ct,f=pt,v=ft,y=dt,m=lt,g=ut,b=Math.floor((i[0]-h-r[0])/u),A=Math.ceil((i[0]+h-r[0])/u);b<0&&(b=0),A>=l.length&&(A=l.length-1);for(var E=l[b],w=l[A],S=b;S<A;S++)l[S]<w&&(w=l[S]),l[S]>E&&(E=l[S]);if(i[1]-h>E)return!c&&0;var x=!1;for(S=b;S<A;S++){D.set(m,S*u,l[S]),D.set(g,(S+1)*u,l[S+1]),D.add(m,m,r),D.add(g,g,r),D.sub(y,g,m),D.rotate(y,y,Math.PI/2),D.normalize(y,y),D.scale(d,y,-h),D.add(d,d,i),D.sub(p,d,m);var B=D.dot(p,y);if(d[0]>=m[0]&&d[0]<g[0]&&B<=0){if(c)return!0;x=!0,D.scale(p,y,-B),D.add(f,d,p),D.copy(v,y);var P=this.createContactEquation(n,t,s,e);D.copy(P.normalA,v),D.scale(P.contactPointB,P.normalA,-h),j(P.contactPointB,P.contactPointB,i),U(P.contactPointB,P.contactPointB,t.position),D.copy(P.contactPointA,f),D.sub(P.contactPointA,P.contactPointA,n.position),this.contactEquations.push(P),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(P))}}if(x=!1,0<h)for(S=b;S<=A;S++)if(D.set(m,S*u,l[S]),D.add(m,m,r),D.sub(p,i,m),D.squaredLength(p)<Math.pow(h,2)){if(c)return!0;x=!0;P=this.createContactEquation(n,t,s,e);D.copy(P.normalA,p),D.normalize(P.normalA,P.normalA),D.scale(P.contactPointB,P.normalA,-h),j(P.contactPointB,P.contactPointB,i),U(P.contactPointB,P.contactPointB,t.position),U(P.contactPointA,m,r),j(P.contactPointA,P.contactPointA,r),U(P.contactPointA,P.contactPointA,n.position),this.contactEquations.push(P),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(P))}return x?1:0};var vt=D.create(),yt=D.create(),mt=D.create(),gt=new c({vertices:[D.create(),D.create(),D.create(),D.create()]});Q.prototype[h.BOX|h.HEIGHTFIELD]=Q.prototype[h.CONVEX|h.HEIGHTFIELD]=Q.prototype.convexHeightfield=function(t,e,i,o,n,s,r,a,c){var h=s.heights,l=s.elementWidth,u=vt,p=yt,d=mt,f=gt,v=Math.floor((t.aabb.lowerBound[0]-r[0])/l),y=Math.ceil((t.aabb.upperBound[0]-r[0])/l);v<0&&(v=0),y>=h.length&&(y=h.length-1);for(var m=h[v],g=h[y],b=v;b<y;b++)h[b]<g&&(g=h[b]),h[b]>m&&(m=h[b]);if(t.aabb.lowerBound[1]>m)return!c&&0;var A=0;for(b=v;b<y;b++){D.set(u,b*l,h[b]),D.set(p,(b+1)*l,h[b+1]),D.add(u,u,r),D.add(p,p,r);D.set(d,.5*(p[0]+u[0]),.5*(p[1]+u[1]-100)),D.sub(f.vertices[0],p,d),D.sub(f.vertices[1],u,d),D.copy(f.vertices[2],f.vertices[1]),D.copy(f.vertices[3],f.vertices[0]),f.vertices[2][1]-=100,f.vertices[3][1]-=100,A+=this.convexConvex(t,e,i,o,n,f,d,0,c)}return A}},{"../equations/ContactEquation":23,"../equations/Equation":24,"../equations/FrictionEquation":25,"../math/vec2":32,"../objects/Body":33,"../shapes/Box":39,"../shapes/Circle":41,"../shapes/Convex":42,"../shapes/Shape":47,"../utils/ContactEquationPool":50,"../utils/FrictionEquationPool":51,"../utils/TupleDictionary":58,"../utils/Utils":59}],13:[function(t,e,i){"use strict";e.exports=r;var c=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB");function r(t){t=t||{},this.from=t.from?c.fromValues(t.from[0],t.from[1]):c.create(),this.to=t.to?c.fromValues(t.to[0],t.to[1]):c.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:r.ANY,this.callback=t.callback||function(t){},this.direction=c.create(),this.length=1,this.update()}(r.prototype.constructor=r).CLOSEST=1,r.ANY=2,r.ALL=4,r.prototype.update=function(){var t=this.direction;c.sub(t,this.to,this.from),this.length=c.length(t),c.normalize(t,t)},r.prototype.intersectBodies=function(t,e){for(var i=0,o=e.length;!t.shouldStop(this)&&i<o;i++){var n=e[i],s=n.getAABB();(0<=s.overlapsRay(this)||s.containsPoint(this.from))&&this.intersectBody(t,n)}};var h=c.create();r.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var o=h,n=0,s=e.shapes.length;n<s;n++){var r=e.shapes[n];if((!i||r.collisionResponse)&&(0!=(this.collisionGroup&r.collisionMask)&&0!=(r.collisionGroup&this.collisionMask))){c.rotate(o,r.position,e.angle),c.add(o,o,e.position);var a=r.angle+e.angle;if(this.intersectShape(t,r,a,o,e),t.shouldStop(this))break}}},r.prototype.intersectShape=function(t,e,i,o,n){(function(t,e,i){c.sub(s,i,t);var o=c.dot(s,e);return c.scale(a,e,o),c.add(a,a,t),c.squaredDistance(i,a)})(this.from,this.direction,o)>e.boundingRadius*e.boundingRadius||(this._currentBody=n,(this._currentShape=e).raycast(t,this,o,i),this._currentBody=this._currentShape=null)},r.prototype.getAABB=function(t){var e=this.to,i=this.from;c.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),c.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};c.create();r.prototype.reportIntersection=function(t,e,i,o){this.from,this.to;var n=this._currentShape,s=this._currentBody;if(!(this.skipBackfaces&&0<c.dot(i,this.direction)))switch(this.mode){case r.ALL:t.set(i,n,s,e,o),this.callback(t);break;case r.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,n,s,e,o);break;case r.ANY:t.set(i,n,s,e,o)}};var s=c.create(),a=c.create()},{"../collision/AABB":9,"../collision/RaycastResult":14,"../math/vec2":32,"../shapes/Shape":47}],14:[function(t,e,i){"use strict";var s=t("../math/vec2"),o=t("../collision/Ray");function n(){this.normal=s.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}(e.exports=n).prototype.reset=function(){s.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},n.prototype.getHitDistance=function(t){return s.distance(t.from,t.to)*this.fraction},n.prototype.hasHit=function(){return-1!==this.fraction},n.prototype.getHitPoint=function(t,e){s.lerp(t,e.from,e.to,this.fraction)},n.prototype.stop=function(){this.isStopped=!0},n.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===o.ANY},n.prototype.set=function(t,e,i,o,n){s.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=o,this.faceIndex=n}},{"../collision/Ray":13,"../math/vec2":32}],15:[function(t,e,i){"use strict";var o=t("../utils/Utils"),u=t("../collision/Broadphase");function n(){u.call(this,u.SAP),this.axisList=[],this.axisIndex=0;var i=this;this._addBodyHandler=function(t){i.axisList.push(t.body)},this._removeBodyHandler=function(t){var e=i.axisList.indexOf(t.body);-1!==e&&i.axisList.splice(e,1)}}(((e.exports=n).prototype=new u).constructor=n).prototype.setWorld=function(t){this.axisList.length=0,o.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},n.sortAxisList=function(t,e){e|=0;for(var i=1,o=t.length;i<o;i++){for(var n=t[i],s=i-1;0<=s&&!(t[s].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);s--)t[s+1]=t[s];t[s+1]=n}return t},n.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;n.sortAxisList(t,e)},n.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,o=this.axisIndex;i.length=0;for(var n=e.length;n--;){var s=e[n];s.aabbNeedsUpdate&&s.updateAABB()}this.sortList();for(var r=0,a=0|e.length;r!==a;r++)for(var c=e[r],h=r+1;h<a;h++){var l=e[h];if(!(l.aabb.lowerBound[o]<=c.aabb.upperBound[o]))break;u.canCollide(c,l)&&this.boundingVolumeCheck(c,l)&&i.push(c,l)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();var o=this.axisIndex,n="x";1===o&&(n="y"),2===o&&(n="z");for(var s=this.axisList,r=(e.lowerBound[n],e.upperBound[n],0);r<s.length;r++){var a=s[r];a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(e)&&i.push(a)}return i}},{"../collision/Broadphase":10,"../utils/Utils":59}],16:[function(t,e,i){"use strict";e.exports=o;var n=t("../utils/Utils");function o(t,e,i,o){this.type=i,o=n.defaults(o,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=o.collideConnected,o.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.DISTANCE=1,o.GEAR=2,o.LOCK=3,o.PRISMATIC=4,o.REVOLUTE=5,o.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.stiffness=t,o.needsUpdate=!0}},o.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.relaxation=t,o.needsUpdate=!0}}},{"../utils/Utils":59}],17:[function(t,e,i){"use strict";var d=t("./Constraint"),f=t("../equations/Equation"),v=t("../math/vec2"),y=t("../utils/Utils");function o(t,e,i){i=y.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),d.call(this,t,e,d.DISTANCE,i),this.localAnchorA=v.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=v.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var o,n=this.localAnchorA,s=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var r=v.create(),a=v.create(),c=v.create();v.rotate(r,n,t.angle),v.rotate(a,s,e.angle),v.add(c,e.position,a),v.sub(c,c,r),v.sub(c,c,t.position),this.distance=v.length(c)}o=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce;var h=new f(t,e,-o,o);this.equations=[h],this.maxForce=o;c=v.create();var l=v.create(),u=v.create(),p=this;h.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,o=e.position;return v.rotate(l,n,t.angle),v.rotate(u,s,e.angle),v.add(c,o,u),v.sub(c,c,l),v.sub(c,c,i),v.length(c)-p.distance},this.setMaxForce(o),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}((e.exports=o).prototype=new d).constructor=o;var l=v.create(),u=v.create(),p=v.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,o=(this.distance,e.position),n=i.position,s=this.equations[0],r=t.G;v.rotate(u,this.localAnchorA,e.angle),v.rotate(p,this.localAnchorB,i.angle),v.add(l,n,p),v.sub(l,l,u),v.sub(l,l,o),this.position=v.length(l);var a=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(s.maxForce=0,s.minForce=-this.maxForce,this.distance=this.upperLimit,a=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(s.maxForce=this.maxForce,s.minForce=0,this.distance=this.lowerLimit,a=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||a){s.enabled=!0,v.normalize(l,l);var c=v.crossLength(u,l),h=v.crossLength(p,l);r[0]=-l[0],r[1]=-l[1],r[2]=-c,r[3]=l[0],r[4]=l[1],r[5]=h}else s.enabled=!1},o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":24,"../math/vec2":32,"../utils/Utils":59,"./Constraint":16}],18:[function(t,e,i){"use strict";var o=t("./Constraint"),n=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2");function s(t,e,i){i=i||{},o.call(this,t,e,o.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new n(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}(((e.exports=s).prototype=new o).constructor=s).prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},s.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},s.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":22,"../equations/Equation":24,"../math/vec2":32,"./Constraint":16}],19:[function(t,e,i){"use strict";var p=t("./Constraint"),d=t("../math/vec2"),f=t("../equations/Equation");function o(t,e,i){i=i||{},p.call(this,t,e,p.LOCK,i);var o=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce,n=(i.localAngleB,new f(t,e,-o,o)),s=new f(t,e,-o,o),r=new f(t,e,-o,o),a=d.create(),c=d.create(),h=this;n.computeGq=function(){return d.rotate(a,h.localOffsetB,t.angle),d.sub(c,e.position,t.position),d.sub(c,c,a),c[0]},s.computeGq=function(){return d.rotate(a,h.localOffsetB,t.angle),d.sub(c,e.position,t.position),d.sub(c,c,a),c[1]};var l=d.create(),u=d.create();r.computeGq=function(){return d.rotate(l,h.localOffsetB,e.angle-h.localAngleB),d.scale(l,l,-1),d.sub(c,t.position,e.position),d.add(c,c,l),d.rotate(u,l,-Math.PI/2),d.normalize(u,u),d.dot(c,u)},this.localOffsetB=d.create(),i.localOffsetB?d.copy(this.localOffsetB,i.localOffsetB):(d.sub(this.localOffsetB,e.position,t.position),d.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(n,s,r),this.setMaxForce(o)}(((e.exports=o).prototype=new p).constructor=o).prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=d.create(),r=d.create(),a=d.create(),c=d.fromValues(1,0),h=d.fromValues(0,1);o.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],o=this.bodyA,n=this.bodyB;d.rotate(s,this.localOffsetB,o.angle),d.rotate(r,this.localOffsetB,n.angle-this.localAngleB),d.scale(r,r,-1),d.rotate(a,r,Math.PI/2),d.normalize(a,a),t.G[0]=-1,t.G[1]=0,t.G[2]=-d.crossLength(s,c),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-d.crossLength(s,h),e.G[4]=1,i.G[0]=-a[0],i.G[1]=-a[1],i.G[3]=a[0],i.G[4]=a[1],i.G[5]=d.crossLength(r,a)}},{"../equations/Equation":24,"../math/vec2":32,"./Constraint":16}],20:[function(t,e,i){"use strict";var v=t("./Constraint"),y=t("../equations/ContactEquation"),m=t("../equations/Equation"),g=t("../math/vec2"),b=t("../equations/RotationalLockEquation");function o(o,n,t){t=t||{},v.call(this,o,n,v.PRISMATIC,t);var s=g.fromValues(0,0),r=g.fromValues(1,0),a=g.fromValues(0,0);t.localAnchorA&&g.copy(s,t.localAnchorA),t.localAxisA&&g.copy(r,t.localAxisA),t.localAnchorB&&g.copy(a,t.localAnchorB),this.localAnchorA=s,this.localAnchorB=a,this.localAxisA=r;var e=this.maxForce=void 0!==t.maxForce?t.maxForce:Number.MAX_VALUE,i=new m(o,n,-e,e),c=new g.create,h=new g.create,l=new g.create,u=new g.create;if(i.computeGq=function(){return g.dot(l,u)},i.updateJacobian=function(){var t=this.G,e=o.position,i=n.position;g.rotate(c,s,o.angle),g.rotate(h,a,n.angle),g.add(l,i,h),g.sub(l,l,e),g.sub(l,l,c),g.rotate(u,r,o.angle+Math.PI/2),t[0]=-u[0],t[1]=-u[1],t[2]=-g.crossLength(c,u)+g.crossLength(u,l),t[3]=u[0],t[4]=u[1],t[5]=g.crossLength(h,u)},this.equations.push(i),!t.disableRotationalLock){var p=new b(o,n,-e,e);this.equations.push(p)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==t.lowerLimit,this.upperLimitEnabled=void 0!==t.upperLimit,this.lowerLimit=void 0!==t.lowerLimit?t.lowerLimit:0,this.upperLimit=void 0!==t.upperLimit?t.upperLimit:1,this.upperLimitEquation=new y(o,n),this.lowerLimitEquation=new y(o,n),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=e,this.motorEquation=new m(o,n),this.motorEnabled=!1,this.motorSpeed=0;var d=this,f=this.motorEquation;f.computeGW;f.computeGq=function(){return 0},f.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,n=i.velocity,s=e.angularVelocity,r=i.angularVelocity;return this.gmult(t,o,s,n,r)+d.motorSpeed}}((e.exports=o).prototype=new v).constructor=o;var f=g.create(),A=g.create(),E=g.create(),w=g.create(),S=g.create(),x=g.create();o.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,o=this.lowerLimit,n=this.upperLimitEquation,s=this.lowerLimitEquation,r=this.bodyA,a=this.bodyB,c=this.localAxisA,h=this.localAnchorA,l=this.localAnchorB;e.updateJacobian(),g.rotate(f,c,r.angle),g.rotate(w,h,r.angle),g.add(A,w,r.position),g.rotate(S,l,a.angle),g.add(E,S,a.position);var u,p=this.position=g.dot(E,f)-g.dot(A,f);if(this.motorEnabled){var d=this.motorEquation.G;d[0]=f[0],d[1]=f[1],d[2]=g.crossLength(f,S),d[3]=-f[0],d[4]=-f[1],d[5]=-g.crossLength(f,w)}this.upperLimitEnabled&&i<p?(g.scale(n.normalA,f,-1),g.sub(n.contactPointA,A,r.position),g.sub(n.contactPointB,E,a.position),g.scale(x,f,i),g.add(n.contactPointA,n.contactPointA,x),-1===t.indexOf(n)&&t.push(n)):-1!==(u=t.indexOf(n))&&t.splice(u,1);this.lowerLimitEnabled&&p<o?(g.scale(s.normalA,f,1),g.sub(s.contactPointA,A,r.position),g.sub(s.contactPointB,E,a.position),g.scale(x,f,o),g.sub(s.contactPointB,s.contactPointB,x),-1===t.indexOf(s)&&t.push(s)):-1!==(u=t.indexOf(s))&&t.splice(u,1)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":23,"../equations/Equation":24,"../equations/RotationalLockEquation":26,"../math/vec2":32,"./Constraint":16}],21:[function(t,e,i){"use strict";var c=t("./Constraint"),h=t("../equations/Equation"),l=t("../equations/RotationalVelocityEquation"),u=t("../equations/RotationalLockEquation"),d=t("../math/vec2");e.exports=o;var f=d.create(),v=d.create(),y=d.fromValues(1,0),m=d.fromValues(0,1),p=d.create();function o(t,e,i){i=i||{},c.call(this,t,e,c.REVOLUTE,i);var o=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=d.create(),this.pivotB=d.create(),i.worldPivot?(d.sub(this.pivotA,i.worldPivot,t.position),d.sub(this.pivotB,i.worldPivot,e.position),d.rotate(this.pivotA,this.pivotA,-t.angle),d.rotate(this.pivotB,this.pivotB,-e.angle)):(d.copy(this.pivotA,i.localPivotA),d.copy(this.pivotB,i.localPivotB));var n=this.equations=[new h(t,e,-o,o),new h(t,e,-o,o)],s=n[0],r=n[1],a=this;s.computeGq=function(){return d.rotate(f,a.pivotA,t.angle),d.rotate(v,a.pivotB,e.angle),d.add(p,e.position,v),d.sub(p,p,t.position),d.sub(p,p,f),d.dot(p,y)},r.computeGq=function(){return d.rotate(f,a.pivotA,t.angle),d.rotate(v,a.pivotB,e.angle),d.add(p,e.position,v),d.sub(p,p,t.position),d.sub(p,p,f),d.dot(p,m)},r.minForce=s.minForce=-o,r.maxForce=s.maxForce=o,this.motorEquation=new l(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new u(t,e),this.lowerLimitEquation=new u(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}((o.prototype=new c).constructor=o).prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},o.prototype.update=function(){var t,e=this.bodyA,i=this.bodyB,o=this.pivotA,n=this.pivotB,s=this.equations,r=(s[0],s[1],s[0]),a=s[1],c=this.upperLimit,h=this.lowerLimit,l=this.upperLimitEquation,u=this.lowerLimitEquation,p=this.angle=i.angle-e.angle;this.upperLimitEnabled&&c<p?(l.angle=c,-1===s.indexOf(l)&&s.push(l)):-1!==(t=s.indexOf(l))&&s.splice(t,1);this.lowerLimitEnabled&&p<h?(u.angle=h,-1===s.indexOf(u)&&s.push(u)):-1!==(t=s.indexOf(u))&&s.splice(t,1);d.rotate(f,o,e.angle),d.rotate(v,n,i.angle),r.G[0]=-1,r.G[1]=0,r.G[2]=-d.crossLength(f,y),r.G[3]=1,r.G[4]=0,r.G[5]=d.crossLength(v,y),a.G[0]=0,a.G[1]=-1,a.G[2]=-d.crossLength(f,m),a.G[3]=0,a.G[4]=1,a.G[5]=d.crossLength(v,m)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.motorIsEnabled=function(){return!!this.motorEnabled},o.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},o.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":24,"../equations/RotationalLockEquation":26,"../equations/RotationalVelocityEquation":27,"../math/vec2":32,"./Constraint":16}],22:[function(t,e,i){"use strict";var o=t("./Equation");t("../math/vec2");function n(t,e,i){i=i||{},o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}(((e.exports=n).prototype=new o).constructor=n).prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},n.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},n.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":32,"./Equation":24}],23:[function(t,e,i){"use strict";var o=t("./Equation"),y=t("../math/vec2");function n(t,e){o.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=y.create(),this.penetrationVec=y.create(),this.contactPointB=y.create(),this.normalA=y.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}(((e.exports=n).prototype=new o).constructor=n).prototype.computeB=function(t,e,i){var o,n,s=this.bodyA,r=this.bodyB,a=this.contactPointA,c=this.contactPointB,h=s.position,l=r.position,u=this.penetrationVec,p=this.normalA,d=this.G,f=y.crossLength(a,p),v=y.crossLength(c,p);return d[0]=-p[0],d[1]=-p[1],d[2]=-f,d[3]=p[0],d[4]=p[1],d[5]=v,y.add(u,l,c),y.sub(u,u,h),y.sub(u,u,a),o=this.firstImpact&&0!==this.restitution?(n=0,1/e*(1+this.restitution)*this.computeGW()):(n=y.dot(p,u)+this.offset,this.computeGW()),-n*t-o*e-i*this.computeGiMf()};var s=y.create(),r=y.create(),a=y.create();n.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(s,this.contactPointA),this.bodyB.getVelocityAtPoint(r,this.contactPointB),y.subtract(a,s,r),y.dot(this.normalA,a)}},{"../math/vec2":32,"./Equation":24}],24:[function(t,e,i){"use strict";e.exports=r;var u=t("../math/vec2"),s=t("../utils/Utils");t("../objects/Body");function r(t,e,i,o){this.minForce=void 0===i?-Number.MAX_VALUE:i,this.maxForce=void 0===o?Number.MAX_VALUE:o,this.bodyA=t,this.bodyB=e,this.stiffness=r.DEFAULT_STIFFNESS,this.relaxation=r.DEFAULT_RELAXATION,this.G=new s.ARRAY_TYPE(6);for(var n=0;n<6;n++)this.G[n]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}(r.prototype.constructor=r).DEFAULT_STIFFNESS=1e6,r.DEFAULT_RELAXATION=4,r.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},r.prototype.gmult=function(t,e,i,o,n){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*o[0]+t[4]*o[1]+t[5]*n},r.prototype.computeB=function(t,e,i){var o=this.computeGW();return-this.computeGq()*t-o*e-this.computeGiMf()*i};var a=u.create(),c=u.create();r.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=(e.position,i.position,e.angle),n=i.angle;return this.gmult(t,a,o,c,n)+this.offset},r.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,n=i.velocity,s=e.angularVelocity,r=i.angularVelocity;return this.gmult(t,o,s,n,r)+this.relativeVelocity},r.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.vlambda,n=i.vlambda,s=e.wlambda,r=i.wlambda;return this.gmult(t,o,s,n,r)};var p=u.create(),d=u.create();r.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,o=t.angularForce,n=e.force,s=e.angularForce,r=t.invMassSolve,a=e.invMassSolve,c=t.invInertiaSolve,h=e.invInertiaSolve,l=this.G;return u.scale(p,i,r),u.multiply(p,t.massMultiplier,p),u.scale(d,n,a),u.multiply(d,e.massMultiplier,d),this.gmult(l,p,o*c,d,s*h)},r.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,o=e.invMassSolve,n=t.invInertiaSolve,s=e.invInertiaSolve,r=this.G;return r[0]*r[0]*i*t.massMultiplier[0]+r[1]*r[1]*i*t.massMultiplier[1]+r[2]*r[2]*n+r[3]*r[3]*o*e.massMultiplier[0]+r[4]*r[4]*o*e.massMultiplier[1]+r[5]*r[5]*s};var f=u.create(),v=u.create(),y=u.create();u.create(),u.create(),u.create();r.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,o=f,n=v,s=y,r=e.invMassSolve,a=i.invMassSolve,c=e.invInertiaSolve,h=i.invInertiaSolve,l=this.G;n[0]=l[0],n[1]=l[1],s[0]=l[3],s[1]=l[4],u.scale(o,n,r*t),u.multiply(o,o,e.massMultiplier),u.add(e.vlambda,e.vlambda,o),e.wlambda+=c*l[2]*t,u.scale(o,s,a*t),u.multiply(o,o,i.massMultiplier),u.add(i.vlambda,i.vlambda,o),i.wlambda+=h*l[5]*t},r.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":32,"../objects/Body":33,"../utils/Utils":59}],25:[function(t,e,i){"use strict";var a=t("../math/vec2"),o=t("./Equation");t("../utils/Utils");function n(t,e,i){o.call(this,t,e,-i,i),this.contactPointA=a.create(),this.contactPointB=a.create(),this.t=a.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}(((e.exports=n).prototype=new o).constructor=n).prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},n.prototype.getSlipForce=function(){return this.maxForce},n.prototype.computeB=function(t,e,i){this.bodyA,this.bodyB;var o=this.contactPointA,n=this.contactPointB,s=this.t,r=this.G;return r[0]=-s[0],r[1]=-s[1],r[2]=-a.crossLength(o,s),r[3]=s[0],r[4]=s[1],r[5]=a.crossLength(n,s),-this.computeGW()*e-i*this.computeGiMf()}},{"../math/vec2":32,"../utils/Utils":59,"./Equation":24}],26:[function(t,e,i){"use strict";var n=t("./Equation"),o=t("../math/vec2");function s(t,e,i){i=i||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var o=this.G;o[2]=1,o[5]=-1}((e.exports=s).prototype=new n).constructor=s;var r=o.create(),a=o.create(),c=o.fromValues(1,0),h=o.fromValues(0,1);s.prototype.computeGq=function(){return o.rotate(r,c,this.bodyA.angle+this.angle),o.rotate(a,h,this.bodyB.angle),o.dot(r,a)}},{"../math/vec2":32,"./Equation":24}],27:[function(t,e,i){"use strict";var o=t("./Equation");t("../math/vec2");function n(t,e){o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}(((e.exports=n).prototype=new o).constructor=n).prototype.computeB=function(t,e,i){var o=this.G;o[2]=-1,o[5]=this.ratio;var n=this.computeGiMf();return-this.computeGW()*e-i*n}},{"../math/vec2":32,"./Equation":24}],28:[function(t,e,i){"use strict";function o(){}(e.exports=o).prototype={constructor:o,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[t]&&(o[t]=[]),-1===o[t].indexOf(e)&&o[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&-1!==i[t].indexOf(e))return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,o=i[t].indexOf(e);return-1!==o&&i[t].splice(o,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=0,o=e.length;i<o;i++){var n=e[i];n.call(n.context,t)}}return this}}},{}],29:[function(t,e,i){"use strict";var o=t("./Material"),n=t("../equations/Equation");function s(t,e,i){if(i=i||{},!(t instanceof o&&e instanceof o))throw new Error("First two arguments must be Material instances.");this.id=s.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==i.friction?Number(i.friction):.3,this.restitution=void 0!==i.restitution?Number(i.restitution):0,this.stiffness=void 0!==i.stiffness?Number(i.stiffness):n.DEFAULT_STIFFNESS,this.relaxation=void 0!==i.relaxation?Number(i.relaxation):n.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==i.frictionStiffness?Number(i.frictionStiffness):n.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==i.frictionRelaxation?Number(i.frictionRelaxation):n.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}(e.exports=s).idCounter=0},{"../equations/Equation":24,"./Material":30}],30:[function(t,e,i){"use strict";function o(t){this.id=t||o.idCounter++}(e.exports=o).idCounter=0},{}],31:[function(t,e,i){"use strict";var g={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,o=0;o<e;o+=2)i+=(t[o+2]-t[o])*(t[o+1]+t[o+3]);return.5*-(i+=(t[0]-t[e])*(t[1+e]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],o=[],n=0;n<e;n++)o.push(n);n=0;for(var s=e;3<s;){var r=o[(n+0)%s],a=o[(n+1)%s],c=o[(n+2)%s],h=t[2*r],l=t[2*r+1],u=t[2*a],p=t[2*a+1],d=t[2*c],f=t[2*c+1],v=!1;if(g._convex(h,l,u,p,d,f)){v=!0;for(var y=0;y<s;y++){var m=o[y];if(m!=r&&m!=a&&m!=c&&g._PointInTriangle(t[2*m],t[2*m+1],h,l,u,p,d,f)){v=!1;break}}}if(v)i.push(r,a,c),o.splice((n+1)%s,1),s--,n=0;else if(n++>3*s)break}return i.push(o[0],o[1],o[2]),i},_PointInTriangle:function(t,e,i,o,n,s,r,a){var c=r-i,h=a-o,l=n-i,u=s-o,p=t-i,d=e-o,f=c*c+h*h,v=c*l+h*u,y=c*p+h*d,m=l*l+u*u,g=l*p+u*d,b=1/(f*m-v*v),A=(m*y-v*g)*b,E=(f*g-v*y)*b;return 0<=A&&0<=E&&A+E<1},_convex:function(t,e,i,o,n,s){return 0<=(e-o)*(n-i)+(i-t)*(s-o)}};e.exports=g},{}],32:[function(t,e,i){"use strict";var r=e.exports={},o=t("../utils/Utils");r.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},r.crossVZ=function(t,e,i){return r.rotate(t,e,-Math.PI/2),r.scale(t,t,i),t},r.crossZV=function(t,e,i){return r.rotate(t,i,Math.PI/2),r.scale(t,t,e),t},r.rotate=function(t,e,i){if(0!==i){var o=Math.cos(i),n=Math.sin(i),s=e[0],r=e[1];t[0]=o*s-n*r,t[1]=n*s+o*r}else t[0]=e[0],t[1]=e[1]},r.rotate90cw=function(t,e){var i=e[0],o=e[1];t[0]=o,t[1]=-i},r.toLocalFrame=function(t,e,i,o){r.copy(t,e),r.sub(t,t,i),r.rotate(t,t,-o)},r.toGlobalFrame=function(t,e,i,o){r.copy(t,e),r.rotate(t,t,o),r.add(t,t,i)},r.vectorToLocalFrame=function(t,e,i){r.rotate(t,e,-i)},r.vectorToGlobalFrame=function(t,e,i){r.rotate(t,e,i)},r.centroid=function(t,e,i,o){return r.add(t,e,i),r.add(t,t,o),r.scale(t,t,1/3),t},r.create=function(){var t=new o.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},r.clone=function(t){var e=new o.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},r.fromValues=function(t,e){var i=new o.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},r.set=function(t,e,i){return t[0]=e,t[1]=i,t},r.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},r.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},r.sub=r.subtract,r.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},r.mul=r.multiply,r.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},r.div=r.divide,r.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},r.distance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(i*i+o*o)},r.dist=r.distance,r.squaredDistance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},r.len=r.length,r.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},r.normalize=function(t,e){var i=e[0],o=e[1],n=i*i+o*o;return 0<n&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},r.lerp=function(t,e,i,o){var n=e[0],s=e[1];return t[0]=n+o*(i[0]-n),t[1]=s+o*(i[1]-s),t},r.reflect=function(t,e,i){var o=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*o,t[1]=e[1]-2*i[1]*o},r.getLineSegmentsIntersection=function(t,e,i,o,n){var s=r.getLineSegmentsIntersectionFraction(e,i,o,n);return!(s<0)&&(t[0]=e[0]+s*(i[0]-e[0]),t[1]=e[1]+s*(i[1]-e[1]),!0)},r.getLineSegmentsIntersectionFraction=function(t,e,i,o){var n,s,r=e[0]-t[0],a=e[1]-t[1],c=o[0]-i[0],h=o[1]-i[1];return n=(-a*(t[0]-i[0])+r*(t[1]-i[1]))/(-c*a+r*h),s=(c*(t[1]-i[1])-h*(t[0]-i[0]))/(-c*a+r*h),0<=n&&n<=1&&0<=s&&s<=1?s:-1}},{"../utils/Utils":59}],33:[function(t,e,i){"use strict";var u=t("../math/vec2"),h=t("poly-decomp"),l=t("../shapes/Convex"),o=t("../collision/RaycastResult"),n=t("../collision/Ray"),s=t("../collision/AABB"),r=t("../events/EventEmitter");function a(t){t=t||{},r.call(this),this.id=t.id||++a._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=u.create(),this.position=u.fromValues(0,0),t.position&&u.copy(this.position,t.position),this.interpolatedPosition=u.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=u.fromValues(0,0),this.previousAngle=0,this.velocity=u.fromValues(0,0),t.velocity&&u.copy(this.velocity,t.velocity),this.vlambda=u.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=u.create(),t.force&&u.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=a.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=a.DYNAMIC:this.type=a.STATIC,this.boundingRadius=0,this.aabb=new s,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=a.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}(((e.exports=a).prototype=new r).constructor=a)._idCounter=0,a.prototype.updateSolveMassProperties=function(){this.sleepState===a.SLEEPING||this.type===a.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},a.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},a.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},a.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var c=new s,p=u.create();a.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=p,o=this.angle,n=0;n!==e;n++){var s=t[n],r=s.angle+o;u.rotate(i,s.position,o),u.add(i,i,this.position),s.computeAABB(c,i,r),0===n?this.aabb.copy(c):this.aabb.extend(c)}this.aabbNeedsUpdate=!1},a.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,o=0;o!==e;o++){var n=t[o],s=u.length(n.position),r=n.boundingRadius;i<s+r&&(i=s+r)}this.boundingRadius=i},a.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?u.copy(t.position,e):u.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},a.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,!(t.body=null))},a.prototype.updateMassProperties=function(){if(this.type===a.STATIC||this.type===a.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,o=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var n=0;n<e;n++){var s=t[n],r=u.squaredLength(s.position);o+=s.computeMomentOfInertia(i)+i*r}this.inertia=o,this.invInertia=0<o?1/o:0}this.invMass=1/this.mass,u.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};u.create();a.prototype.applyForce=function(t,e){if(u.add(this.force,this.force,t),e){var i=u.crossLength(e,t);this.angularForce+=i}};var d=u.create(),f=u.create(),v=u.create();a.prototype.applyForceLocal=function(t,e){e=e||v;var i=d,o=f;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyForce(i,o)};var y=u.create();a.prototype.applyImpulse=function(t,e){if(this.type===a.DYNAMIC){var i=y;if(u.scale(i,t,this.invMass),u.multiply(i,this.massMultiplier,i),u.add(this.velocity,i,this.velocity),e){var o=u.crossLength(e,t);o*=this.invInertia,this.angularVelocity+=o}}};var m=u.create(),g=u.create(),b=u.create();a.prototype.applyImpulseLocal=function(t,e){e=e||b;var i=m,o=g;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyImpulse(i,o)},a.prototype.toLocalFrame=function(t,e){u.toLocalFrame(t,e,this.position,this.angle)},a.prototype.toWorldFrame=function(t,e){u.toGlobalFrame(t,e,this.position,this.angle)},a.prototype.vectorToLocalFrame=function(t,e){u.vectorToLocalFrame(t,e,this.angle)},a.prototype.vectorToWorldFrame=function(t,e){u.vectorToGlobalFrame(t,e,this.angle)},a.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;0<=i;--i)this.removeShape(this.shapes[i]);var o,n=new h.Polygon;if(n.vertices=t,n.makeCCW(),"number"==typeof e.removeCollinearPoints&&n.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!n.isSimple())return!1;this.concavePath=n.vertices.slice(0);for(i=0;i<this.concavePath.length;i++){var s=[0,0];u.copy(s,this.concavePath[i]),this.concavePath[i]=s}o=e.optimalDecomp?n.decomp():n.quickDecomp();var r=u.create();for(i=0;i!==o.length;i++){for(var a=new l({vertices:o[i].vertices}),c=0;c!==a.vertices.length;c++){s=a.vertices[c];u.sub(s,s,a.centerOfMass)}u.scale(r,a.centerOfMass,1),a.updateTriangles(),a.updateCenterOfMass(),a.updateBoundingRadius(),this.addShape(a,r)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0};u.fromValues(0,0);var A=u.fromValues(0,0),E=u.fromValues(0,0),w=u.fromValues(0,0);a.prototype.adjustCenterOfMass=function(){var t=A,e=E,i=w,o=0;u.set(e,0,0);for(var n=0;n!==this.shapes.length;n++){var s=this.shapes[n];u.scale(t,s.position,s.area),u.add(e,e,t),o+=s.area}u.scale(i,e,1/o);for(n=0;n!==this.shapes.length;n++){s=this.shapes[n];u.sub(s.position,s.position,i)}u.add(this.position,this.position,i);for(n=0;this.concavePath&&n<this.concavePath.length;n++)u.sub(this.concavePath[n],this.concavePath[n],i);this.updateMassProperties(),this.updateBoundingRadius()},a.prototype.setZeroForce=function(){u.set(this.force,0,0),this.angularForce=0},a.prototype.resetConstraintVelocity=function(){var t=this.vlambda;u.set(t,0,0),this.wlambda=0},a.prototype.addConstraintVelocity=function(){var t=this.velocity;u.add(t,t,this.vlambda),this.angularVelocity+=this.wlambda},a.prototype.applyDamping=function(t){if(this.type===a.DYNAMIC){var e=this.velocity;u.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},a.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=a.AWAKE,this.idleTime=0,t!==a.AWAKE&&this.emit(a.wakeUpEvent)},a.prototype.sleep=function(){this.sleepState=a.SLEEPING,this.angularVelocity=0,this.angularForce=0,u.set(this.velocity,0,0),u.set(this.force,0,0),this.emit(a.sleepEvent)},a.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==a.SLEEPING){this.wantsToSleep=!1;this.sleepState;var o=u.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2);Math.pow(this.sleepSpeedLimit,2)<=o?(this.idleTime=0,this.sleepState=a.AWAKE):(this.idleTime+=i,this.sleepState=a.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},a.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var S=u.create(),x=u.create();a.prototype.integrate=function(t){var e=this.invMass,i=this.force,o=this.position,n=this.velocity;u.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),u.scale(S,i,t*e),u.multiply(S,this.massMultiplier,S),u.add(n,S,n),this.integrateToTimeOfImpact(t)||(u.scale(x,n,t),u.add(o,o,x),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var B=new o,P=new n({mode:n.ALL}),C=u.create(),L=u.create(),q=u.create(),M=u.create();a.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||u.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;u.normalize(C,this.velocity),u.scale(L,this.velocity,t),u.add(L,L,this.position),u.sub(q,L,this.position);var e,i=this.angularVelocity*t,o=u.length(q),n=1,s=this;if(B.reset(),P.callback=function(t){t.body!==s&&(e=t.body,t.getHitPoint(L,P),u.sub(q,L,s.position),n=u.length(q)/o,t.stop())},u.copy(P.from,this.position),u.copy(P.to,L),P.update(),this.world.raycast(B,P),!e)return!1;var r=this.angle;u.copy(M,this.position);for(var a=0,c=0,h=0,l=n;c<=l&&a<this.ccdIterations;){a++,h=(l-c)/2,u.scale(x,q,n),u.add(this.position,M,x),this.angle=r+i*n,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?c=h:l=h}return n=h,u.copy(this.position,M),this.angle=r,u.scale(x,q,n),u.add(this.position,this.position,x),this.fixedRotation||(this.angle+=i*n),!0},a.prototype.getVelocityAtPoint=function(t,e){return u.crossVZ(t,e,this.angularVelocity),u.subtract(t,this.velocity,t),t},a.sleepyEvent={type:"sleepy"},a.sleepEvent={type:"sleep"},a.wakeUpEvent={type:"wakeup"},a.DYNAMIC=1,a.STATIC=2,a.KINEMATIC=4,a.AWAKE=0,a.SLEEPY=1,a.SLEEPING=2},{"../collision/AABB":9,"../collision/Ray":13,"../collision/RaycastResult":14,"../events/EventEmitter":28,"../math/vec2":32,"../shapes/Convex":42,"poly-decomp":78}],34:[function(t,e,i){"use strict";var m=t("../math/vec2"),r=t("./Spring");t("../utils/Utils");function o(t,e,i){i=i||{},r.call(this,t,e,i),this.localAnchorA=m.fromValues(0,0),this.localAnchorB=m.fromValues(0,0),i.localAnchorA&&m.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&m.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var o=m.create(),n=m.create();this.getWorldAnchorA(o),this.getWorldAnchorB(n);var s=m.distance(o,n);this.restLength="number"==typeof i.restLength?i.restLength:s}(((e.exports=o).prototype=new r).constructor=o).prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var g=m.create(),b=m.create(),A=m.create(),E=m.create(),w=m.create(),S=m.create(),x=m.create(),B=m.create(),P=m.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,o=this.bodyA,n=this.bodyB,s=g,r=b,a=A,c=E,h=P,l=w,u=S,p=x,d=B;this.getWorldAnchorA(l),this.getWorldAnchorB(u),m.sub(p,l,o.position),m.sub(d,u,n.position),m.sub(s,u,l);var f=m.len(s);m.normalize(r,s),m.sub(a,n.velocity,o.velocity),m.crossZV(h,n.angularVelocity,d),m.add(a,a,h),m.crossZV(h,o.angularVelocity,p),m.sub(a,a,h),m.scale(c,r,-t*(f-i)-e*m.dot(a,r)),m.sub(o.force,o.force,c),m.add(n.force,n.force,c);var v=m.crossLength(p,c),y=m.crossLength(d,c);o.angularForce-=v,n.angularForce+=y}},{"../math/vec2":32,"../utils/Utils":59,"./Spring":36}],35:[function(t,e,i){"use strict";t("../math/vec2");var o=t("./Spring");function n(t,e,i){i=i||{},o.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}(((e.exports=n).prototype=new o).constructor=n).prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,o=this.bodyA,n=this.bodyB,s=-t*(n.angle-o.angle-i)-e*(n.angularVelocity-o.angularVelocity)*0;o.angularForce-=s,n.angularForce+=s}},{"../math/vec2":32,"./Spring":36}],36:[function(t,e,i){"use strict";t("../math/vec2");var o=t("../utils/Utils");function n(t,e,i){i=o.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}(e.exports=n).prototype.applyForce=function(){}},{"../math/vec2":32,"../utils/Utils":59}],37:[function(t,e,i){"use strict";var o=t("../math/vec2"),n=(t("../utils/Utils"),t("../constraints/Constraint")),s=t("../equations/FrictionEquation"),r=t("../objects/Body");function a(t,e){this.chassisBody=t,this.wheels=[],this.groundBody=new r({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function c(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new s(t.chassisBody,t.groundBody),this.sideEquation=new s(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=o.fromValues(0,1),e.localForwardVector&&o.copy(this.localForwardVector,e.localForwardVector),this.localPosition=o.fromValues(0,0),e.localPosition&&o.copy(this.localPosition,e.localPosition),n.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}(e.exports=a).prototype.addToWorld=function(t){(this.world=t).addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},a.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},a.prototype.addWheel=function(t){var e=new c(this,t);return this.wheels.push(e),e},a.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},(c.prototype=new n).setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},c.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var h=o.create(),l=o.create();c.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(l,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(h,l),o.dot(h,l)};var u=o.create();c.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),o.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),o.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),o.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),o.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),o.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),o.normalize(u,this.forwardEquation.t),o.scale(u,u,this.engineForce),this.vehicle.chassisBody.applyForce(u,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":16,"../equations/FrictionEquation":25,"../math/vec2":32,"../objects/Body":33,"../utils/Utils":59}],38:[function(t,e,i){"use strict";var o=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(o,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":8,"./collision/AABB":9,"./collision/Broadphase":10,"./collision/NaiveBroadphase":11,"./collision/Narrowphase":12,"./collision/Ray":13,"./collision/RaycastResult":14,"./collision/SAPBroadphase":15,"./constraints/Constraint":16,"./constraints/DistanceConstraint":17,"./constraints/GearConstraint":18,"./constraints/LockConstraint":19,"./constraints/PrismaticConstraint":20,"./constraints/RevoluteConstraint":21,"./equations/AngleLockEquation":22,"./equations/ContactEquation":23,"./equations/Equation":24,"./equations/FrictionEquation":25,"./equations/RotationalVelocityEquation":27,"./events/EventEmitter":28,"./material/ContactMaterial":29,"./material/Material":30,"./math/vec2":32,"./objects/Body":33,"./objects/LinearSpring":34,"./objects/RotationalSpring":35,"./objects/Spring":36,"./objects/TopDownVehicle":37,"./shapes/Box":39,"./shapes/Capsule":40,"./shapes/Circle":41,"./shapes/Convex":42,"./shapes/Heightfield":43,"./shapes/Line":44,"./shapes/Particle":45,"./shapes/Plane":46,"./shapes/Shape":47,"./solver/GSSolver":48,"./solver/Solver":49,"./utils/ContactEquationPool":50,"./utils/FrictionEquationPool":51,"./utils/Pool":57,"./utils/Utils":59,"./world/World":63}],39:[function(t,e,i){"use strict";var s=t("../math/vec2"),r=t("./Shape"),a=t("./Convex");function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,o=[s.fromValues(-e/2,-i/2),s.fromValues(e/2,-i/2),s.fromValues(e/2,i/2),s.fromValues(-e/2,i/2)],n=[s.fromValues(1,0),s.fromValues(0,1)];t.vertices=o,t.axes=n,t.type=r.BOX,a.call(this,t)}(((e.exports=o).prototype=new a).constructor=o).prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},o.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};s.create(),s.create(),s.create(),s.create();o.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},o.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":32,"./Convex":42,"./Shape":47}],40:[function(t,e,i){"use strict";var o=t("./Shape"),w=t("../math/vec2");function n(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=o.CAPSULE,o.call(this,t)}(((e.exports=n).prototype=new o).constructor=n).prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,o=2*e;return t*(o*o+i*i)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=w.create();n.prototype.computeAABB=function(t,e,i){var o=this.radius;w.set(s,this.length/2,0),0!==i&&w.rotate(s,s,i),w.set(t.upperBound,Math.max(s[0]+o,-s[0]+o),Math.max(s[1]+o,-s[1]+o)),w.set(t.lowerBound,Math.min(s[0]-o,-s[0]-o),Math.min(s[1]-o,-s[1]-o)),w.add(t.lowerBound,t.lowerBound,e),w.add(t.upperBound,t.upperBound,e)};var S=w.create(),x=w.create(),B=w.create(),P=w.create(),C=w.fromValues(0,1);n.prototype.raycast=function(t,e,i,o){for(var n=e.from,s=e.to,r=(e.direction,S),a=x,c=B,h=P,l=this.length/2,u=0;u<2;u++){var p=this.radius*(2*u-1);if(w.set(c,-l,p),w.set(h,l,p),w.toGlobalFrame(c,c,i,o),w.toGlobalFrame(h,h,i,o),0<=(f=w.getLineSegmentsIntersectionFraction(n,s,c,h))&&(w.rotate(a,C,o),w.scale(a,a,2*u-1),e.reportIntersection(t,f,a,-1),t.shouldStop(e)))return}var d=Math.pow(this.radius,2)+Math.pow(l,2);for(u=0;u<2;u++){w.set(c,l*(2*u-1),0),w.toGlobalFrame(c,c,i,o);var f,v=Math.pow(s[0]-n[0],2)+Math.pow(s[1]-n[1],2),y=2*((s[0]-n[0])*(n[0]-c[0])+(s[1]-n[1])*(n[1]-c[1])),m=Math.pow(n[0]-c[0],2)+Math.pow(n[1]-c[1],2)-Math.pow(this.radius,2);if(!((f=Math.pow(y,2)-4*v*m)<0))if(0===f){if(w.lerp(r,n,s,f),w.squaredDistance(r,i)>d&&(w.sub(a,r,c),w.normalize(a,a),e.reportIntersection(t,f,a,-1),t.shouldStop(e)))return}else{var g=Math.sqrt(f),b=1/(2*v),A=(-y-g)*b,E=(-y+g)*b;if(0<=A&&A<=1&&(w.lerp(r,n,s,A),w.squaredDistance(r,i)>d&&(w.sub(a,r,c),w.normalize(a,a),e.reportIntersection(t,A,a,-1),t.shouldStop(e))))return;if(0<=E&&E<=1&&(w.lerp(r,n,s,E),w.squaredDistance(r,i)>d&&(w.sub(a,r,c),w.normalize(a,a),e.reportIntersection(t,E,a,-1),t.shouldStop(e))))return}}}},{"../math/vec2":32,"./Shape":47}],41:[function(t,e,i){"use strict";var o=t("./Shape"),m=t("../math/vec2");function n(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=o.CIRCLE,o.call(this,t)}(((e.exports=n).prototype=new o).constructor=n).prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},n.prototype.computeAABB=function(t,e,i){var o=this.radius;m.set(t.upperBound,o,o),m.set(t.lowerBound,-o,-o),e&&(m.add(t.lowerBound,t.lowerBound,e),m.add(t.upperBound,t.upperBound,e))};var g=m.create(),b=m.create();n.prototype.raycast=function(t,e,i,o){var n=e.from,s=e.to,r=this.radius,a=Math.pow(s[0]-n[0],2)+Math.pow(s[1]-n[1],2),c=2*((s[0]-n[0])*(n[0]-i[0])+(s[1]-n[1])*(n[1]-i[1])),h=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2)-Math.pow(r,2),l=Math.pow(c,2)-4*a*h,u=g,p=b;if(!(l<0))if(0==l)m.lerp(u,n,s,l),m.sub(p,u,i),m.normalize(p,p),e.reportIntersection(t,l,p,-1);else{var d=Math.sqrt(l),f=1/(2*a),v=(-c-d)*f,y=(-c+d)*f;if(0<=v&&v<=1&&(m.lerp(u,n,s,v),m.sub(p,u,i),m.normalize(p,p),e.reportIntersection(t,v,p,-1),t.shouldStop(e)))return;0<=y&&y<=1&&(m.lerp(u,n,s,y),m.sub(p,u,i),m.normalize(p,p),e.reportIntersection(t,y,p,-1))}}},{"../math/vec2":32,"./Shape":47}],42:[function(t,e,i){"use strict";var c=t("./Shape"),d=t("../math/vec2"),a=t("../math/polyk");t("poly-decomp");function p(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var o=d.create();d.copy(o,e[i]),this.vertices.push(o)}if(this.axes=[],t.axes)for(i=0;i<t.axes.length;i++){var n=d.create();d.copy(n,t.axes[i]),this.axes.push(n)}else for(i=0;i<this.vertices.length;i++){var s=this.vertices[i],r=this.vertices[(i+1)%this.vertices.length],a=d.create();d.sub(a,r,s),d.rotate90cw(a,a),d.normalize(a,a),this.axes.push(a)}if(this.centerOfMass=d.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=c.CONVEX,c.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}((e.exports=p).prototype=new c).constructor=p;var h=d.create(),r=d.create();p.prototype.projectOntoLocalAxis=function(t,e){for(var i,o,n=null,s=null,r=(t=h,0);r<this.vertices.length;r++)i=this.vertices[r],o=d.dot(i,t),(null===n||n<o)&&(n=o),(null===s||o<s)&&(s=o);if(n<s){var a=s;s=n,n=a}d.set(e,s,n)},p.prototype.projectOntoWorldAxis=function(t,e,i,o){var n=r;this.projectOntoLocalAxis(t,o),0!==i?d.rotate(n,t,i):n=t;var s=d.dot(e,n);d.set(o,o[0]+s,o[1]+s)},p.prototype.updateTriangles=function(){for(var t=[],e=this.triangles.length=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}var o=a.Triangulate(t);for(e=0;e<o.length;e+=3){var n=o[e],s=o[e+1],r=o[e+2];this.triangles.push([n,s,r])}};var f=d.create(),v=d.create(),y=d.create(),m=d.create(),g=d.create();d.create(),d.create(),d.create(),d.create();p.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,o=f,n=y,s=m,r=g,a=v;d.set(i,0,0);for(var c=0,h=0;h!==t.length;h++){var l=t[h];n=e[l[0]],s=e[l[1]],r=e[l[2]];d.centroid(o,n,s,r);var u=p.triangleArea(n,s,r);c+=u,d.scale(a,o,u),d.add(i,i,a)}d.scale(i,i,1/c)},p.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,o=this.vertices.length,n=o-1,s=0;s<o;n=s,s++){var r=this.vertices[n],a=this.vertices[s],c=Math.abs(d.crossLength(r,a));e+=c*(d.dot(a,a)+d.dot(a,r)+d.dot(r,r)),i+=c}return t/6*(e/i)},p.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var o=d.squaredLength(t[i]);e<o&&(e=o)}this.boundingRadius=Math.sqrt(e)},p.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},p.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var o=t[i],n=e[o[0]],s=e[o[1]],r=e[o[2]],a=p.triangleArea(n,s,r);this.area+=a}},p.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var b=d.create(),A=d.create(),E=d.create();p.prototype.raycast=function(t,e,i,o){var n=b,s=A,r=E,a=this.vertices;d.toLocalFrame(n,e.from,i,o),d.toLocalFrame(s,e.to,i,o);for(var c=a.length,h=0;h<c&&!t.shouldStop(e);h++){var l=a[h],u=a[(h+1)%c],p=d.getLineSegmentsIntersectionFraction(n,s,l,u);0<=p&&(d.sub(r,u,l),d.rotate(r,r,-Math.PI/2+o),d.normalize(r,r),e.reportIntersection(t,p,r,h))}}},{"../math/polyk":31,"../math/vec2":32,"./Shape":47,"poly-decomp":78}],43:[function(t,e,i){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=t("./Shape"),y=t("../math/vec2");t("../utils/Utils");function s(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"===o(arguments[1]))for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=n.HEIGHTFIELD,n.call(this,t)}(((e.exports=s).prototype=new n).constructor=s).prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],o=0;o!==t.length;o++){var n=t[o];e<n&&(e=n),n<i&&(i=n)}this.maxValue=e,this.minValue=i},s.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},s.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},s.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var r=[y.create(),y.create(),y.create(),y.create()];s.prototype.computeAABB=function(t,e,i){y.set(r[0],0,this.maxValue),y.set(r[1],this.elementWidth*this.heights.length,this.maxValue),y.set(r[2],this.elementWidth*this.heights.length,this.minValue),y.set(r[3],0,this.minValue),t.setFromPoints(r,e,i)},s.prototype.getLineSegment=function(t,e,i){var o=this.heights,n=this.elementWidth;y.set(t,i*n,o[i]),y.set(e,(i+1)*n,o[i+1])},s.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},s.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};y.create();var m=y.create(),g=y.create(),b=y.create(),A=y.create(),E=y.create();y.fromValues(0,1);s.prototype.raycast=function(t,e,i,o){var n=e.from,s=e.to,r=(e.direction,m),a=g,c=b,h=A,l=E;y.toLocalFrame(h,n,i,o),y.toLocalFrame(l,s,i,o);var u=this.getClampedSegmentIndex(h),p=this.getClampedSegmentIndex(l);if(p<u){var d=u;u=p,p=d}for(var f=0;f<this.heights.length-1;f++){this.getLineSegment(a,c,f);var v=y.getLineSegmentsIntersectionFraction(h,l,a,c);if(0<=v&&(y.sub(r,c,a),y.rotate(r,r,o+Math.PI/2),y.normalize(r,r),e.reportIntersection(t,v,r,-1),t.shouldStop(e)))return}}},{"../math/vec2":32,"../utils/Utils":59,"./Shape":47}],44:[function(t,e,i){"use strict";var o=t("./Shape"),u=t("../math/vec2");function n(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=o.LINE,o.call(this,t)}(((e.exports=n).prototype=new o).constructor=n).prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[u.create(),u.create()];n.prototype.computeAABB=function(t,e,i){var o=this.length/2;u.set(s[0],-o,0),u.set(s[1],o,0),t.setFromPoints(s,e,i,0)};u.create();var p=u.create(),d=u.create(),f=u.create(),v=u.fromValues(0,1);n.prototype.raycast=function(t,e,i,o){var n=e.from,s=e.to,r=d,a=f,c=this.length/2;u.set(r,-c,0),u.set(a,c,0),u.toGlobalFrame(r,r,i,o),u.toGlobalFrame(a,a,i,o);var h=u.getLineSegmentsIntersectionFraction(r,a,n,s);if(0<=h){var l=p;u.rotate(l,v,o),e.reportIntersection(t,h,l,-1)}}},{"../math/vec2":32,"./Shape":47}],45:[function(t,e,i){"use strict";var o=t("./Shape"),n=t("../math/vec2");function s(t){(t=t||{}).type=o.PARTICLE,o.call(this,t)}(((e.exports=s).prototype=new o).constructor=s).prototype.computeMomentOfInertia=function(t){return 0},s.prototype.updateBoundingRadius=function(){this.boundingRadius=0},s.prototype.computeAABB=function(t,e,i){n.copy(t.lowerBound,e),n.copy(t.upperBound,e)}},{"../math/vec2":32,"./Shape":47}],46:[function(t,e,i){"use strict";var o=t("./Shape"),d=t("../math/vec2");t("../utils/Utils");function n(t){(t=t||{}).type=o.PLANE,o.call(this,t)}(((e.exports=n).prototype=new o).constructor=n).prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.computeAABB=function(t,e,i){var o=i%(2*Math.PI),n=d.set,s=t.lowerBound,r=t.upperBound;n(s,-1e7,-1e7),n(r,1e7,1e7),0==o?r[1]=0:o==Math.PI/2?s[0]=0:o===Math.PI?s[1]=0:o==3*Math.PI/2&&(r[0]=0)},n.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var f=d.create(),v=(d.create(),d.create(),d.create()),y=d.create();n.prototype.raycast=function(t,e,i,o){var n=e.from,s=e.to,r=e.direction,a=f,c=v,h=y;d.set(c,0,1),d.rotate(c,c,o),d.sub(h,n,i);var l=d.dot(h,c);if(d.sub(h,s,i),!(0<l*d.dot(h,c)||d.squaredDistance(n,s)<l*l)){var u=d.dot(c,r);d.sub(a,n,i);var p=-d.dot(c,a)/u/e.length;e.reportIntersection(t,p,c,-1)}}},{"../math/vec2":32,"../utils/Utils":59,"./Shape":47}],47:[function(t,e,i){"use strict";e.exports=n;var o=t("../math/vec2");function n(t){t=t||{},this.body=null,this.position=o.fromValues(0,0),t.position&&o.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=n.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}n.idCounter=0,n.CIRCLE=1,n.PARTICLE=2,n.PLANE=4,n.CONVEX=8,n.LINE=16,n.BOX=32,Object.defineProperty(n,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),n.BOX}}),n.CAPSULE=64,n.HEIGHTFIELD=128,n.prototype.computeMomentOfInertia=function(t){},n.prototype.updateBoundingRadius=function(){},n.prototype.updateArea=function(){},n.prototype.computeAABB=function(t,e,i){},n.prototype.raycast=function(t,e,i,o){}},{"../math/vec2":32}],48:[function(t,e,i){"use strict";var w=t("../math/vec2"),o=t("./Solver"),S=t("../utils/Utils"),x=t("../equations/FrictionEquation");function B(t){o.call(this,t,o.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new S.ARRAY_TYPE(this.arrayStep),this.Bs=new S.ARRAY_TYPE(this.arrayStep),this.invCs=new S.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}(((e.exports=B).prototype=new o).constructor=B).prototype.solve=function(t,e){this.sortEquations();var i=0,o=this.iterations,n=this.frictionIterations,s=this.equations,r=s.length,a=Math.pow(this.tolerance*r,2),c=e.bodies,h=e.bodies.length,l=(w.add,w.set,this.useZeroRHS),u=this.lambda;if(this.usedIterations=0,r)for(var p=0;p!==h;p++){c[p].updateSolveMassProperties()}u.length<r&&(u=this.lambda=new S.ARRAY_TYPE(r+this.arrayStep),this.Bs=new S.ARRAY_TYPE(r+this.arrayStep),this.invCs=new S.ARRAY_TYPE(r+this.arrayStep)),function(t){for(var e=t.length;e--;)t[e]=0}(u);var d,f,v=this.invCs,y=this.Bs;for(u=this.lambda,p=0;p!==s.length;p++){var m;(m=s[p]).timeStep===t&&!m.needsUpdate||(m.timeStep=t,m.update()),y[p]=m.computeB(m.a,m.b,t),v[p]=m.computeInvC(m.epsilon)}if(0!==r){for(p=0;p!==h;p++){c[p].resetConstraintVelocity()}if(n){for(i=0;i!==n;i++){for(f=d=0;f!==r;f++){m=s[f];var g=B.iterateEquation(f,m,m.epsilon,y,v,u,l,t,i);d+=Math.abs(g)}if(this.usedIterations++,d*d<=a)break}for(B.updateMultipliers(s,u,1/t),f=0;f!==r;f++){var b=s[f];if(b instanceof x){for(var A=0,E=0;E!==b.contactEquations.length;E++)A+=b.contactEquations[E].multiplier;A*=b.frictionCoefficient/b.contactEquations.length,b.maxForce=A,b.minForce=-A}}}for(i=0;i!==o;i++){for(f=d=0;f!==r;f++){m=s[f];g=B.iterateEquation(f,m,m.epsilon,y,v,u,l,t,i);d+=Math.abs(g)}if(this.usedIterations++,d*d<=a)break}for(p=0;p!==h;p++)c[p].addConstraintVelocity();B.updateMultipliers(s,u,1/t)}},B.updateMultipliers=function(t,e,i){for(var o=t.length;o--;)t[o].multiplier=e[o]*i},B.iterateEquation=function(t,e,i,o,n,s,r,a,c){var h=o[t],l=n[t],u=s[t],p=e.computeGWlambda(),d=e.maxForce,f=e.minForce;r&&(h=0);var v=l*(h-p-i*u),y=u+v;return y<f*a?v=f*a-u:d*a<y&&(v=d*a-u),s[t]+=v,e.addToWlambda(v),v}},{"../equations/FrictionEquation":25,"../math/vec2":32,"../utils/Utils":59,"./Solver":49}],49:[function(t,e,i){"use strict";t("../utils/Utils");var o=t("../events/EventEmitter");function n(t,e){t=t||{},o.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}(((e.exports=n).prototype=new o).constructor=n).prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var s={bodies:[]};n.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),s.bodies.length=0,e.getBodies(s.bodies),s.bodies.length&&this.solve(t,s))},n.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},n.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},n.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var o=t[e];o.enabled&&this.equations.push(o)}},n.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},n.prototype.removeAllEquations=function(){this.equations.length=0},n.GS=1,n.ISLAND=2},{"../events/EventEmitter":28,"../utils/Utils":59}],50:[function(t,e,i){"use strict";var o=t("../equations/ContactEquation"),n=t("./Pool");function s(){n.apply(this,arguments)}(((e.exports=s).prototype=new n).constructor=s).prototype.create=function(){return new o},s.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":23,"./Pool":57}],51:[function(t,e,i){"use strict";var o=t("../equations/FrictionEquation"),n=t("./Pool");function s(){n.apply(this,arguments)}(((e.exports=s).prototype=new n).constructor=s).prototype.create=function(){return new o},s.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":25,"./Pool":57}],52:[function(t,e,i){"use strict";var o=t("../world/IslandNode"),n=t("./Pool");function s(){n.apply(this,arguments)}(((e.exports=s).prototype=new n).constructor=s).prototype.create=function(){return new o},s.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":62,"./Pool":57}],53:[function(t,e,i){"use strict";var o=t("../world/Island"),n=t("./Pool");function s(){n.apply(this,arguments)}(((e.exports=s).prototype=new n).constructor=s).prototype.create=function(){return new o},s.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":60,"./Pool":57}],54:[function(t,e,i){"use strict";var o=t("./TupleDictionary"),n=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils");function s(){this.overlappingShapesLastState=new o,this.overlappingShapesCurrentState=new o,this.recordPool=new n({size:16}),this.tmpDict=new o,this.tmpArray1=[]}(e.exports=s).prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var o=t.keys[i],n=t.getByKey(o);e.getByKey(o);n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},s.prototype.setOverlapping=function(t,e,i,o){this.overlappingShapesLastState;var n=this.overlappingShapesCurrentState;if(!n.get(e.id,o.id)){var s=this.recordPool.get();s.set(t,e,i,o),n.set(e.id,o.id,s)}},s.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},s.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},s.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,o=i.keys.length;o--;){var n=i.keys[o],s=i.data[n];if(s.bodyA===t&&s.bodyB===e||s.bodyA===e&&s.bodyB===t)return!0}return!1},s.prototype.getDiff=function(t,e,i){var o=t,n=e;(i=i||[]).length=0;for(var s=n.keys.length;s--;){var r=n.keys[s],a=n.data[r];if(!a)throw new Error("Key "+r+" had no data!");o.data[r]||i.push(a)}return i},s.prototype.isNewOverlap=function(t,e){var i=0|t.id,o=0|e.id,n=this.overlappingShapesLastState,s=this.overlappingShapesCurrentState;return!n.get(i,o)&&!!s.get(i,o)},s.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},s.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},s.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,o=t.length;o--;){var n=t[o];i.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(o=i.keys.length;o--;){(n=i.getByKey(i.keys[o]))&&e.push(n.bodyA,n.bodyB)}return i.reset(),e}},{"./OverlapKeeperRecord":55,"./OverlapKeeperRecordPool":56,"./TupleDictionary":58,"./Utils":59}],55:[function(t,e,i){"use strict";function n(t,e,i,o){this.shapeA=e,this.shapeB=o,this.bodyA=t,this.bodyB=i}(e.exports=n).prototype.set=function(t,e,i,o){n.call(this,t,e,i,o)}},{}],56:[function(t,e,i){"use strict";var o=t("./OverlapKeeperRecord"),n=t("./Pool");function s(){n.apply(this,arguments)}(((e.exports=s).prototype=new n).constructor=s).prototype.create=function(){return new o},s.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":55,"./Pool":57}],57:[function(t,e,i){"use strict";function o(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}(e.exports=o).prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},o.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},o.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],58:[function(t,e,i){"use strict";var o=t("./Utils");function n(){this.data={},this.keys=[]}(e.exports=n).prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|e)<(0|t)?t<<16|65535&e:e<<16|65535&t)},n.prototype.getByKey=function(t){return t|=0,this.data[t]},n.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},n.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var o=this.getKey(t,e);return this.data[o]||this.keys.push(o),this.data[o]=i,o},n.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},n.prototype.copy=function(t){this.reset(),o.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":59}],59:[function(t,e,i){"use strict";function o(){}(e.exports=o).appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,o=e.length;i!==o;++i)t.push(e[i])},o.splice=function(t,e,i){i=i||1;for(var o=e,n=t.length-i;o<n;o++)t[o]=t[o+i];t.length=n},"undefined"!=typeof P2_ARRAY_TYPE?o.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?o.ARRAY_TYPE=Float32Array:o.ARRAY_TYPE=Array,o.extend=function(t,e){for(var i in e)t[i]=e[i]},o.defaults=function(t,e){for(var i in t=t||{},e)i in t||(t[i]=e[i]);return t}},{}],60:[function(t,e,i){"use strict";var o=t("../objects/Body");function n(){this.equations=[],this.bodies=[]}(e.exports=n).prototype.reset=function(){this.equations.length=this.bodies.length=0};var s=[];n.prototype.getBodies=function(t){for(var e=t||[],i=this.equations,o=s.length=0;o!==i.length;o++){var n=i[o];-1===s.indexOf(n.bodyA.id)&&(e.push(n.bodyA),s.push(n.bodyA.id)),-1===s.indexOf(n.bodyB.id)&&(e.push(n.bodyB),s.push(n.bodyB.id))}return e},n.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===o.DYNAMIC&&!e.wantsToSleep)return!1}return!0},n.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){this.bodies[t].sleep()}return!0}},{"../objects/Body":33}],61:[function(t,e,i){"use strict";t("../math/vec2"),t("./Island"),t("./IslandNode");var o=t("./../utils/IslandNodePool"),n=t("./../utils/IslandPool"),r=t("../objects/Body");function f(t){this.nodePool=new o({size:16}),this.islandPool=new n({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}(e.exports=f).getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var o=t[i];if(!o.visited&&o.body.type===r.DYNAMIC)return o}return!1},f.prototype.visit=function(t,e,i){e.push(t.body);for(var o=t.equations.length,n=0;n!==o;n++){var s=t.equations[n];-1===i.indexOf(s)&&i.push(s)}},f.prototype.bfs=function(t,e,i){var o=this.queue;for(o.length=0,o.push(t),t.visited=!0,this.visit(t,e,i);o.length;)for(var n,s=o.pop();n=f.getUnvisitedNode(s.neighbors);)n.visited=!0,this.visit(n,e,i),n.body.type===r.DYNAMIC&&o.push(n)},f.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,o=this.equations;i.length;)this.nodePool.release(i.pop());for(var n=0;n!==e.length;n++){var s=this.nodePool.get();s.body=e[n],i.push(s)}for(var r=0;r!==o.length;r++){var a=o[r],c=(n=e.indexOf(a.bodyA),e.indexOf(a.bodyB)),h=i[n],l=i[c];h.neighbors.push(l),l.neighbors.push(h),h.equations.push(a),l.equations.push(a)}var u,p=this.islands;for(n=0;n<p.length;n++)this.islandPool.release(p[n]);for(p.length=0;u=f.getUnvisitedNode(i);){var d=this.islandPool.get();this.bfs(u,d.bodies,d.equations),p.push(d)}return p}},{"../math/vec2":32,"../objects/Body":33,"./../utils/IslandNodePool":52,"./../utils/IslandPool":53,"./Island":60,"./IslandNode":62}],62:[function(t,e,i){"use strict";function o(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}(e.exports=o).prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],63:[function(t,e,i){"use strict";var o=t("../solver/GSSolver"),X=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),m=t("../shapes/Circle"),g=t("../shapes/Convex"),b=(t("../shapes/Line"),t("../shapes/Plane")),A=t("../shapes/Capsule"),E=t("../shapes/Particle"),n=t("../events/EventEmitter"),W=t("../objects/Body"),s=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),r=t("../material/ContactMaterial"),a=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),c=t("../collision/SAPBroadphase"),h=t("../collision/Narrowphase"),Y=t("../utils/Utils"),l=t("../utils/OverlapKeeper"),u=t("./IslandManager");t("../objects/RotationalSpring");function H(t){n.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new o,this.narrowphase=new h(this),this.islandManager=new u,this.gravity=X.fromValues(0,-9.78),t.gravity&&X.copy(this.gravity,t.gravity),this.frictionGravity=X.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new c,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new s,this.defaultContactMaterial=new r(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=H.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new l}(((e.exports=H).prototype=new Object(n.prototype)).constructor=H).NO_SLEEPING=1,H.BODY_SLEEPING=2,H.ISLAND_SLEEPING=4,H.prototype.addConstraint=function(t){this.constraints.push(t)},H.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},H.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&Y.splice(this.contactMaterials,e,1)},H.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,o=0,n=i.length;o!==n;o++){var s=i[o];if(s.materialA.id===t.id&&s.materialB.id===e.id||s.materialA.id===e.id&&s.materialB.id===t.id)return s}return!1},H.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&Y.splice(this.constraints,e,1)};X.create(),X.create(),X.create(),X.create(),X.create(),X.create();var K=X.create(),x=X.fromValues(0,0),B=X.fromValues(0,0);X.fromValues(0,0),X.fromValues(0,0);H.prototype.step=function(t,e,i){if(i=i||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var o=0;this.accumulator>=t&&o<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,o++;for(var n=this.accumulator%t/t,s=0;s!==this.bodies.length;s++){var r=this.bodies[s];X.lerp(r.interpolatedPosition,r.previousPosition,r.position,n),r.interpolatedAngle=r.previousAngle+n*(r.angle-r.previousAngle)}}};var J=[];H.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,o=this.bodies,n=this.gravity,s=this.solver,r=this.bodies.length,a=this.broadphase,c=this.narrowphase,h=this.constraints,l=K,u=(X.scale,X.add),p=(X.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var d=X.length(this.gravity);0===d&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=d)}if(this.applyGravity)for(var f=0;f!==r;f++){var v=(y=o[f]).force;y.type===W.DYNAMIC&&y.sleepState!==W.SLEEPING&&(X.scale(l,n,y.mass*y.gravityScale),u(v,v,l))}if(this.applySpringForces)for(f=0;f!==e;f++){i[f].applyForce()}if(this.applyDamping)for(f=0;f!==r;f++){var y;(y=o[f]).type===W.DYNAMIC&&y.applyDamping(t)}var m=a.getCollisionPairs(this),g=this.disabledBodyCollisionPairs;for(f=g.length-2;0<=f;f-=2)for(var b=m.length-2;0<=b;b-=2)(g[f]===m[b]&&g[f+1]===m[b+1]||g[f+1]===m[b]&&g[f]===m[b+1])&&m.splice(b,2);var A=h.length;for(f=0;f!==A;f++){var E=h[f];if(!E.collideConnected)for(b=m.length-2;0<=b;b-=2)(E.bodyA===m[b]&&E.bodyB===m[b+1]||E.bodyB===m[b]&&E.bodyA===m[b+1])&&m.splice(b,2)}this.postBroadphaseEvent.pairs=m,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,c.reset(this);f=0;for(var w=m.length;f!==w;f+=2)for(var S=m[f],x=m[f+1],B=0,P=S.shapes.length;B!==P;B++)for(var C=S.shapes[B],L=C.position,q=C.angle,M=0,I=x.shapes.length;M!==I;M++){var _=x.shapes[M],F=_.position,R=_.angle,T=this.defaultContactMaterial;if(C.material&&_.material){var V=this.getContactMaterial(C.material,_.material);V&&(T=V)}this.runNarrowphase(c,S,C,L,q,x,_,F,R,T,this.frictionGravity)}for(f=0;f!==r;f++){(G=o[f])._wakeUpAfterNarrowphase&&(G.wakeUp(),G._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(J);var N=this.endContactEvent;for(M=J.length;M--;){var k=J[M];N.shapeA=k.shapeA,N.shapeB=k.shapeB,N.bodyA=k.bodyA,N.bodyB=k.bodyB,this.emit(N)}J.length=0}var O=this.preSolveEvent;O.contactEquations=c.contactEquations,O.frictionEquations=c.frictionEquations,this.emit(O),O.contactEquations=O.frictionEquations=null;A=h.length;for(f=0;f!==A;f++)h[f].update();if(c.contactEquations.length||c.frictionEquations.length||A)if(this.islandSplit){for(p.equations.length=0,Y.appendArray(p.equations,c.contactEquations),Y.appendArray(p.equations,c.frictionEquations),f=0;f!==A;f++)Y.appendArray(p.equations,h[f].equations);p.split(this);for(f=0;f!==p.islands.length;f++){(j=p.islands[f]).equations.length&&s.solveIsland(t,j)}}else{for(s.addEquations(c.contactEquations),s.addEquations(c.frictionEquations),f=0;f!==A;f++)s.addEquations(h[f].equations);this.solveConstraints&&s.solve(t,this),s.removeAllEquations()}for(f=0;f!==r;f++){var G;(G=o[f]).integrate(t)}for(f=0;f!==r;f++)o[f].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var D=this.impactEvent;for(f=0;f!==c.contactEquations.length;f++){var U=c.contactEquations[f];U.firstImpact&&(D.bodyA=U.bodyA,D.bodyB=U.bodyB,D.shapeA=U.shapeA,D.shapeB=U.shapeB,D.contactEquation=U,this.emit(D))}}if(this.sleepMode===H.BODY_SLEEPING)for(f=0;f!==r;f++)o[f].sleepTick(this.time,!1,t);else if(this.sleepMode===H.ISLAND_SLEEPING&&this.islandSplit){for(f=0;f!==r;f++)o[f].sleepTick(this.time,!0,t);for(f=0;f<this.islandManager.islands.length;f++){var j;(j=this.islandManager.islands[f]).wantsToSleep()&&j.sleep()}}this.stepping=!1;var z=this.bodiesToBeRemoved;for(f=0;f!==z.length;f++)this.removeBody(z[f]);z.length=0,this.emit(this.postStepEvent)},H.prototype.runNarrowphase=function(t,e,i,o,n,s,r,a,c,h,l){if(0!=(i.collisionGroup&r.collisionMask)&&0!=(r.collisionGroup&i.collisionMask)){X.rotate(x,o,e.angle),X.rotate(B,a,s.angle),X.add(x,x,e.position),X.add(B,B,s.position);var u,p=n+e.angle,d=c+s.angle;t.enableFriction=0<h.friction,t.frictionCoefficient=h.friction,u=e.type===W.STATIC||e.type===W.KINEMATIC?s.mass:s.type===W.STATIC||s.type===W.KINEMATIC?e.mass:e.mass*s.mass/(e.mass+s.mass),t.slipForce=h.friction*l*u,t.restitution=h.restitution,t.surfaceVelocity=h.surfaceVelocity,t.frictionStiffness=h.frictionStiffness,t.frictionRelaxation=h.frictionRelaxation,t.stiffness=h.stiffness,t.relaxation=h.relaxation,t.contactSkinSize=h.contactSkinSize,t.enabledEquations=e.collisionResponse&&s.collisionResponse&&i.collisionResponse&&r.collisionResponse;var f=t[i.type|r.type],v=0;if(f){var y=i.sensor||r.sensor,m=t.frictionEquations.length;v=i.type<r.type?f.call(t,e,i,x,p,s,r,B,d,y):f.call(t,s,r,B,d,e,i,x,p,y);var g=t.frictionEquations.length-m;if(v){if(e.allowSleep&&e.type===W.DYNAMIC&&e.sleepState===W.SLEEPING&&s.sleepState===W.AWAKE&&s.type!==W.STATIC){var b=X.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2);2*Math.pow(s.sleepSpeedLimit,2)<=b&&(e._wakeUpAfterNarrowphase=!0)}if(s.allowSleep&&s.type===W.DYNAMIC&&s.sleepState===W.SLEEPING&&e.sleepState===W.AWAKE&&e.type!==W.STATIC){var A=X.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2);2*Math.pow(e.sleepSpeedLimit,2)<=A&&(s._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,i,s,r),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,r)){var E=this.beginContactEvent;if(E.shapeA=i,E.shapeB=r,E.bodyA=e,E.bodyB=s,E.contactEquations.length=0,"number"==typeof v)for(var w=t.contactEquations.length-v;w<t.contactEquations.length;w++)E.contactEquations.push(t.contactEquations[w]);this.emit(E)}if("number"==typeof v&&1<g)for(w=t.frictionEquations.length-g;w<t.frictionEquations.length;w++){var S=t.frictionEquations[w];S.setSlipForce(S.getSlipForce()/g)}}}}},H.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},H.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&Y.splice(this.springs,e,1)},H.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t);var e=(t.world=this).addBodyEvent;e.body=t,this.emit(e),e.body=null}},H.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(Y.splice(this.bodies,e,1),(this.removeBodyEvent.body=t).resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},H.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var o=e[i];if(o.id===t)return o}return!1},H.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},H.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,o=0;o<i.length;o+=2)if(i[o]===t&&i[o+1]===e||i[o+1]===t&&i[o]===e)return void i.splice(o,2)},H.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;0<=e;e--)this.removeConstraint(t[e]);var i=this.bodies;for(e=i.length-1;0<=e;e--)this.removeBody(i[e]);var o=this.springs;for(e=o.length-1;0<=e;e--)this.removeSpring(o[e]);var n=this.contactMaterials;for(e=n.length-1;0<=e;e--)this.removeContactMaterial(n[e]);H.apply(this)};var w=X.create(),S=(X.fromValues(0,0),X.fromValues(0,0));H.prototype.hitTest=function(t,e,i){i=i||0;var o=new W({position:t}),n=new E,s=t,r=w,a=S;o.addShape(n);for(var c=this.narrowphase,h=[],l=0,u=e.length;l!==u;l++)for(var p=e[l],d=0,f=p.shapes.length;d!==f;d++){var v=p.shapes[d];X.rotate(r,v.position,p.angle),X.add(r,r,p.position);var y=v.angle+p.angle;(v instanceof m&&c.circleParticle(p,v,r,y,o,n,s,0,!0)||v instanceof g&&c.particleConvex(o,n,s,0,p,v,r,y,!0)||v instanceof b&&c.particlePlane(o,n,s,0,p,v,r,y,!0)||v instanceof A&&c.particleCapsule(o,n,s,0,p,v,r,y,!0)||v instanceof E&&X.squaredLength(X.sub(a,r,t))<i*i)&&h.push(p)}return h},H.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var o=e[i],n=0;n!==o.equations.length;n++){var s=o.equations[n];s.stiffness=t,s.needsUpdate=!0}var r=this.contactMaterials;for(i=0;i!==r.length;i++){(o=r[i]).stiffness=o.frictionStiffness=t}(o=this.defaultContactMaterial).stiffness=o.frictionStiffness=t},H.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],o=0;o!==i.equations.length;o++){var n=i.equations[o];n.relaxation=t,n.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++){(i=this.contactMaterials[e]).relaxation=i.frictionRelaxation=t}(i=this.defaultContactMaterial).relaxation=i.frictionRelaxation=t};var p=new a,d=[];H.prototype.raycast=function(t,e){return e.getAABB(p),this.broadphase.aabbQuery(this,p,d),e.intersectBodies(t,d),d.length=0,t.hasHit()}},{"../../package.json":8,"../collision/AABB":9,"../collision/Broadphase":10,"../collision/Narrowphase":12,"../collision/Ray":13,"../collision/SAPBroadphase":15,"../constraints/Constraint":16,"../constraints/DistanceConstraint":17,"../constraints/GearConstraint":18,"../constraints/LockConstraint":19,"../constraints/PrismaticConstraint":20,"../constraints/RevoluteConstraint":21,"../events/EventEmitter":28,"../material/ContactMaterial":29,"../material/Material":30,"../math/vec2":32,"../objects/Body":33,"../objects/LinearSpring":34,"../objects/RotationalSpring":35,"../shapes/Capsule":40,"../shapes/Circle":41,"../shapes/Convex":42,"../shapes/Line":44,"../shapes/Particle":45,"../shapes/Plane":46,"../shapes/Shape":47,"../solver/GSSolver":48,"../solver/Solver":49,"../utils/OverlapKeeper":54,"../utils/Utils":59,"./IslandManager":61}],64:[function(t,e,i){"use strict";var r=/rgba?\(\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,?\s*([.0-9]+)?\s*\)/;function o(){this.r=0,this.g=0,this.b=0,this.a=void 0,this.string=""}(e.exports=o).prototype._setRGB=function(t,e,i){this.r=t,this.g=e,this.b=i},o.prototype.fromPixel=function(t,e){var i=t[e+0],o=t[e+1],n=t[e+2];return this.string="rgb("+i+","+o+","+n+")",this._setRGB(i,o,n),this},o.prototype.fromString=function(t){var e,i,o,n=(this.string=t).match(r);if(n)e=~~n[1],i=~~n[2],o=~~n[3],this._setRGB(e,i,o);else{var s="0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&");this._setRGB(s>>16,s>>8&255,255&s)}return this},o.prototype.fromRGB=function(t,e,i){return this._setRGB(t,e,i),this.string="rgb("+t+","+e+","+i+")",this},o.prototype.fromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.string=t.string,this}},{}],65:[function(t,e,i){"use strict";var o=t("./index"),n=t("../domUtils/createCanvas"),h=8,l=8,v=Math.PI/2;o.setTileSize=function(t,e){h=~~t,l=~~e},o.prototype._init=function(){this.canvas=n(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.palette[0].string,this.ctx.strokeStyle=this.palette[1].string,this.resize(this.width,this.height)},o.prototype.resize=function(t,e){return this.canvas.width=this.width=t,this.canvas.height=this.height=e,this.clear(),this},o.prototype.sprite=function(t,e,i,o,n,s){var r=h*(t%16),a=l*~~(t/16),c=this.ctx;return e=e||0,i=i||0,e=~~Math.round(e-this.camera.x),i=~~Math.round(i-this.camera.y),o||n||s?(c.save(),o&&(c.scale(-1,1),e=-e-h),n&&(c.scale(1,-1),i=-i-l),s?(c.translate(e+l,i),c.rotate(v)):c.translate(e,i),c.drawImage(this.tilesheet,this.ox+r,this.oy+a,h,l,0,0,h,l),c.restore()):c.drawImage(this.tilesheet,this.ox+r,this.oy+a,h,l,e,i,h,l),this},o.prototype.draw=function(t,e,i,o,n,s){var r=o||n||s;if(t._isSprite){var a=t;t=a.img;var c=a.x,h=a.y,l=a.width,u=a.height,p=~~Math.round((e||0)-this.camera.x),d=~~Math.round((i||0)-this.camera.y);return r?((f=this.ctx).save(),s?(o&&(f.scale(-1,1),p*=-1,p-=u),n&&(f.scale(1,-1),d*=-1,d-=l),f.translate(p+u,d),f.rotate(v)):(o&&(f.scale(-1,1),p*=-1,p-=l),n&&(f.scale(1,-1),d*=-1,d-=u),f.translate(p,d)),f.drawImage(t,c,h,l,u,0,0,l,u),f.restore(),this):(this.ctx.drawImage(t,c,h,l,u,p,d,l,u),this)}t._isTileMap&&(t.texture||t._prepareTexture(),t=t.texture.canvas),t._isTexture&&(t=t.canvas);var f;p=~~Math.round((e||0)-this.camera.x),d=~~Math.round((i||0)-this.camera.y);return r?((f=this.ctx).save(),s?(o&&(f.scale(-1,1),p*=-1,p-=t.height),n&&(f.scale(1,-1),d*=-1,d-=t.width),f.translate(p+t.height,d),f.rotate(v)):(o&&(f.scale(-1,1),p*=-1,p-=t.width),n&&(f.scale(1,-1),d*=-1,d-=t.height),f.translate(p,d)),f.drawImage(t,0,0),f.restore()):this.ctx.drawImage(t,p,d),this},o.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},o.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this},o.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen].string,this},o.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper].string,this},o.prototype.rect=function(t,e,i,o){if(i<=1||o<=1){var n=this.ctx.fillStyle;return this.ctx.fillStyle=this.ctx.strokeStyle,this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~i,~~o),this.ctx.fillStyle=n,this}return this.ctx.strokeRect(.5+~~(t-this.camera.x),.5+~~(e-this.camera.y),~~(i-1),~~(o-1)),this},o.prototype.rectf=function(t,e,i,o){return this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~i,~~o),this},o.prototype.rectfill=o.prototype.rectf,o.prototype._isTexture=!0,o.prototype.tilesheet=n(16*h,16*l)},{"../domUtils/createCanvas":70,"./index":66}],66:[function(t,e,i){"use strict";function o(t,e){this.width=t,this.height=e,this.camera={x:0,y:0},this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._init()}function n(t,e){t.ox=0,t.oy=0,e._isImageWrapper&&(e=e.asset),e._isSprite?(t.ox=e.x,t.oy=e.y,t.tilesheet=e.img):e._isMap?(e.texture||e._prepareTexture(),t.tilesheet=e.texture.canvas):e._isTexture?t.tilesheet=e.canvas:(e instanceof Image||e instanceof HTMLCanvasElement)&&(t.tilesheet=e)}(e.exports=o).prototype.palette=[{string:"#000000",r:0,g:0,b:0},{string:"#FFFFFF",r:1,g:1,b:1}],o.prototype.ox=0,o.prototype.oy=0,o.setTileSize=function(){},o.prototype.setPalette=function(t){o.prototype.palette=t},o.prototype.setGlobalTilesheet=function(t){n(o.prototype,t)},o.prototype.setTilesheet=function(t){if(t)return n(this,t),this;delete this.tilesheet},o.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this}},{}],67:[function(t,e,i){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=t("./index.js"),h=3,l=5,n=o.prototype.setPalette;o.prototype.setPalette=function(t){n.call(this,t),o.prototype.textCharset=new o(128*h,l*t.length),function(t,e){for(var i=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],o=0;o<e.length;o++){t.fillStyle=e[o].string;for(var n=0;n<i.length;n++)for(var s=i[n],r=0;r<15;r++){var a=r%h,c=~~(r/h);1==(s>>r&1)&&t.fillRect(n*h+a,o*l+c,1,1)}}t.fillStyle=e[0].string}(o.prototype.textCharset.ctx,t)};var r=o.prototype.resize;o.prototype.resize=function(t,e){return this._textOffset=1,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textPadding=e-6*this._textLine-this._textOffset,this._cursor.i=0,this._cursor.j=0,r.call(this,t,e),this},o.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},o.prototype.textCharset=new o(128*h,l*o.prototype.palette.length),o.prototype.locate=function(t,e){return this._cursor.i=~~t,this._cursor.j=~~e,this},o.prototype.print=function(e,t,i){if("object"===s(e))try{e=JSON.stringify(e)}catch(t){e="[Object]"}else"string"!=typeof e&&(e=e.toString());if(void 0!==t){t=~~Math.round(t-this.camera.x),i=~~Math.round(i-this.camera.y);for(var o=0;o<e.length;o++)this.ctx.drawImage(this.textCharset.canvas,h*e.charCodeAt(o),l*this._pen,h,l,t,i,h,l),t+=4;return this}for(o=0;o<e.length;o++){this._cursor.j>=this._textLine&&this.textScroll();var n=e.charCodeAt(o);10!==n&&13!==n?(this.ctx.drawImage(this.textCharset.canvas,h*n,l*this._pen,h,l,4*this._cursor.i,6*this._cursor.j+this._textOffset,h,l),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},o.prototype.println=function(t){return this.print(t),this.print("\n"),this},o.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{"./index.js":66}],68:[function(t,e,i){"use strict";var o=t("../Texture"),n=t(".."),h=8,l=8;function u(t,e,i,o,n,s,r,a){this.x=~~t,this.y=~~e,this.sprite=~~i,this.flipH=!!o,this.flipV=!!n,this.flipR=!!s,this.flagA=!!r,this.flagB=!!a}function s(t,e){this._name="",this.width=0,this.height=0,this.items=[],this.texture=null,this.tilesheet=null,this._tilesheetPath="",t&&e&&this._init(t,e)}(e.exports=s).prototype._isTileMap=!0;var a,d,r={},c=[];s.getMap=function(t){return"string"==typeof t?r[t]:"number"==typeof t?c[t]:(console.error("Map does not exist",t),null)},s._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:{_type:"maps",maps:[]}},s.loadBank=function(t){t=s._checkBankFormat(t),r={},c=[];for(var e=t.maps||[],i=0;i<e.length;i++)c.push((new s).load(e[i]))},s.setTileSize=function(t,e){h=~~t,l=~~e},Object.defineProperty(s.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&r[this._name]&&r[this._name]===this&&delete r[this._name],(this._name=t)&&!r[t]&&(r[t]=this)}}),s.prototype._init=function(t,e){this.width=t,this.height=e,this.items=[];for(var i=0;i<t;i++){this.items.push([]);for(var o=0;o<e;o++)this.items[i][o]=null}this.texture&&this.texture.resize(t*h,e*l)},s.prototype.resize=function(t,e){var i=this.items,o=Math.min(this.width,t),n=Math.min(this.height,e);this._init(t,e);for(var s=0;s<o;s++)for(var r=0;r<n;r++)this.items[s][r]=i[s][r];return this.redraw(),this},s.prototype.set=function(t,e,i,o,n,s,r,a){if(null==i)return this.remove(t,e);if(!(t<0||e<0||t>=this.width||e>=this.height)){var c=this.items[t][e]=new u(t,e,i,o,n,s,r,a);return this.texture&&(this.texture.ctx.clearRect(t*h,e*l,h,l),this.texture.sprite(c.sprite,c.x*h,c.y*l,c.flipH,c.flipV,c.flipR)),this}},s.prototype.remove=function(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.items[t][e]=null,this.texture&&this.texture.ctx.clearRect(t*h,e*l,h,l),this},s.prototype.get=function(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.items[t][e]},s.prototype.redraw=function(){if(!this.texture)return this;this.texture.clear();for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++){var i=this.items[t][e];i&&this.texture.sprite(i.sprite,i.x*h,i.y*l,i.flipH,i.flipV,i.flipR)}return this},s.prototype._prepareTexture=function(){this.texture=new o(this.width*h,this.height*l),this.texture.setTilesheet(this.tilesheet),this.redraw()},s.prototype.release=function(){this.texture=null},s.prototype.draw=function(t,e){this.texture||this._prepareTexture(),draw(this.texture,t,e)},s.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture&&(this.texture.setTilesheet(t),this.redraw()),this},s.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();for(var e=t.split("/"),i=n.assets||{},o=0;o<e.length;o++)if(!(i=i[e[o]]))return console.warn("Could not find tilesheet",t);this.setTilesheet(i)},function(){for(var i="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",h={},t=0;t<i.length;t++)h[i[t]]=t;var l=i.length,u=l*l-1,p=Math.pow(2,13),s=u-p-1;function r(t){var e=t%l;return i[~~(t/l)]+i[e]}a=function(t){for(var e="",i=0,o=0;o<t.length;o++){var n=t[o];n===t[o+1]&&++i<s||(null===n&&(n=u),e+=r(n),i===s&&i--,0!==i&&(e+=r(p+i)),i=0)}return i===s&&i--,0!==i&&(e+=r(p+i)),e},d=function(t){for(var e=[],i=0;i<t.length;){var o=t[i++],n=t[i++],s=h[o]*l+h[n];if(s===u)e.push(null);else if(p<s)for(var r=s-p,a=e[e.length-1],c=0;c<r;c++)e.push(a);else e.push(s)}return e}}(),s.prototype.save=function(){for(var t=this.width,e=this.height,i=new Array(t*e),o=0;o<t;o++)for(var n=0;n<e;n++){var s=this.items[o][n];i[o+n*t]=s?s.sprite+(s.flipH<<8)+(s.flipV<<9)+(s.flipR<<10)+(s.flagA<<11)+(s.flagB<<12):null}return{w:t,h:e,name:this.name,sheet:this._tilesheetPath||"",data:a(i)}},s.prototype.load=function(t){this.texture=null;var e=t.w,i=t.h;this._init(e,i),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var o=d(t.data),n=0;n<e;n++)for(var s=0;s<i;s++){var r=o[n+s*e];if(null!==r){var a=255&r,c=r>>8&1,h=r>>9&1,l=r>>10&1,u=r>>11&1,p=r>>12&1;this.set(n,s,a,c,h,l,u,p)}}return this},s.prototype.copy=function(t,e,i,o){t=t||0,e=e||0,null==i&&(i=this.width),null==o&&(o=this.height);var n=new s(i,o);return n.paste(this,-t,-e),n},s.prototype.paste=function(t,e,i,o){e=e||0,i=i||0;for(var n=Math.min(t.width,this.width-e),s=Math.min(t.height,this.height-i),r=Math.max(0,-e),a=Math.max(0,-i),c=r;c<n;c++)for(var h=a;h<s;h++){var l=t.items[c][h];if(l)this.set(c+e,h+i,l.sprite,l.flipH,l.flipV,l.flipR,l.flagA,l.flagB);else{if(o)continue;this.remove(c+e,h+i)}}return this},s.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]=null;return this.texture&&this.texture.clear(),this},s.prototype.find=function(t,e,i){if(null===t)return this._findNull();void 0===e&&(e=null),void 0===i&&(i=null);for(var o=[],n=0;n<this.width;n++)for(var s=0;s<this.height;s++){var r=this.items[n][s];if(r){var a=null===e||r.flagA===e,c=null===i||r.flagB===i;r.sprite===t&&a&&c&&o.push(r)}}return o},s.prototype._findNull=function(){for(var t=[],e=0;e<this.width;e++)for(var i=0;i<this.height;i++)null===this.items[e][i]&&t.push({x:e,y:i});return t}},{"..":72,"../Texture":66}],69:[function(t,e,i){"use strict";function d(t,e){var i=new Image;i.onload=function(){this.onload=null,this.onerror=null,e&&e(null,this)},i.onerror=function(){this.onload=null,this.onerror=null,e&&e("img:"+t)},i.src=t}function f(t,e){var i=new Audio;function o(){e&&e(null,i),i.removeEventListener("canplaythrough",o),i.removeEventListener("error",n)}function n(){e&&e("snd:load"),i.removeEventListener("canplaythrough",o),i.removeEventListener("error",n)}i.preload=!0,i.loop=!1,i.addEventListener("canplaythrough",o),i.addEventListener("error",n),i.src=t,i.load()}i.loadData=function(t,e,i){var o=new XMLHttpRequest;o.responseType=e||"arraybuffer",o.onreadystatechange=function(){if(4==~~o.readyState)return 200!=~~o.status&&0!=~~o.status?i&&i("xhrError:"+o.status):i&&i(null,o.response)},o.open("GET",t,!0),o.send()},i.loadJson=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==~~i.readyState)return 200!=~~i.status?e("xhrError:"+i.status):e&&e(null,JSON.parse(i.response))},i.open("GET",t,!0),i.send()},i.loadImage=d,i.loadSound=f,i.preloadStaticAssets=function(o,n,s){var a=o.dat,r=o.img.length,c=r+o.snd.length,h=o.root,l=0,u=0;function p(){var i,t,e=l+u;s&&s(l,e,c,e/c),t=e<r?(i=o.img[e],d):(i=o.snd[e-r],f),u+=1,t(h+i,function(t,e){t||function(t,e){var i=t.split("/"),o=i.pop().split(".");o.pop(),o=o.join(".");for(var n=a,s=0,r=i.length;s<r;s++)n=n[i[s]];n[o]=e,i.push(o),e.name=o,e.path=i.join("/")}(i,e),(l+=1)+--u<c?p():0===u&&n(null,a)})}if(0===c)return n(null,a);for(var t=Math.min(5,c-1),e=0;e<=t;e++)p()}},{}],70:[function(t,e,i){"use strict";e.exports=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}},{}],71:[function(t,e,i){"use strict";var u=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],o=!(!navigator||!navigator.getGamepads),p=!1,d=.2;function n(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}n.prototype._setupButtons=function(){for(var t=0;t<u.length;t++){var e=u[t];this.btn[e]=!1,this.btnp[e]=!1,this.btnr[e]=!1}};var f=[new n,new n,new n,new n,window],s=new n;var r=o?function(){for(var t=navigator.getGamepads(),e=0;e<4;e++){var i=t[e],o=f[e];if(i){var n,s,r,a;o.available=!0,p&&(n=o.btn.right,s=o.btn.left,a=o.btn.down,r=o.btn.up);for(var c=0;c<u.length;c++){var h=u[c],l=i.buttons[c].pressed;o.btnp[h]=!o.btn[h]&&l,o.btnr[h]=o.btn[h]&&!l,o.btn[h]=l}o.x=i.axes[0],o.y=i.axes[1],o.z=i.axes[2],o.w=i.axes[3],o.lt=i.buttons[6].value,o.rt=i.buttons[7].value,p&&(o.btn.right=o.btn.right||o.x>d,o.btn.left=o.btn.left||o.x<-d,o.btn.down=o.btn.down||o.y>d,o.btn.up=o.btn.up||o.y<-d,o.btnp.right=o.btn.right&&!n,o.btnp.left=o.btn.left&&!s,o.btnp.down=o.btn.down&&!a,o.btnp.up=o.btn.up&&!r,o.btnr.right=!o.btn.right&&n,o.btnr.left=!o.btn.left&&s,o.btnr.down=!o.btn.down&&a,o.btnr.up=!o.btn.up&&r)}else o.available=!1}return f}:function(){return f};i.mapAnalogStickToDpad=function(t){p=!0,d=void 0===t?.3:t},i.update=function(){window.gamepads=r(),window.gamepad=function(){for(var t=0;t<u.length;t++){var e=u[t];s.btnp[e]=btnp[e]||f[0].btnp[e]||f[1].btnp[e]||f[2].btnp[e]||f[3].btnp[e],s.btnr[e]=btnr[e]||f[0].btnr[e]||f[1].btnr[e]||f[2].btnr[e]||f[3].btnr[e],s.btn[e]=btn[e]||f[0].btn[e]||f[1].btn[e]||f[2].btn[e]||f[3].btn[e]}return s.btn.up&&s.btn.down&&(s.btn.down=!1),s.btn.right&&s.btn.left&&(s.btn.left=!1),s}()}},{}],72:[function(t,e,i){"use strict";e.exports={}},{}],73:[function(t,e,i){"use strict";e.exports=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],74:[function(t,e,i){"use strict";var u=t("./Scalar");function o(){}(e.exports=o).lineInt=function(t,e,i){i=i||0;var o,n,s,r,a,c,h,l=[0,0];return o=t[1][1]-t[0][1],n=t[0][0]-t[1][0],s=o*t[0][0]+n*t[0][1],r=e[1][1]-e[0][1],a=e[0][0]-e[1][0],c=r*e[0][0]+a*e[0][1],h=o*a-r*n,u.eq(h,0,i)||(l[0]=(a*s-n*c)/h,l[1]=(o*c-r*s)/h),l},o.segmentsIntersect=function(t,e,i,o){var n=e[0]-t[0],s=e[1]-t[1],r=o[0]-i[0],a=o[1]-i[1];if(r*s-a*n==0)return!1;var c=(n*(i[1]-t[1])+s*(t[0]-i[0]))/(r*s-a*n),h=(r*(t[1]-i[1])+a*(i[0]-t[0]))/(a*n-r*s);return 0<=c&&c<=1&&0<=h&&h<=1}},{"./Scalar":77}],75:[function(t,e,i){"use strict";function h(){}(e.exports=h).area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},h.left=function(t,e,i){return 0<h.area(t,e,i)},h.leftOn=function(t,e,i){return 0<=h.area(t,e,i)},h.right=function(t,e,i){return h.area(t,e,i)<0},h.rightOn=function(t,e,i){return h.area(t,e,i)<=0};var l=[],u=[];h.collinear=function(t,e,i,o){if(o){var n=l,s=u;n[0]=e[0]-t[0],n[1]=e[1]-t[1],s[0]=i[0]-e[0],s[1]=i[1]-e[1];var r=n[0]*s[0]+n[1]*s[1],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]),c=Math.sqrt(s[0]*s[0]+s[1]*s[1]);return Math.acos(r/(a*c))<o}return 0==h.area(t,e,i)},h.sqdist=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o}},{}],76:[function(t,e,i){"use strict";var a=t("./Line"),w=t("./Point"),p=t("./Scalar");function S(){this.vertices=[]}(e.exports=S).prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},S.prototype.first=function(){return this.vertices[0]},S.prototype.last=function(){return this.vertices[this.vertices.length-1]},S.prototype.clear=function(){this.vertices.length=0},S.prototype.append=function(t,e,i){if(void 0===e)throw new Error("From is not given!");if(void 0===i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var o=e;o<i;o++)this.vertices.push(t.vertices[o])},S.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);w.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},S.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},S.prototype.isReflex=function(t){return w.right(this.at(t-1),this.at(t),this.at(t+1))};var c=[],h=[];function x(t,e,i,o,n){n=n||0;var s=e[1]-t[1],r=t[0]-e[0],a=s*t[0]+r*t[1],c=o[1]-i[1],h=i[0]-o[0],l=c*i[0]+h*i[1],u=s*h-c*r;return p.eq(u,0,n)?[0,0]:[(h*a-r*l)/u,(s*l-c*a)/u]}S.prototype.canSee=function(t,e){var i,o,n=c,s=h;if(w.leftOn(this.at(t+1),this.at(t),this.at(e))&&w.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;o=w.sqdist(this.at(t),this.at(e));for(var r=0;r!==this.vertices.length;++r)if((r+1)%this.vertices.length!==t&&r!==t&&w.leftOn(this.at(t),this.at(e),this.at(r+1))&&w.rightOn(this.at(t),this.at(e),this.at(r))&&(n[0]=this.at(t),n[1]=this.at(e),s[0]=this.at(r),s[1]=this.at(r+1),i=a.lineInt(n,s),w.sqdist(this.at(t),i)<o))return!1;return!0},S.prototype.copy=function(t,e,i){var o=i||new S;if(o.clear(),t<e)for(var n=t;n<=e;n++)o.vertices.push(this.vertices[n]);else{for(n=0;n<=e;n++)o.vertices.push(this.vertices[n]);for(n=t;n<this.vertices.length;n++)o.vertices.push(this.vertices[n])}return o},S.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],o=new S,n=Number.MAX_VALUE,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var r=0;r<this.vertices.length;++r)if(this.canSee(s,r)){e=this.copy(s,r,o).getCutEdges(),i=this.copy(r,s,o).getCutEdges();for(var a=0;a<i.length;a++)e.push(i[a]);e.length<n&&(n=(t=e).length,t.push([this.at(s),this.at(r)]))}return t},S.prototype.decomp=function(){var t=this.getCutEdges();return 0<t.length?this.slice(t):[this]},S.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var o=t[i],n=0;n<e.length;n++){var s=e[n].slice(o);if(s){e.splice(n,1),e.push(s[0],s[1]);break}}return e}o=t,i=this.vertices.indexOf(o[0]),n=this.vertices.indexOf(o[1]);return-1!=i&&-1!=n&&[this.copy(i,n),this.copy(n,i)]},S.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(a.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(e=1;e<t.length-2;e++)if(a.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},S.prototype.quickDecomp=function(t,e,i,o,n,s){n=n||100,s=s||0,o=o||25,t=void 0!==t?t:[],e=e||[],i=i||[];var r=[0,0],a=[0,0],c=[0,0],h=0,l=0,u=0,p=0,d=0,f=0,v=0,y=new S,m=new S,g=this,b=this.vertices;if(b.length<3)return t;if(n<++s)return console.warn("quickDecomp: max level ("+n+") reached."),t;for(var A=0;A<this.vertices.length;++A)if(g.isReflex(A)){e.push(g.vertices[A]),h=l=Number.MAX_VALUE;for(var E=0;E<this.vertices.length;++E)w.left(g.at(A-1),g.at(A),g.at(E))&&w.rightOn(g.at(A-1),g.at(A),g.at(E-1))&&(c=x(g.at(A-1),g.at(A),g.at(E),g.at(E-1)),w.right(g.at(A+1),g.at(A),c)&&(u=w.sqdist(g.vertices[A],c))<l&&(l=u,a=c,f=E)),w.left(g.at(A+1),g.at(A),g.at(E+1))&&w.rightOn(g.at(A+1),g.at(A),g.at(E))&&(c=x(g.at(A+1),g.at(A),g.at(E),g.at(E+1)),w.left(g.at(A-1),g.at(A),c)&&(u=w.sqdist(g.vertices[A],c))<h&&(h=u,r=c,d=E));if(f==(d+1)%this.vertices.length)c[0]=(a[0]+r[0])/2,c[1]=(a[1]+r[1])/2,i.push(c),A<d?(y.append(g,A,d+1),y.vertices.push(c),m.vertices.push(c),0!=f&&m.append(g,f,g.vertices.length),m.append(g,0,A+1)):(0!=A&&y.append(g,A,g.vertices.length),y.append(g,0,d+1),y.vertices.push(c),m.vertices.push(c),m.append(g,f,A+1));else{if(d<f&&(d+=this.vertices.length),p=Number.MAX_VALUE,d<f)return t;for(E=f;E<=d;++E)w.leftOn(g.at(A-1),g.at(A),g.at(E))&&w.rightOn(g.at(A+1),g.at(A),g.at(E))&&(u=w.sqdist(g.at(A),g.at(E)))<p&&(p=u,v=E%this.vertices.length);A<v?(y.append(g,A,v+1),0!=v&&m.append(g,v,b.length),m.append(g,0,A+1)):(0!=A&&y.append(g,A,b.length),y.append(g,0,v+1),m.append(g,v,A+1))}return y.vertices.length<m.vertices.length?(y.quickDecomp(t,e,i,o,n,s),m.quickDecomp(t,e,i,o,n,s)):(m.quickDecomp(t,e,i,o,n,s),y.quickDecomp(t,e,i,o,n,s)),t}return t.push(this),t},S.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;3<this.vertices.length&&0<=i;--i)w.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":74,"./Point":75,"./Scalar":77}],77:[function(t,e,i){"use strict";function o(){}(e.exports=o).eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],78:[function(t,e,i){"use strict";e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":75,"./Polygon":76}],79:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,s=(o=t("./Electron.js"))&&o.__esModule?o:{default:o},r=t("./main.js");function a(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var n=function(){function n(t,e,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.sprite=0,this.z=1,this.tilePos=t,this.pulseTime=i,this.pulseSpeed=o,this.charges=e,this.pulseCount=0,this.pulseTimer=this.pulseTime,r.em.AddUpdate(this)}var t,e,i;return t=n,(e=[{key:"Pulse",value:function(){var t=new s.default({x:(this.tilePos.x+1.5)*r.PIXEL_SCALE,y:(this.tilePos.y+.5)*r.PIXEL_SCALE},{chargedSprite:18,unchargedSprite:19},this.pulseSpeed);this.pulseCount++,t.SetVelocity({x:this.pulseSpeed,y:0})}},{key:"Update",value:function(t){this.pulseCount<this.charges&&(this.pulseTimer+=t,this.pulseTimer>=this.pulseTime&&(this.Pulse(),this.pulseTimer-=this.pulseTime,this.sprite++))}}])&&a(t.prototype,e),i&&a(t,i),n}();i.default=n},{"./Electron.js":81,"./main.js":84}],80:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=t("./main");function s(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.tilePos=t,this.spriteInfo=e,this.z=10,n.em.AddRender(this)}var t,e,o;return t=i,(e=[{key:"Draw",value:function(){sprite(this.spriteInfo.index,this.tilePos.x*n.PIXEL_SCALE,this.tilePos.y*n.PIXEL_SCALE,this.spriteInfo.flipX,this.spriteInfo.flipY,this.spriteInfo.flipR)}}])&&s(t.prototype,e),o&&s(t,o),i}();i.default=o},{"./main":84}],81:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=t("./main");function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function o(t,e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.chargedSprite=e.chargedSprite,this.unchargedSprite=e.unchargedSprite,this.isCharged=!0,this.logging=!1,this.speed=i,this.contact=null,this.approach=null,this.z=5,this.velocity={x:0,y:0},s.em.AddRender(this),s.em.AddPhys(this,{mass:1,position:[t.x,-t.y],tag:"ELECTRON",colliderRect:{width:s.PIXEL_SCALE/2,height:s.PIXEL_SCALE/2}}),s.em.AddUpdate(this)}var t,e,i;return t=o,(e=[{key:"CompareCentre",value:function(t,e){var i=!1,o=0;"X"===this.approach.axis?o=0:"Y"===this.approach.axis&&(o=1);var n=e.phys.position[o]-t.phys.position[o];return this.logging&&console.log("Centre Dist: x="+xDist+", y="+yDist+", PIXEL_SCALE="+s.PIXEL_SCALE),Math.sign(n)!==this.approach.dir&&(i=!0),i}},{key:"GetXDiff",value:function(t,e){return e.phys.position[0]-t.phys.position[0]}},{key:"GetYDiff",value:function(t,e){return e.phys.position[1]-t.phys.position[1]}},{key:"SetContact",value:function(t){this.contact=t;var e=this.GetXDiff(this,t),i=this.GetYDiff(this,t);Math.abs(e)>Math.abs(i)?this.approach={axis:"X",dir:Math.sign(e)}:Math.abs(i)>Math.abs(e)?this.approach={axis:"Y",dir:Math.sign(i)}:((0,s.consoleLog)("Something has gone horribly wrong in Electron.SetContact"),(0,s.consoleLog)(e),(0,s.consoleLog)(i)),this.logging&&((0,s.consoleLog)("CONTACT SET!"),(0,s.consoleLog)(this),(0,s.consoleLog)(t))}},{key:"SetVelocity",value:function(t){this.velocity=t}},{key:"SnapToContact",value:function(t){for(var e=0;e<t.phys.position.length;e++)this.phys.position[e]=t.phys.position[e]}},{key:"Update",value:function(){if(this.phys.velocity=[this.velocity.x,this.velocity.y],this.contact&&this.CompareCentre(this,this.contact)){var t=this.contact.GetFlippedDirection(this.phys.velocity);this.SnapToContact(this.contact),this.SetVelocity({x:t[0]*this.speed,y:t[1]*this.speed}),this.contact=null}}},{key:"Draw",value:function(){sprite(this.isCharged?this.chargedSprite:this.unchargedSprite,this.phys.position[0]-.5*s.PIXEL_SCALE,-this.phys.position[1]-.5*s.PIXEL_SCALE)}}])&&n(t.prototype,e),i&&n(t,i),o}();i.default=o},{"./main":84}],82:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=t("./main.js");function s(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.phys=t?null:new n.p2.World({gravity:[0,0]}),this.map=null,this.renderers=[],this.updates=[],this.phys&&this.SetupPhys()}var t,i,o;return t=e,(i=[{key:"CompareTags",value:function(t,e,i){return t.bodyA.tag===e&&t.bodyB.tag===i||t.bodyA.tag===i&&t.bodyB.tag===e}},{key:"BodyWithTag",value:function(t,e){var i=null;return t.bodyA.tag===e?i=t.bodyA:t.bodyB.tag===e&&(i=t.bodyB),i}},{key:"SetupPhys",value:function(){var o=this;this.phys.on("beginContact",function(t){if(o.CompareTags(t,"ELECTRON","POINTS")){var e=o.BodyWithTag(t,"ELECTRON"),i=o.BodyWithTag(t,"POINTS");e.obj.SetContact(i.obj)}})}},{key:"AddPhys",value:function(t,e){t.phys=new n.p2.Body({mass:e.mass,position:e.position,fixedRotation:!0}),t.phys.obj=t,e.tag&&(t.phys.tag=e.tag),e.isKinematic&&(t.phys.type=n.p2.Body.KINEMATIC);var i=new n.p2.Box(e.colliderRect);i.friction=0,e.isSensor&&(i.sensor=e.isSensor),t.phys.addShape(i),this.phys.addBody(t.phys)}},{key:"SortRenders",value:function(){this.renderers.sort(function(t,e){return t.z-e.z})}},{key:"AddRender",value:function(t){this.renderers.push(t),this.SortRenders()}},{key:"RemoveRender",value:function(t){for(var e=0;e<this.renderers.length;e++)if(this.renderers[e]===t){this.renderers.splice(e,1);break}this.SortRenders()}},{key:"AddUpdate",value:function(t){this.updates.push(t)}},{key:"RemoveUpdate",value:function(t){for(var e=0;e<this.updates.length;e++)if(this.updates[e]===t){this.updatable.splice(e,1);break}}},{key:"Render",value:function(){cls(),this.map&&this.map.draw(0,0);for(var t=0;t<this.renderers.length;t++)this.renderers[t].Draw()}},{key:"Update",value:function(t){this.phys&&this.phys.step(t);for(var e=0;e<this.updates.length;e++)this.updates[e].Update(t)}}])&&s(t.prototype,i),o&&s(t,o),e}();i.default=o},{"./main.js":84}],83:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=t("./main");function s(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.tilePos=t,this.dirMap=e,this.z=2,n.em.AddPhys(this,{mass:1,position:[(this.tilePos.x+.5)*n.PIXEL_SCALE,-(this.tilePos.y+.5)*n.PIXEL_SCALE],isSensor:!0,tag:"POINTS",isKinematic:!0,colliderRect:{width:n.PIXEL_SCALE,height:n.PIXEL_SCALE}}),n.em.AddRender(this)}var t,e,o;return t=i,(e=[{key:"GetVert",value:function(){for(var t="",e=0;e<this.dirMap.dir.length;e++)if("U"===this.dirMap.dir[e]||"D"===this.dirMap.dir[e]){t=this.dirMap.dir[e];break}return t}},{key:"GetHoriz",value:function(){for(var t="",e=0;e<this.dirMap.dir.length;e++)if("L"===this.dirMap.dir[e]||"R"===this.dirMap.dir[e]){t=this.dirMap.dir[e];break}return t}},{key:"GetFlippedDirection",value:function(t){var e=this.GetHoriz(),i=this.GetVert();return Math.abs(t[0])>Math.abs(t[1])?(0<t[0]&&"R"===e||t[0]<0&&"L"===e?t[1]="U"===i?1:-1:(0<t[0]&&"L"===e||t[0]<0&&"R"===e)&&(t[1]="U"===i?-1:1),t[0]=0):Math.abs(t[1])>Math.abs(t[0])&&(0<t[1]&&"U"===i||t[1]<0&&"D"===i||0<t[1]&&"D"===i||t[1]<0&&"U"===i?t[0]="R"===e?-1:1:(0,n.consoleLog)("X NOT SET!"),t[1]=0),t}},{key:"Draw",value:function(){pen(9),rect(this.phys.position[0]-.5*n.PIXEL_SCALE,-this.phys.position[1]-.5*n.PIXEL_SCALE,n.PIXEL_SCALE,n.PIXEL_SCALE)}}])&&s(t.prototype,e),o&&s(t,o),i}();i.default=o},{"./main":84}],84:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.consoleLog=m,i.PIXEL_SCALE=i.TOTAL_SPRITES=i.p2=i.em=void 0;var o=n(t("./EntityManager.js")),u=n(t("./Battery.js")),p=n(t("./Component.js")),d=n(t("./RailPoint.js"));function n(t){return t&&t.__esModule?t:{default:t}}var s=!1;i.TOTAL_SPRITES=255;var f;i.PIXEL_SCALE=16,i.em=f;var r=t("p2");i.p2=r;var a=!0,c=[{dir:"RD",flipX:!1,flipY:!1,flipR:!1},{dir:"RU",flipX:!1,flipY:!0,flipR:!1},{dir:"LD",flipX:!0,flipY:!1,flipR:!1},{dir:"LU",flipX:!0,flipY:!1,flipR:!0},{dir:"LU",flipX:!0,flipY:!0,flipR:!1}],v=[{type:"Battery",index:0},{type:"Direction",index:5},{type:"Corner",index:2}];function y(t,e,i){for(var o=null,n=0;n<c.length;n++){var s=c[n];if(s.flipX===t&&s.flipY===e&&s.flipR===i){o=s;break}}return null===o&&(m("DIR MAP NOT FOUND!"),m("GET DIR MAP: X: "+t+", Y:"+e+", R: "+i)),o}function m(t){a&&console.log(t)}function h(t){for(var e=getMap(t),i=[],o=[],n=function(){for(var t=0,e=0;e<v.length;e++)if("Corner"===v[e].type){t=v[e].index;break}return t}(),s=0;s<v.length;s++)for(var r=e.find(v[s].index),a=0;a<r.length;a++){var c=r[a];v[s].index===n?o.push(c):i.push({tileX:c.x,tileY:c.y,tileType:v[s].type,tileSprite:c.sprite,tileData:c})}f.map=e,m("=== MAP DEFINITIONS ==="),m(JSON.stringify(i)),m("=======================");var h=function(t){for(var e=assets.mapDefs.mapDefs,i=null,o=0;o<e.length;o++)e[o].name===t&&(i=e[o]);return i}(t);m("=== ADDITIONAL MAP DEF ==="),m(h),m("==========================");for(s=0;s<h.components.length;s++){var l=h.components[s];if(l.component)new p.default({x:l.tileX,y:l.tileY},{index:l.component.sprite,flipX:l.component.flipX,flipY:l.component.flipY,flipR:l.component.flipR});else if(l.battery)new u.default({x:l.tileX,y:l.tileY},l.battery.charges,l.battery.pulseTime,l.battery.pulseSpeed)}for(s=0;s<o.length;s++)new d.default({x:o[s].x,y:o[s].y},y(o[s].flipH,o[s].flipV,o[s].flipR))}i.update=function(){s||(paper(1),assets.mapDefs.mapDefs,i.em=f=new o.default,h("map"),s=!0),f.Update(1/60),f.Render()}},{"./Battery.js":79,"./Component.js":80,"./EntityManager.js":82,"./RailPoint.js":83,p2:38}],85:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],86:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],87:[function(t,e,d){var a=/%[sdj%]/g;d.format=function(t){if(!E(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(c(arguments[i]));return e.join(" ")}i=1;for(var o=arguments,n=o.length,s=String(t).replace(a,function(t){if("%%"===t)return"%";if(n<=i)return t;switch(t){case"%s":return String(o[i++]);case"%d":return Number(o[i++]);case"%j":try{return JSON.stringify(o[i++])}catch(t){return"[Circular]"}default:return t}}),r=o[i];i<n;r=o[++i])b(r)||!h(r)?s+=" "+r:s+=" "+c(r);return s},d.deprecate=function(t,e){if(w(global.process))return function(){return d.deprecate(t,e).apply(this,arguments)};if(!0===process.noDeprecation)return t;var i=!1;return function(){if(!i){if(process.throwDeprecation)throw new Error(e);process.traceDeprecation?console.trace(e):console.error(e),i=!0}return t.apply(this,arguments)}};var o,n={};function c(t,e){var i={seen:[],stylize:r};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),g(e)?i.showHidden=e:e&&d._extend(i,e),w(i.showHidden)&&(i.showHidden=!1),w(i.depth)&&(i.depth=2),w(i.colors)&&(i.colors=!1),w(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=s),f(i,t,i.depth)}function s(t,e){var i=c.styles[e];return i?"["+c.colors[i][0]+"m"+t+"["+c.colors[i][1]+"m":t}function r(t,e){return t}function f(e,i,o){if(e.customInspect&&i&&P(i.inspect)&&i.inspect!==d.inspect&&(!i.constructor||i.constructor.prototype!==i)){var t=i.inspect(o,e);return E(t)||(t=f(e,t,o)),t}var n=function(t,e){if(w(e))return t.stylize("undefined","undefined");if(E(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(A(e))return t.stylize(""+e,"number");if(g(e))return t.stylize(""+e,"boolean");if(b(e))return t.stylize("null","null")}(e,i);if(n)return n;var s,r=Object.keys(i),a=(s={},r.forEach(function(t,e){s[t]=!0}),s);if(e.showHidden&&(r=Object.getOwnPropertyNames(i)),B(i)&&(0<=r.indexOf("message")||0<=r.indexOf("description")))return v(i);if(0===r.length){if(P(i)){var c=i.name?": "+i.name:"";return e.stylize("[Function"+c+"]","special")}if(S(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(x(i))return e.stylize(Date.prototype.toString.call(i),"date");if(B(i))return v(i)}var h,l="",u=!1,p=["{","}"];m(i)&&(u=!0,p=["[","]"]),P(i)&&(l=" [Function"+(i.name?": "+i.name:"")+"]");return S(i)&&(l=" "+RegExp.prototype.toString.call(i)),x(i)&&(l=" "+Date.prototype.toUTCString.call(i)),B(i)&&(l=" "+v(i)),0!==r.length||u&&0!=i.length?o<0?S(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),h=u?function(e,i,o,n,t){for(var s=[],r=0,a=i.length;r<a;++r)C(i,String(r))?s.push(y(e,i,o,n,String(r),!0)):s.push("");return t.forEach(function(t){t.match(/^\d+$/)||s.push(y(e,i,o,n,t,!0))}),s}(e,i,o,a,r):r.map(function(t){return y(e,i,o,a,t,u)}),e.seen.pop(),function(t,e,i){if(60<t.reduce(function(t,e){return 0<=e.indexOf("\n")&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(h,l,p)):p[0]+l+p[1]}function v(t){return"["+Error.prototype.toString.call(t)+"]"}function y(t,e,i,o,n,s){var r,a,c;if((c=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),C(o,n)||(r="["+n+"]"),a||(t.seen.indexOf(c.value)<0?-1<(a=b(i)?f(t,c.value,null):f(t,c.value,i-1)).indexOf("\n")&&(a=s?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),w(r)){if(s&&n.match(/^\d+$/))return a;r=(r=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),t.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(r,"string"))}return r+": "+a}function m(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function b(t){return null===t}function A(t){return"number"==typeof t}function E(t){return"string"==typeof t}function w(t){return void 0===t}function S(t){return h(t)&&"[object RegExp]"===i(t)}function h(t){return"object"==typeof t&&null!==t}function x(t){return h(t)&&"[object Date]"===i(t)}function B(t){return h(t)&&("[object Error]"===i(t)||t instanceof Error)}function P(t){return"function"==typeof t}function i(t){return Object.prototype.toString.call(t)}function l(t){return t<10?"0"+t.toString(10):t.toString(10)}d.debuglog=function(e){if(w(o)&&(o=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!n[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var i=process.pid;n[e]=function(){var t=d.format.apply(d,arguments);console.error("%s %d: %s",e,i,t)}}else n[e]=function(){};return n[e]},(d.inspect=c).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},d.isArray=m,d.isBoolean=g,d.isNull=b,d.isNullOrUndefined=function(t){return null==t},d.isNumber=A,d.isString=E,d.isSymbol=function(t){return"symbol"==typeof t},d.isUndefined=w,d.isRegExp=S,d.isObject=h,d.isDate=x,d.isError=B,d.isFunction=P,d.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},d.isBuffer=t("./support/isBuffer");var u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}d.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[l(t.getHours()),l(t.getMinutes()),l(t.getSeconds())].join(":"),[t.getDate(),u[t.getMonth()],e].join(" ")),d.format.apply(d,arguments))},d.inherits=t("inherits"),d._extend=function(t,e){if(!e||!h(e))return t;for(var i=Object.keys(e),o=i.length;o--;)t[i[o]]=e[i[o]];return t}},{"./support/isBuffer":86,inherits:85}],88:[function(f,t,e){"use strict";var i,o,u=f("."),n={dat:{palette:null,tilesheet:null,mapDefs:{mapDefs:[{name:"map",components:[{tileX:7,tileY:0,tileType:"Battery",tileSprite:0,battery:{charges:10,pulseTime:2,pulseSpeed:60}},{tileX:0,tileY:7,tileType:"Direction",tileSprite:5,component:{sprite:6,flipX:!1,flipY:!1,flipR:!1}},{tileX:13,tileY:7,tileType:"Direction",tileSprite:5,component:{sprite:6,flipX:!1,flipY:!0,flipR:!1}}]}]},maps:{_type:"maps",maps:[{w:16,h:16,name:"map",sheet:"tilesheet",data:"%l#$|0###$|/#%!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,#(#$|0#3#$|/#(!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,+=#$|6(T!!|<"}]}},root:"assets/",img:["palette.png","tilesheet.png"],snd:[],settings:{name:"LD47",version:"2.0.2",appid:"NcimdFsF2f2kAzBq",screen:{fullscreen:!1,resizable:!1,keepAspectRatio:!1,width:256,height:256,pixelSize:{width:4,height:4}},tileSize:{width:16,height:16},palette:{name:"db16",file:"palette",colors:["#140c1c","#deeed6","#d2aa99","#346524","#4e4a4e","#757161","#8595a1","#6daa2c","#854c30","#d04648","#d27d2c","#dad45e","#442434","#30346d","#597dce","#6dc2ca"]},controls:{up:38,down:40,left:37,right:39,A:32,B:88},touchEvent:{multiTouch:!1,disableContextMenu:!0,hideMousePointer:!1},gamepad:{analogToDpad:!0,deadZone:.5},loader:{colors:["#140C1C","#DEEED6"],custom:""}}},v=u.settings=n.settings,s=f("./assetLoader");function r(){i.resume(),document.body.removeEventListener("mousedown",r),document.body.removeEventListener("touchstart",r)}u.inherits=f("./inherits"),u.setFullScreen=function(){},i=null,o=window.AudioContext||window.webkitAudioContext,window.AudioContext=window.webkitAudioContext=function(){return i||(i=new o,document.body.addEventListener("mousedown",r),document.body.addEventListener("touchstart",r),i)};var a=f("audio-manager"),c=u.audioManager=new a(["sfx"]);c.settings.audioPath="audio/",c.settings.defaultFade=.3,c.init(),c.setVolume("sfx",1),u.sfx=function(t,e,i,o){c.playSound("sfx",t,e,i,o)},u.music=function(t,e,i,o){t?c.playLoopSound("sfx",t,e,0,0,i,o):c.stopLoopSound("sfx")};var h=u.btn={},l=u.btnp={},p=u.btnr={},d={},y=[],m=0;function g(){for(var t=0;t<m;t++)l[y[t]]=!1,p[y[t]]=!1}function b(t,e){var i=d[t];i&&(e&&!h[i]&&(l[i]=!0),!e&&h[i]&&(p[i]=!0),h[i]=e)}!function(){var t=v.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var e in t)d[t[e]]=e,h[e]=!1,l[e]=!1,p[e]=!1,y.push(e);m=y.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),t.repeat||b(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),b(t.keyCode,!1)}),u.chr$=function(t){return String.fromCharCode(t)},u.clamp=function(t,e,i){return Math.max(e,Math.min(i,t))},u.random=function(t,e){return void 0===e?~~(t*Math.random()):~~(t+Math.random()*(e-t))};var A=f("./Texture"),E=f("./TileMap");f("./Texture/canvas2D"),f("./Texture/textCanvas2D");var w=v.tileSize.width,S=v.tileSize.height;A.setTileSize(w,S),E.setTileSize(w,S),u.texture=function(t){var e=new A(t.width,t.height);return e.clear().draw(t,0,0),e},u.tilesheet=function(t){return A.prototype.setGlobalTilesheet(t)};var x=function(){var t=v.screen,c=t.width,h=t.height,l=t.pixelSize,e=u.$screen=new A(c,h),i=e.canvas,o=i.style;if(document.body.appendChild(i),t.fullscreen)if(t.keepAspectRatio){var n=function(){var t=window.innerWidth,e=window.innerHeight,i=c*l.width,o=h*l.height,n=Math.min(t/i,e/o),s=i*n,r=o*n,a=u.$screen.canvas.style;a.width=s+"px",a.height=r+"px",a.left=(t-s)/2+"px",a.top=(e-r)/2+"px"};addEventListener("resize",n),n()}else o.width=o.height="100%";else o.width=c*l.width+"px",o.height=h*l.height+"px";return e}();u.cls=function(){return x.cls()},u.sprite=function(t,e,i,o,n,s){return x.sprite(t,e,i,o,n,s)},u.draw=function(t,e,i,o,n,s){return x.draw(t,e,i,o,n,s)},u.rect=function(t,e,i,o){return x.rect(t,e,i,o)},u.rectf=function(t,e,i,o){return x.rectf(t,e,i,o)},u.camera=function(t,e){return x.setCamera(t,e)},u.pen=function(t){return x.pen(t)},u.paper=function(t){return x.paper(t)},u.locate=function(t,e){return x.locate(t,e)},u.print=function(t,e,i){return x.print(t,e,i)},u.println=function(t){return x.println(t)},u.getMap=E.getMap,u.rectfill=u.rectf,x.canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1});var B=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1/60)};window.frameId=0;var P=~~(v.screen.width/2),C=~~(v.screen.width/4),L=~~(v.screen.height/2);var q=["#000","#FFF"],M=v.loader&&v.loader.colors||v.loaderColors||q;Array.isArray(M)||(M=q);var I=f("./Color");x.setPalette([(new I).fromString(M[0]),(new I).fromString(M[1])]),x.paper(0).cls().paper(1).pen(1).rect(P-C-2,L-4,2*C+4,8),s.preloadStaticAssets(n,function(t,d){if(x.paper(0).pen(1).cls(),t)return console.error(t),void print(t);for(var e in u.assets=d,u)window[e]=u[e];(function(){var t=f("./Color"),e=v.palette;if(e.file){for(var i=e.file.split("/"),o=d;o&&i.length;)o=o[i.shift()];if(!o)return;var n=o.width,s=o.height,r=o.x||0,a=o.y||0;o._isSprite&&(o=o.img);var c=f("./domUtils/createCanvas")(n,s).getContext("2d");c.drawImage(o,r,a,n,s,0,0,n,s);for(var h=c.getImageData(0,0,n,s).data,l=[],u=0;u<h.length;u+=4)h[u+3]<=1||l.push((new t).fromPixel(h,u));x.setPalette(l)}else{var p;for(p=e.colors?e.colors:e,l=[],u=0;u<p.length;u++)l.push((new t).fromString(p[u]));x.setPalette(l)}})(),d.tilesheet&&u.tilesheet(d.tilesheet),E.loadBank(d.maps);var i=f("./gamepad"),o=v.gamepad||{};o.analogToDpad&&i.mapAnalogStickToDpad(o.deadZone);var n=f("../../src/main.js");n.update&&(g(),function t(){window.frameId+=1,i.update(),n.update(),g(),B(t)}())},function(t,e,i,o){x.rect(P-C-2,L-4,2*C+4,8).rectf(P-C,L-2,~~(o*C*2),4)})},{".":72,"../../src/main.js":84,"./Color":64,"./Texture":66,"./Texture/canvas2D":65,"./Texture/textCanvas2D":67,"./TileMap":68,"./assetLoader":69,"./domUtils/createCanvas":70,"./gamepad":71,"./inherits":73,"audio-manager":2}]},{},[88]);