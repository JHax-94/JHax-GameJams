!function n(s,a,l){function c(e,t){if(!a[e]){if(!s[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(p)return p(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var r=a[e]={exports:{}};s[e][0].call(r.exports,function(t){return c(s[e][1][t]||t)},r,r.exports,n,s,a,l)}return a[e].exports}for(var p="function"==typeof require&&require,t=0;t<l.length;t++)c(l[t]);return c}({1:[function(t,e,i){"use strict";function o(t){this.id=t,this.volume=1,this.muted=!0,this.loopSound=null,this.loopId=null,this.loopVol=0,this.nextLoop=null}(e.exports=o).prototype.setVolume=function(t,e){var i=this.muted;this.muted=0===t||e||!1,null!=t?this.volume=t:t=this.volume,this.loopId&&(this.loopSound&&this.muted?this.loopSound.stop():this.loopSound&&this.loopSound.id===this.loopId?(this.loopSound.setVolume(Math.max(0,Math.min(1,t*this.loopVol))),i&&this.loopSound.play()):this.muted||this.audioManager.playLoopSound(this.id,this.loopId,this.loopVol))},o.prototype.setMute=function(t){this.setVolume(null,t)},o.prototype.playLoopSound=function(t,i,o,r,n,s){var a=this.audioManager,l=a.settings.defaultFade,e=a.settings.crossFading,c=this.loopSound,p=c&&c.id;if(i=Math.max(0,Math.min(1,i||1)),this.loopId=t,this.loopVol=i,!a.muted&&!this.muted){if(t===p&&c)return c.play(i*this.volume,o,r),void(this.nextLoop&&(this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=null));if(c=null,!this.nextLoop||this.nextLoop.id!==t){var u=this;e?(this.nextLoop&&this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=a.createSound(t,this.id),this.nextLoop.load(function(t){if(t)return u.nextLoop.unload(),void(u.nextLoop=null);h(u.loopSound),d()})):(this.nextLoop=a.createSound(t,this.id),h(this.loopSound,d))}}function h(t,e){if(!t)return e&&e();t.stopping||t.stop(function(){return a.freeSound(t),t=null,e&&e()})}function f(){var e=u.loopSound=u.nextLoop;u.nextLoop=null,e&&(e.setLoop(!0,n,s),e.fade=l,e.load(function(t){if(t)return e.unload(),void(u.loopSound=null);e.play(i*u.volume,o,r)}))}function d(){u.loopSound=null,window.setTimeout(f,0)}}},{}],2:[function(t,e,i){"use strict";var o=window.AudioContext||window.webkitAudioContext,r=t("./OrderedList"),n=t("./SoundBuffered.js"),s=t("./SoundGroup.js"),a=t("./AudioChannel.js"),l=t("./ISound.js");function c(t){this.soundsById={},this.soundGroupsById={},this.permanentSounds={},this.freeSoundPool=[],this.soundArchive=new r(function(){return 1}),this.soundGroupArchive=new r(function(){return 1}),this.soundArchiveById={},this.soundGroupArchiveById={},this.usedMemory=0,this.channels={},this.audioContext=null,this.muted=!1,this.settings={audioPath:"",maxSoundGroup:500,maxUsedMemory:300,defaultFade:2,maxPlayLatency:1e3,crossFading:!1,getFileUri:function(t,e){return t+e+".mp3"},getSoundConstructor:function(){return null}};for(var e=0;e<t.length;e++){var i=t[e];this.channels[i]=new a(i)}l.prototype.audioManager=this,s.prototype.audioManager=this,a.prototype.audioManager=this}o||(console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),n=t("./Sound.js"),window.Audio||(console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),n=l)),e.exports=c,e.exports.ISound=l,c.prototype.init=function(){if(!this.audioContext&&o)for(var t in this.audioContext=new o,n.prototype.audioContext=this.audioContext,this.soundsById)this.soundsById[t].init()},c.prototype.getEmptySound=function(t,e){var i,o=this.settings.getSoundConstructor(t,e);return o?i=new o:(0<this.freeSoundPool.length?(i=this.freeSoundPool.pop()).init():i=new n,i)},c.prototype.setup=function(t){for(var e in t){var i=t[e];this.setVolume(e,i.volume,i.muted)}},c.prototype.addChannel=function(t){this.channels[t]||(this.channels[t]=new a(t))},c.prototype.setVolume=function(t,e,i){var o=this.channels[t];o&&o.setVolume(e,i)},c.prototype.setMute=function(t){for(var e in void 0===t&&(t=!this.muted),this.muted=!!t,this.channels){var i=this.channels[e];if(i.loopSound)if(t)i.loopSound.stop();else{var o=i.muted;i.muted=!0,i.setVolume(null,o)}}},c.prototype.loadSound=function(t,e){var i=this.createSound(t);return i.load(e),i},c.prototype.createSound=function(t,e){var i=this.getSound(t);return i||((i=this.soundsById[t]=this.getEmptySound(e,t)).setId(t),i)},c.prototype.createSoundPermanent=function(t,e){var i=this.getSound(t);if(i)return i;var o=this.settings.getSoundConstructor(e,t)||n;return(i=this.permanentSounds[t]=new o).setId(t),i},c.prototype.getSound=function(t){var e=this.permanentSounds[t];return e||((e=this.soundsById[t])?e:(e=this.soundArchiveById[t])?(this.soundArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundArchiveById[t],this.soundsById[t]=e):null)},c.prototype.getSoundGroup=function(t){var e=this.soundGroupsById[t];return e||((e=this.soundGroupArchiveById[t])?(this.soundGroupArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundGroupArchiveById[t],e.verifySounds(),this.soundGroupsById[t]=e):null)},c.prototype.freeSound=function(t){var e=t.id;this.soundsById[e]&&delete this.soundsById[e],this.soundArchiveById[e]&&(this.soundArchive.removeByRef(t.poolRef),t.poolRef=null,delete this.soundArchiveById[e]),t.unload(),t instanceof n&&this.freeSoundPool.push(t)},c.prototype.playLoopSound=function(t,e,i,o,r,n,s){var a=this.channels[t];if(!a)return console.warn('Channel id "'+t+'" does not exist.');a.playLoopSound(e,i,o,r,n,s)},c.prototype.stopLoopSound=function(t){var e=this,i=this.channels[t];if(!i)return console.warn('Channel id "'+t+'" does not exist.');var o=i.loopSound;i.loopId=null,o&&o.stop(function(){e.freeSound(o),i.loopSound=null})},c.prototype.stopAllLoopSounds=function(){for(var t in this.channels)this.stopLoopSound(t)},c.prototype.release=function(){var t,e,i,o=this.settings.maxSoundGroup,r=this.settings.maxUsedMemory,n={};for(t in this.channels){var s=this.channels[t];s.loopSound&&(n[s.loopSound.id]=!0)}for(t in this.soundGroupsById)(e=this.soundGroupsById[t]).poolRef=this.soundGroupArchive.add(e),this.soundGroupArchiveById[t]=e,delete this.soundGroupsById[t];for(t in this.soundsById)n[t]||((i=this.soundsById[t]).poolRef=this.soundArchive.add(i),this.soundArchiveById[t]=i,delete this.soundsById[t]);for(var a=this.soundGroupArchive.getCount();o<a&&(e=this.soundGroupArchive.popFirst());)e.poolRef=null,delete this.soundGroupArchiveById[e.id],--a;for(;this.usedMemory>r&&(i=this.soundArchive.popFirst());)i.poolRef=null,delete this.soundArchiveById[i.id],this.freeSound(i)},c.prototype.playSound=function(t,e,i,o,r){if(!this.muted){var n=this.channels[t];if(!n.muted){var s=this.getSound(e);i=i||1,(s=s||this.createSound(e,t)).play(n.volume*i,o,r)}}},c.prototype.playSoundGroup=function(t,e,i,o,r){if(!this.muted){var n=this.channels[t];if(n&&!n.muted){var s=this.getSoundGroup(e);if(!s)return console.warn('SoundGroup "'+e+'" does not exist.');i=i||1,s.play(i*n.volume,o,r)}}},c.prototype.createSoundGroup=function(t,e,i){if(!this.getSoundGroup(t)){var o=new s(t,e.id,e.vol,e.pitch,i);this.soundGroupsById[t]=o}},c.prototype.createSoundGroups=function(t,e){var i=void 0!==e&&this.channels[e].muted;for(var o in t)this.createSoundGroup(o,t[o],i)}},{"./AudioChannel.js":1,"./ISound.js":3,"./OrderedList":4,"./Sound.js":5,"./SoundBuffered.js":6,"./SoundGroup.js":7}],3:[function(t,e,i){"use strict";function o(){this.playing=!1,this.stopping=!1,this.fade=0,this.usedMemory=0,this.poolRef=null,this.id=null,this.volume=1,this.pan=0,this.loop=!1,this.pitch=0,this._loaded=!1,this._loading=!1,this._unloading=!1,this._playTriggered=0,this._onLoadQueuedCallback=[]}(e.exports=o).prototype.setId=function(t){this.id=t,this._loaded=!1},o.prototype.load=function(t){return this.id?this._loaded?t&&t(null,this):(t&&this._onLoadQueuedCallback.push(t),this._loading?void 0:(this._loading=!0,this._load())):t&&t("noId")},o.prototype._finalizeLoad=function(t){var e=this.audioManager.settings.maxPlayLatency;this._loaded=!t,this._loading=!1;for(var i=0;i<this._onLoadQueuedCallback.length;i++)this._onLoadQueuedCallback[i](t,this);if(this._onLoadQueuedCallback=[],this._unloading)return this._unloading=!1,void this.unload();this._loaded&&this._playTriggered&&((this.loop||Date.now()-this._playTriggered<e)&&this._play(),this._playTriggered=0)},o.prototype.cancelOnLoadCallbacks=function(){this._onLoadQueuedCallback=[]},o.prototype.play=function(t,e,i){if(null!=t&&this.setVolume(t),null!=e&&this.setPan(e),!this._loaded)return this._playTriggered=Date.now(),void this.load();this.loop&&this.playing?this._updatePlayPitch(i):this._play(i)},o.prototype.init=function(){},o.prototype.setVolume=function(t){this.volume=t},o.prototype.setPan=function(t){this.pan=t},o.prototype.setLoop=function(t){this.loop=t},o.prototype.setPitch=function(t){this.pitch=t},o.prototype._updatePlayPitch=function(t){},o.prototype._play=function(t){this.playing=!0,console.log('ISound play call: "'+this.id+'"')},o.prototype.stop=function(t){return this.playing=!1,t&&t()},o.prototype._load=function(){return console.log("ISound load call: "+this.id),this._finalizeLoad(null)},o.prototype.unload=function(){return this._playTriggered=0,this.setLoop(!1),this.fade=0,this.pitch=0,this.stop(),this._loading?!(this._unloading=!0):(this.audioManager.usedMemory-=this.usedMemory,this.setVolume(1),this.setPan(0),this.id=null,this._loaded=!1,!(this.usedMemory=0))}},{}],4:[function(t,e,i){"use strict";function n(t,e,i,o){this.object=t,this.previous=e,this.next=i,this.container=o}function o(t){this.count=0,this.first=null,this.last=null,this.cmpFunc=t}o.prototype.add=function(t){var e=new n(t,null,null,this);if(this.count+=1,null===this.first)return this.first=e,this.last=e;var i=this.cmpFunc(t,this.first.object);if(i<0)return e.next=this.first,this.first.previous=e,this.first=e;var o,r=this.cmpFunc(t,this.last.object);if(0<=r)return e.previous=this.last,this.last.next=e,this.last=e;if(i+r<0){for(o=this.first.next;0<=this.cmpFunc(t,o.object);)o=o.next;e.next=o,e.previous=o.previous,e.previous.next=e,o.previous=e}else{for(o=this.last.previous;this.cmpFunc(t,o.object)<0;)o=o.previous;e.previous=o,e.next=o.next,e.next.previous=e,o.next=e}return e},o.prototype.removeByRef=function(t){return!(!t||t.container!==this)&&(--this.count,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,!(t.container=null))},o.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},o.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},o.prototype.possess=function(t){return t&&t.container===this},o.prototype.popFirst=function(){var t=this.first;if(!t)return null;--this.count;var e=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,e},o.prototype.popLast=function(){var t=this.last;if(!t)return null;--this.count;var e=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,e},o.prototype.getFirst=function(){return this.first&&this.first.object},o.prototype.getLast=function(){return this.last&&this.last.object},o.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.count=0,this.first=null,this.last=null},o.prototype.getCount=function(){return this.count},o.prototype.forEach=function(t,e){for(var i=this.first;i;i=i.next)t(i.object,e)},o.prototype.forEachReverse=function(t,e){for(var i=this.last;i;i=i.previous)t(i.object,e)},o.prototype.reposition=function(t){if(t.container!==this)return this.add(t.object);var e=t.previous,i=t.next,o=t.object;for(null===i?this.last=e:i.previous=e,null===e?this.first=i:e.next=i;null!==e&&this.cmpFunc(o,e.object)<0;)e=(i=e).previous;for(;null!==i&&0<=this.cmpFunc(o,i.object);)i=(e=i).next;return null===(t.next=i)?this.last=t:i.previous=t,null===(t.previous=e)?this.first=t:e.next=t,t},e.exports=o},{}],5:[function(t,e,i){"use strict";var o=t("util").inherits,r=t("./ISound.js"),n={playAudioWhenScreenIsLocked:!1};function s(){r.call(this);var t=new Audio;t.loop=!1,t.type="audio/mpeg",this._audio=t,this.audioContext&&(this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination))}o(s,r),(e.exports=s).prototype.setVolume=function(t){this.volume=this._audio.volume=t},s.prototype.setLoop=function(t){this.loop=this._audio.loop=t},s.prototype._load=function(){var e=this;function i(t){e._finalizeLoad(t)}function o(){this.removeEventListener("canplaythrough",o),this.removeEventListener("error",r),e.usedMemory=this.duration,e.audioManager.usedMemory+=this.duration,e._finalizeLoad(null)}function r(t){this.removeEventListener("canplaythrough",o),this.removeEventListener("error",r),i(t)}function n(t){e._loading=!0,e._audio.addEventListener("canplaythrough",o),e._audio.addEventListener("error",r),e._audio.src=t,e._audio.load()}var t=this.audioManager.settings.getFileUri,s=this.audioManager.settings.audioPath;if(2<t.length)t(s,this.id,function(t,e){if(t)return i(t);n(e)});else try{var a=t(s,this.id);if(!a)return i("emptyUri");n(a)}catch(t){i(t)}},s.prototype.unload=function(){r.prototype.unload.call(this)&&(this._audio.volume=1,this._audio.src="",this._audio.load())},s.prototype._play=function(t){this._audio.volume=this.volume,this._audio.pause(),this._audio.currentTime=0,this._audio.play(n),this.playing=!0},s.prototype.stop=function(t){return this._audio.pause(),this._audio.currentTime=0,this._playTriggered=0,this.playing=!1,t&&t()}},{"./ISound.js":3,util:103}],6:[function(t,e,i){"use strict";var o=t("util").inherits,r=t("./ISound.js"),n=1e-6;function s(){r.call(this),this.buffer=null,this.source=null,this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._playPitch=0,this._fadeTimeout=null,this._onStopCallback=null,this._audioNodeReady=!1,this._loopStart=0,this._loopEnd=0,this.init()}o(s,r),(e.exports=s).prototype._createAudioNodes=function(){if(!this._audioNodeReady&&this.audioContext){var t,e=this.audioContext,i=e.createGain();t=e.createStereoPanner?e.createStereoPanner():e.createPanner(),i.connect(t),t.connect(e.destination),i.gain.value=0,this.sourceConnector=i,this.gain=i.gain,this.panNode=t,this._audioNodeReady=!0}},s.prototype._destroyAudioNodes=function(){if(this._audioNodeReady){var t=this.audioContext,e=this.panNode,i=this.sourceConnector;i.disconnect(e),e.disconnect(t.destination),this.source&&(this.source.disconnect(i),this.source.onended=null,this.source=null),this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._audioNodeReady=!1}},s.prototype.init=function(){if(this._createAudioNodes(),this.rawAudioData){var e=this,i=this.audioManager.settings.maxPlayLatency;this.audioContext.decodeAudioData(this.rawAudioData,function(t){e.buffer=t,e.usedMemory=t.duration,e.audioManager.usedMemory+=t.duration,e.rawAudioData=null,e._loaded&&e._playTriggered&&((e.loop||Date.now()-e._playTriggered<i)&&e._play(),e._playTriggered=0)},function(){console.error("decode audio failed for sound ",e.id)})}},s.prototype.setVolume=function(t){if(this.volume=t,this.playing)if(this.fade){t<=0&&(t=n);var e=this.audioContext.currentTime;this.gain.cancelScheduledValues(e),this.gain.setValueAtTime(this.gain.value||n,e),this.gain.linearRampToValueAtTime(t,e+this.fade)}else this.gain.value=t},s.prototype.setPan=function(t){this.pan=t,this.panNode&&(this.panNode.pan?this.panNode.pan.value=t:this.panNode.setPosition(t,0,.2))},s.prototype.setLoop=function(t,e,i){this.loop=!!t,this._loopStart=e||0,this._loopEnd=i||0,this.source&&this.buffer&&(this.source.loop=t,this._setLoopPoints())},s.prototype._setLoopPoints=function(){this.source.loopStart=this._loopStart||0;var t=this._loopEnd;t<0&&(t=this.buffer.duration+t),t<0&&(t=0),this.source.loopEnd=t||this.buffer.duration},s.prototype.setPitch=function(t,e){this.pitch=t,this._setPlaybackRate(e)},s.prototype._updatePlayPitch=function(t){!t&&0!==t||t===this._playPitch||(this._playPitch=t,this._setPlaybackRate(0))},s.prototype._setPlaybackRate=function(t){if(this.source){var e=Math.pow(2,(this._playPitch+this.pitch)/12);if(t){var i=this.audioContext.currentTime;this.source.playbackRate.cancelScheduledValues(i),this.source.playbackRate.setValueAtTime(this.source.playbackRate.value||n,i),this.source.playbackRate.linearRampToValueAtTime(e,i+t)}else this.source.playbackRate.value=e}},s.prototype._load=function(){var i=this;function o(t){i._finalizeLoad(t)}function r(t){i.buffer=t,i.usedMemory=t.duration,i.audioManager.usedMemory+=t.duration,i._finalizeLoad(null)}function n(t){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=function(){if(4==~~e.readyState)return 200!=~~e.status&&0!=~~e.status?o("xhrError:"+e.status):void(i.audioContext?i.audioContext.decodeAudioData(e.response,r,o):(i.rawAudioData=e.response,i._finalizeLoad(null)))},e.open("GET",t,!0),e.send()}this._createAudioNodes();var t=this.audioManager.settings.getFileUri,e=this.audioManager.settings.audioPath;if(2<t.length)t(e,this.id,function(t,e){if(t)return o(t);n(e)});else try{var s=t(e,this.id);if(!s)return o("emptyUri");n(s)}catch(t){o(t)}},s.prototype.unload=function(){r.prototype.unload.call(this)&&(this._fadeTimeout&&(this._onStopCallback=null,this._stopAndClear()),this.buffer=null,this.source&&(this.source.onended=null,this.source.stop(0),this.source=null),this._destroyAudioNodes())},s.prototype._play=function(t){if(this.buffer){this.playing=!0;var e=this.audioContext.currentTime;if(this.gain.cancelScheduledValues(e),this.fade?(this.gain.setValueAtTime(this.gain.value||n,e),this.gain.linearRampToValueAtTime(this.volume||n,e+this.fade)):this.gain.value=this.volume,this._fadeTimeout)return this._onStopCallback=null,this.source.onended=null,this.stopping=!1,window.clearTimeout(this._fadeTimeout),void(this._fadeTimeout=null);this.source&&(this.source.disconnect(this.sourceConnector),this.source.onended=null);var i=this.source=this.audioContext.createBufferSource();i.connect(this.sourceConnector);var o=this;i.onended=function(){o.playing=!1,i.onended=null,o.source=null},this._playPitch=t||0,(t||this.pitch)&&this._setPlaybackRate(0),i.loop=this.loop,i.buffer=this.buffer,this._setLoopPoints(),i.start(0)}else this._playTriggered=Date.now()},s.prototype._stopAndClear=function(){this.stopping=!1,this.source.onended=null,this.source.stop(0),this.source=null,this._fadeTimeout&&(window.clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this._onStopCallback&&(this._onStopCallback(),this._onStopCallback=null)},s.prototype.stop=function(t){if(!this.playing&&!this.stopping)return t&&t();if(this._playTriggered=0,this.stopping=!0,this.playing=!1,!this.source)return t&&t();if(this._onStopCallback=t,!this._fadeTimeout){if(this.fade){var e=this,i=this.audioContext.currentTime;return this.gain.cancelScheduledValues(i),this.gain.setValueAtTime(this.gain.value||n,i),this.gain.linearRampToValueAtTime(n,i+this.fade),void(this._fadeTimeout=window.setTimeout(function(){e._fadeTimeout=null,e._stopAndClear()},1e3*this.fade))}this._stopAndClear()}}},{"./ISound.js":3,util:103}],7:[function(t,e,i){"use strict";function o(t,e,i,o,r){this.id=t,this.soundIds=e,this.volumes=i||[],this.pitches=o||[],this.soundIndex=0,this.volIndex=0,this.pitchIndex=0,this.poolRef=null,this._ready=!1,0===this.volumes.length&&this.volumes.push(1),0===this.pitches.length&&this.pitches.push(0),r||this._createSounds()}(e.exports=o).prototype._createSounds=function(){for(var t=this.soundIds,e=0;e<t.length;e++)this.audioManager.loadSound(t[e]);this._ready=!0},o.prototype.play=function(t,e,i){if(0!==this.soundIds.length){this._ready||this._createSounds();var o=this.soundIds[this.soundIndex++],r=this.audioManager.getSound(o);if(!r)return console.warn("[Sound Group: "+this.id+"] sound id "+o+"  cannot be played.");t=t||1,i=i||0,t*=this.volumes[this.volIndex++],i+=this.pitches[this.pitchIndex++],r.play(t,e,i),this.soundIndex>=this.soundIds.length&&(this.soundIndex=0),this.volIndex>=this.volumes.length&&(this.volIndex=0),this.pitchIndex>=this.pitches.length&&(this.pitchIndex=0)}},o.prototype.verifySounds=function(){for(var t=0;t<this.soundIds.length;t++){var e=this.soundIds[t];this.audioManager.createSound(e)}}},{}],8:[function(t,e,i){e.exports={_from:"p2",_id:"p2@0.7.1",_inBundle:!1,_integrity:"sha1-JfJHTZvDptMUCh2iamfJ4RislUM=",_location:"/p2",_phantomChildren:{},_requested:{type:"tag",registry:!0,raw:"p2",name:"p2",escapedName:"p2",rawSpec:"",saveSpec:null,fetchSpec:"latest"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/p2/-/p2-0.7.1.tgz",_shasum:"25f2474d9bc3a6d3140a1da26a67c9e118ac9543",_spec:"p2",_where:"C:\\Dev\\JHax-GameJams\\LD47\\LD47",author:{name:"Stefan Hedman",email:"schteppe@gmail.com",url:"http://steffe.se"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},bundleDependencies:!1,dependencies:{"poly-decomp":"0.1.1"},deprecated:!1,description:"A JavaScript 2D physics engine.",devDependencies:{grunt:"^0.4.5","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0"},engines:{node:"*"},homepage:"https://github.com/schteppe/p2.js#readme",keywords:["p2.js","p2","physics","engine","2d"],licenses:[{type:"MIT"}],main:"./src/p2.js",name:"p2",repository:{type:"git",url:"git+https://github.com/schteppe/p2.js.git"},version:"0.7.1"}},{}],9:[function(t,e,i){"use strict";var f=t("../math/vec2");t("../utils/Utils");function o(t){this.lowerBound=f.create(),t&&t.lowerBound&&f.copy(this.lowerBound,t.lowerBound),this.upperBound=f.create(),t&&t.upperBound&&f.copy(this.upperBound,t.upperBound)}e.exports=o;var d=f.create();o.prototype.setFromPoints=function(t,e,i,o){var r=this.lowerBound,n=this.upperBound;"number"!=typeof i&&(i=0),0!==i?f.rotate(r,t[0],i):f.copy(r,t[0]),f.copy(n,r);for(var s=Math.cos(i),a=Math.sin(i),l=1;l<t.length;l++){var c=t[l];if(0!==i){var p=c[0],u=c[1];d[0]=s*p-a*u,d[1]=a*p+s*u,c=d}for(var h=0;h<2;h++)c[h]>n[h]&&(n[h]=c[h]),c[h]<r[h]&&(r[h]=c[h])}e&&(f.add(this.lowerBound,this.lowerBound,e),f.add(this.upperBound,this.upperBound,e)),o&&(this.lowerBound[0]-=o,this.lowerBound[1]-=o,this.upperBound[0]+=o,this.upperBound[1]+=o)},o.prototype.copy=function(t){f.copy(this.lowerBound,t.lowerBound),f.copy(this.upperBound,t.upperBound)},o.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);var o=t.upperBound[e];this.upperBound[e]<o&&(this.upperBound[e]=o)}},o.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,o=t.lowerBound,r=t.upperBound;return(o[0]<=i[0]&&i[0]<=r[0]||e[0]<=r[0]&&r[0]<=i[0])&&(o[1]<=i[1]&&i[1]<=r[1]||e[1]<=r[1]&&r[1]<=i[1])},o.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},o.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],o=(this.lowerBound[0]-t.from[0])*e,r=(this.upperBound[0]-t.from[0])*e,n=(this.lowerBound[1]-t.from[1])*i,s=(this.upperBound[1]-t.from[1])*i,a=Math.max(Math.max(Math.min(o,r),Math.min(n,s))),l=Math.min(Math.min(Math.max(o,r),Math.max(n,s)));return l<0||l<a?-1:a}},{"../math/vec2":32,"../utils/Utils":59}],10:[function(t,e,i){"use strict";var r=t("../math/vec2"),n=t("../objects/Body");function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}(e.exports=o).AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(t){};var s=r.create();o.boundingRadiusCheck=function(t,e){r.sub(s,t.position,e.position);var i=r.squaredLength(s),o=t.boundingRadius+e.boundingRadius;return i<=o*o},o.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},o.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:i=o.boundingRadiusCheck(t,e);break;case o.AABB:i=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},o.canCollide=function(t,e){var i=n.KINEMATIC,o=n.STATIC;return(t.type!==o||e.type!==o)&&(!(t.type===i&&e.type===o||t.type===o&&e.type===i)&&((t.type!==i||e.type!==i)&&((t.sleepState!==n.SLEEPING||e.sleepState!==n.SLEEPING)&&!(t.sleepState===n.SLEEPING&&e.type===o||e.sleepState===n.SLEEPING&&t.type===o))))},o.NAIVE=1,o.SAP=2},{"../math/vec2":32,"../objects/Body":33}],11:[function(t,e,i){"use strict";t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle");var l=t("../collision/Broadphase");t("../math/vec2");function o(){l.call(this,l.NAIVE)}(((e.exports=o).prototype=new l).constructor=o).prototype.getCollisionPairs=function(t){for(var e=t.bodies,i=this.result,o=i.length=0,r=e.length;o!==r;o++)for(var n=e[o],s=0;s<o;s++){var a=e[s];l.canCollide(n,a)&&this.boundingVolumeCheck(n,a)&&i.push(n,a)}return i},o.prototype.aabbQuery=function(t,e,i){i=i||[];for(var o=t.bodies,r=0;r<o.length;r++){var n=o[r];n.aabbNeedsUpdate&&n.updateAABB(),n.aabb.overlaps(e)&&i.push(n)}return i}},{"../collision/Broadphase":10,"../math/vec2":32,"../shapes/Circle":41,"../shapes/Particle":45,"../shapes/Plane":46,"../shapes/Shape":47}],12:[function(t,e,i){"use strict";var Y=t("../math/vec2"),N=Y.sub,G=Y.add,H=Y.dot,o=(t("../utils/Utils"),t("../utils/ContactEquationPool")),r=t("../utils/FrictionEquationPool"),n=t("../utils/TupleDictionary"),s=t("../equations/Equation"),a=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),l=t("../shapes/Convex"),c=t("../shapes/Shape"),w=(t("../objects/Body"),t("../shapes/Box"));e.exports=J;var x=Y.fromValues(0,1),j=Y.fromValues(0,0),U=Y.fromValues(0,0),W=Y.fromValues(0,0),$=Y.fromValues(0,0),z=Y.fromValues(0,0),O=Y.fromValues(0,0),K=Y.fromValues(0,0),Q=Y.fromValues(0,0),Z=Y.fromValues(0,0),M=Y.fromValues(0,0),q=Y.fromValues(0,0),F=Y.fromValues(0,0),X=Y.fromValues(0,0),V=Y.fromValues(0,0),D=Y.fromValues(0,0),_=Y.fromValues(0,0),C=Y.fromValues(0,0),P=Y.fromValues(0,0),k=[];function J(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new o({size:32}),this.frictionEquationPool=new r({size:64}),this.restitution=0,this.stiffness=s.DEFAULT_STIFFNESS,this.relaxation=s.DEFAULT_RELAXATION,this.frictionStiffness=s.DEFAULT_STIFFNESS,this.frictionRelaxation=s.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new n,this.contactSkinSize=.01}var p=Y.create(),u=Y.create();function b(t,e){Y.set(t.vertices[0],.5*-e.length,-e.radius),Y.set(t.vertices[1],.5*e.length,-e.radius),Y.set(t.vertices[2],.5*e.length,e.radius),Y.set(t.vertices[3],.5*-e.length,e.radius)}J.prototype.bodiesOverlap=function(t,e){for(var i=p,o=u,r=0,n=t.shapes.length;r!==n;r++){var s=t.shapes[r];t.toWorldFrame(i,s.position);for(var a=0,l=e.shapes.length;a!==l;a++){var c=e.shapes[a];if(e.toWorldFrame(o,c.position),this[s.type|c.type](t,s,i,s.angle+t.angle,e,c,o,c.angle+e.angle,!0))return!0}}return!1},J.prototype.collidedLastStep=function(t,e){var i=0|t.id,o=0|e.id;return!!this.collidingBodiesLastStep.get(i,o)},J.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],o=i.bodyA.id,r=i.bodyB.id;this.collidingBodiesLastStep.set(o,r,!0)}for(var n=this.contactEquations,s=this.frictionEquations,a=0;a<n.length;a++)this.contactEquationPool.release(n[a]);for(a=0;a<s.length;a++)this.frictionEquationPool.release(s[a]);this.contactEquations.length=this.frictionEquations.length=0},J.prototype.createContactEquation=function(t,e,i,o){var r=this.contactEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=o,r.restitution=this.restitution,r.firstImpact=!this.collidedLastStep(t,e),r.stiffness=this.stiffness,r.relaxation=this.relaxation,r.needsUpdate=!0,r.enabled=this.enabledEquations,r.offset=this.contactSkinSize,r},J.prototype.createFrictionEquation=function(t,e,i,o){var r=this.frictionEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=o,r.setSlipForce(this.slipForce),r.frictionCoefficient=this.frictionCoefficient,r.relativeVelocity=this.surfaceVelocity,r.enabled=this.enabledEquations,r.needsUpdate=!0,r.stiffness=this.frictionStiffness,r.relaxation=this.frictionRelaxation,r.contactEquations.length=0,r},J.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return Y.copy(e.contactPointA,t.contactPointA),Y.copy(e.contactPointB,t.contactPointB),Y.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},J.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),o=e.bodyA;e.bodyB;Y.set(i.contactPointA,0,0),Y.set(i.contactPointB,0,0),Y.set(i.t,0,0);for(var r=0;r!==t;r++)(e=this.contactEquations[this.contactEquations.length-1-r]).bodyA===o?(Y.add(i.t,i.t,e.normalA),Y.add(i.contactPointA,i.contactPointA,e.contactPointA),Y.add(i.contactPointB,i.contactPointB,e.contactPointB)):(Y.sub(i.t,i.t,e.normalA),Y.add(i.contactPointA,i.contactPointA,e.contactPointB),Y.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var n=1/t;return Y.scale(i.contactPointA,i.contactPointA,n),Y.scale(i.contactPointB,i.contactPointB,n),Y.normalize(i.t,i.t),Y.rotate90cw(i.t,i.t),i},J.prototype[c.LINE|c.CONVEX]=J.prototype.convexLine=function(t,e,i,o,r,n,s,a,l){return!l&&0},J.prototype[c.LINE|c.BOX]=J.prototype.lineBox=function(t,e,i,o,r,n,s,a,l){return!l&&0};var f=new w({width:1,height:1}),d=Y.create();J.prototype[c.CAPSULE|c.CONVEX]=J.prototype[c.CAPSULE|c.BOX]=J.prototype.convexCapsule=function(t,e,i,o,r,n,s,a,l){var c=d;Y.set(c,n.length/2,0),Y.rotate(c,c,a),Y.add(c,c,s);var p=this.circleConvex(r,n,c,a,t,e,i,o,l,n.radius);Y.set(c,-n.length/2,0),Y.rotate(c,c,a),Y.add(c,c,s);var u=this.circleConvex(r,n,c,a,t,e,i,o,l,n.radius);if(l&&(p||u))return!0;var h=f;return b(h,n),this.convexConvex(t,e,i,o,r,h,s,a,l)+p+u},J.prototype[c.CAPSULE|c.LINE]=J.prototype.lineCapsule=function(t,e,i,o,r,n,s,a,l){return!l&&0};var S=Y.create(),A=Y.create(),E=new w({width:1,height:1});J.prototype[c.CAPSULE|c.CAPSULE]=J.prototype.capsuleCapsule=function(t,e,i,o,r,n,s,a,l){for(var c=S,p=A,u=0,h=0;h<2;h++){Y.set(c,(0===h?-1:1)*e.length/2,0),Y.rotate(c,c,o),Y.add(c,c,i);for(var f=0;f<2;f++){Y.set(p,(0===f?-1:1)*n.length/2,0),Y.rotate(p,p,a),Y.add(p,p,s),this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);var d=this.circleCircle(t,e,c,o,r,n,p,a,l,e.radius,n.radius);if(this.enableFrictionReduction&&(this.enableFriction=g),l&&d)return!0;u+=d}}this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);var y=E;b(y,e);var v=this.convexCapsule(t,y,i,o,r,n,s,a,l);if(this.enableFrictionReduction&&(this.enableFriction=g),l&&v)return!0;if(u+=v,this.enableFrictionReduction){var g=this.enableFriction;this.enableFriction=!1}b(y,n);var m=this.convexCapsule(r,y,s,a,t,e,i,o,l);return this.enableFrictionReduction&&(this.enableFriction=g),!(!l||!m)||(u+=m,this.enableFrictionReduction&&u&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(u)),u)},J.prototype[c.LINE|c.LINE]=J.prototype.lineLine=function(t,e,i,o,r,n,s,a,l){return!l&&0},J.prototype[c.PLANE|c.LINE]=J.prototype.planeLine=function(t,e,i,o,r,n,s,a,l){var c=j,p=U,u=W,h=$,f=z,d=O,y=K,v=Q,g=Z,m=k,b=0;Y.set(c,-n.length/2,0),Y.set(p,n.length/2,0),Y.rotate(u,c,a),Y.rotate(h,p,a),G(u,u,s),G(h,h,s),Y.copy(c,u),Y.copy(p,h),N(f,p,c),Y.normalize(d,f),Y.rotate90cw(g,d),Y.rotate(v,x,o),m[0]=c,m[1]=p;for(var S=0;S<m.length;S++){var A=m[S];N(y,A,i);var E=H(y,v);if(E<0){if(l)return!0;var w=this.createContactEquation(t,r,e,n);b++,Y.copy(w.normalA,v),Y.normalize(w.normalA,w.normalA),Y.scale(y,v,E),N(w.contactPointA,A,y),N(w.contactPointA,w.contactPointA,t.position),N(w.contactPointB,A,s),G(w.contactPointB,w.contactPointB,s),N(w.contactPointB,w.contactPointB,r.position),this.contactEquations.push(w),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}}return!l&&(this.enableFrictionReduction||b&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(b)),b)},J.prototype[c.PARTICLE|c.CAPSULE]=J.prototype.particleCapsule=function(t,e,i,o,r,n,s,a,l){return this.circleLine(t,e,i,o,r,n,s,a,l,n.radius,0)},J.prototype[c.CIRCLE|c.LINE]=J.prototype.circleLine=function(t,e,i,o,r,n,s,a,l,c,p){c=c||0,p=void 0!==p?p:e.radius;var u=j,h=U,f=W,d=$,y=z,v=O,g=K,m=Q,b=Z,S=M,A=q,E=F,w=X,x=V,R=k;Y.set(m,-n.length/2,0),Y.set(b,n.length/2,0),Y.rotate(S,m,a),Y.rotate(A,b,a),G(S,S,s),G(A,A,s),Y.copy(m,S),Y.copy(b,A),N(v,b,m),Y.normalize(g,v),Y.rotate90cw(y,g),N(E,i,m);var B=H(E,y);N(d,m,s),N(w,i,s);var L=p+c;if(Math.abs(B)<L){Y.scale(u,y,B),N(f,i,u),Y.scale(h,y,H(y,w)),Y.normalize(h,h),Y.scale(h,h,c),G(f,f,h);var C=H(g,f),P=H(g,m),D=H(g,b);if(P<C&&C<D){if(l)return!0;var _=this.createContactEquation(t,r,e,n);return Y.scale(_.normalA,u,-1),Y.normalize(_.normalA,_.normalA),Y.scale(_.contactPointA,_.normalA,p),G(_.contactPointA,_.contactPointA,i),N(_.contactPointA,_.contactPointA,t.position),N(_.contactPointB,f,s),G(_.contactPointB,_.contactPointB,s),N(_.contactPointB,_.contactPointB,r.position),this.contactEquations.push(_),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(_)),1}}R[0]=m,R[1]=b;for(var T=0;T<R.length;T++){var I=R[T];if(N(E,I,i),Y.squaredLength(E)<Math.pow(L,2)){if(l)return!0;_=this.createContactEquation(t,r,e,n);return Y.copy(_.normalA,E),Y.normalize(_.normalA,_.normalA),Y.scale(_.contactPointA,_.normalA,p),G(_.contactPointA,_.contactPointA,i),N(_.contactPointA,_.contactPointA,t.position),N(_.contactPointB,I,s),Y.scale(x,_.normalA,-c),G(_.contactPointB,_.contactPointB,x),G(_.contactPointB,_.contactPointB,s),N(_.contactPointB,_.contactPointB,r.position),this.contactEquations.push(_),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(_)),1}}return 0},J.prototype[c.CIRCLE|c.CAPSULE]=J.prototype.circleCapsule=function(t,e,i,o,r,n,s,a,l){return this.circleLine(t,e,i,o,r,n,s,a,l,n.radius)},J.prototype[c.CIRCLE|c.CONVEX]=J.prototype[c.CIRCLE|c.BOX]=J.prototype.circleConvex=function(t,e,i,o,r,n,s,a,l,c){c="number"==typeof c?c:e.radius;for(var p=j,u=U,h=W,f=$,d=z,y=M,v=q,g=X,m=V,b=D,S=_,A=!1,E=Number.MAX_VALUE,w=n.vertices,x=0;x!==w.length+1;x++){var R=w[x%w.length],B=w[(x+1)%w.length];if(Y.rotate(p,R,a),Y.rotate(u,B,a),G(p,p,s),G(u,u,s),N(h,u,p),Y.normalize(f,h),Y.rotate90cw(d,f),Y.scale(m,d,-e.radius),G(m,m,i),T(m,n,s,a)){Y.sub(b,p,m);var L=Math.abs(Y.dot(b,d));L<E&&(Y.copy(S,m),E=L,Y.scale(g,d,L),Y.add(g,g,m),A=!0)}}if(A){if(l)return!0;var C=this.createContactEquation(t,r,e,n);return Y.sub(C.normalA,S,i),Y.normalize(C.normalA,C.normalA),Y.scale(C.contactPointA,C.normalA,c),G(C.contactPointA,C.contactPointA,i),N(C.contactPointA,C.contactPointA,t.position),N(C.contactPointB,g,s),G(C.contactPointB,C.contactPointB,s),N(C.contactPointB,C.contactPointB,r.position),this.contactEquations.push(C),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(C)),1}if(0<c)for(x=0;x<w.length;x++){var P=w[x];if(Y.rotate(v,P,a),G(v,v,s),N(y,v,i),Y.squaredLength(y)<Math.pow(c,2)){if(l)return!0;C=this.createContactEquation(t,r,e,n);return Y.copy(C.normalA,y),Y.normalize(C.normalA,C.normalA),Y.scale(C.contactPointA,C.normalA,c),G(C.contactPointA,C.contactPointA,i),N(C.contactPointA,C.contactPointA,t.position),N(C.contactPointB,v,s),G(C.contactPointB,C.contactPointB,s),N(C.contactPointB,C.contactPointB,r.position),this.contactEquations.push(C),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(C)),1}}return 0};var y=Y.create(),v=Y.create(),g=Y.create(),m=Y.create();function T(t,e,i,o){for(var r=y,n=v,s=g,a=m,l=t,c=e.vertices,p=null,u=0;u!==c.length+1;u++){var h=c[u%c.length],f=c[(u+1)%c.length];Y.rotate(r,h,o),Y.rotate(n,f,o),G(r,r,i),G(n,n,i),N(s,r,l),N(a,n,l);var d=Y.crossLength(s,a);if(null===p&&(p=d),d*p<=0)return;p=d}return 1}J.prototype[c.PARTICLE|c.CONVEX]=J.prototype[c.PARTICLE|c.BOX]=J.prototype.particleConvex=function(t,e,i,o,r,n,s,a,l){var c=j,p=U,u=W,h=$,f=z,d=O,y=K,v=M,g=X,m=C,b=P,S=Number.MAX_VALUE,A=!1,E=n.vertices;if(!T(i,n,s,a))return 0;if(l)return!0;for(var w=0;w!==E.length+1;w++){var x=E[w%E.length],R=E[(w+1)%E.length];Y.rotate(c,x,a),Y.rotate(p,R,a),G(c,c,s),G(p,p,s),N(u,p,c),Y.normalize(h,u),Y.rotate90cw(f,h),N(v,i,c);H(v,f);N(d,c,s),N(y,i,s),Y.sub(m,c,i);var B=Math.abs(Y.dot(m,f));B<S&&(S=B,Y.scale(g,f,B),Y.add(g,g,i),Y.copy(b,f),A=!0)}if(A){var L=this.createContactEquation(t,r,e,n);return Y.scale(L.normalA,b,-1),Y.normalize(L.normalA,L.normalA),Y.set(L.contactPointA,0,0),G(L.contactPointA,L.contactPointA,i),N(L.contactPointA,L.contactPointA,t.position),N(L.contactPointB,g,s),G(L.contactPointB,L.contactPointB,s),N(L.contactPointB,L.contactPointB,r.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L)),1}return 0},J.prototype[c.CIRCLE]=J.prototype.circleCircle=function(t,e,i,o,r,n,s,a,l,c,p){var u=j;c=c||e.radius,p=p||n.radius;N(u,i,s);var h=c+p;if(Y.squaredLength(u)>Math.pow(h,2))return 0;if(l)return!0;var f=this.createContactEquation(t,r,e,n);return N(f.normalA,s,i),Y.normalize(f.normalA,f.normalA),Y.scale(f.contactPointA,f.normalA,c),Y.scale(f.contactPointB,f.normalA,-p),G(f.contactPointA,f.contactPointA,i),N(f.contactPointA,f.contactPointA,t.position),G(f.contactPointB,f.contactPointB,s),N(f.contactPointB,f.contactPointB,r.position),this.contactEquations.push(f),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(f)),1},J.prototype[c.PLANE|c.CONVEX]=J.prototype[c.PLANE|c.BOX]=J.prototype.planeConvex=function(t,e,i,o,r,n,s,a,l){var c=j,p=U,u=W,h=0;Y.rotate(p,x,o);for(var f=0;f!==n.vertices.length;f++){var d=n.vertices[f];if(Y.rotate(c,d,a),G(c,c,s),N(u,c,i),H(u,p)<=0){if(l)return!0;h++;var y=this.createContactEquation(t,r,e,n);N(u,c,i),Y.copy(y.normalA,p);var v=H(u,y.normalA);Y.scale(u,y.normalA,v),N(y.contactPointB,c,r.position),N(y.contactPointA,c,u),N(y.contactPointA,y.contactPointA,t.position),this.contactEquations.push(y),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y))}}return this.enableFrictionReduction&&this.enableFriction&&h&&this.frictionEquations.push(this.createFrictionFromAverage(h)),h},J.prototype[c.PARTICLE|c.PLANE]=J.prototype.particlePlane=function(t,e,i,o,r,n,s,a,l){var c=j,p=U;a=a||0,N(c,i,s),Y.rotate(p,x,a);var u=H(c,p);if(0<u)return 0;if(l)return!0;var h=this.createContactEquation(r,t,n,e);return Y.copy(h.normalA,p),Y.scale(c,h.normalA,u),N(h.contactPointA,i,c),N(h.contactPointA,h.contactPointA,r.position),N(h.contactPointB,i,t.position),this.contactEquations.push(h),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(h)),1},J.prototype[c.CIRCLE|c.PARTICLE]=J.prototype.circleParticle=function(t,e,i,o,r,n,s,a,l){var c=j;if(N(c,s,i),Y.squaredLength(c)>Math.pow(e.radius,2))return 0;if(l)return!0;var p=this.createContactEquation(t,r,e,n);return Y.copy(p.normalA,c),Y.normalize(p.normalA,p.normalA),Y.scale(p.contactPointA,p.normalA,e.radius),G(p.contactPointA,p.contactPointA,i),N(p.contactPointA,p.contactPointA,t.position),N(p.contactPointB,s,r.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1};var R=new a({radius:1}),B=Y.create(),L=Y.create();Y.create();J.prototype[c.PLANE|c.CAPSULE]=J.prototype.planeCapsule=function(t,e,i,o,r,n,s,a,l){var c,p=B,u=L,h=R;Y.set(p,-n.length/2,0),Y.rotate(p,p,a),G(p,p,s),Y.set(u,n.length/2,0),Y.rotate(u,u,a),G(u,u,s),h.radius=n.radius,this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1);var f=this.circlePlane(r,h,p,0,t,e,i,o,l),d=this.circlePlane(r,h,u,0,t,e,i,o,l);if(this.enableFrictionReduction&&(this.enableFriction=c),l)return f||d;var y=f+d;return this.enableFrictionReduction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},J.prototype[c.CIRCLE|c.PLANE]=J.prototype.circlePlane=function(t,e,i,o,r,n,s,a,l){var c=t,p=e,u=i,h=r,f=s,d=a;d=d||0;var y=j,v=U,g=W;N(y,u,f),Y.rotate(v,x,d);var m=H(v,y);if(m>p.radius)return 0;if(l)return!0;var b=this.createContactEquation(h,c,n,e);return Y.copy(b.normalA,v),Y.scale(b.contactPointB,b.normalA,-p.radius),G(b.contactPointB,b.contactPointB,u),N(b.contactPointB,b.contactPointB,c.position),Y.scale(g,b.normalA,m),N(b.contactPointA,y,g),G(b.contactPointA,b.contactPointA,f),N(b.contactPointA,b.contactPointA,h.position),this.contactEquations.push(b),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(b)),1},J.prototype[c.CONVEX]=J.prototype[c.CONVEX|c.BOX]=J.prototype[c.BOX]=J.prototype.convexConvex=function(t,e,i,o,r,n,s,a,l,c){var p=j,u=U,h=W,f=$,d=z,y=K,v=Q,g=Z,m=0;c="number"==typeof c?c:0;if(!J.findSeparatingAxis(e,i,o,n,s,a,p))return 0;N(v,s,i),0<H(p,v)&&Y.scale(p,p,-1);var b=J.getClosestEdge(e,o,p,!0),S=J.getClosestEdge(n,a,p);if(-1===b||-1===S)return 0;for(var A=0;A<2;A++){var E,w=b,x=S,R=e,B=n,L=i,C=s,P=o,D=a,_=t,T=r;if(0===A)E=w,w=x,x=E,E=R,R=B,B=E,E=L,L=C,C=E,E=P,P=D,D=E,E=_,_=T,T=E;for(var I=x;I<x+2;I++){var O=B.vertices[(I+B.vertices.length)%B.vertices.length];Y.rotate(u,O,D),G(u,u,C);for(var M=0,q=w-1;q<w+2;q++){var F=R.vertices[(q+R.vertices.length)%R.vertices.length],X=R.vertices[(q+1+R.vertices.length)%R.vertices.length];Y.rotate(h,F,P),Y.rotate(f,X,P),G(h,h,L),G(f,f,L),N(d,f,h),Y.rotate90cw(g,d),Y.normalize(g,g),N(v,u,h);var V=H(g,v);(q===w&&V<=c||q!==w&&V<=0)&&M++}if(3<=M){if(l)return!0;var k=this.createContactEquation(_,T,R,B);m++;F=R.vertices[w%R.vertices.length],X=R.vertices[(w+1)%R.vertices.length];Y.rotate(h,F,P),Y.rotate(f,X,P),G(h,h,L),G(f,f,L),N(d,f,h),Y.rotate90cw(k.normalA,d),Y.normalize(k.normalA,k.normalA),N(v,u,h);V=H(k.normalA,v);Y.scale(y,k.normalA,V),N(k.contactPointA,u,L),N(k.contactPointA,k.contactPointA,y),G(k.contactPointA,k.contactPointA,L),N(k.contactPointA,k.contactPointA,_.position),N(k.contactPointB,u,C),G(k.contactPointB,k.contactPointB,C),N(k.contactPointB,k.contactPointB,T.position),this.contactEquations.push(k),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(k))}}}return this.enableFrictionReduction&&this.enableFriction&&m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m};var I=Y.fromValues(0,0);J.projectConvexOntoAxis=function(t,e,i,o,r){var n,s,a=null,l=null,c=I;Y.rotate(c,o,-i);for(var p=0;p<t.vertices.length;p++)n=t.vertices[p],s=H(n,c),(null===a||a<s)&&(a=s),(null===l||s<l)&&(l=s);if(a<l){var u=l;l=a,a=u}var h=H(e,o);Y.set(r,l+h,a+h)};var tt=Y.fromValues(0,0),et=Y.fromValues(0,0),it=Y.fromValues(0,0),ot=Y.fromValues(0,0),rt=Y.fromValues(0,0),nt=Y.fromValues(0,0);J.findSeparatingAxis=function(t,e,i,o,r,n,s){var a=null,l=!1,c=!1,p=tt,u=et,h=it,f=ot,d=rt,y=nt;if(t instanceof w&&o instanceof w)for(var v=0;2!==v;v++){var g=t,m=i;1===v&&(g=o,m=n);for(var b=0;2!==b;b++){0===b?Y.set(f,0,1):1===b&&Y.set(f,1,0),0!==m&&Y.rotate(f,f,m),J.projectConvexOntoAxis(t,e,i,f,d),J.projectConvexOntoAxis(o,r,n,f,y);var S=d,A=y;d[0]>y[0]&&(A=d,S=y,0),l=(E=A[0]-S[1])<=0,(null===a||a<E)&&(Y.copy(s,f),a=E,c=l)}}else for(v=0;2!==v;v++){g=t,m=i;1===v&&(g=o,m=n);for(b=0;b!==g.vertices.length;b++){Y.rotate(u,g.vertices[b],m),Y.rotate(h,g.vertices[(b+1)%g.vertices.length],m),N(p,h,u),Y.rotate90cw(f,p),Y.normalize(f,f),J.projectConvexOntoAxis(t,e,i,f,d),J.projectConvexOntoAxis(o,r,n,f,y);var E;S=d,A=y;d[0]>y[0]&&(A=d,S=y,0),l=(E=A[0]-S[1])<=0,(null===a||a<E)&&(Y.copy(s,f),a=E,c=l)}}return c};var h=Y.fromValues(0,0),st=Y.fromValues(0,0),at=Y.fromValues(0,0);J.getClosestEdge=function(t,e,i,o){var r=h,n=st,s=at;Y.rotate(r,i,-e),o&&Y.scale(r,r,-1);for(var a=-1,l=t.vertices.length,c=-1,p=0;p!==l;p++){N(n,t.vertices[(p+1)%l],t.vertices[p%l]),Y.rotate90cw(s,n),Y.normalize(s,s);var u=H(s,r);(-1===a||c<u)&&(a=p%l,c=u)}return a};var lt=Y.create(),ct=Y.create(),pt=Y.create(),ut=Y.create(),ht=Y.create(),ft=Y.create(),dt=Y.create();J.prototype[c.CIRCLE|c.HEIGHTFIELD]=J.prototype.circleHeightfield=function(t,e,i,o,r,n,s,a,l,c){var p=n.heights,u=(c=c||e.radius,n.elementWidth),h=ct,f=lt,d=ht,y=dt,v=ft,g=pt,m=ut,b=Math.floor((i[0]-c-s[0])/u),S=Math.ceil((i[0]+c-s[0])/u);b<0&&(b=0),S>=p.length&&(S=p.length-1);for(var A=p[b],E=p[S],w=b;w<S;w++)p[w]<E&&(E=p[w]),p[w]>A&&(A=p[w]);if(i[1]-c>A)return!l&&0;var x=!1;for(w=b;w<S;w++){Y.set(g,w*u,p[w]),Y.set(m,(w+1)*u,p[w+1]),Y.add(g,g,s),Y.add(m,m,s),Y.sub(v,m,g),Y.rotate(v,v,Math.PI/2),Y.normalize(v,v),Y.scale(f,v,-c),Y.add(f,f,i),Y.sub(h,f,g);var R=Y.dot(h,v);if(f[0]>=g[0]&&f[0]<m[0]&&R<=0){if(l)return!0;x=!0,Y.scale(h,v,-R),Y.add(d,f,h),Y.copy(y,v);var B=this.createContactEquation(r,t,n,e);Y.copy(B.normalA,y),Y.scale(B.contactPointB,B.normalA,-c),G(B.contactPointB,B.contactPointB,i),N(B.contactPointB,B.contactPointB,t.position),Y.copy(B.contactPointA,d),Y.sub(B.contactPointA,B.contactPointA,r.position),this.contactEquations.push(B),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B))}}if(x=!1,0<c)for(w=b;w<=S;w++)if(Y.set(g,w*u,p[w]),Y.add(g,g,s),Y.sub(h,i,g),Y.squaredLength(h)<Math.pow(c,2)){if(l)return!0;x=!0;B=this.createContactEquation(r,t,n,e);Y.copy(B.normalA,h),Y.normalize(B.normalA,B.normalA),Y.scale(B.contactPointB,B.normalA,-c),G(B.contactPointB,B.contactPointB,i),N(B.contactPointB,B.contactPointB,t.position),N(B.contactPointA,g,s),G(B.contactPointA,B.contactPointA,s),N(B.contactPointA,B.contactPointA,r.position),this.contactEquations.push(B),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B))}return x?1:0};var yt=Y.create(),vt=Y.create(),gt=Y.create(),mt=new l({vertices:[Y.create(),Y.create(),Y.create(),Y.create()]});J.prototype[c.BOX|c.HEIGHTFIELD]=J.prototype[c.CONVEX|c.HEIGHTFIELD]=J.prototype.convexHeightfield=function(t,e,i,o,r,n,s,a,l){var c=n.heights,p=n.elementWidth,u=yt,h=vt,f=gt,d=mt,y=Math.floor((t.aabb.lowerBound[0]-s[0])/p),v=Math.ceil((t.aabb.upperBound[0]-s[0])/p);y<0&&(y=0),v>=c.length&&(v=c.length-1);for(var g=c[y],m=c[v],b=y;b<v;b++)c[b]<m&&(m=c[b]),c[b]>g&&(g=c[b]);if(t.aabb.lowerBound[1]>g)return!l&&0;var S=0;for(b=y;b<v;b++){Y.set(u,b*p,c[b]),Y.set(h,(b+1)*p,c[b+1]),Y.add(u,u,s),Y.add(h,h,s);Y.set(f,.5*(h[0]+u[0]),.5*(h[1]+u[1]-100)),Y.sub(d.vertices[0],h,f),Y.sub(d.vertices[1],u,f),Y.copy(d.vertices[2],d.vertices[1]),Y.copy(d.vertices[3],d.vertices[0]),d.vertices[2][1]-=100,d.vertices[3][1]-=100,S+=this.convexConvex(t,e,i,o,r,d,f,0,l)}return S}},{"../equations/ContactEquation":23,"../equations/Equation":24,"../equations/FrictionEquation":25,"../math/vec2":32,"../objects/Body":33,"../shapes/Box":39,"../shapes/Circle":41,"../shapes/Convex":42,"../shapes/Shape":47,"../utils/ContactEquationPool":50,"../utils/FrictionEquationPool":51,"../utils/TupleDictionary":58,"../utils/Utils":59}],13:[function(t,e,i){"use strict";e.exports=s;var l=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB");function s(t){t=t||{},this.from=t.from?l.fromValues(t.from[0],t.from[1]):l.create(),this.to=t.to?l.fromValues(t.to[0],t.to[1]):l.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:s.ANY,this.callback=t.callback||function(t){},this.direction=l.create(),this.length=1,this.update()}(s.prototype.constructor=s).CLOSEST=1,s.ANY=2,s.ALL=4,s.prototype.update=function(){var t=this.direction;l.sub(t,this.to,this.from),this.length=l.length(t),l.normalize(t,t)},s.prototype.intersectBodies=function(t,e){for(var i=0,o=e.length;!t.shouldStop(this)&&i<o;i++){var r=e[i],n=r.getAABB();(0<=n.overlapsRay(this)||n.containsPoint(this.from))&&this.intersectBody(t,r)}};var c=l.create();s.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var o=c,r=0,n=e.shapes.length;r<n;r++){var s=e.shapes[r];if((!i||s.collisionResponse)&&(0!=(this.collisionGroup&s.collisionMask)&&0!=(s.collisionGroup&this.collisionMask))){l.rotate(o,s.position,e.angle),l.add(o,o,e.position);var a=s.angle+e.angle;if(this.intersectShape(t,s,a,o,e),t.shouldStop(this))break}}},s.prototype.intersectShape=function(t,e,i,o,r){(function(t,e,i){l.sub(n,i,t);var o=l.dot(n,e);return l.scale(a,e,o),l.add(a,a,t),l.squaredDistance(i,a)})(this.from,this.direction,o)>e.boundingRadius*e.boundingRadius||(this._currentBody=r,(this._currentShape=e).raycast(t,this,o,i),this._currentBody=this._currentShape=null)},s.prototype.getAABB=function(t){var e=this.to,i=this.from;l.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),l.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};l.create();s.prototype.reportIntersection=function(t,e,i,o){this.from,this.to;var r=this._currentShape,n=this._currentBody;if(!(this.skipBackfaces&&0<l.dot(i,this.direction)))switch(this.mode){case s.ALL:t.set(i,r,n,e,o),this.callback(t);break;case s.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,r,n,e,o);break;case s.ANY:t.set(i,r,n,e,o)}};var n=l.create(),a=l.create()},{"../collision/AABB":9,"../collision/RaycastResult":14,"../math/vec2":32,"../shapes/Shape":47}],14:[function(t,e,i){"use strict";var n=t("../math/vec2"),o=t("../collision/Ray");function r(){this.normal=n.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}(e.exports=r).prototype.reset=function(){n.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},r.prototype.getHitDistance=function(t){return n.distance(t.from,t.to)*this.fraction},r.prototype.hasHit=function(){return-1!==this.fraction},r.prototype.getHitPoint=function(t,e){n.lerp(t,e.from,e.to,this.fraction)},r.prototype.stop=function(){this.isStopped=!0},r.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===o.ANY},r.prototype.set=function(t,e,i,o,r){n.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=o,this.faceIndex=r}},{"../collision/Ray":13,"../math/vec2":32}],15:[function(t,e,i){"use strict";var o=t("../utils/Utils"),u=t("../collision/Broadphase");function r(){u.call(this,u.SAP),this.axisList=[],this.axisIndex=0;var i=this;this._addBodyHandler=function(t){i.axisList.push(t.body)},this._removeBodyHandler=function(t){var e=i.axisList.indexOf(t.body);-1!==e&&i.axisList.splice(e,1)}}(((e.exports=r).prototype=new u).constructor=r).prototype.setWorld=function(t){this.axisList.length=0,o.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},r.sortAxisList=function(t,e){e|=0;for(var i=1,o=t.length;i<o;i++){for(var r=t[i],n=i-1;0<=n&&!(t[n].aabb.lowerBound[e]<=r.aabb.lowerBound[e]);n--)t[n+1]=t[n];t[n+1]=r}return t},r.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;r.sortAxisList(t,e)},r.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,o=this.axisIndex;i.length=0;for(var r=e.length;r--;){var n=e[r];n.aabbNeedsUpdate&&n.updateAABB()}this.sortList();for(var s=0,a=0|e.length;s!==a;s++)for(var l=e[s],c=s+1;c<a;c++){var p=e[c];if(!(p.aabb.lowerBound[o]<=l.aabb.upperBound[o]))break;u.canCollide(l,p)&&this.boundingVolumeCheck(l,p)&&i.push(l,p)}return i},r.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();var o=this.axisIndex,r="x";1===o&&(r="y"),2===o&&(r="z");for(var n=this.axisList,s=(e.lowerBound[r],e.upperBound[r],0);s<n.length;s++){var a=n[s];a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(e)&&i.push(a)}return i}},{"../collision/Broadphase":10,"../utils/Utils":59}],16:[function(t,e,i){"use strict";e.exports=o;var r=t("../utils/Utils");function o(t,e,i,o){this.type=i,o=r.defaults(o,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=o.collideConnected,o.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.DISTANCE=1,o.GEAR=2,o.LOCK=3,o.PRISMATIC=4,o.REVOLUTE=5,o.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.stiffness=t,o.needsUpdate=!0}},o.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.relaxation=t,o.needsUpdate=!0}}},{"../utils/Utils":59}],17:[function(t,e,i){"use strict";var f=t("./Constraint"),d=t("../equations/Equation"),y=t("../math/vec2"),v=t("../utils/Utils");function o(t,e,i){i=v.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),f.call(this,t,e,f.DISTANCE,i),this.localAnchorA=y.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=y.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var o,r=this.localAnchorA,n=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var s=y.create(),a=y.create(),l=y.create();y.rotate(s,r,t.angle),y.rotate(a,n,e.angle),y.add(l,e.position,a),y.sub(l,l,s),y.sub(l,l,t.position),this.distance=y.length(l)}o=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce;var c=new d(t,e,-o,o);this.equations=[c],this.maxForce=o;l=y.create();var p=y.create(),u=y.create(),h=this;c.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,o=e.position;return y.rotate(p,r,t.angle),y.rotate(u,n,e.angle),y.add(l,o,u),y.sub(l,l,p),y.sub(l,l,i),y.length(l)-h.distance},this.setMaxForce(o),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}((e.exports=o).prototype=new f).constructor=o;var p=y.create(),u=y.create(),h=y.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,o=(this.distance,e.position),r=i.position,n=this.equations[0],s=t.G;y.rotate(u,this.localAnchorA,e.angle),y.rotate(h,this.localAnchorB,i.angle),y.add(p,r,h),y.sub(p,p,u),y.sub(p,p,o),this.position=y.length(p);var a=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(n.maxForce=0,n.minForce=-this.maxForce,this.distance=this.upperLimit,a=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(n.maxForce=this.maxForce,n.minForce=0,this.distance=this.lowerLimit,a=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||a){n.enabled=!0,y.normalize(p,p);var l=y.crossLength(u,p),c=y.crossLength(h,p);s[0]=-p[0],s[1]=-p[1],s[2]=-l,s[3]=p[0],s[4]=p[1],s[5]=c}else n.enabled=!1},o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":24,"../math/vec2":32,"../utils/Utils":59,"./Constraint":16}],18:[function(t,e,i){"use strict";var o=t("./Constraint"),r=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2");function n(t,e,i){i=i||{},o.call(this,t,e,o.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new r(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}(((e.exports=n).prototype=new o).constructor=n).prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},n.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},n.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":22,"../equations/Equation":24,"../math/vec2":32,"./Constraint":16}],19:[function(t,e,i){"use strict";var h=t("./Constraint"),f=t("../math/vec2"),d=t("../equations/Equation");function o(t,e,i){i=i||{},h.call(this,t,e,h.LOCK,i);var o=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce,r=(i.localAngleB,new d(t,e,-o,o)),n=new d(t,e,-o,o),s=new d(t,e,-o,o),a=f.create(),l=f.create(),c=this;r.computeGq=function(){return f.rotate(a,c.localOffsetB,t.angle),f.sub(l,e.position,t.position),f.sub(l,l,a),l[0]},n.computeGq=function(){return f.rotate(a,c.localOffsetB,t.angle),f.sub(l,e.position,t.position),f.sub(l,l,a),l[1]};var p=f.create(),u=f.create();s.computeGq=function(){return f.rotate(p,c.localOffsetB,e.angle-c.localAngleB),f.scale(p,p,-1),f.sub(l,t.position,e.position),f.add(l,l,p),f.rotate(u,p,-Math.PI/2),f.normalize(u,u),f.dot(l,u)},this.localOffsetB=f.create(),i.localOffsetB?f.copy(this.localOffsetB,i.localOffsetB):(f.sub(this.localOffsetB,e.position,t.position),f.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(r,n,s),this.setMaxForce(o)}(((e.exports=o).prototype=new h).constructor=o).prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var n=f.create(),s=f.create(),a=f.create(),l=f.fromValues(1,0),c=f.fromValues(0,1);o.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],o=this.bodyA,r=this.bodyB;f.rotate(n,this.localOffsetB,o.angle),f.rotate(s,this.localOffsetB,r.angle-this.localAngleB),f.scale(s,s,-1),f.rotate(a,s,Math.PI/2),f.normalize(a,a),t.G[0]=-1,t.G[1]=0,t.G[2]=-f.crossLength(n,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-f.crossLength(n,c),e.G[4]=1,i.G[0]=-a[0],i.G[1]=-a[1],i.G[3]=a[0],i.G[4]=a[1],i.G[5]=f.crossLength(s,a)}},{"../equations/Equation":24,"../math/vec2":32,"./Constraint":16}],20:[function(t,e,i){"use strict";var y=t("./Constraint"),v=t("../equations/ContactEquation"),g=t("../equations/Equation"),m=t("../math/vec2"),b=t("../equations/RotationalLockEquation");function o(o,r,t){t=t||{},y.call(this,o,r,y.PRISMATIC,t);var n=m.fromValues(0,0),s=m.fromValues(1,0),a=m.fromValues(0,0);t.localAnchorA&&m.copy(n,t.localAnchorA),t.localAxisA&&m.copy(s,t.localAxisA),t.localAnchorB&&m.copy(a,t.localAnchorB),this.localAnchorA=n,this.localAnchorB=a,this.localAxisA=s;var e=this.maxForce=void 0!==t.maxForce?t.maxForce:Number.MAX_VALUE,i=new g(o,r,-e,e),l=new m.create,c=new m.create,p=new m.create,u=new m.create;if(i.computeGq=function(){return m.dot(p,u)},i.updateJacobian=function(){var t=this.G,e=o.position,i=r.position;m.rotate(l,n,o.angle),m.rotate(c,a,r.angle),m.add(p,i,c),m.sub(p,p,e),m.sub(p,p,l),m.rotate(u,s,o.angle+Math.PI/2),t[0]=-u[0],t[1]=-u[1],t[2]=-m.crossLength(l,u)+m.crossLength(u,p),t[3]=u[0],t[4]=u[1],t[5]=m.crossLength(c,u)},this.equations.push(i),!t.disableRotationalLock){var h=new b(o,r,-e,e);this.equations.push(h)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==t.lowerLimit,this.upperLimitEnabled=void 0!==t.upperLimit,this.lowerLimit=void 0!==t.lowerLimit?t.lowerLimit:0,this.upperLimit=void 0!==t.upperLimit?t.upperLimit:1,this.upperLimitEquation=new v(o,r),this.lowerLimitEquation=new v(o,r),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=e,this.motorEquation=new g(o,r),this.motorEnabled=!1,this.motorSpeed=0;var f=this,d=this.motorEquation;d.computeGW;d.computeGq=function(){return 0},d.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,r=i.velocity,n=e.angularVelocity,s=i.angularVelocity;return this.gmult(t,o,n,r,s)+f.motorSpeed}}((e.exports=o).prototype=new y).constructor=o;var d=m.create(),S=m.create(),A=m.create(),E=m.create(),w=m.create(),x=m.create();o.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,o=this.lowerLimit,r=this.upperLimitEquation,n=this.lowerLimitEquation,s=this.bodyA,a=this.bodyB,l=this.localAxisA,c=this.localAnchorA,p=this.localAnchorB;e.updateJacobian(),m.rotate(d,l,s.angle),m.rotate(E,c,s.angle),m.add(S,E,s.position),m.rotate(w,p,a.angle),m.add(A,w,a.position);var u,h=this.position=m.dot(A,d)-m.dot(S,d);if(this.motorEnabled){var f=this.motorEquation.G;f[0]=d[0],f[1]=d[1],f[2]=m.crossLength(d,w),f[3]=-d[0],f[4]=-d[1],f[5]=-m.crossLength(d,E)}this.upperLimitEnabled&&i<h?(m.scale(r.normalA,d,-1),m.sub(r.contactPointA,S,s.position),m.sub(r.contactPointB,A,a.position),m.scale(x,d,i),m.add(r.contactPointA,r.contactPointA,x),-1===t.indexOf(r)&&t.push(r)):-1!==(u=t.indexOf(r))&&t.splice(u,1);this.lowerLimitEnabled&&h<o?(m.scale(n.normalA,d,1),m.sub(n.contactPointA,S,s.position),m.sub(n.contactPointB,A,a.position),m.scale(x,d,o),m.sub(n.contactPointB,n.contactPointB,x),-1===t.indexOf(n)&&t.push(n)):-1!==(u=t.indexOf(n))&&t.splice(u,1)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":23,"../equations/Equation":24,"../equations/RotationalLockEquation":26,"../math/vec2":32,"./Constraint":16}],21:[function(t,e,i){"use strict";var l=t("./Constraint"),c=t("../equations/Equation"),p=t("../equations/RotationalVelocityEquation"),u=t("../equations/RotationalLockEquation"),f=t("../math/vec2");e.exports=o;var d=f.create(),y=f.create(),v=f.fromValues(1,0),g=f.fromValues(0,1),h=f.create();function o(t,e,i){i=i||{},l.call(this,t,e,l.REVOLUTE,i);var o=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=f.create(),this.pivotB=f.create(),i.worldPivot?(f.sub(this.pivotA,i.worldPivot,t.position),f.sub(this.pivotB,i.worldPivot,e.position),f.rotate(this.pivotA,this.pivotA,-t.angle),f.rotate(this.pivotB,this.pivotB,-e.angle)):(f.copy(this.pivotA,i.localPivotA),f.copy(this.pivotB,i.localPivotB));var r=this.equations=[new c(t,e,-o,o),new c(t,e,-o,o)],n=r[0],s=r[1],a=this;n.computeGq=function(){return f.rotate(d,a.pivotA,t.angle),f.rotate(y,a.pivotB,e.angle),f.add(h,e.position,y),f.sub(h,h,t.position),f.sub(h,h,d),f.dot(h,v)},s.computeGq=function(){return f.rotate(d,a.pivotA,t.angle),f.rotate(y,a.pivotB,e.angle),f.add(h,e.position,y),f.sub(h,h,t.position),f.sub(h,h,d),f.dot(h,g)},s.minForce=n.minForce=-o,s.maxForce=n.maxForce=o,this.motorEquation=new p(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new u(t,e),this.lowerLimitEquation=new u(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}((o.prototype=new l).constructor=o).prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},o.prototype.update=function(){var t,e=this.bodyA,i=this.bodyB,o=this.pivotA,r=this.pivotB,n=this.equations,s=(n[0],n[1],n[0]),a=n[1],l=this.upperLimit,c=this.lowerLimit,p=this.upperLimitEquation,u=this.lowerLimitEquation,h=this.angle=i.angle-e.angle;this.upperLimitEnabled&&l<h?(p.angle=l,-1===n.indexOf(p)&&n.push(p)):-1!==(t=n.indexOf(p))&&n.splice(t,1);this.lowerLimitEnabled&&h<c?(u.angle=c,-1===n.indexOf(u)&&n.push(u)):-1!==(t=n.indexOf(u))&&n.splice(t,1);f.rotate(d,o,e.angle),f.rotate(y,r,i.angle),s.G[0]=-1,s.G[1]=0,s.G[2]=-f.crossLength(d,v),s.G[3]=1,s.G[4]=0,s.G[5]=f.crossLength(y,v),a.G[0]=0,a.G[1]=-1,a.G[2]=-f.crossLength(d,g),a.G[3]=0,a.G[4]=1,a.G[5]=f.crossLength(y,g)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.motorIsEnabled=function(){return!!this.motorEnabled},o.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},o.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":24,"../equations/RotationalLockEquation":26,"../equations/RotationalVelocityEquation":27,"../math/vec2":32,"./Constraint":16}],22:[function(t,e,i){"use strict";var o=t("./Equation");t("../math/vec2");function r(t,e,i){i=i||{},o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}(((e.exports=r).prototype=new o).constructor=r).prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},r.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},r.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":32,"./Equation":24}],23:[function(t,e,i){"use strict";var o=t("./Equation"),v=t("../math/vec2");function r(t,e){o.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=v.create(),this.penetrationVec=v.create(),this.contactPointB=v.create(),this.normalA=v.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}(((e.exports=r).prototype=new o).constructor=r).prototype.computeB=function(t,e,i){var o,r,n=this.bodyA,s=this.bodyB,a=this.contactPointA,l=this.contactPointB,c=n.position,p=s.position,u=this.penetrationVec,h=this.normalA,f=this.G,d=v.crossLength(a,h),y=v.crossLength(l,h);return f[0]=-h[0],f[1]=-h[1],f[2]=-d,f[3]=h[0],f[4]=h[1],f[5]=y,v.add(u,p,l),v.sub(u,u,c),v.sub(u,u,a),o=this.firstImpact&&0!==this.restitution?(r=0,1/e*(1+this.restitution)*this.computeGW()):(r=v.dot(h,u)+this.offset,this.computeGW()),-r*t-o*e-i*this.computeGiMf()};var n=v.create(),s=v.create(),a=v.create();r.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(n,this.contactPointA),this.bodyB.getVelocityAtPoint(s,this.contactPointB),v.subtract(a,n,s),v.dot(this.normalA,a)}},{"../math/vec2":32,"./Equation":24}],24:[function(t,e,i){"use strict";e.exports=s;var u=t("../math/vec2"),n=t("../utils/Utils");t("../objects/Body");function s(t,e,i,o){this.minForce=void 0===i?-Number.MAX_VALUE:i,this.maxForce=void 0===o?Number.MAX_VALUE:o,this.bodyA=t,this.bodyB=e,this.stiffness=s.DEFAULT_STIFFNESS,this.relaxation=s.DEFAULT_RELAXATION,this.G=new n.ARRAY_TYPE(6);for(var r=0;r<6;r++)this.G[r]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}(s.prototype.constructor=s).DEFAULT_STIFFNESS=1e6,s.DEFAULT_RELAXATION=4,s.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},s.prototype.gmult=function(t,e,i,o,r){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*o[0]+t[4]*o[1]+t[5]*r},s.prototype.computeB=function(t,e,i){var o=this.computeGW();return-this.computeGq()*t-o*e-this.computeGiMf()*i};var a=u.create(),l=u.create();s.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=(e.position,i.position,e.angle),r=i.angle;return this.gmult(t,a,o,l,r)+this.offset},s.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,r=i.velocity,n=e.angularVelocity,s=i.angularVelocity;return this.gmult(t,o,n,r,s)+this.relativeVelocity},s.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.vlambda,r=i.vlambda,n=e.wlambda,s=i.wlambda;return this.gmult(t,o,n,r,s)};var h=u.create(),f=u.create();s.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,o=t.angularForce,r=e.force,n=e.angularForce,s=t.invMassSolve,a=e.invMassSolve,l=t.invInertiaSolve,c=e.invInertiaSolve,p=this.G;return u.scale(h,i,s),u.multiply(h,t.massMultiplier,h),u.scale(f,r,a),u.multiply(f,e.massMultiplier,f),this.gmult(p,h,o*l,f,n*c)},s.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,o=e.invMassSolve,r=t.invInertiaSolve,n=e.invInertiaSolve,s=this.G;return s[0]*s[0]*i*t.massMultiplier[0]+s[1]*s[1]*i*t.massMultiplier[1]+s[2]*s[2]*r+s[3]*s[3]*o*e.massMultiplier[0]+s[4]*s[4]*o*e.massMultiplier[1]+s[5]*s[5]*n};var d=u.create(),y=u.create(),v=u.create();u.create(),u.create(),u.create();s.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,o=d,r=y,n=v,s=e.invMassSolve,a=i.invMassSolve,l=e.invInertiaSolve,c=i.invInertiaSolve,p=this.G;r[0]=p[0],r[1]=p[1],n[0]=p[3],n[1]=p[4],u.scale(o,r,s*t),u.multiply(o,o,e.massMultiplier),u.add(e.vlambda,e.vlambda,o),e.wlambda+=l*p[2]*t,u.scale(o,n,a*t),u.multiply(o,o,i.massMultiplier),u.add(i.vlambda,i.vlambda,o),i.wlambda+=c*p[5]*t},s.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":32,"../objects/Body":33,"../utils/Utils":59}],25:[function(t,e,i){"use strict";var a=t("../math/vec2"),o=t("./Equation");t("../utils/Utils");function r(t,e,i){o.call(this,t,e,-i,i),this.contactPointA=a.create(),this.contactPointB=a.create(),this.t=a.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}(((e.exports=r).prototype=new o).constructor=r).prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},r.prototype.getSlipForce=function(){return this.maxForce},r.prototype.computeB=function(t,e,i){this.bodyA,this.bodyB;var o=this.contactPointA,r=this.contactPointB,n=this.t,s=this.G;return s[0]=-n[0],s[1]=-n[1],s[2]=-a.crossLength(o,n),s[3]=n[0],s[4]=n[1],s[5]=a.crossLength(r,n),-this.computeGW()*e-i*this.computeGiMf()}},{"../math/vec2":32,"../utils/Utils":59,"./Equation":24}],26:[function(t,e,i){"use strict";var r=t("./Equation"),o=t("../math/vec2");function n(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var o=this.G;o[2]=1,o[5]=-1}((e.exports=n).prototype=new r).constructor=n;var s=o.create(),a=o.create(),l=o.fromValues(1,0),c=o.fromValues(0,1);n.prototype.computeGq=function(){return o.rotate(s,l,this.bodyA.angle+this.angle),o.rotate(a,c,this.bodyB.angle),o.dot(s,a)}},{"../math/vec2":32,"./Equation":24}],27:[function(t,e,i){"use strict";var o=t("./Equation");t("../math/vec2");function r(t,e){o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}(((e.exports=r).prototype=new o).constructor=r).prototype.computeB=function(t,e,i){var o=this.G;o[2]=-1,o[5]=this.ratio;var r=this.computeGiMf();return-this.computeGW()*e-i*r}},{"../math/vec2":32,"./Equation":24}],28:[function(t,e,i){"use strict";function o(){}(e.exports=o).prototype={constructor:o,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[t]&&(o[t]=[]),-1===o[t].indexOf(e)&&o[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&-1!==i[t].indexOf(e))return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,o=i[t].indexOf(e);return-1!==o&&i[t].splice(o,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=0,o=e.length;i<o;i++){var r=e[i];r.call(r.context,t)}}return this}}},{}],29:[function(t,e,i){"use strict";var o=t("./Material"),r=t("../equations/Equation");function n(t,e,i){if(i=i||{},!(t instanceof o&&e instanceof o))throw new Error("First two arguments must be Material instances.");this.id=n.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==i.friction?Number(i.friction):.3,this.restitution=void 0!==i.restitution?Number(i.restitution):0,this.stiffness=void 0!==i.stiffness?Number(i.stiffness):r.DEFAULT_STIFFNESS,this.relaxation=void 0!==i.relaxation?Number(i.relaxation):r.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==i.frictionStiffness?Number(i.frictionStiffness):r.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==i.frictionRelaxation?Number(i.frictionRelaxation):r.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}(e.exports=n).idCounter=0},{"../equations/Equation":24,"./Material":30}],30:[function(t,e,i){"use strict";function o(t){this.id=t||o.idCounter++}(e.exports=o).idCounter=0},{}],31:[function(t,e,i){"use strict";var m={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,o=0;o<e;o+=2)i+=(t[o+2]-t[o])*(t[o+1]+t[o+3]);return.5*-(i+=(t[0]-t[e])*(t[1+e]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],o=[],r=0;r<e;r++)o.push(r);r=0;for(var n=e;3<n;){var s=o[(r+0)%n],a=o[(r+1)%n],l=o[(r+2)%n],c=t[2*s],p=t[2*s+1],u=t[2*a],h=t[2*a+1],f=t[2*l],d=t[2*l+1],y=!1;if(m._convex(c,p,u,h,f,d)){y=!0;for(var v=0;v<n;v++){var g=o[v];if(g!=s&&g!=a&&g!=l&&m._PointInTriangle(t[2*g],t[2*g+1],c,p,u,h,f,d)){y=!1;break}}}if(y)i.push(s,a,l),o.splice((r+1)%n,1),n--,r=0;else if(r++>3*n)break}return i.push(o[0],o[1],o[2]),i},_PointInTriangle:function(t,e,i,o,r,n,s,a){var l=s-i,c=a-o,p=r-i,u=n-o,h=t-i,f=e-o,d=l*l+c*c,y=l*p+c*u,v=l*h+c*f,g=p*p+u*u,m=p*h+u*f,b=1/(d*g-y*y),S=(g*v-y*m)*b,A=(d*m-y*v)*b;return 0<=S&&0<=A&&S+A<1},_convex:function(t,e,i,o,r,n){return 0<=(e-o)*(r-i)+(i-t)*(n-o)}};e.exports=m},{}],32:[function(t,e,i){"use strict";var s=e.exports={},o=t("../utils/Utils");s.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},s.crossVZ=function(t,e,i){return s.rotate(t,e,-Math.PI/2),s.scale(t,t,i),t},s.crossZV=function(t,e,i){return s.rotate(t,i,Math.PI/2),s.scale(t,t,e),t},s.rotate=function(t,e,i){if(0!==i){var o=Math.cos(i),r=Math.sin(i),n=e[0],s=e[1];t[0]=o*n-r*s,t[1]=r*n+o*s}else t[0]=e[0],t[1]=e[1]},s.rotate90cw=function(t,e){var i=e[0],o=e[1];t[0]=o,t[1]=-i},s.toLocalFrame=function(t,e,i,o){s.copy(t,e),s.sub(t,t,i),s.rotate(t,t,-o)},s.toGlobalFrame=function(t,e,i,o){s.copy(t,e),s.rotate(t,t,o),s.add(t,t,i)},s.vectorToLocalFrame=function(t,e,i){s.rotate(t,e,-i)},s.vectorToGlobalFrame=function(t,e,i){s.rotate(t,e,i)},s.centroid=function(t,e,i,o){return s.add(t,e,i),s.add(t,t,o),s.scale(t,t,1/3),t},s.create=function(){var t=new o.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},s.clone=function(t){var e=new o.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},s.fromValues=function(t,e){var i=new o.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},s.set=function(t,e,i){return t[0]=e,t[1]=i,t},s.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},s.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},s.sub=s.subtract,s.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},s.mul=s.multiply,s.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},s.div=s.divide,s.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},s.distance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(i*i+o*o)},s.dist=s.distance,s.squaredDistance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},s.len=s.length,s.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},s.normalize=function(t,e){var i=e[0],o=e[1],r=i*i+o*o;return 0<r&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},s.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},s.lerp=function(t,e,i,o){var r=e[0],n=e[1];return t[0]=r+o*(i[0]-r),t[1]=n+o*(i[1]-n),t},s.reflect=function(t,e,i){var o=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*o,t[1]=e[1]-2*i[1]*o},s.getLineSegmentsIntersection=function(t,e,i,o,r){var n=s.getLineSegmentsIntersectionFraction(e,i,o,r);return!(n<0)&&(t[0]=e[0]+n*(i[0]-e[0]),t[1]=e[1]+n*(i[1]-e[1]),!0)},s.getLineSegmentsIntersectionFraction=function(t,e,i,o){var r,n,s=e[0]-t[0],a=e[1]-t[1],l=o[0]-i[0],c=o[1]-i[1];return r=(-a*(t[0]-i[0])+s*(t[1]-i[1]))/(-l*a+s*c),n=(l*(t[1]-i[1])-c*(t[0]-i[0]))/(-l*a+s*c),0<=r&&r<=1&&0<=n&&n<=1?n:-1}},{"../utils/Utils":59}],33:[function(t,e,i){"use strict";var u=t("../math/vec2"),c=t("poly-decomp"),p=t("../shapes/Convex"),o=t("../collision/RaycastResult"),r=t("../collision/Ray"),n=t("../collision/AABB"),s=t("../events/EventEmitter");function a(t){t=t||{},s.call(this),this.id=t.id||++a._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=u.create(),this.position=u.fromValues(0,0),t.position&&u.copy(this.position,t.position),this.interpolatedPosition=u.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=u.fromValues(0,0),this.previousAngle=0,this.velocity=u.fromValues(0,0),t.velocity&&u.copy(this.velocity,t.velocity),this.vlambda=u.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=u.create(),t.force&&u.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=a.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=a.DYNAMIC:this.type=a.STATIC,this.boundingRadius=0,this.aabb=new n,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=a.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}(((e.exports=a).prototype=new s).constructor=a)._idCounter=0,a.prototype.updateSolveMassProperties=function(){this.sleepState===a.SLEEPING||this.type===a.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},a.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},a.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},a.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new n,h=u.create();a.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=h,o=this.angle,r=0;r!==e;r++){var n=t[r],s=n.angle+o;u.rotate(i,n.position,o),u.add(i,i,this.position),n.computeAABB(l,i,s),0===r?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},a.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,o=0;o!==e;o++){var r=t[o],n=u.length(r.position),s=r.boundingRadius;i<n+s&&(i=n+s)}this.boundingRadius=i},a.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?u.copy(t.position,e):u.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},a.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,!(t.body=null))},a.prototype.updateMassProperties=function(){if(this.type===a.STATIC||this.type===a.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,o=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var r=0;r<e;r++){var n=t[r],s=u.squaredLength(n.position);o+=n.computeMomentOfInertia(i)+i*s}this.inertia=o,this.invInertia=0<o?1/o:0}this.invMass=1/this.mass,u.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};u.create();a.prototype.applyForce=function(t,e){if(u.add(this.force,this.force,t),e){var i=u.crossLength(e,t);this.angularForce+=i}};var f=u.create(),d=u.create(),y=u.create();a.prototype.applyForceLocal=function(t,e){e=e||y;var i=f,o=d;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyForce(i,o)};var v=u.create();a.prototype.applyImpulse=function(t,e){if(this.type===a.DYNAMIC){var i=v;if(u.scale(i,t,this.invMass),u.multiply(i,this.massMultiplier,i),u.add(this.velocity,i,this.velocity),e){var o=u.crossLength(e,t);o*=this.invInertia,this.angularVelocity+=o}}};var g=u.create(),m=u.create(),b=u.create();a.prototype.applyImpulseLocal=function(t,e){e=e||b;var i=g,o=m;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyImpulse(i,o)},a.prototype.toLocalFrame=function(t,e){u.toLocalFrame(t,e,this.position,this.angle)},a.prototype.toWorldFrame=function(t,e){u.toGlobalFrame(t,e,this.position,this.angle)},a.prototype.vectorToLocalFrame=function(t,e){u.vectorToLocalFrame(t,e,this.angle)},a.prototype.vectorToWorldFrame=function(t,e){u.vectorToGlobalFrame(t,e,this.angle)},a.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;0<=i;--i)this.removeShape(this.shapes[i]);var o,r=new c.Polygon;if(r.vertices=t,r.makeCCW(),"number"==typeof e.removeCollinearPoints&&r.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!r.isSimple())return!1;this.concavePath=r.vertices.slice(0);for(i=0;i<this.concavePath.length;i++){var n=[0,0];u.copy(n,this.concavePath[i]),this.concavePath[i]=n}o=e.optimalDecomp?r.decomp():r.quickDecomp();var s=u.create();for(i=0;i!==o.length;i++){for(var a=new p({vertices:o[i].vertices}),l=0;l!==a.vertices.length;l++){n=a.vertices[l];u.sub(n,n,a.centerOfMass)}u.scale(s,a.centerOfMass,1),a.updateTriangles(),a.updateCenterOfMass(),a.updateBoundingRadius(),this.addShape(a,s)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0};u.fromValues(0,0);var S=u.fromValues(0,0),A=u.fromValues(0,0),E=u.fromValues(0,0);a.prototype.adjustCenterOfMass=function(){var t=S,e=A,i=E,o=0;u.set(e,0,0);for(var r=0;r!==this.shapes.length;r++){var n=this.shapes[r];u.scale(t,n.position,n.area),u.add(e,e,t),o+=n.area}u.scale(i,e,1/o);for(r=0;r!==this.shapes.length;r++){n=this.shapes[r];u.sub(n.position,n.position,i)}u.add(this.position,this.position,i);for(r=0;this.concavePath&&r<this.concavePath.length;r++)u.sub(this.concavePath[r],this.concavePath[r],i);this.updateMassProperties(),this.updateBoundingRadius()},a.prototype.setZeroForce=function(){u.set(this.force,0,0),this.angularForce=0},a.prototype.resetConstraintVelocity=function(){var t=this.vlambda;u.set(t,0,0),this.wlambda=0},a.prototype.addConstraintVelocity=function(){var t=this.velocity;u.add(t,t,this.vlambda),this.angularVelocity+=this.wlambda},a.prototype.applyDamping=function(t){if(this.type===a.DYNAMIC){var e=this.velocity;u.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},a.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=a.AWAKE,this.idleTime=0,t!==a.AWAKE&&this.emit(a.wakeUpEvent)},a.prototype.sleep=function(){this.sleepState=a.SLEEPING,this.angularVelocity=0,this.angularForce=0,u.set(this.velocity,0,0),u.set(this.force,0,0),this.emit(a.sleepEvent)},a.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==a.SLEEPING){this.wantsToSleep=!1;this.sleepState;var o=u.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2);Math.pow(this.sleepSpeedLimit,2)<=o?(this.idleTime=0,this.sleepState=a.AWAKE):(this.idleTime+=i,this.sleepState=a.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},a.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var w=u.create(),x=u.create();a.prototype.integrate=function(t){var e=this.invMass,i=this.force,o=this.position,r=this.velocity;u.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),u.scale(w,i,t*e),u.multiply(w,this.massMultiplier,w),u.add(r,w,r),this.integrateToTimeOfImpact(t)||(u.scale(x,r,t),u.add(o,o,x),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var R=new o,B=new r({mode:r.ALL}),L=u.create(),C=u.create(),P=u.create(),D=u.create();a.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||u.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;u.normalize(L,this.velocity),u.scale(C,this.velocity,t),u.add(C,C,this.position),u.sub(P,C,this.position);var e,i=this.angularVelocity*t,o=u.length(P),r=1,n=this;if(R.reset(),B.callback=function(t){t.body!==n&&(e=t.body,t.getHitPoint(C,B),u.sub(P,C,n.position),r=u.length(P)/o,t.stop())},u.copy(B.from,this.position),u.copy(B.to,C),B.update(),this.world.raycast(R,B),!e)return!1;var s=this.angle;u.copy(D,this.position);for(var a=0,l=0,c=0,p=r;l<=p&&a<this.ccdIterations;){a++,c=(p-l)/2,u.scale(x,P,r),u.add(this.position,D,x),this.angle=s+i*r,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?l=c:p=c}return r=c,u.copy(this.position,D),this.angle=s,u.scale(x,P,r),u.add(this.position,this.position,x),this.fixedRotation||(this.angle+=i*r),!0},a.prototype.getVelocityAtPoint=function(t,e){return u.crossVZ(t,e,this.angularVelocity),u.subtract(t,this.velocity,t),t},a.sleepyEvent={type:"sleepy"},a.sleepEvent={type:"sleep"},a.wakeUpEvent={type:"wakeup"},a.DYNAMIC=1,a.STATIC=2,a.KINEMATIC=4,a.AWAKE=0,a.SLEEPY=1,a.SLEEPING=2},{"../collision/AABB":9,"../collision/Ray":13,"../collision/RaycastResult":14,"../events/EventEmitter":28,"../math/vec2":32,"../shapes/Convex":42,"poly-decomp":80}],34:[function(t,e,i){"use strict";var g=t("../math/vec2"),s=t("./Spring");t("../utils/Utils");function o(t,e,i){i=i||{},s.call(this,t,e,i),this.localAnchorA=g.fromValues(0,0),this.localAnchorB=g.fromValues(0,0),i.localAnchorA&&g.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&g.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var o=g.create(),r=g.create();this.getWorldAnchorA(o),this.getWorldAnchorB(r);var n=g.distance(o,r);this.restLength="number"==typeof i.restLength?i.restLength:n}(((e.exports=o).prototype=new s).constructor=o).prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var m=g.create(),b=g.create(),S=g.create(),A=g.create(),E=g.create(),w=g.create(),x=g.create(),R=g.create(),B=g.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,o=this.bodyA,r=this.bodyB,n=m,s=b,a=S,l=A,c=B,p=E,u=w,h=x,f=R;this.getWorldAnchorA(p),this.getWorldAnchorB(u),g.sub(h,p,o.position),g.sub(f,u,r.position),g.sub(n,u,p);var d=g.len(n);g.normalize(s,n),g.sub(a,r.velocity,o.velocity),g.crossZV(c,r.angularVelocity,f),g.add(a,a,c),g.crossZV(c,o.angularVelocity,h),g.sub(a,a,c),g.scale(l,s,-t*(d-i)-e*g.dot(a,s)),g.sub(o.force,o.force,l),g.add(r.force,r.force,l);var y=g.crossLength(h,l),v=g.crossLength(f,l);o.angularForce-=y,r.angularForce+=v}},{"../math/vec2":32,"../utils/Utils":59,"./Spring":36}],35:[function(t,e,i){"use strict";t("../math/vec2");var o=t("./Spring");function r(t,e,i){i=i||{},o.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}(((e.exports=r).prototype=new o).constructor=r).prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,o=this.bodyA,r=this.bodyB,n=-t*(r.angle-o.angle-i)-e*(r.angularVelocity-o.angularVelocity)*0;o.angularForce-=n,r.angularForce+=n}},{"../math/vec2":32,"./Spring":36}],36:[function(t,e,i){"use strict";t("../math/vec2");var o=t("../utils/Utils");function r(t,e,i){i=o.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}(e.exports=r).prototype.applyForce=function(){}},{"../math/vec2":32,"../utils/Utils":59}],37:[function(t,e,i){"use strict";var o=t("../math/vec2"),r=(t("../utils/Utils"),t("../constraints/Constraint")),n=t("../equations/FrictionEquation"),s=t("../objects/Body");function a(t,e){this.chassisBody=t,this.wheels=[],this.groundBody=new s({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function l(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new n(t.chassisBody,t.groundBody),this.sideEquation=new n(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=o.fromValues(0,1),e.localForwardVector&&o.copy(this.localForwardVector,e.localForwardVector),this.localPosition=o.fromValues(0,0),e.localPosition&&o.copy(this.localPosition,e.localPosition),r.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}(e.exports=a).prototype.addToWorld=function(t){(this.world=t).addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},a.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},a.prototype.addWheel=function(t){var e=new l(this,t);return this.wheels.push(e),e},a.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},(l.prototype=new r).setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},l.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=o.create(),p=o.create();l.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(p,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(c,p),o.dot(c,p)};var u=o.create();l.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),o.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),o.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),o.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),o.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),o.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),o.normalize(u,this.forwardEquation.t),o.scale(u,u,this.engineForce),this.vehicle.chassisBody.applyForce(u,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":16,"../equations/FrictionEquation":25,"../math/vec2":32,"../objects/Body":33,"../utils/Utils":59}],38:[function(t,e,i){"use strict";var o=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(o,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":8,"./collision/AABB":9,"./collision/Broadphase":10,"./collision/NaiveBroadphase":11,"./collision/Narrowphase":12,"./collision/Ray":13,"./collision/RaycastResult":14,"./collision/SAPBroadphase":15,"./constraints/Constraint":16,"./constraints/DistanceConstraint":17,"./constraints/GearConstraint":18,"./constraints/LockConstraint":19,"./constraints/PrismaticConstraint":20,"./constraints/RevoluteConstraint":21,"./equations/AngleLockEquation":22,"./equations/ContactEquation":23,"./equations/Equation":24,"./equations/FrictionEquation":25,"./equations/RotationalVelocityEquation":27,"./events/EventEmitter":28,"./material/ContactMaterial":29,"./material/Material":30,"./math/vec2":32,"./objects/Body":33,"./objects/LinearSpring":34,"./objects/RotationalSpring":35,"./objects/Spring":36,"./objects/TopDownVehicle":37,"./shapes/Box":39,"./shapes/Capsule":40,"./shapes/Circle":41,"./shapes/Convex":42,"./shapes/Heightfield":43,"./shapes/Line":44,"./shapes/Particle":45,"./shapes/Plane":46,"./shapes/Shape":47,"./solver/GSSolver":48,"./solver/Solver":49,"./utils/ContactEquationPool":50,"./utils/FrictionEquationPool":51,"./utils/Pool":57,"./utils/Utils":59,"./world/World":63}],39:[function(t,e,i){"use strict";var n=t("../math/vec2"),s=t("./Shape"),a=t("./Convex");function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,o=[n.fromValues(-e/2,-i/2),n.fromValues(e/2,-i/2),n.fromValues(e/2,i/2),n.fromValues(-e/2,i/2)],r=[n.fromValues(1,0),n.fromValues(0,1)];t.vertices=o,t.axes=r,t.type=s.BOX,a.call(this,t)}(((e.exports=o).prototype=new a).constructor=o).prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},o.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};n.create(),n.create(),n.create(),n.create();o.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},o.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":32,"./Convex":42,"./Shape":47}],40:[function(t,e,i){"use strict";var o=t("./Shape"),E=t("../math/vec2");function r(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=o.CAPSULE,o.call(this,t)}(((e.exports=r).prototype=new o).constructor=r).prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,o=2*e;return t*(o*o+i*i)/12},r.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},r.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var n=E.create();r.prototype.computeAABB=function(t,e,i){var o=this.radius;E.set(n,this.length/2,0),0!==i&&E.rotate(n,n,i),E.set(t.upperBound,Math.max(n[0]+o,-n[0]+o),Math.max(n[1]+o,-n[1]+o)),E.set(t.lowerBound,Math.min(n[0]-o,-n[0]-o),Math.min(n[1]-o,-n[1]-o)),E.add(t.lowerBound,t.lowerBound,e),E.add(t.upperBound,t.upperBound,e)};var w=E.create(),x=E.create(),R=E.create(),B=E.create(),L=E.fromValues(0,1);r.prototype.raycast=function(t,e,i,o){for(var r=e.from,n=e.to,s=(e.direction,w),a=x,l=R,c=B,p=this.length/2,u=0;u<2;u++){var h=this.radius*(2*u-1);if(E.set(l,-p,h),E.set(c,p,h),E.toGlobalFrame(l,l,i,o),E.toGlobalFrame(c,c,i,o),0<=(d=E.getLineSegmentsIntersectionFraction(r,n,l,c))&&(E.rotate(a,L,o),E.scale(a,a,2*u-1),e.reportIntersection(t,d,a,-1),t.shouldStop(e)))return}var f=Math.pow(this.radius,2)+Math.pow(p,2);for(u=0;u<2;u++){E.set(l,p*(2*u-1),0),E.toGlobalFrame(l,l,i,o);var d,y=Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2),v=2*((n[0]-r[0])*(r[0]-l[0])+(n[1]-r[1])*(r[1]-l[1])),g=Math.pow(r[0]-l[0],2)+Math.pow(r[1]-l[1],2)-Math.pow(this.radius,2);if(!((d=Math.pow(v,2)-4*y*g)<0))if(0===d){if(E.lerp(s,r,n,d),E.squaredDistance(s,i)>f&&(E.sub(a,s,l),E.normalize(a,a),e.reportIntersection(t,d,a,-1),t.shouldStop(e)))return}else{var m=Math.sqrt(d),b=1/(2*y),S=(-v-m)*b,A=(-v+m)*b;if(0<=S&&S<=1&&(E.lerp(s,r,n,S),E.squaredDistance(s,i)>f&&(E.sub(a,s,l),E.normalize(a,a),e.reportIntersection(t,S,a,-1),t.shouldStop(e))))return;if(0<=A&&A<=1&&(E.lerp(s,r,n,A),E.squaredDistance(s,i)>f&&(E.sub(a,s,l),E.normalize(a,a),e.reportIntersection(t,A,a,-1),t.shouldStop(e))))return}}}},{"../math/vec2":32,"./Shape":47}],41:[function(t,e,i){"use strict";var o=t("./Shape"),g=t("../math/vec2");function r(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=o.CIRCLE,o.call(this,t)}(((e.exports=r).prototype=new o).constructor=r).prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},r.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},r.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},r.prototype.computeAABB=function(t,e,i){var o=this.radius;g.set(t.upperBound,o,o),g.set(t.lowerBound,-o,-o),e&&(g.add(t.lowerBound,t.lowerBound,e),g.add(t.upperBound,t.upperBound,e))};var m=g.create(),b=g.create();r.prototype.raycast=function(t,e,i,o){var r=e.from,n=e.to,s=this.radius,a=Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2),l=2*((n[0]-r[0])*(r[0]-i[0])+(n[1]-r[1])*(r[1]-i[1])),c=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2)-Math.pow(s,2),p=Math.pow(l,2)-4*a*c,u=m,h=b;if(!(p<0))if(0==p)g.lerp(u,r,n,p),g.sub(h,u,i),g.normalize(h,h),e.reportIntersection(t,p,h,-1);else{var f=Math.sqrt(p),d=1/(2*a),y=(-l-f)*d,v=(-l+f)*d;if(0<=y&&y<=1&&(g.lerp(u,r,n,y),g.sub(h,u,i),g.normalize(h,h),e.reportIntersection(t,y,h,-1),t.shouldStop(e)))return;0<=v&&v<=1&&(g.lerp(u,r,n,v),g.sub(h,u,i),g.normalize(h,h),e.reportIntersection(t,v,h,-1))}}},{"../math/vec2":32,"./Shape":47}],42:[function(t,e,i){"use strict";var l=t("./Shape"),f=t("../math/vec2"),a=t("../math/polyk");t("poly-decomp");function h(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var o=f.create();f.copy(o,e[i]),this.vertices.push(o)}if(this.axes=[],t.axes)for(i=0;i<t.axes.length;i++){var r=f.create();f.copy(r,t.axes[i]),this.axes.push(r)}else for(i=0;i<this.vertices.length;i++){var n=this.vertices[i],s=this.vertices[(i+1)%this.vertices.length],a=f.create();f.sub(a,s,n),f.rotate90cw(a,a),f.normalize(a,a),this.axes.push(a)}if(this.centerOfMass=f.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=l.CONVEX,l.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}((e.exports=h).prototype=new l).constructor=h;var c=f.create(),s=f.create();h.prototype.projectOntoLocalAxis=function(t,e){for(var i,o,r=null,n=null,s=(t=c,0);s<this.vertices.length;s++)i=this.vertices[s],o=f.dot(i,t),(null===r||r<o)&&(r=o),(null===n||o<n)&&(n=o);if(r<n){var a=n;n=r,r=a}f.set(e,n,r)},h.prototype.projectOntoWorldAxis=function(t,e,i,o){var r=s;this.projectOntoLocalAxis(t,o),0!==i?f.rotate(r,t,i):r=t;var n=f.dot(e,r);f.set(o,o[0]+n,o[1]+n)},h.prototype.updateTriangles=function(){for(var t=[],e=this.triangles.length=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}var o=a.Triangulate(t);for(e=0;e<o.length;e+=3){var r=o[e],n=o[e+1],s=o[e+2];this.triangles.push([r,n,s])}};var d=f.create(),y=f.create(),v=f.create(),g=f.create(),m=f.create();f.create(),f.create(),f.create(),f.create();h.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,o=d,r=v,n=g,s=m,a=y;f.set(i,0,0);for(var l=0,c=0;c!==t.length;c++){var p=t[c];r=e[p[0]],n=e[p[1]],s=e[p[2]];f.centroid(o,r,n,s);var u=h.triangleArea(r,n,s);l+=u,f.scale(a,o,u),f.add(i,i,a)}f.scale(i,i,1/l)},h.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,o=this.vertices.length,r=o-1,n=0;n<o;r=n,n++){var s=this.vertices[r],a=this.vertices[n],l=Math.abs(f.crossLength(s,a));e+=l*(f.dot(a,a)+f.dot(a,s)+f.dot(s,s)),i+=l}return t/6*(e/i)},h.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var o=f.squaredLength(t[i]);e<o&&(e=o)}this.boundingRadius=Math.sqrt(e)},h.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},h.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var o=t[i],r=e[o[0]],n=e[o[1]],s=e[o[2]],a=h.triangleArea(r,n,s);this.area+=a}},h.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var b=f.create(),S=f.create(),A=f.create();h.prototype.raycast=function(t,e,i,o){var r=b,n=S,s=A,a=this.vertices;f.toLocalFrame(r,e.from,i,o),f.toLocalFrame(n,e.to,i,o);for(var l=a.length,c=0;c<l&&!t.shouldStop(e);c++){var p=a[c],u=a[(c+1)%l],h=f.getLineSegmentsIntersectionFraction(r,n,p,u);0<=h&&(f.sub(s,u,p),f.rotate(s,s,-Math.PI/2+o),f.normalize(s,s),e.reportIntersection(t,h,s,c))}}},{"../math/polyk":31,"../math/vec2":32,"./Shape":47,"poly-decomp":80}],43:[function(t,e,i){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r=t("./Shape"),v=t("../math/vec2");t("../utils/Utils");function n(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"===o(arguments[1]))for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=r.HEIGHTFIELD,r.call(this,t)}(((e.exports=n).prototype=new r).constructor=n).prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],o=0;o!==t.length;o++){var r=t[o];e<r&&(e=r),r<i&&(i=r)}this.maxValue=e,this.minValue=i},n.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var s=[v.create(),v.create(),v.create(),v.create()];n.prototype.computeAABB=function(t,e,i){v.set(s[0],0,this.maxValue),v.set(s[1],this.elementWidth*this.heights.length,this.maxValue),v.set(s[2],this.elementWidth*this.heights.length,this.minValue),v.set(s[3],0,this.minValue),t.setFromPoints(s,e,i)},n.prototype.getLineSegment=function(t,e,i){var o=this.heights,r=this.elementWidth;v.set(t,i*r,o[i]),v.set(e,(i+1)*r,o[i+1])},n.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},n.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};v.create();var g=v.create(),m=v.create(),b=v.create(),S=v.create(),A=v.create();v.fromValues(0,1);n.prototype.raycast=function(t,e,i,o){var r=e.from,n=e.to,s=(e.direction,g),a=m,l=b,c=S,p=A;v.toLocalFrame(c,r,i,o),v.toLocalFrame(p,n,i,o);var u=this.getClampedSegmentIndex(c),h=this.getClampedSegmentIndex(p);if(h<u){var f=u;u=h,h=f}for(var d=0;d<this.heights.length-1;d++){this.getLineSegment(a,l,d);var y=v.getLineSegmentsIntersectionFraction(c,p,a,l);if(0<=y&&(v.sub(s,l,a),v.rotate(s,s,o+Math.PI/2),v.normalize(s,s),e.reportIntersection(t,y,s,-1),t.shouldStop(e)))return}}},{"../math/vec2":32,"../utils/Utils":59,"./Shape":47}],44:[function(t,e,i){"use strict";var o=t("./Shape"),u=t("../math/vec2");function r(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=o.LINE,o.call(this,t)}(((e.exports=r).prototype=new o).constructor=r).prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},r.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var n=[u.create(),u.create()];r.prototype.computeAABB=function(t,e,i){var o=this.length/2;u.set(n[0],-o,0),u.set(n[1],o,0),t.setFromPoints(n,e,i,0)};u.create();var h=u.create(),f=u.create(),d=u.create(),y=u.fromValues(0,1);r.prototype.raycast=function(t,e,i,o){var r=e.from,n=e.to,s=f,a=d,l=this.length/2;u.set(s,-l,0),u.set(a,l,0),u.toGlobalFrame(s,s,i,o),u.toGlobalFrame(a,a,i,o);var c=u.getLineSegmentsIntersectionFraction(s,a,r,n);if(0<=c){var p=h;u.rotate(p,y,o),e.reportIntersection(t,c,p,-1)}}},{"../math/vec2":32,"./Shape":47}],45:[function(t,e,i){"use strict";var o=t("./Shape"),r=t("../math/vec2");function n(t){(t=t||{}).type=o.PARTICLE,o.call(this,t)}(((e.exports=n).prototype=new o).constructor=n).prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=0},n.prototype.computeAABB=function(t,e,i){r.copy(t.lowerBound,e),r.copy(t.upperBound,e)}},{"../math/vec2":32,"./Shape":47}],46:[function(t,e,i){"use strict";var o=t("./Shape"),f=t("../math/vec2");t("../utils/Utils");function r(t){(t=t||{}).type=o.PLANE,o.call(this,t)}(((e.exports=r).prototype=new o).constructor=r).prototype.computeMomentOfInertia=function(t){return 0},r.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},r.prototype.computeAABB=function(t,e,i){var o=i%(2*Math.PI),r=f.set,n=t.lowerBound,s=t.upperBound;r(n,-1e7,-1e7),r(s,1e7,1e7),0==o?s[1]=0:o==Math.PI/2?n[0]=0:o===Math.PI?n[1]=0:o==3*Math.PI/2&&(s[0]=0)},r.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var d=f.create(),y=(f.create(),f.create(),f.create()),v=f.create();r.prototype.raycast=function(t,e,i,o){var r=e.from,n=e.to,s=e.direction,a=d,l=y,c=v;f.set(l,0,1),f.rotate(l,l,o),f.sub(c,r,i);var p=f.dot(c,l);if(f.sub(c,n,i),!(0<p*f.dot(c,l)||f.squaredDistance(r,n)<p*p)){var u=f.dot(l,s);f.sub(a,r,i);var h=-f.dot(l,a)/u/e.length;e.reportIntersection(t,h,l,-1)}}},{"../math/vec2":32,"../utils/Utils":59,"./Shape":47}],47:[function(t,e,i){"use strict";e.exports=r;var o=t("../math/vec2");function r(t){t=t||{},this.body=null,this.position=o.fromValues(0,0),t.position&&o.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=r.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}r.idCounter=0,r.CIRCLE=1,r.PARTICLE=2,r.PLANE=4,r.CONVEX=8,r.LINE=16,r.BOX=32,Object.defineProperty(r,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),r.BOX}}),r.CAPSULE=64,r.HEIGHTFIELD=128,r.prototype.computeMomentOfInertia=function(t){},r.prototype.updateBoundingRadius=function(){},r.prototype.updateArea=function(){},r.prototype.computeAABB=function(t,e,i){},r.prototype.raycast=function(t,e,i,o){}},{"../math/vec2":32}],48:[function(t,e,i){"use strict";var E=t("../math/vec2"),o=t("./Solver"),w=t("../utils/Utils"),x=t("../equations/FrictionEquation");function R(t){o.call(this,t,o.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new w.ARRAY_TYPE(this.arrayStep),this.Bs=new w.ARRAY_TYPE(this.arrayStep),this.invCs=new w.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}(((e.exports=R).prototype=new o).constructor=R).prototype.solve=function(t,e){this.sortEquations();var i=0,o=this.iterations,r=this.frictionIterations,n=this.equations,s=n.length,a=Math.pow(this.tolerance*s,2),l=e.bodies,c=e.bodies.length,p=(E.add,E.set,this.useZeroRHS),u=this.lambda;if(this.usedIterations=0,s)for(var h=0;h!==c;h++){l[h].updateSolveMassProperties()}u.length<s&&(u=this.lambda=new w.ARRAY_TYPE(s+this.arrayStep),this.Bs=new w.ARRAY_TYPE(s+this.arrayStep),this.invCs=new w.ARRAY_TYPE(s+this.arrayStep)),function(t){for(var e=t.length;e--;)t[e]=0}(u);var f,d,y=this.invCs,v=this.Bs;for(u=this.lambda,h=0;h!==n.length;h++){var g;(g=n[h]).timeStep===t&&!g.needsUpdate||(g.timeStep=t,g.update()),v[h]=g.computeB(g.a,g.b,t),y[h]=g.computeInvC(g.epsilon)}if(0!==s){for(h=0;h!==c;h++){l[h].resetConstraintVelocity()}if(r){for(i=0;i!==r;i++){for(d=f=0;d!==s;d++){g=n[d];var m=R.iterateEquation(d,g,g.epsilon,v,y,u,p,t,i);f+=Math.abs(m)}if(this.usedIterations++,f*f<=a)break}for(R.updateMultipliers(n,u,1/t),d=0;d!==s;d++){var b=n[d];if(b instanceof x){for(var S=0,A=0;A!==b.contactEquations.length;A++)S+=b.contactEquations[A].multiplier;S*=b.frictionCoefficient/b.contactEquations.length,b.maxForce=S,b.minForce=-S}}}for(i=0;i!==o;i++){for(d=f=0;d!==s;d++){g=n[d];m=R.iterateEquation(d,g,g.epsilon,v,y,u,p,t,i);f+=Math.abs(m)}if(this.usedIterations++,f*f<=a)break}for(h=0;h!==c;h++)l[h].addConstraintVelocity();R.updateMultipliers(n,u,1/t)}},R.updateMultipliers=function(t,e,i){for(var o=t.length;o--;)t[o].multiplier=e[o]*i},R.iterateEquation=function(t,e,i,o,r,n,s,a,l){var c=o[t],p=r[t],u=n[t],h=e.computeGWlambda(),f=e.maxForce,d=e.minForce;s&&(c=0);var y=p*(c-h-i*u),v=u+y;return v<d*a?y=d*a-u:f*a<v&&(y=f*a-u),n[t]+=y,e.addToWlambda(y),y}},{"../equations/FrictionEquation":25,"../math/vec2":32,"../utils/Utils":59,"./Solver":49}],49:[function(t,e,i){"use strict";t("../utils/Utils");var o=t("../events/EventEmitter");function r(t,e){t=t||{},o.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}(((e.exports=r).prototype=new o).constructor=r).prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var n={bodies:[]};r.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),n.bodies.length=0,e.getBodies(n.bodies),n.bodies.length&&this.solve(t,n))},r.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},r.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},r.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var o=t[e];o.enabled&&this.equations.push(o)}},r.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},r.prototype.removeAllEquations=function(){this.equations.length=0},r.GS=1,r.ISLAND=2},{"../events/EventEmitter":28,"../utils/Utils":59}],50:[function(t,e,i){"use strict";var o=t("../equations/ContactEquation"),r=t("./Pool");function n(){r.apply(this,arguments)}(((e.exports=n).prototype=new r).constructor=n).prototype.create=function(){return new o},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":23,"./Pool":57}],51:[function(t,e,i){"use strict";var o=t("../equations/FrictionEquation"),r=t("./Pool");function n(){r.apply(this,arguments)}(((e.exports=n).prototype=new r).constructor=n).prototype.create=function(){return new o},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":25,"./Pool":57}],52:[function(t,e,i){"use strict";var o=t("../world/IslandNode"),r=t("./Pool");function n(){r.apply(this,arguments)}(((e.exports=n).prototype=new r).constructor=n).prototype.create=function(){return new o},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":62,"./Pool":57}],53:[function(t,e,i){"use strict";var o=t("../world/Island"),r=t("./Pool");function n(){r.apply(this,arguments)}(((e.exports=n).prototype=new r).constructor=n).prototype.create=function(){return new o},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":60,"./Pool":57}],54:[function(t,e,i){"use strict";var o=t("./TupleDictionary"),r=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils");function n(){this.overlappingShapesLastState=new o,this.overlappingShapesCurrentState=new o,this.recordPool=new r({size:16}),this.tmpDict=new o,this.tmpArray1=[]}(e.exports=n).prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var o=t.keys[i],r=t.getByKey(o);e.getByKey(o);r&&this.recordPool.release(r)}t.reset(),t.copy(e),e.reset()},n.prototype.setOverlapping=function(t,e,i,o){this.overlappingShapesLastState;var r=this.overlappingShapesCurrentState;if(!r.get(e.id,o.id)){var n=this.recordPool.get();n.set(t,e,i,o),r.set(e.id,o.id,n)}},n.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},n.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},n.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,o=i.keys.length;o--;){var r=i.keys[o],n=i.data[r];if(n.bodyA===t&&n.bodyB===e||n.bodyA===e&&n.bodyB===t)return!0}return!1},n.prototype.getDiff=function(t,e,i){var o=t,r=e;(i=i||[]).length=0;for(var n=r.keys.length;n--;){var s=r.keys[n],a=r.data[s];if(!a)throw new Error("Key "+s+" had no data!");o.data[s]||i.push(a)}return i},n.prototype.isNewOverlap=function(t,e){var i=0|t.id,o=0|e.id,r=this.overlappingShapesLastState,n=this.overlappingShapesCurrentState;return!r.get(i,o)&&!!n.get(i,o)},n.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,o=t.length;o--;){var r=t[o];i.set(0|r.bodyA.id,0|r.bodyB.id,r)}for(o=i.keys.length;o--;){(r=i.getByKey(i.keys[o]))&&e.push(r.bodyA,r.bodyB)}return i.reset(),e}},{"./OverlapKeeperRecord":55,"./OverlapKeeperRecordPool":56,"./TupleDictionary":58,"./Utils":59}],55:[function(t,e,i){"use strict";function r(t,e,i,o){this.shapeA=e,this.shapeB=o,this.bodyA=t,this.bodyB=i}(e.exports=r).prototype.set=function(t,e,i,o){r.call(this,t,e,i,o)}},{}],56:[function(t,e,i){"use strict";var o=t("./OverlapKeeperRecord"),r=t("./Pool");function n(){r.apply(this,arguments)}(((e.exports=n).prototype=new r).constructor=n).prototype.create=function(){return new o},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":55,"./Pool":57}],57:[function(t,e,i){"use strict";function o(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}(e.exports=o).prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},o.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},o.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],58:[function(t,e,i){"use strict";var o=t("./Utils");function r(){this.data={},this.keys=[]}(e.exports=r).prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|e)<(0|t)?t<<16|65535&e:e<<16|65535&t)},r.prototype.getByKey=function(t){return t|=0,this.data[t]},r.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},r.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var o=this.getKey(t,e);return this.data[o]||this.keys.push(o),this.data[o]=i,o},r.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},r.prototype.copy=function(t){this.reset(),o.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":59}],59:[function(t,e,i){"use strict";function o(){}(e.exports=o).appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,o=e.length;i!==o;++i)t.push(e[i])},o.splice=function(t,e,i){i=i||1;for(var o=e,r=t.length-i;o<r;o++)t[o]=t[o+i];t.length=r},"undefined"!=typeof P2_ARRAY_TYPE?o.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?o.ARRAY_TYPE=Float32Array:o.ARRAY_TYPE=Array,o.extend=function(t,e){for(var i in e)t[i]=e[i]},o.defaults=function(t,e){for(var i in t=t||{},e)i in t||(t[i]=e[i]);return t}},{}],60:[function(t,e,i){"use strict";var o=t("../objects/Body");function r(){this.equations=[],this.bodies=[]}(e.exports=r).prototype.reset=function(){this.equations.length=this.bodies.length=0};var n=[];r.prototype.getBodies=function(t){for(var e=t||[],i=this.equations,o=n.length=0;o!==i.length;o++){var r=i[o];-1===n.indexOf(r.bodyA.id)&&(e.push(r.bodyA),n.push(r.bodyA.id)),-1===n.indexOf(r.bodyB.id)&&(e.push(r.bodyB),n.push(r.bodyB.id))}return e},r.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===o.DYNAMIC&&!e.wantsToSleep)return!1}return!0},r.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){this.bodies[t].sleep()}return!0}},{"../objects/Body":33}],61:[function(t,e,i){"use strict";t("../math/vec2"),t("./Island"),t("./IslandNode");var o=t("./../utils/IslandNodePool"),r=t("./../utils/IslandPool"),s=t("../objects/Body");function d(t){this.nodePool=new o({size:16}),this.islandPool=new r({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}(e.exports=d).getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var o=t[i];if(!o.visited&&o.body.type===s.DYNAMIC)return o}return!1},d.prototype.visit=function(t,e,i){e.push(t.body);for(var o=t.equations.length,r=0;r!==o;r++){var n=t.equations[r];-1===i.indexOf(n)&&i.push(n)}},d.prototype.bfs=function(t,e,i){var o=this.queue;for(o.length=0,o.push(t),t.visited=!0,this.visit(t,e,i);o.length;)for(var r,n=o.pop();r=d.getUnvisitedNode(n.neighbors);)r.visited=!0,this.visit(r,e,i),r.body.type===s.DYNAMIC&&o.push(r)},d.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,o=this.equations;i.length;)this.nodePool.release(i.pop());for(var r=0;r!==e.length;r++){var n=this.nodePool.get();n.body=e[r],i.push(n)}for(var s=0;s!==o.length;s++){var a=o[s],l=(r=e.indexOf(a.bodyA),e.indexOf(a.bodyB)),c=i[r],p=i[l];c.neighbors.push(p),p.neighbors.push(c),c.equations.push(a),p.equations.push(a)}var u,h=this.islands;for(r=0;r<h.length;r++)this.islandPool.release(h[r]);for(h.length=0;u=d.getUnvisitedNode(i);){var f=this.islandPool.get();this.bfs(u,f.bodies,f.equations),h.push(f)}return h}},{"../math/vec2":32,"../objects/Body":33,"./../utils/IslandNodePool":52,"./../utils/IslandPool":53,"./Island":60,"./IslandNode":62}],62:[function(t,e,i){"use strict";function o(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}(e.exports=o).prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],63:[function(t,e,i){"use strict";var o=t("../solver/GSSolver"),j=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),g=t("../shapes/Circle"),m=t("../shapes/Convex"),b=(t("../shapes/Line"),t("../shapes/Plane")),S=t("../shapes/Capsule"),A=t("../shapes/Particle"),r=t("../events/EventEmitter"),U=t("../objects/Body"),n=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),s=t("../material/ContactMaterial"),a=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),l=t("../collision/SAPBroadphase"),c=t("../collision/Narrowphase"),W=t("../utils/Utils"),p=t("../utils/OverlapKeeper"),u=t("./IslandManager");t("../objects/RotationalSpring");function $(t){r.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new o,this.narrowphase=new c(this),this.islandManager=new u,this.gravity=j.fromValues(0,-9.78),t.gravity&&j.copy(this.gravity,t.gravity),this.frictionGravity=j.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new l,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new n,this.defaultContactMaterial=new s(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=$.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new p}(((e.exports=$).prototype=new Object(r.prototype)).constructor=$).NO_SLEEPING=1,$.BODY_SLEEPING=2,$.ISLAND_SLEEPING=4,$.prototype.addConstraint=function(t){this.constraints.push(t)},$.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},$.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&W.splice(this.contactMaterials,e,1)},$.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,o=0,r=i.length;o!==r;o++){var n=i[o];if(n.materialA.id===t.id&&n.materialB.id===e.id||n.materialA.id===e.id&&n.materialB.id===t.id)return n}return!1},$.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&W.splice(this.constraints,e,1)};j.create(),j.create(),j.create(),j.create(),j.create(),j.create();var z=j.create(),x=j.fromValues(0,0),R=j.fromValues(0,0);j.fromValues(0,0),j.fromValues(0,0);$.prototype.step=function(t,e,i){if(i=i||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var o=0;this.accumulator>=t&&o<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,o++;for(var r=this.accumulator%t/t,n=0;n!==this.bodies.length;n++){var s=this.bodies[n];j.lerp(s.interpolatedPosition,s.previousPosition,s.position,r),s.interpolatedAngle=s.previousAngle+r*(s.angle-s.previousAngle)}}};var K=[];$.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,o=this.bodies,r=this.gravity,n=this.solver,s=this.bodies.length,a=this.broadphase,l=this.narrowphase,c=this.constraints,p=z,u=(j.scale,j.add),h=(j.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var f=j.length(this.gravity);0===f&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=f)}if(this.applyGravity)for(var d=0;d!==s;d++){var y=(v=o[d]).force;v.type===U.DYNAMIC&&v.sleepState!==U.SLEEPING&&(j.scale(p,r,v.mass*v.gravityScale),u(y,y,p))}if(this.applySpringForces)for(d=0;d!==e;d++){i[d].applyForce()}if(this.applyDamping)for(d=0;d!==s;d++){var v;(v=o[d]).type===U.DYNAMIC&&v.applyDamping(t)}var g=a.getCollisionPairs(this),m=this.disabledBodyCollisionPairs;for(d=m.length-2;0<=d;d-=2)for(var b=g.length-2;0<=b;b-=2)(m[d]===g[b]&&m[d+1]===g[b+1]||m[d+1]===g[b]&&m[d]===g[b+1])&&g.splice(b,2);var S=c.length;for(d=0;d!==S;d++){var A=c[d];if(!A.collideConnected)for(b=g.length-2;0<=b;b-=2)(A.bodyA===g[b]&&A.bodyB===g[b+1]||A.bodyB===g[b]&&A.bodyA===g[b+1])&&g.splice(b,2)}this.postBroadphaseEvent.pairs=g,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,l.reset(this);d=0;for(var E=g.length;d!==E;d+=2)for(var w=g[d],x=g[d+1],R=0,B=w.shapes.length;R!==B;R++)for(var L=w.shapes[R],C=L.position,P=L.angle,D=0,_=x.shapes.length;D!==_;D++){var T=x.shapes[D],I=T.position,O=T.angle,M=this.defaultContactMaterial;if(L.material&&T.material){var q=this.getContactMaterial(L.material,T.material);q&&(M=q)}this.runNarrowphase(l,w,L,C,P,x,T,I,O,M,this.frictionGravity)}for(d=0;d!==s;d++){(k=o[d])._wakeUpAfterNarrowphase&&(k.wakeUp(),k._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(K);var F=this.endContactEvent;for(D=K.length;D--;){var X=K[D];F.shapeA=X.shapeA,F.shapeB=X.shapeB,F.bodyA=X.bodyA,F.bodyB=X.bodyB,this.emit(F)}K.length=0}var V=this.preSolveEvent;V.contactEquations=l.contactEquations,V.frictionEquations=l.frictionEquations,this.emit(V),V.contactEquations=V.frictionEquations=null;S=c.length;for(d=0;d!==S;d++)c[d].update();if(l.contactEquations.length||l.frictionEquations.length||S)if(this.islandSplit){for(h.equations.length=0,W.appendArray(h.equations,l.contactEquations),W.appendArray(h.equations,l.frictionEquations),d=0;d!==S;d++)W.appendArray(h.equations,c[d].equations);h.split(this);for(d=0;d!==h.islands.length;d++){(G=h.islands[d]).equations.length&&n.solveIsland(t,G)}}else{for(n.addEquations(l.contactEquations),n.addEquations(l.frictionEquations),d=0;d!==S;d++)n.addEquations(c[d].equations);this.solveConstraints&&n.solve(t,this),n.removeAllEquations()}for(d=0;d!==s;d++){var k;(k=o[d]).integrate(t)}for(d=0;d!==s;d++)o[d].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var Y=this.impactEvent;for(d=0;d!==l.contactEquations.length;d++){var N=l.contactEquations[d];N.firstImpact&&(Y.bodyA=N.bodyA,Y.bodyB=N.bodyB,Y.shapeA=N.shapeA,Y.shapeB=N.shapeB,Y.contactEquation=N,this.emit(Y))}}if(this.sleepMode===$.BODY_SLEEPING)for(d=0;d!==s;d++)o[d].sleepTick(this.time,!1,t);else if(this.sleepMode===$.ISLAND_SLEEPING&&this.islandSplit){for(d=0;d!==s;d++)o[d].sleepTick(this.time,!0,t);for(d=0;d<this.islandManager.islands.length;d++){var G;(G=this.islandManager.islands[d]).wantsToSleep()&&G.sleep()}}this.stepping=!1;var H=this.bodiesToBeRemoved;for(d=0;d!==H.length;d++)this.removeBody(H[d]);H.length=0,this.emit(this.postStepEvent)},$.prototype.runNarrowphase=function(t,e,i,o,r,n,s,a,l,c,p){if(0!=(i.collisionGroup&s.collisionMask)&&0!=(s.collisionGroup&i.collisionMask)){j.rotate(x,o,e.angle),j.rotate(R,a,n.angle),j.add(x,x,e.position),j.add(R,R,n.position);var u,h=r+e.angle,f=l+n.angle;t.enableFriction=0<c.friction,t.frictionCoefficient=c.friction,u=e.type===U.STATIC||e.type===U.KINEMATIC?n.mass:n.type===U.STATIC||n.type===U.KINEMATIC?e.mass:e.mass*n.mass/(e.mass+n.mass),t.slipForce=c.friction*p*u,t.restitution=c.restitution,t.surfaceVelocity=c.surfaceVelocity,t.frictionStiffness=c.frictionStiffness,t.frictionRelaxation=c.frictionRelaxation,t.stiffness=c.stiffness,t.relaxation=c.relaxation,t.contactSkinSize=c.contactSkinSize,t.enabledEquations=e.collisionResponse&&n.collisionResponse&&i.collisionResponse&&s.collisionResponse;var d=t[i.type|s.type],y=0;if(d){var v=i.sensor||s.sensor,g=t.frictionEquations.length;y=i.type<s.type?d.call(t,e,i,x,h,n,s,R,f,v):d.call(t,n,s,R,f,e,i,x,h,v);var m=t.frictionEquations.length-g;if(y){if(e.allowSleep&&e.type===U.DYNAMIC&&e.sleepState===U.SLEEPING&&n.sleepState===U.AWAKE&&n.type!==U.STATIC){var b=j.squaredLength(n.velocity)+Math.pow(n.angularVelocity,2);2*Math.pow(n.sleepSpeedLimit,2)<=b&&(e._wakeUpAfterNarrowphase=!0)}if(n.allowSleep&&n.type===U.DYNAMIC&&n.sleepState===U.SLEEPING&&e.sleepState===U.AWAKE&&e.type!==U.STATIC){var S=j.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2);2*Math.pow(e.sleepSpeedLimit,2)<=S&&(n._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,i,n,s),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,s)){var A=this.beginContactEvent;if(A.shapeA=i,A.shapeB=s,A.bodyA=e,A.bodyB=n,A.contactEquations.length=0,"number"==typeof y)for(var E=t.contactEquations.length-y;E<t.contactEquations.length;E++)A.contactEquations.push(t.contactEquations[E]);this.emit(A)}if("number"==typeof y&&1<m)for(E=t.frictionEquations.length-m;E<t.frictionEquations.length;E++){var w=t.frictionEquations[E];w.setSlipForce(w.getSlipForce()/m)}}}}},$.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},$.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&W.splice(this.springs,e,1)},$.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t);var e=(t.world=this).addBodyEvent;e.body=t,this.emit(e),e.body=null}},$.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(W.splice(this.bodies,e,1),(this.removeBodyEvent.body=t).resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},$.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var o=e[i];if(o.id===t)return o}return!1},$.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},$.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,o=0;o<i.length;o+=2)if(i[o]===t&&i[o+1]===e||i[o+1]===t&&i[o]===e)return void i.splice(o,2)},$.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;0<=e;e--)this.removeConstraint(t[e]);var i=this.bodies;for(e=i.length-1;0<=e;e--)this.removeBody(i[e]);var o=this.springs;for(e=o.length-1;0<=e;e--)this.removeSpring(o[e]);var r=this.contactMaterials;for(e=r.length-1;0<=e;e--)this.removeContactMaterial(r[e]);$.apply(this)};var E=j.create(),w=(j.fromValues(0,0),j.fromValues(0,0));$.prototype.hitTest=function(t,e,i){i=i||0;var o=new U({position:t}),r=new A,n=t,s=E,a=w;o.addShape(r);for(var l=this.narrowphase,c=[],p=0,u=e.length;p!==u;p++)for(var h=e[p],f=0,d=h.shapes.length;f!==d;f++){var y=h.shapes[f];j.rotate(s,y.position,h.angle),j.add(s,s,h.position);var v=y.angle+h.angle;(y instanceof g&&l.circleParticle(h,y,s,v,o,r,n,0,!0)||y instanceof m&&l.particleConvex(o,r,n,0,h,y,s,v,!0)||y instanceof b&&l.particlePlane(o,r,n,0,h,y,s,v,!0)||y instanceof S&&l.particleCapsule(o,r,n,0,h,y,s,v,!0)||y instanceof A&&j.squaredLength(j.sub(a,s,t))<i*i)&&c.push(h)}return c},$.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var o=e[i],r=0;r!==o.equations.length;r++){var n=o.equations[r];n.stiffness=t,n.needsUpdate=!0}var s=this.contactMaterials;for(i=0;i!==s.length;i++){(o=s[i]).stiffness=o.frictionStiffness=t}(o=this.defaultContactMaterial).stiffness=o.frictionStiffness=t},$.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],o=0;o!==i.equations.length;o++){var r=i.equations[o];r.relaxation=t,r.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++){(i=this.contactMaterials[e]).relaxation=i.frictionRelaxation=t}(i=this.defaultContactMaterial).relaxation=i.frictionRelaxation=t};var h=new a,f=[];$.prototype.raycast=function(t,e){return e.getAABB(h),this.broadphase.aabbQuery(this,h,f),e.intersectBodies(t,f),f.length=0,t.hasHit()}},{"../../package.json":8,"../collision/AABB":9,"../collision/Broadphase":10,"../collision/Narrowphase":12,"../collision/Ray":13,"../collision/SAPBroadphase":15,"../constraints/Constraint":16,"../constraints/DistanceConstraint":17,"../constraints/GearConstraint":18,"../constraints/LockConstraint":19,"../constraints/PrismaticConstraint":20,"../constraints/RevoluteConstraint":21,"../events/EventEmitter":28,"../material/ContactMaterial":29,"../material/Material":30,"../math/vec2":32,"../objects/Body":33,"../objects/LinearSpring":34,"../objects/RotationalSpring":35,"../shapes/Capsule":40,"../shapes/Circle":41,"../shapes/Convex":42,"../shapes/Line":44,"../shapes/Particle":45,"../shapes/Plane":46,"../shapes/Shape":47,"../solver/GSSolver":48,"../solver/Solver":49,"../utils/OverlapKeeper":54,"../utils/Utils":59,"./IslandManager":61}],64:[function(t,e,i){"use strict";var s=/rgba?\(\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,?\s*([.0-9]+)?\s*\)/;function o(){this.r=0,this.g=0,this.b=0,this.a=void 0,this.string=""}(e.exports=o).prototype._setRGB=function(t,e,i){this.r=t,this.g=e,this.b=i},o.prototype.fromPixel=function(t,e){var i=t[e+0],o=t[e+1],r=t[e+2];return this.string="rgb("+i+","+o+","+r+")",this._setRGB(i,o,r),this},o.prototype.fromString=function(t){var e,i,o,r=(this.string=t).match(s);if(r)e=~~r[1],i=~~r[2],o=~~r[3],this._setRGB(e,i,o);else{var n="0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&");this._setRGB(n>>16,n>>8&255,255&n)}return this},o.prototype.fromRGB=function(t,e,i){return this._setRGB(t,e,i),this.string="rgb("+t+","+e+","+i+")",this},o.prototype.fromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.string=t.string,this}},{}],65:[function(t,e,i){"use strict";var o=t("./index"),r=t("../domUtils/createCanvas"),c=8,p=8,y=Math.PI/2;o.setTileSize=function(t,e){c=~~t,p=~~e},o.prototype._init=function(){this.canvas=r(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.palette[0].string,this.ctx.strokeStyle=this.palette[1].string,this.resize(this.width,this.height)},o.prototype.resize=function(t,e){return this.canvas.width=this.width=t,this.canvas.height=this.height=e,this.clear(),this},o.prototype.sprite=function(t,e,i,o,r,n){var s=c*(t%16),a=p*~~(t/16),l=this.ctx;return e=e||0,i=i||0,e=~~Math.round(e-this.camera.x),i=~~Math.round(i-this.camera.y),o||r||n?(l.save(),o&&(l.scale(-1,1),e=-e-c),r&&(l.scale(1,-1),i=-i-p),n?(l.translate(e+p,i),l.rotate(y)):l.translate(e,i),l.drawImage(this.tilesheet,this.ox+s,this.oy+a,c,p,0,0,c,p),l.restore()):l.drawImage(this.tilesheet,this.ox+s,this.oy+a,c,p,e,i,c,p),this},o.prototype.draw=function(t,e,i,o,r,n){var s=o||r||n;if(t._isSprite){var a=t;t=a.img;var l=a.x,c=a.y,p=a.width,u=a.height,h=~~Math.round((e||0)-this.camera.x),f=~~Math.round((i||0)-this.camera.y);return s?((d=this.ctx).save(),n?(o&&(d.scale(-1,1),h*=-1,h-=u),r&&(d.scale(1,-1),f*=-1,f-=p),d.translate(h+u,f),d.rotate(y)):(o&&(d.scale(-1,1),h*=-1,h-=p),r&&(d.scale(1,-1),f*=-1,f-=u),d.translate(h,f)),d.drawImage(t,l,c,p,u,0,0,p,u),d.restore(),this):(this.ctx.drawImage(t,l,c,p,u,h,f,p,u),this)}t._isTileMap&&(t.texture||t._prepareTexture(),t=t.texture.canvas),t._isTexture&&(t=t.canvas);var d;h=~~Math.round((e||0)-this.camera.x),f=~~Math.round((i||0)-this.camera.y);return s?((d=this.ctx).save(),n?(o&&(d.scale(-1,1),h*=-1,h-=t.height),r&&(d.scale(1,-1),f*=-1,f-=t.width),d.translate(h+t.height,f),d.rotate(y)):(o&&(d.scale(-1,1),h*=-1,h-=t.width),r&&(d.scale(1,-1),f*=-1,f-=t.height),d.translate(h,f)),d.drawImage(t,0,0),d.restore()):this.ctx.drawImage(t,h,f),this},o.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},o.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this},o.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen].string,this},o.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper].string,this},o.prototype.rect=function(t,e,i,o){if(i<=1||o<=1){var r=this.ctx.fillStyle;return this.ctx.fillStyle=this.ctx.strokeStyle,this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~i,~~o),this.ctx.fillStyle=r,this}return this.ctx.strokeRect(.5+~~(t-this.camera.x),.5+~~(e-this.camera.y),~~(i-1),~~(o-1)),this},o.prototype.rectf=function(t,e,i,o){return this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~i,~~o),this},o.prototype.rectfill=o.prototype.rectf,o.prototype._isTexture=!0,o.prototype.tilesheet=r(16*c,16*p)},{"../domUtils/createCanvas":71,"./index":66}],66:[function(t,e,i){"use strict";function o(t,e){this.width=t,this.height=e,this.camera={x:0,y:0},this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._init()}function r(t,e){t.ox=0,t.oy=0,e._isImageWrapper&&(e=e.asset),e._isSprite?(t.ox=e.x,t.oy=e.y,t.tilesheet=e.img):e._isMap?(e.texture||e._prepareTexture(),t.tilesheet=e.texture.canvas):e._isTexture?t.tilesheet=e.canvas:(e instanceof Image||e instanceof HTMLCanvasElement)&&(t.tilesheet=e)}(e.exports=o).prototype.palette=[{string:"#000000",r:0,g:0,b:0},{string:"#FFFFFF",r:1,g:1,b:1}],o.prototype.ox=0,o.prototype.oy=0,o.setTileSize=function(){},o.prototype.setPalette=function(t){o.prototype.palette=t},o.prototype.setGlobalTilesheet=function(t){r(o.prototype,t)},o.prototype.setTilesheet=function(t){if(t)return r(this,t),this;delete this.tilesheet},o.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this}},{}],67:[function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=t("./index.js"),c=3,p=5,r=o.prototype.setPalette;o.prototype.setPalette=function(t){r.call(this,t),o.prototype.textCharset=new o(128*c,p*t.length),function(t,e){for(var i=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],o=0;o<e.length;o++){t.fillStyle=e[o].string;for(var r=0;r<i.length;r++)for(var n=i[r],s=0;s<15;s++){var a=s%c,l=~~(s/c);1==(n>>s&1)&&t.fillRect(r*c+a,o*p+l,1,1)}}t.fillStyle=e[0].string}(o.prototype.textCharset.ctx,t)};var s=o.prototype.resize;o.prototype.resize=function(t,e){return this._textOffset=1,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textPadding=e-6*this._textLine-this._textOffset,this._cursor.i=0,this._cursor.j=0,s.call(this,t,e),this},o.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},o.prototype.textCharset=new o(128*c,p*o.prototype.palette.length),o.prototype.locate=function(t,e){return this._cursor.i=~~t,this._cursor.j=~~e,this},o.prototype.print=function(e,t,i){if("object"===n(e))try{e=JSON.stringify(e)}catch(t){e="[Object]"}else"string"!=typeof e&&(e=e.toString());if(void 0!==t){t=~~Math.round(t-this.camera.x),i=~~Math.round(i-this.camera.y);for(var o=0;o<e.length;o++)this.ctx.drawImage(this.textCharset.canvas,c*e.charCodeAt(o),p*this._pen,c,p,t,i,c,p),t+=4;return this}for(o=0;o<e.length;o++){this._cursor.j>=this._textLine&&this.textScroll();var r=e.charCodeAt(o);10!==r&&13!==r?(this.ctx.drawImage(this.textCharset.canvas,c*r,p*this._pen,c,p,4*this._cursor.i,6*this._cursor.j+this._textOffset,c,p),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},o.prototype.println=function(t){return this.print(t),this.print("\n"),this},o.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{"./index.js":66}],68:[function(t,e,i){"use strict";var o=t("../Texture"),r=t(".."),c=8,p=8;function u(t,e,i,o,r,n,s,a){this.x=~~t,this.y=~~e,this.sprite=~~i,this.flipH=!!o,this.flipV=!!r,this.flipR=!!n,this.flagA=!!s,this.flagB=!!a}function n(t,e){this._name="",this.width=0,this.height=0,this.items=[],this.texture=null,this.tilesheet=null,this._tilesheetPath="",t&&e&&this._init(t,e)}(e.exports=n).prototype._isTileMap=!0;var a,f,s={},l=[];n.getMap=function(t){return"string"==typeof t?s[t]:"number"==typeof t?l[t]:(console.error("Map does not exist",t),null)},n._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:{_type:"maps",maps:[]}},n.loadBank=function(t){t=n._checkBankFormat(t),s={},l=[];for(var e=t.maps||[],i=0;i<e.length;i++)l.push((new n).load(e[i]))},n.setTileSize=function(t,e){c=~~t,p=~~e},Object.defineProperty(n.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&s[this._name]&&s[this._name]===this&&delete s[this._name],(this._name=t)&&!s[t]&&(s[t]=this)}}),n.prototype._init=function(t,e){this.width=t,this.height=e,this.items=[];for(var i=0;i<t;i++){this.items.push([]);for(var o=0;o<e;o++)this.items[i][o]=null}this.texture&&this.texture.resize(t*c,e*p)},n.prototype.resize=function(t,e){var i=this.items,o=Math.min(this.width,t),r=Math.min(this.height,e);this._init(t,e);for(var n=0;n<o;n++)for(var s=0;s<r;s++)this.items[n][s]=i[n][s];return this.redraw(),this},n.prototype.set=function(t,e,i,o,r,n,s,a){if(null==i)return this.remove(t,e);if(!(t<0||e<0||t>=this.width||e>=this.height)){var l=this.items[t][e]=new u(t,e,i,o,r,n,s,a);return this.texture&&(this.texture.ctx.clearRect(t*c,e*p,c,p),this.texture.sprite(l.sprite,l.x*c,l.y*p,l.flipH,l.flipV,l.flipR)),this}},n.prototype.remove=function(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.items[t][e]=null,this.texture&&this.texture.ctx.clearRect(t*c,e*p,c,p),this},n.prototype.get=function(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.items[t][e]},n.prototype.redraw=function(){if(!this.texture)return this;this.texture.clear();for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++){var i=this.items[t][e];i&&this.texture.sprite(i.sprite,i.x*c,i.y*p,i.flipH,i.flipV,i.flipR)}return this},n.prototype._prepareTexture=function(){this.texture=new o(this.width*c,this.height*p),this.texture.setTilesheet(this.tilesheet),this.redraw()},n.prototype.release=function(){this.texture=null},n.prototype.draw=function(t,e){this.texture||this._prepareTexture(),draw(this.texture,t,e)},n.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture&&(this.texture.setTilesheet(t),this.redraw()),this},n.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();for(var e=t.split("/"),i=r.assets||{},o=0;o<e.length;o++)if(!(i=i[e[o]]))return console.warn("Could not find tilesheet",t);this.setTilesheet(i)},function(){for(var i="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",c={},t=0;t<i.length;t++)c[i[t]]=t;var p=i.length,u=p*p-1,h=Math.pow(2,13),n=u-h-1;function s(t){var e=t%p;return i[~~(t/p)]+i[e]}a=function(t){for(var e="",i=0,o=0;o<t.length;o++){var r=t[o];r===t[o+1]&&++i<n||(null===r&&(r=u),e+=s(r),i===n&&i--,0!==i&&(e+=s(h+i)),i=0)}return i===n&&i--,0!==i&&(e+=s(h+i)),e},f=function(t){for(var e=[],i=0;i<t.length;){var o=t[i++],r=t[i++],n=c[o]*p+c[r];if(n===u)e.push(null);else if(h<n)for(var s=n-h,a=e[e.length-1],l=0;l<s;l++)e.push(a);else e.push(n)}return e}}(),n.prototype.save=function(){for(var t=this.width,e=this.height,i=new Array(t*e),o=0;o<t;o++)for(var r=0;r<e;r++){var n=this.items[o][r];i[o+r*t]=n?n.sprite+(n.flipH<<8)+(n.flipV<<9)+(n.flipR<<10)+(n.flagA<<11)+(n.flagB<<12):null}return{w:t,h:e,name:this.name,sheet:this._tilesheetPath||"",data:a(i)}},n.prototype.load=function(t){this.texture=null;var e=t.w,i=t.h;this._init(e,i),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var o=f(t.data),r=0;r<e;r++)for(var n=0;n<i;n++){var s=o[r+n*e];if(null!==s){var a=255&s,l=s>>8&1,c=s>>9&1,p=s>>10&1,u=s>>11&1,h=s>>12&1;this.set(r,n,a,l,c,p,u,h)}}return this},n.prototype.copy=function(t,e,i,o){t=t||0,e=e||0,null==i&&(i=this.width),null==o&&(o=this.height);var r=new n(i,o);return r.paste(this,-t,-e),r},n.prototype.paste=function(t,e,i,o){e=e||0,i=i||0;for(var r=Math.min(t.width,this.width-e),n=Math.min(t.height,this.height-i),s=Math.max(0,-e),a=Math.max(0,-i),l=s;l<r;l++)for(var c=a;c<n;c++){var p=t.items[l][c];if(p)this.set(l+e,c+i,p.sprite,p.flipH,p.flipV,p.flipR,p.flagA,p.flagB);else{if(o)continue;this.remove(l+e,c+i)}}return this},n.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]=null;return this.texture&&this.texture.clear(),this},n.prototype.find=function(t,e,i){if(null===t)return this._findNull();void 0===e&&(e=null),void 0===i&&(i=null);for(var o=[],r=0;r<this.width;r++)for(var n=0;n<this.height;n++){var s=this.items[r][n];if(s){var a=null===e||s.flagA===e,l=null===i||s.flagB===i;s.sprite===t&&a&&l&&o.push(s)}}return o},n.prototype._findNull=function(){for(var t=[],e=0;e<this.width;e++)for(var i=0;i<this.height;i++)null===this.items[e][i]&&t.push({x:e,y:i});return t}},{"..":73,"../Texture":66}],69:[function(t,e,i){"use strict";function f(t,e){var i=new Image;i.onload=function(){this.onload=null,this.onerror=null,e&&e(null,this)},i.onerror=function(){this.onload=null,this.onerror=null,e&&e("img:"+t)},i.src=t}function d(t,e){var i=new Audio;function o(){e&&e(null,i),i.removeEventListener("canplaythrough",o),i.removeEventListener("error",r)}function r(){e&&e("snd:load"),i.removeEventListener("canplaythrough",o),i.removeEventListener("error",r)}i.preload=!0,i.loop=!1,i.addEventListener("canplaythrough",o),i.addEventListener("error",r),i.src=t,i.load()}i.loadData=function(t,e,i){var o=new XMLHttpRequest;o.responseType=e||"arraybuffer",o.onreadystatechange=function(){if(4==~~o.readyState)return 200!=~~o.status&&0!=~~o.status?i&&i("xhrError:"+o.status):i&&i(null,o.response)},o.open("GET",t,!0),o.send()},i.loadJson=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==~~i.readyState)return 200!=~~i.status?e("xhrError:"+i.status):e&&e(null,JSON.parse(i.response))},i.open("GET",t,!0),i.send()},i.loadImage=f,i.loadSound=d,i.preloadStaticAssets=function(o,r,n){var a=o.dat,s=o.img.length,l=s+o.snd.length,c=o.root,p=0,u=0;function h(){var i,t,e=p+u;n&&n(p,e,l,e/l),t=e<s?(i=o.img[e],f):(i=o.snd[e-s],d),u+=1,t(c+i,function(t,e){t||function(t,e){var i=t.split("/"),o=i.pop().split(".");o.pop(),o=o.join(".");for(var r=a,n=0,s=i.length;n<s;n++)r=r[i[n]];r[o]=e,i.push(o),e.name=o,e.path=i.join("/")}(i,e),(p+=1)+--u<l?h():0===u&&r(null,a)})}if(0===l)return r(null,a);for(var t=Math.min(5,l-1),e=0;e<=t;e++)h()}},{}],70:[function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o,r;o=window,r=function(){return o={},r.m=i=[function(t,e,i){var r=i(4);function o(){this.name="",this.speed=20,this.pmin=0,this.pmax=127,this.snap=!1,this.steps=[],this.audio=null}(t.exports=o).prototype.serialize=function(){for(var t="",e=0;e<this.steps.length;e++)t+=this.steps[e].serialize();return{n:this.name,i:[this.speed,this.pmin,this.pmax,~~this.snap],s:t}},o.prototype.deserialize=function(t){this.name=t.n,this.speed=t.i[0],this.pmin=t.i[1],this.pmax=t.i[2],this.snap=!!t.i[3],this.audio=null,this.steps=[];for(var e=t.s,i=0;i<e.length;i+=3){var o=new r;o.deserialize(e,i),this.steps.push(o)}return this},o.prototype.check=function(){11<this.name.length&&(this.name=this.name.substr(0,11)),this.speed=Math.max(0,Math.min(53,~~this.speed)),this.pmin=Math.max(0,Math.min(101,~~this.pmin)),this.pmax=Math.max(26,Math.min(127,~~this.pmax));for(var t=0;t<this.steps.length;t++)this.steps[t].check()}},function(t,e){e.SAMPLE_RATE=44100,e.CHUNK_LENGTH=50},function(t,e,i){var o=i(3),r=i(0),n=new(i(6)),s=audioManager.getEmptySound().__proto__.constructor;if(!s.prototype._createAudioNodes)throw new Error("webAudio required");function a(t){s.call(this),this._data=t}function l(t){var e=new a(t);return t.audio=e}inherits(a,s),a.prototype.load=function(t){if(this._loaded)return t&&t(null,this);t&&this._onLoadQueuedCallback.push(t),this.buffer=n.generateSound(this._data),this.usedMemory=this.buffer.duration,this.audioManager.usedMemory+=this.buffer.duration,this._finalizeLoad(null)},r.prototype.play=function(t,e,i){this.audio?this.audio.play(t,e,i):l(this).play(t,e,i)};var c=new o,p=[];e.loadProgram=function(t){c.deserialize(t),assets.bleeper={};for(var e=p.length=0;e<c.sounds.length;e++){var i=c.sounds[e],o=l(i);p.push(o);var r=i.name;r&&(assets.bleeper[r]=o,audioManager.permanentSounds[r]=o)}return c},e.sounds=p},function(t,e,i){var r=i(0);function o(){this.version=1,this.sounds=[]}(t.exports=o).prototype.serialize=function(){for(var t=[],e=0;e<this.sounds.length;e++)t.push(this.sounds[e].serialize());return{_type:"Bleeper program",v:this.version,s:t}},o.prototype.deserialize=function(t){if("Bleeper program"!==t._type)throw new Error("Incorrect data type");this.version=t.v,this.sounds.length=0;for(var e=t.s,i=0;i<e.length;i++){var o=new r;o.deserialize(e[i]),this.sounds.push(o)}return this},o.prototype.check=function(){if(0!==this.sounds.length)for(var t=0;t<this.sounds.length;t++)this.sounds[t].check();else this.sounds.push(new r)}},function(t,e,i){var r=i(5);function o(){this.wave=0,this.pitch=0,this.volume=0}(t.exports=o).prototype.serialize=function(){var t=this.wave,e=this.pitch;return 92<this.pitch&&(t+=8,e-=92),r.encodeUint6(t)+r.encodeUint6(e)+r.encodeUint6(this.volume)},o.prototype.deserialize=function(t,e){var i=r.decodeUint6(t,e),o=r.decodeUint6(t,e+1);return this.volume=r.decodeUint6(t,e+2),8<=i&&(i-=8,o+=92),this.wave=i,this.pitch=o,this},o.prototype.check=function(){this.wave=Math.max(0,Math.min(7,~~this.wave)),this.pitch=Math.max(0,Math.min(93,~~this.pitch)),this.volume=Math.max(0,Math.min(62,~~this.volume))}},function(t,e){for(var i="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",r=i.length,n={},o=0;o<i.length;o++)n[i[o]]=o;e.encodeUint13=function(t){return i[~~(t/r)]+i[t%r]},e.encodeUint6=function(t){return i[t]},e.decodeUint13=function(t,e){var i=t[e],o=t[e+1];return n[i]*r+n[o]},e.decodeUint6=function(t,e){return n[t[e]]}},function(t,e,i){var c=i(7),o=i(8),r=i(1),p=r.SAMPLE_RATE,u=r.CHUNK_LENGTH;function n(){this.oscillator=new o}(t.exports=n).prototype.generateSound=function(t){var e=t.steps;if(0===e.length)return null;var i=(t.speed+1)*u,o=e.length*i+100,r=c.createBuffer(1,o,p),n=r.getChannelData(0);this.oscillator.reset();for(var s=0,a=0;s<e.length;s++){var l=e[s];this.oscillator.setStep(t,l),this.oscillator.generate(n,a,a+i),a+=i}return this.oscillator.generateEndDamping(n,a,a+100),r}},function(t,e){var i=new window.AudioContext;t.exports=i},function(t,e,i){var o=i(9),r=i(1).SAMPLE_RATE,n=2*Math.PI,s=[0,.12,.25,.37,.5,.62,.75,.87,.87,.75,.62,.5,.37,.25,.12,0,-.12,-.25,-.37,-.5,-.62,-.75,-.87,-1,-1,-.87,-.75,-.62,-.5,-.37,-.25,-.12];function a(){this._amp=1,this._oscPos=0,this._oscInc=0,this._oscState=1,this._oscOut=0,this._duty=0,this._prevOut=0,this.generate=this._generatePulse}(t.exports=a).prototype.reset=function(){this._oscPos=0,this._oscState=1,this._oscOut=0,this._prevOut=0},a.prototype.setStep=function(t,e){var i=t.pmin+(t.pmax-t.pmin-20)*e.pitch/93;switch(i=20+90*i/107,t.snap&&(i=Math.round(i)),this._oscInc=o.noteToFreq(i)/r,this._amp=e.volume/63,e.wave){case 0:this.generate=this._generatePulse,this._duty=.06;break;case 1:this.generate=this._generatePulse,this._duty=.12;break;case 2:this.generate=this._generatePulse,this._duty=.25;break;case 3:this.generate=this._generatePulse,this._duty=.5;break;case 4:this.generate=this._generateTriangle;break;case 5:this.generate=this._generateSine;break;case 6:this.generate=this._generateSaw,this._amp*=2;break;case 7:this.generate=this._generateNoise,this._oscInc=2.9*this._oscInc+.01}},a.prototype._generatePulse=function(t,e,i){for(var o=this._prevOut,r=e;r<i;r++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),o=this._oscPos>this._duty?this._amp:-this._amp,t[r]=o;this._prevOut=o},a.prototype._generateTriangle=function(t,e,i){for(var o=this._prevOut,r=e;r<i;r++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),o=s[~~(32*this._oscPos)]*this._amp,t[r]=o;this._prevOut=o},a.prototype._generateSine=function(t,e,i){for(var o=this._prevOut,r=e;r<i;r++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),o=Math.sin(this._oscPos*n)*this._amp,t[r]=o;this._prevOut=o},a.prototype._generateSaw=function(t,e,i){for(var o=this._prevOut,r=e;r<i;r++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),o=(this._oscPos-.5)*this._amp,t[r]=o;this._prevOut=o},a.prototype._generateNoise=function(t,e,i){for(var o=this._prevOut,r=e;r<i;r++){if(this._oscPos+=this._oscInc,1<this._oscPos){this._oscPos=this._oscPos%1;var n=!(16384&this._oscState)^!(8192&this._oscState);this._oscState=32767&(this._oscState<<1|n),this._oscOut=(16384&this._oscState)>>14}o=(this._oscOut-.5)*this._amp,t[r]=o}this._prevOut=o},a.prototype.generateEndDamping=function(t,e,i){for(var o=this._prevOut,r=e;r<i;r++)o*=.98,t[r]=o}},function(t,e){for(var r=[],i=0;i<128;i++)r.push(440*Math.pow(2,(i-69)/12));e.noteToFreqTable=r,e.noteToFreq=function(t){t<0&&(t=0),127<t&&(t=127);var e=~~t,i=t-e,o=r[e];return o+i*(r[1+e]-o)}}],r.c=o,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==n(e)&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2);function r(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}var i,o},"object"==(void 0===i?"undefined":n(i))&&"object"==(void 0===e?"undefined":n(e))?e.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==(void 0===i?"undefined":n(i))?i.bleeper=r():o.bleeper=r()},{}],71:[function(t,e,i){"use strict";e.exports=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}},{}],72:[function(t,e,i){"use strict";var u=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],o=!(!navigator||!navigator.getGamepads),h=!1,f=.2;function r(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}r.prototype._setupButtons=function(){for(var t=0;t<u.length;t++){var e=u[t];this.btn[e]=!1,this.btnp[e]=!1,this.btnr[e]=!1}};var d=[new r,new r,new r,new r,window],n=new r;var s=o?function(){for(var t=navigator.getGamepads(),e=0;e<4;e++){var i=t[e],o=d[e];if(i){var r,n,s,a;o.available=!0,h&&(r=o.btn.right,n=o.btn.left,a=o.btn.down,s=o.btn.up);for(var l=0;l<u.length;l++){var c=u[l],p=i.buttons[l].pressed;o.btnp[c]=!o.btn[c]&&p,o.btnr[c]=o.btn[c]&&!p,o.btn[c]=p}o.x=i.axes[0],o.y=i.axes[1],o.z=i.axes[2],o.w=i.axes[3],o.lt=i.buttons[6].value,o.rt=i.buttons[7].value,h&&(o.btn.right=o.btn.right||o.x>f,o.btn.left=o.btn.left||o.x<-f,o.btn.down=o.btn.down||o.y>f,o.btn.up=o.btn.up||o.y<-f,o.btnp.right=o.btn.right&&!r,o.btnp.left=o.btn.left&&!n,o.btnp.down=o.btn.down&&!a,o.btnp.up=o.btn.up&&!s,o.btnr.right=!o.btn.right&&r,o.btnr.left=!o.btn.left&&n,o.btnr.down=!o.btn.down&&a,o.btnr.up=!o.btn.up&&s)}else o.available=!1}return d}:function(){return d};i.mapAnalogStickToDpad=function(t){h=!0,f=void 0===t?.3:t},i.update=function(){window.gamepads=s(),window.gamepad=function(){for(var t=0;t<u.length;t++){var e=u[t];n.btnp[e]=btnp[e]||d[0].btnp[e]||d[1].btnp[e]||d[2].btnp[e]||d[3].btnp[e],n.btnr[e]=btnr[e]||d[0].btnr[e]||d[1].btnr[e]||d[2].btnr[e]||d[3].btnr[e],n.btn[e]=btn[e]||d[0].btn[e]||d[1].btn[e]||d[2].btn[e]||d[3].btn[e]}return n.btn.up&&n.btn.down&&(n.btn.down=!1),n.btn.right&&n.btn.left&&(n.btn.left=!1),n}()}},{}],73:[function(t,e,i){"use strict";e.exports={}},{}],74:[function(t,e,i){"use strict";e.exports=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],75:[function(t,e,i){"use strict";var a,l,o=t(".."),r=o.settings,c=~~r.screen.pixelSize.width,p=~~r.screen.pixelSize.height,n=o.$screen.canvas,u=!0;if(r.screen.fullscreen){var s=function(){d=null;var t=n.getBoundingClientRect();c=t.width/h,p=t.height/f},h=r.screen.width,f=r.screen.height,d=null;window.onresize=function(){d&&window.clearTimeout(d),d=window.setTimeout(s,300)},s()}var y={x:0,y:0,pressed:!1},v=null,g=null,m=null,b=null,S=null,A=0,E=n.getBoundingClientRect();a=E.left,l=E.top;var w=r.touchEvent||{};w.disableContextMenu&&(n.oncontextmenu=function(){return!1}),w.hideMousePointer&&(n.style.cursor="none"),w.multiTouch&&(u=!1),n.addEventListener("mousedown",function(t){t.preventDefault(),window.focus(),y.pressed=!0,y.x=~~(t.layerX/c),y.y=~~(t.layerY/p),v&&v(y.x,y.y,0,t)}),n.addEventListener("mousemove",function(t){t.preventDefault(),y.x=~~(t.layerX/c),y.y=~~(t.layerY/p),g&&g(y.x,y.y,0,t)}),window.addEventListener("mouseup",function(t){t.preventDefault(),y.pressed&&(y.pressed=!1,y.x=~~(t.layerX/c),y.y=~~(t.layerY/p),m&&m(y.x,y.y,0,t))}),document.addEventListener("mouseleave",function(t){y.pressed&&(y.pressed=!1,b?b(0,t):m&&m(y.x,y.y,0,t))}),n.addEventListener("touchstart",function(t){if(t.preventDefault(),v){var e=t.changedTouches;if(u)return A=e[0].identifier,y.x=~~((o.clientX-a)/c),y.y=~~((o.clientY-l)/p),void v(y.x,y.y,o.identifier,o);for(var i=0;i<e.length;i++){var o=e[i],r=~~((o.clientX-a)/c),n=~~((o.clientY-l)/p);v(r,n,o.identifier,o)}}}),n.addEventListener("touchmove",function(t){if(t.preventDefault(),g)for(var e=t.changedTouches,i=0;i<e.length;i++){var o=e[i],r=o.identifier;if(u){if(r!==A)continue;return y.x=~~((o.clientX-a)/c),y.y=~~((o.clientY-l)/p),void g(y.x,y.y,o.identifier,o)}var n=~~((o.clientX-a)/c),s=~~((o.clientY-l)/p);g(n,s,o.identifier,o)}}),n.addEventListener("touchend",function(t){if(t.preventDefault(),onEnd)for(var e=t.changedTouches,i=0;i<e.length;i++){var o=e[i],r=o.identifier;if(u){if(r!==A)continue;return y.x=~~((o.clientX-a)/c),y.y=~~((o.clientY-l)/p),void onEnd(y.x,y.y,o.identifier,o)}var n=~~((o.clientX-a)/c),s=~~((o.clientY-l)/p);onEnd(n,s,o.identifier,o)}}),n.addEventListener("touchcancel",function(t){if(t.preventDefault(),b)for(var e=t.changedTouches,i=0;i<e.length;i++){var o=e[i],r=o.identifier;if(u){if(r!==A)continue;return void b(o.identifier,o)}b(o.identifier,o)}}),n.addEventListener("wheel",function(t){t.preventDefault();var e=t.wheelDeltaY;0!==e&&S&&S(e,t)}),i.onPress=function(t){v=t},i.onRelease=function(t){m=t},i.onMove=function(t){g=t},i.onCancel=function(t){b=t},i.onScroll=function(t){S=t},i.pointer=y},{"..":73}],76:[function(t,e,i){"use strict";var u=t("./Scalar");function o(){}(e.exports=o).lineInt=function(t,e,i){i=i||0;var o,r,n,s,a,l,c,p=[0,0];return o=t[1][1]-t[0][1],r=t[0][0]-t[1][0],n=o*t[0][0]+r*t[0][1],s=e[1][1]-e[0][1],a=e[0][0]-e[1][0],l=s*e[0][0]+a*e[0][1],c=o*a-s*r,u.eq(c,0,i)||(p[0]=(a*n-r*l)/c,p[1]=(o*l-s*n)/c),p},o.segmentsIntersect=function(t,e,i,o){var r=e[0]-t[0],n=e[1]-t[1],s=o[0]-i[0],a=o[1]-i[1];if(s*n-a*r==0)return!1;var l=(r*(i[1]-t[1])+n*(t[0]-i[0]))/(s*n-a*r),c=(s*(t[1]-i[1])+a*(i[0]-t[0]))/(a*r-s*n);return 0<=l&&l<=1&&0<=c&&c<=1}},{"./Scalar":79}],77:[function(t,e,i){"use strict";function c(){}(e.exports=c).area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},c.left=function(t,e,i){return 0<c.area(t,e,i)},c.leftOn=function(t,e,i){return 0<=c.area(t,e,i)},c.right=function(t,e,i){return c.area(t,e,i)<0},c.rightOn=function(t,e,i){return c.area(t,e,i)<=0};var p=[],u=[];c.collinear=function(t,e,i,o){if(o){var r=p,n=u;r[0]=e[0]-t[0],r[1]=e[1]-t[1],n[0]=i[0]-e[0],n[1]=i[1]-e[1];var s=r[0]*n[0]+r[1]*n[1],a=Math.sqrt(r[0]*r[0]+r[1]*r[1]),l=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return Math.acos(s/(a*l))<o}return 0==c.area(t,e,i)},c.sqdist=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o}},{}],78:[function(t,e,i){"use strict";var a=t("./Line"),E=t("./Point"),h=t("./Scalar");function w(){this.vertices=[]}(e.exports=w).prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},w.prototype.first=function(){return this.vertices[0]},w.prototype.last=function(){return this.vertices[this.vertices.length-1]},w.prototype.clear=function(){this.vertices.length=0},w.prototype.append=function(t,e,i){if(void 0===e)throw new Error("From is not given!");if(void 0===i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var o=e;o<i;o++)this.vertices.push(t.vertices[o])},w.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);E.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},w.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},w.prototype.isReflex=function(t){return E.right(this.at(t-1),this.at(t),this.at(t+1))};var l=[],c=[];function x(t,e,i,o,r){r=r||0;var n=e[1]-t[1],s=t[0]-e[0],a=n*t[0]+s*t[1],l=o[1]-i[1],c=i[0]-o[0],p=l*i[0]+c*i[1],u=n*c-l*s;return h.eq(u,0,r)?[0,0]:[(c*a-s*p)/u,(n*p-l*a)/u]}w.prototype.canSee=function(t,e){var i,o,r=l,n=c;if(E.leftOn(this.at(t+1),this.at(t),this.at(e))&&E.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;o=E.sqdist(this.at(t),this.at(e));for(var s=0;s!==this.vertices.length;++s)if((s+1)%this.vertices.length!==t&&s!==t&&E.leftOn(this.at(t),this.at(e),this.at(s+1))&&E.rightOn(this.at(t),this.at(e),this.at(s))&&(r[0]=this.at(t),r[1]=this.at(e),n[0]=this.at(s),n[1]=this.at(s+1),i=a.lineInt(r,n),E.sqdist(this.at(t),i)<o))return!1;return!0},w.prototype.copy=function(t,e,i){var o=i||new w;if(o.clear(),t<e)for(var r=t;r<=e;r++)o.vertices.push(this.vertices[r]);else{for(r=0;r<=e;r++)o.vertices.push(this.vertices[r]);for(r=t;r<this.vertices.length;r++)o.vertices.push(this.vertices[r])}return o},w.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],o=new w,r=Number.MAX_VALUE,n=0;n<this.vertices.length;++n)if(this.isReflex(n))for(var s=0;s<this.vertices.length;++s)if(this.canSee(n,s)){e=this.copy(n,s,o).getCutEdges(),i=this.copy(s,n,o).getCutEdges();for(var a=0;a<i.length;a++)e.push(i[a]);e.length<r&&(r=(t=e).length,t.push([this.at(n),this.at(s)]))}return t},w.prototype.decomp=function(){var t=this.getCutEdges();return 0<t.length?this.slice(t):[this]},w.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var o=t[i],r=0;r<e.length;r++){var n=e[r].slice(o);if(n){e.splice(r,1),e.push(n[0],n[1]);break}}return e}o=t,i=this.vertices.indexOf(o[0]),r=this.vertices.indexOf(o[1]);return-1!=i&&-1!=r&&[this.copy(i,r),this.copy(r,i)]},w.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(a.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(e=1;e<t.length-2;e++)if(a.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},w.prototype.quickDecomp=function(t,e,i,o,r,n){r=r||100,n=n||0,o=o||25,t=void 0!==t?t:[],e=e||[],i=i||[];var s=[0,0],a=[0,0],l=[0,0],c=0,p=0,u=0,h=0,f=0,d=0,y=0,v=new w,g=new w,m=this,b=this.vertices;if(b.length<3)return t;if(r<++n)return console.warn("quickDecomp: max level ("+r+") reached."),t;for(var S=0;S<this.vertices.length;++S)if(m.isReflex(S)){e.push(m.vertices[S]),c=p=Number.MAX_VALUE;for(var A=0;A<this.vertices.length;++A)E.left(m.at(S-1),m.at(S),m.at(A))&&E.rightOn(m.at(S-1),m.at(S),m.at(A-1))&&(l=x(m.at(S-1),m.at(S),m.at(A),m.at(A-1)),E.right(m.at(S+1),m.at(S),l)&&(u=E.sqdist(m.vertices[S],l))<p&&(p=u,a=l,d=A)),E.left(m.at(S+1),m.at(S),m.at(A+1))&&E.rightOn(m.at(S+1),m.at(S),m.at(A))&&(l=x(m.at(S+1),m.at(S),m.at(A),m.at(A+1)),E.left(m.at(S-1),m.at(S),l)&&(u=E.sqdist(m.vertices[S],l))<c&&(c=u,s=l,f=A));if(d==(f+1)%this.vertices.length)l[0]=(a[0]+s[0])/2,l[1]=(a[1]+s[1])/2,i.push(l),S<f?(v.append(m,S,f+1),v.vertices.push(l),g.vertices.push(l),0!=d&&g.append(m,d,m.vertices.length),g.append(m,0,S+1)):(0!=S&&v.append(m,S,m.vertices.length),v.append(m,0,f+1),v.vertices.push(l),g.vertices.push(l),g.append(m,d,S+1));else{if(f<d&&(f+=this.vertices.length),h=Number.MAX_VALUE,f<d)return t;for(A=d;A<=f;++A)E.leftOn(m.at(S-1),m.at(S),m.at(A))&&E.rightOn(m.at(S+1),m.at(S),m.at(A))&&(u=E.sqdist(m.at(S),m.at(A)))<h&&(h=u,y=A%this.vertices.length);S<y?(v.append(m,S,y+1),0!=y&&g.append(m,y,b.length),g.append(m,0,S+1)):(0!=S&&v.append(m,S,b.length),v.append(m,0,y+1),g.append(m,y,S+1))}return v.vertices.length<g.vertices.length?(v.quickDecomp(t,e,i,o,r,n),g.quickDecomp(t,e,i,o,r,n)):(g.quickDecomp(t,e,i,o,r,n),v.quickDecomp(t,e,i,o,r,n)),t}return t.push(this),t},w.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;3<this.vertices.length&&0<=i;--i)E.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":76,"./Point":77,"./Scalar":79}],79:[function(t,e,i){"use strict";function o(){}(e.exports=o).eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],80:[function(t,e,i){"use strict";e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":77,"./Polygon":78}],81:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,s=(o=t("./Component"))&&o.__esModule?o:{default:o},a=t("./main");function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function p(t,e,i){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(n){return function(){var t,e,i,o=d(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=d(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return e=this,!(i=t)||"object"!==l(i)&&"function"!=typeof i?f(e):i}}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(n,s["default"]);var t,e,i,r=h(n);function n(t,e,i){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),e.flipH=i.flipX,e.flipV=i.flipY,e.flipR=i.flipR,(o=r.call(this,t,e,"POWERED_ALT")).dirMaps=[(0,a.GetAltSwitchDirMapFromDir)(i.dir),(0,a.GetAltSwitchDirMapFromDir)(i.alt)],o.chargesRequired=i.chargesRequired,o.currentMap=0,o.SetBarDirections(i),o.chargeProgress=o.AddProgressBar(o.chargeBarDir,{bg:a.COLOURS.barBg,fg:a.COLOURS.chargeBarFg}),o.decayProgress=o.AddProgressBar(o.decayBarDir,{bg:a.COLOURS.barBg,fg:a.COLOURS.decayBarFg}),o.SetupDecay(i),o.SwitchDirection(0),o.ResetProgressBars(),o.logging=!0,o.logName="ALT SWITCH",a.em.AddUpdate(f(o)),(0,a.consoleLog)("====== ALT SWITCH CONSTRUCTED ====="),(0,a.consoleLog)(f(o)),o}return t=n,(e=[{key:"GetFlippedDirection",value:function(){var t=[0,0],e=this.dirMaps[this.currentMap];return(0,a.consoleLog)("USE D MAP"),(0,a.consoleLog)(e),e.setDir===a.UP?t[1]=1:e.setDir===a.DOWN?t[1]=-1:e.setDir===a.RIGHT?t[0]=1:e.setDir===a.LEFT&&(t[0]=-1),t}},{key:"SwitchDirection",value:function(t){this.currentMap=t,this.spriteInfo.flipX=this.dirMaps[this.currentMap].flipX,this.spriteInfo.flipY=this.dirMaps[this.currentMap].flipY,this.spriteInfo.flipR=this.dirMaps[this.currentMap].flipR}},{key:"Update",value:function(t){p(d(n.prototype),"ChargeDecay",this).call(this,t)}},{key:"Charged",value:function(){var t=(this.currentMap+1)%this.dirMaps.length;t!==this.currentMap&&this.SwitchDirection(t)}}])&&c(t.prototype,e),i&&c(t,i),n}();i.default=r},{"./Component":85,"./main":100}],82:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o=n(t("./Component.js")),r=n(t("./Electron.js")),l=t("./main.js");function n(t){return t&&t.__esModule?t:{default:t}}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(n){return function(){var t,e,i,o=a(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=a(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return e=this,!(i=t)||"object"!==s(i)&&"function"!=typeof i?h(e):i}}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(a,o["default"]);var t,e,i,s=u(a);function a(t,e,i,o,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,t,e,"BATTERY")).tilePos=t,n.pulseTime=o,n.pulseSpeed=r,n.charges=i,n.pulseCount=0,n.pulseTimer=n.pulseTime,l.em.AddUpdate(h(n)),l.em.AddBattery(h(n)),n}return t=a,(e=[{key:"HasChargesLeft",value:function(){return this.pulseCount<this.charges}},{key:"Pulse",value:function(){var t=(0,l.getGameSpeed)(),e=new r.default({x:(this.tilePos.x+(this.spriteInfo.flipX?0:1.5))*l.PIXEL_SCALE,y:(this.tilePos.y+.5)*l.PIXEL_SCALE},{index:18,unchargedSprite:19,flipX:!1,flipY:!1,flipR:!1},this.pulseSpeed*t.speed);this.pulseCount++,e.SetVelocity({x:t.speed*this.pulseSpeed*(this.spriteInfo.flipX?-1:1),y:0})}},{key:"Update",value:function(t){this.pulseCount<this.charges&&(this.pulseTimer+=t,this.pulseTimer>=this.pulseTime&&(this.Pulse(),this.pulseTimer-=this.pulseTime,this.sprite++))}}])&&c(t.prototype,e),i&&c(t,i),a}();i.default=f},{"./Component.js":85,"./Electron.js":88,"./main.js":100}],83:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,s=(o=t("./Component"))&&o.__esModule?o:{default:o},a=t("./main");function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function p(t,e,i){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(n){return function(){var t,e,i,o=d(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=d(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return e=this,!(i=t)||"object"!==l(i)&&"function"!=typeof i?f(e):i}}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(n,s["default"]);var t,e,i,r=h(n);function n(t,e,i){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(o=r.call(this,t,e,"POWERED")).isOn=!1,o.chargesRequired=i.chargesRequired,o.chargedSprite=i.chargedSprite,o.unchargedSprite=e.sprite,o.SetBarDirections(i),o.chargeProgress=o.AddProgressBar(o.chargeBarDir,{bg:a.COLOURS.barBg,fg:a.COLOURS.chargeBarFg}),0<i.chargeDecayTime&&(o.decayProgress=o.AddProgressBar(o.decayBarDir,{bg:a.COLOURS.barBg,fg:a.COLOURS.decayBarFg})),(0,a.consoleLog)("ASSIGN BULB PROG BARS"),(0,a.consoleLog)(o.chargeProgress),(0,a.consoleLog)(o.decayProgress),o.SetupDecay(i),o.ResetProgressBars(),a.em.AddBulb(f(o)),i.chargeDecayTime&&a.em.AddUpdate(f(o)),(0,a.consoleLog)("==== BULB CONSTRUCTED ===="),(0,a.consoleLog)(f(o)),o}return t=n,(e=[{key:"Decay",value:function(){(0,a.consoleLog)("BULB DECAY"),p(d(n.prototype),"Decay",this).call(this),a.em.QueueSound(a.SFX.bulbOff),this.isOn&&(this.isOn=!1,this.spriteInfo.index=this.un)}},{key:"IsLit",value:function(){return this.isOn}},{key:"Charged",value:function(){!1===this.isOn&&a.em.QueueSound(a.SFX.bulbOn),this.spriteInfo.index=this.chargedSprite,this.isOn=!0,a.em.CheckEndGame()}},{key:"Update",value:function(t){p(d(n.prototype),"ChargeDecay",this).call(this,t)}}])&&c(t.prototype,e),i&&c(t,i),n}();i.default=r},{"./Component":85,"./main":100}],84:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,n=(o=t("./Label"))&&o.__esModule?o:{default:o},s=t("./main");function a(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var r=function(){function r(t,e,i,o){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.tileRect=t,"SIZE_TOGGLE"===i.type)e=(0,s.getGameSize)().name;else if("SPEED_TOGGLE"===i.type){e=(0,s.getGameSpeed)().name}this.label=new n.default({tileX:t.x+.25,tileY:t.y+.25},e,4),this.options=i,this.colours=o,this.z=190,(this.hover=!1,s.consoleLog)("BUTTON CONSTRUCTED"),(0,s.consoleLog)(this),s.em.AddHover(this),s.em.AddClickable(this),s.em.AddRender(this)}var t,e,i;return t=r,(e=[{key:"Bounds",value:function(){return{x:this.tileRect.x*s.PIXEL_SCALE,y:this.tileRect.y*s.PIXEL_SCALE,w:this.tileRect.w*s.PIXEL_SCALE,h:this.tileRect.h*s.PIXEL_SCALE}}},{key:"Hover",value:function(t){t!==this.hover&&(this.hover=t)}},{key:"Click",value:function(t){(0,s.consoleLog)("CLICKED BUTTON"),(0,s.consoleLog)(this),0===t&&("LVL"===this.options.type?((0,s.consoleLog)("Load Level: "+this.options.value),(this.hover=!1,s.LoadLevel)(this.options.value)):"SFX_TOGGLE"===this.options.type?s.em.soundControl.Toggle():"SPEED_TOGGLE"===this.options.type?(0,s.ToggleGameSpeed)():"SIZE_TOGGLE"===this.options.type&&(0,s.ToggleGameSize)())}},{key:"Draw",value:function(){paper(this.colours.shadow),rectf(this.tileRect.x*s.PIXEL_SCALE-2,this.tileRect.y*s.PIXEL_SCALE+4,this.tileRect.w*s.PIXEL_SCALE,this.tileRect.h*s.PIXEL_SCALE),paper(this.hover?this.colours.hover:this.colours.top),rectf(this.tileRect.x*s.PIXEL_SCALE,this.tileRect.y*s.PIXEL_SCALE,this.tileRect.w*s.PIXEL_SCALE,this.tileRect.h*s.PIXEL_SCALE)}}])&&a(t.prototype,e),i&&a(t,i),r}();i.default=r},{"./Label":91,"./main":100}],85:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,n=(o=t("./ProgressBar"))&&o.__esModule?o:{default:o},s=t("./main");function r(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var a=function(){function o(t,e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.tilePos=t,this.spriteInfo=e,this.z=10,this.progressBars=[],this.chargeBarDir=s.UP,this.decayBarDir=s.UP,this.chargeProgress=null,this.decayProgress=null,this.chargesRequired=0,this.currentCharges=0,this.chargeDecayTime=0,this.chargeDecayTimer=0,this.resetOnFullyCharged=!1,this.decayWhenFull=!1,this.decayToZero=!1,this.chargeResetsDecay=!0,this.overcharge=!1,i&&s.em.AddPhys(this,{mass:1,position:[(this.tilePos.x+.5)*s.PIXEL_SCALE,-(this.tilePos.y+.5)*s.PIXEL_SCALE],isSensor:!0,tag:i,isKinematic:!0,colliderRect:{width:s.PIXEL_SCALE,height:s.PIXEL_SCALE}}),s.em.AddRender(this)}var t,e,i;return t=o,(e=[{key:"SetupDecay",value:function(t){t.chargeDecayTime&&(this.chargeDecayTime=t.chargeDecayTime),t.decayWhenFull&&(this.decayWhenFull=t.decayWhenFull),t.decayToZero&&(this.decayToZero=t.decayToZero),(0,s.consoleLog)("RESET DECAY?"),(0,s.consoleLog)(t.chargeResetsDecay),null!=t.chargeResetsDecay&&(this.chargeResetsDecay=t.chargeResetsDecay),t.overrideDecayColour&&(this.decayProgress.colours.foreground=t.overrideDecayColour)}},{key:"SetBarDirections",value:function(t){t.chargeBarDir&&(this.chargeBarDir=(0,s.GetDirectionFromString)(t.chargeBarDir)),t.decayBarDir&&(this.decayBarDir=(0,s.GetDirectionFromString)(t.decayBarDir))}},{key:"AddProgressBar",value:function(t,e){var i=0;(0,s.consoleLog)("PROG COLOURS"),(0,s.consoleLog)(e);for(var o=0;o<this.progressBars.length;o++)this.progressBars[o].direction===t&&i++;var r=null;return t===s.UP||t===s.DOWN?r=new n.default({x:this.tilePos.x*s.PIXEL_SCALE,y:(this.tilePos.y+(t===s.UP?-.25-3/16*i:1.125+3/16*i))*s.PIXEL_SCALE,w:s.PIXEL_SCALE,h:3},{background:e.bg,foreground:e.fg}):t!==s.LEFT&&t!==s.RIGHT||(r=new n.default({x:(this.tilePos.x+(t===s.LEFT?-.25-3/16*i:1.125+3/16*i))*s.PIXEL_SCALE,y:this.tilePos.y*s.PIXEL_SCALE,w:3,h:s.PIXEL_SCALE,flip:!0},{background:e.bg,foreground:e.fg})),this.progressBars.push({direction:t,bar:r}),(0,s.consoleLog)("RETURN PROG BAR"),(0,s.consoleLog)(r),r}},{key:"ShouldDecay",value:function(){return 0<this.chargeDecayTime&&(this.decayWhenFull&&this.currentCharges>=this.chargesRequired||!1===this.decayWhenFull&&0<this.currentCharges)}},{key:"SetCharge",value:function(t){this.currentCharges=t,null!==this.chargeProgress&&this.chargeProgress.CalculateValue(this.currentCharges,this.chargesRequired)}},{key:"Decay",value:function(){this.decayToZero?this.SetCharge(0):this.SetCharge(this.currentCharges-1)}},{key:"ChargeDecay",value:function(t){0<this.chargeDecayTime&&this.ShouldDecay()&&(this.chargeDecayTimer+=t,null!==this.decayProgress&&this.decayProgress.CalculateValue(this.chargeDecayTime-this.chargeDecayTimer,this.chargeDecayTime),this.chargeDecayTimer>=this.chargeDecayTime&&(this.Decay(),this.chargeDecayTimer=0))}},{key:"ResetProgressBars",value:function(){null!==this.chargeProgress&&this.chargeProgress.CalculateValue(this.currentCharges,this.chargesRequired),null!==this.decayProgress&&this.decayProgress.CalculateValue(this.chargeDecayTime-this.chargeDecayTimer,this.chargeDecayTime)}},{key:"Charged",value:function(){}},{key:"AddCharge",value:function(){this.logging&&(0,s.consoleLog)("TRY TO ADD CHARGE TO: "+this.logName);var t=!1;return 0<this.chargesRequired&&((this.overcharge||this.currentCharges<this.chargesRequired)&&(this.logging&&((0,s.consoleLog)("overcharge: "+this.overcharge),(0,s.consoleLog)("charges below required: "+(this.currentCharges<this.chargesRequired)),(0,s.consoleLog)("USED CHARGE TO POWER UP!")),this.SetCharge(this.currentCharges+1),t=!0),0<this.chargeDecayTime&&this.chargeResetsDecay&&(this.logging&&(0,s.consoleLog)("USED CHARGE TO RESET DECAY"),t=!(this.chargeDecayTimer=0)),t&&this.currentCharges>=this.chargesRequired&&(this.logging&&(0,s.consoleLog)("Call charge!"),this.Charged(),this.resetOnFullyCharged&&this.SetCharge(0))),this.logging&&(0,s.consoleLog)("Return charged: "+t),t}},{key:"Draw",value:function(){sprite(this.spriteInfo.index,this.tilePos.x*s.PIXEL_SCALE,this.tilePos.y*s.PIXEL_SCALE,this.spriteInfo.flipX,this.spriteInfo.flipY,this.spriteInfo.flipR),null!==this.chargeProgress&&this.chargeProgress.Draw(),null!==this.decayProgress&&this.ShouldDecay()&&this.decayProgress.Draw()}}])&&r(t.prototype,e),i&&r(t,i),o}();i.default=a},{"./ProgressBar":93,"./main":100}],86:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,n=(o=t("./Component"))&&o.__esModule?o:{default:o},s=t("./main");function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(n){return function(){var t,e,i,o=h(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=h(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return e=this,!(i=t)||"object"!==a(i)&&"function"!=typeof i?u(e):i}}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(r,n["default"]);var t,e,i,o=p(r);function r(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(i=o.call(this,t,e,"DIODE")).direction=(0,s.GetDiodeDirMapFromFlips)(e.flipX,e.flipY,e.flipR).dir,(0,s.consoleLog)("==== DIODE CONSTRUCTED ===="),(0,s.consoleLog)(u(i)),i}return t=r,(e=[{key:"AllowPassage",value:function(t){var e=!1;return(0,s.consoleLog)("Check Diode Passage:"),(0,s.consoleLog)(this.direction),(0,s.consoleLog)(t.phys.velocity),(this.direction===s.UP&&0<t.phys.velocity[1]||this.direction===s.DOWN&&t.phys.velocity[1]<0||this.direction===s.LEFT&&t.phys.velocity[0]<0||this.direction===s.RIGHT&&0<t.phys.velocity[0])&&(e=!0),e}}])&&l(t.prototype,e),i&&l(t,i),r}();i.default=r},{"./Component":85,"./main":100}],87:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,r=(o=t("./Component"))&&o.__esModule?o:{default:o},l=t("./main");function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function c(t,e,i){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(n){return function(){var t,e,i,o=f(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=f(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return e=this,!(i=t)||"object"!==s(i)&&"function"!=typeof i?h(e):i}}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var a=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(a,r["default"]);var t,e,i,s=u(a);function a(t,e,i,o){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=s.call(this,t,e,"POINTS")).validDirections=o,r.isControllable=i.isControllable;var n=(0,l.GetArrowDirMapFromName)(i.dir);return r.SetDirectionFromMap(n),(0,l.consoleLog)("DIR SWITCHER CONSTRUCTED"),(0,l.consoleLog)(h(r)),r.hover=!1,r.isControllable&&l.em.AddHover(h(r)),l.em.AddClickable(h(r)),r}return t=a,(e=[{key:"GetFlippedDirection",value:function(){var t=[0,0];return this.currentDirection===l.UP?t[1]=1:this.currentDirection===l.DOWN?t[1]=-1:this.currentDirection===l.RIGHT?t[0]=1:this.currentDirection===l.LEFT&&(t[0]=-1),t}},{key:"Bounds",value:function(){return{x:this.tilePos.x*l.PIXEL_SCALE,y:this.tilePos.y*l.PIXEL_SCALE,w:l.PIXEL_SCALE,h:l.PIXEL_SCALE}}},{key:"SetDirectionFromMap",value:function(t){this.spriteInfo.flipX=t.flipX,this.spriteInfo.flipY=t.flipY,this.spriteInfo.flipR=t.flipR,this.currentDirection=t.dir}},{key:"ChangeDir",value:function(t){var e=(0,l.GetArrowDirMapFromDir)(t);this.SetDirectionFromMap(e),l.em.QueueSound(l.SFX.arrowChange)}},{key:"IsValidDir",value:function(t){for(var e=!1,i=0;i<this.validDirections.length;i++)if(this.validDirections[i].dir===t){e=!0;break}return e}},{key:"Input",value:function(t){this.currentDirection!==t&&(this.IsValidDir(t)?this.ChangeDir(t):l.em.QueueSound(l.SFX.arrowDirectionInvalid))}},{key:"Hover",value:function(t){t!==this.hover&&(this.hover=t,this.hover&&l.em.QueueSound(l.SFX.hoverArrow))}},{key:"Draw",value:function(){c(f(a.prototype),"Draw",this).call(this),this.hover&&sprite(l.HOVER_SPRITE,this.tilePos.x*l.PIXEL_SCALE,this.tilePos.y*l.PIXEL_SCALE)}},{key:"NextValidDirection",value:function(t){for(var e=this.currentDirection,i=1;i<4;i++){var o=(this.currentDirection+i*t+4)%4;if((0,l.consoleLog)("IS "+o+" VALID?"),this.IsValidDir(o)){e=o;break}}return e}},{key:"Click",value:function(t){if(this.isControllable)if(l.em.Selected()!==this)l.em.SetSelected(this),l.em.QueueSound(l.SFX.selectArrow);else{var e=this.NextValidDirection(0===t?1:-1);this.ChangeDir(e)}}}])&&n(t.prototype,e),i&&n(t,i),a}();i.default=a},{"./Component":85,"./main":100}],88:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./main");function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function o(t,e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),r.em.AddAnimateFunctions(this),this.frameTimer=0,this.currentAnimation=null,this.currentFrame=0,this.loopAnimation=!1,this.chargedSprite=e.chargedSprite,this.unchargedSprite=e.unchargedSprite,this.spriteInfo=e,this.isCharged=!0,this.logging=!1,this.speed=i,this.contact=null,this.approach=null,this.z=5,this.velocity={x:0,y:0},this.SetAnimation("ELECTRON_TRAVEL",!0),r.em.AddRender(this),r.em.AddPhys(this,{mass:1,position:[t.x,-t.y],tag:"ELECTRON",colliderRect:{width:r.PIXEL_SCALE/2,height:r.PIXEL_SCALE/2}}),r.em.AddUpdate(this),r.em.AddElectron(this)}var t,e,i;return t=o,(e=[{key:"AnimationFinished",value:function(t){(0,r.consoleLog)("Animation: "+t.name+" Ended!"),t.name.includes("ELECTRON_DESTROY")&&((0,r.consoleLog)("Delete this!"),this.Delete())}},{key:"UpdateFrame",value:function(){var t=this.currentAnimation.frames[this.currentFrame];this.spriteInfo.index=t.sprite,this.spriteInfo.flipX=t.flipX,this.spriteInfo.flipY=t.flipY,this.spriteInfo.flipR=t.flipR}},{key:"CompareCentre",value:function(t,e){var i=!1,o=0;"X"===this.approach.axis?o=0:"Y"===this.approach.axis&&(o=1);var r=e.phys.position[o]-t.phys.position[o];return Math.sign(r)!==this.approach.dir&&(i=!0),i}},{key:"GetXDiff",value:function(t,e){return e.phys.position[0]-t.phys.position[0]}},{key:"GetYDiff",value:function(t,e){return e.phys.position[1]-t.phys.position[1]}},{key:"SetContact",value:function(t){this.contact=t;var e=this.GetXDiff(this,t),i=this.GetYDiff(this,t);Math.abs(e)>Math.abs(i)?this.approach={axis:"X",dir:Math.sign(e)}:Math.abs(i)>Math.abs(e)?this.approach={axis:"Y",dir:Math.sign(i)}:(0,r.consoleLog)("Something has gone horribly wrong in Electron.SetContact")}},{key:"SetVelocity",value:function(t){this.velocity=t}},{key:"SnapToContact",value:function(t){this.reSnap=[];for(var e=0;e<t.phys.position.length;e++)this.phys.position[e]=t.phys.position[e],this.reSnap[e]=t.phys.position[e]}},{key:"Delete",value:function(){r.em.phys.removeBody(this.phys),r.em.RemoveUpdate(this),r.em.RemoveRender(this),r.em.RemoveElectron(this)}},{key:"Destroy",value:function(){var t=0<Math.abs(this.phys.velocity[0])?"_H":"_V",e=this.isCharged?"CHARGED_ELECTRON_DESTROY":"UNCHARGED_ELECTRON_DESTROY";this.SetAnimation(e+t,!1),(0,r.consoleLog)(this.phys),this.phys.shapes=[],this.isCharged=!0,this.setDeleteSpeed=!0}},{key:"Charge",value:function(){this.isCharged||(this.isCharged=!0,r.em.QueueSound(r.SFX.electronCharged))}},{key:"ChargeComponent",value:function(t){if(this.isCharged){var e=t.AddCharge();(0,r.consoleLog)("CHARGE USED: "+e),e&&((0,r.consoleLog)("Switch off electron!"),this.RemoveCharge())}}},{key:"RemoveCharge",value:function(){this.isCharged=!1,r.em.QueueSound(r.SFX.chargeSpent)}},{key:"Update",value:function(t){if(this.Animate(t),this.phys.velocity=[this.velocity.x,this.velocity.y],this.contact){if(this.CompareCentre(this,this.contact)){var e=this.contact.GetFlippedDirection(this.phys.velocity);this.phys.setZeroForce(),this.SetVelocity({x:e[0]*this.speed,y:e[1]*this.speed}),this.SnapToContact(this.contact,e),"POWERED_ALT"===this.contact.phys.tag&&this.ChargeComponent(this.contact),this.contact=null}}else this.reSnap?(this.phys.position=this.reSnap,this.reSnap=null):this.setDeleteSpeed&&(this.phys.velocity[0]=.1*this.phys.velocity[0],this.phys.velocity[1]=.1*this.phys.velocity[1])}},{key:"Draw",value:function(){var t={x:this.phys.position[0]-.5*r.PIXEL_SCALE,y:-this.phys.position[1]-.5*r.PIXEL_SCALE};sprite(this.isCharged?this.spriteInfo.index:this.unchargedSprite,t.x,t.y,this.spriteInfo.flipX,this.spriteInfo.flipY,this.spriteInfo.flipR)}}])&&n(t.prototype,e),i&&n(t,i),o}();i.default=o},{"./main":100}],89:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,n=(o=t("./Label"))&&o.__esModule?o:{default:o},s=t("./main");function a(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var r=function(){function r(t,e,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.displayRect=t,this.mainText=e,this.additionalText=i,this.colours=o,(0,s.consoleLog)(this.colours),this.additionalLabels=[],this.levelOverMax=4,this.isWin=!1,this.z=1e3}var t,e,i;return t=r,(e=[{key:"Collapse",value:function(){s.em.RemoveRender(this.mainLabel);for(var t=0;t<this.additionalLabels.length;t++)s.em.RemoveRender(this.additionalLabels[t]);s.em.RemoveRender(this)}},{key:"ShowScreen",value:function(t,e){(0,s.consoleLog)("Electrons Left:"+e),this.isWin=t,this.mainLabel=new n.default(this.mainText.pos,t?this.mainText.winText:0===e?this.mainText.loseText:this.mainText.altLose,4),this.mainLabel.z=1010;var i=this.isWin||!1===this.isWin&&0===e?this.levelOverMax:this.additionalText.length;0==this.isWin&&0<e&&((0,s.consoleLog)("Add Tile for extra lines..."),this.displayRect.tileH+=1);for(var o=0;o<i;o++){var r=new n.default(this.additionalText[o].pos,this.additionalText[o].text,4);r.z=1010,this.additionalLabels.push(r)}s.em.AddRender(this)}},{key:"Draw",value:function(){var t=this.isWin?this.colours.win:this.colours.lose;paper(t.background),rectf((this.displayRect.tileX-.25)*s.PIXEL_SCALE,(this.displayRect.tileY+.5)*s.PIXEL_SCALE,this.displayRect.tileW*s.PIXEL_SCALE,this.displayRect.tileH*s.PIXEL_SCALE),paper(t.foreground),rectf(this.displayRect.tileX*s.PIXEL_SCALE,this.displayRect.tileY*s.PIXEL_SCALE,this.displayRect.tileW*s.PIXEL_SCALE,this.displayRect.tileH*s.PIXEL_SCALE)}}])&&a(t.prototype,e),i&&a(t,i),r}();i.default=r},{"./Label":91,"./main":100}],90:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=o(t("./EndScreen.js")),s=t("./main.js"),n=o(t("./PauseMenu.js"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var l=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.electronLossThreshold=0,this.electronsLost=0,this.canShowEnd="title"!==s.CURRENT_LVL,this.bgColour=1,this.phys=t?null:new s.p2.World({gravity:[0,0]}),this.selector=null,this.map=null,this.renderers=[],this.updates=[],this.pause=!1,this.continued=!1,this.endScreenOn=!1,this.hovers=[],this.clickables=[],this.electrons=[],this.batteries=[],this.bulbs=[],this.endScreen=null,this.trackMouse=!1,this.selected=null,this.soundQueue=[],this.phys&&this.SetupPhys(),"title"===s.CURRENT_LVL&&(this.soundControl=s.SOUND,this.AddRender(this.soundControl))}var t,i,o;return t=e,(i=[{key:"QueueSound",value:function(t,e){var i=0;e&&(i=e),this.soundQueue.push({sound:t,delay:i}),(0,s.consoleLog)(this.soundQueue)}},{key:"Initialise",value:function(){this.CreateNewEndScreenBox(),this.CreatePauseMenu()}},{key:"CreatePauseMenu",value:function(){this.pauseMenu=new n.default({tileX:4,tileY:3,tileW:6,tileH:4.5},[{pos:{tileX:5,tileY:3.1},text:"PAUSED"},{pos:{tileX:5,tileY:4},text:"Press R to"},{pos:{tileX:5.5,tileY:4.5},text:"Restart"},{pos:{tileX:5,tileY:5.25},text:"Press Space to"},{pos:{tileX:5.5,tileY:5.75},text:"Unpause"},{pos:{tileX:5,tileY:6.5},text:"Press Esc to"},{pos:{tileX:5.5,tileY:7},text:"return to menu"}],{background:13,foreground:14})}},{key:"CreateNewEndScreenBox",value:function(){this.endScreen=new r.default({tileX:4,tileY:3,tileW:6,tileH:3.5},{pos:{tileX:5,tileY:3.1},winText:"Congratulations!",loseText:"Game Over!",altLose:"Current too low!"},[{pos:{tileX:5,tileY:4},text:"Press R to"},{pos:{tileX:5,tileY:4.5},text:"Restart Level"},{pos:{tileX:5,tileY:5.25},text:"Press Esc to"},{pos:{tileX:5,tileY:5.75},text:"return to menu"},{pos:{tileX:5,tileY:6.5},text:"Press Space to"},{pos:{tileX:5,tileY:7},text:"Continue Regardless"}],{win:{background:3,foreground:7},lose:{background:12,foreground:9}})}},{key:"AddHover",value:function(t){!1===this.trackMouse&&(this.trackMouse=!0),this.hovers.push(t)}},{key:"Selected",value:function(){return this.selected}},{key:"SetSelected",value:function(t){if(null!==(this.selected=t)){var e=this.selected.Bounds();this.selector.position={x:e.x,y:e.y},this.selector.isActive=!0}else this.selector.isActive=!1}},{key:"Overlap",value:function(t,e,i){var o=t.Bounds(),r=o.x<e&&e<o.x+o.w,n=o.y<i&&i<o.y+o.h;return r&&n}},{key:"Input",value:function(){if(this.endScreenOn||this.pause)btnp.esc?(0,s.LoadLevel)("title"):btnp.reset?(0,s.LoadLevel)(s.CURRENT_LVL,!0):btnp.space&&(this.endScreenOn&&(this.continued=!0,this.endScreen.Collapse(),this.CreateNewEndScreenBox()),this.pause=!1,this.endScreenOn=!1,this.pauseMenu.Show(!1));else{var t=-1;btnp.up||btnp.up_alt?t=s.UP:btnp.right||btnp.right_alt?t=s.RIGHT:btnp.down||btnp.down_alt?t=s.DOWN:(btnp.left||btnp.left_alt)&&(t=s.LEFT),0<=t&&null!==this.selected&&this.selected.Input&&this.selected.Input(t),this.canShowEnd&&(btnp.esc||btnp.reset||btnp.space)&&(this.pause=!0,this.pauseMenu.Show(!0))}}},{key:"MouseMove",value:function(t,e){if(this.trackMouse)for(var i=0;i<this.hovers.length;i++)this.hovers[i].Hover(this.Overlap(this.hovers[i],t,e))}},{key:"MouseClick",value:function(t,e,i){if(!this.endScreenOn){for(var o=!1,r=0;r<this.clickables.length;r++)if(this.Overlap(this.clickables[r],t,e)){this.clickables[r].Click(i),o=!0;break}o||this.SetSelected(null)}}},{key:"CompareTags",value:function(t,e,i){return t.bodyA.tag===e&&t.bodyB.tag===i||t.bodyA.tag===i&&t.bodyB.tag===e}},{key:"BodyWithTag",value:function(t,e){var i=null;return t.bodyA.tag===e?i=t.bodyA:t.bodyB.tag===e&&(i=t.bodyB),i}},{key:"SetupPhys",value:function(){var n=this;this.phys.on("beginContact",function(t){if(n.CompareTags(t,"ELECTRON","POINTS")){var e=n.BodyWithTag(t,"ELECTRON"),i=n.BodyWithTag(t,"POINTS");e.obj.SetContact(i.obj)}else if(n.CompareTags(t,"ELECTRON","POWERED")){e=n.BodyWithTag(t,"ELECTRON");var o=n.BodyWithTag(t,"POWERED");e.obj.ChargeComponent(o.obj)}else if(n.CompareTags(t,"ELECTRON","BATTERY")){(e=n.BodyWithTag(t,"ELECTRON")).obj.Charge()}else if(n.CompareTags(t,"ELECTRON","POWERED_ALT")){e=n.BodyWithTag(t,"ELECTRON"),o=n.BodyWithTag(t,"POWERED_ALT");e.obj.SetContact(o.obj)}else if(n.CompareTags(t,"ELECTRON","ELECTRON"))n.QueueSound(s.SFX.electronCollision),t.bodyA.obj.Destroy(),t.bodyB.obj.Destroy();else if(n.CompareTags(t,"ELECTRON","WIRE_SWITCH")){e=n.BodyWithTag(t,"ELECTRON");n.BodyWithTag(t,"WIRE_SWITCH").obj.AllowPassage(e.obj)||(n.QueueSound(s.SFX.electronLost),e.obj.Destroy())}else if(n.CompareTags(t,"ELECTRON","DIODE")){e=n.BodyWithTag(t,"ELECTRON");var r=n.BodyWithTag(t,"DIODE");(0,s.consoleLog)("Diode collision!"),r.obj.AllowPassage(e.obj)||((0,s.consoleLog)("Remove electron charge!"),e.obj.RemoveCharge())}}),this.phys.on("postStep",function(t){n.UpdateLoop(n.deltaTime)})}},{key:"AddClickable",value:function(t){this.clickables.push(t)}},{key:"AddPhys",value:function(t,e){t.phys=new s.p2.Body({mass:e.mass,position:e.position,fixedRotation:!0}),t.phys.obj=t,e.tag&&(t.phys.tag=e.tag),e.isKinematic&&(t.phys.type=s.p2.Body.KINEMATIC);var i=new s.p2.Box(e.colliderRect);i.friction=0,e.isSensor&&(i.sensor=e.isSensor),t.phys.addShape(i),this.phys.addBody(t.phys)}},{key:"AddBulb",value:function(t){this.bulbs.push(t)}},{key:"AddElectron",value:function(t){this.electrons.push(t)}},{key:"RemoveElectron",value:function(t){for(var e=0;e<this.electrons.length;e++)if(this.electrons[e]===t){this.electrons.splice(e,1),this.electronsLost++;break}this.CheckEndGame()}},{key:"CheckEndGame",value:function(){if(this.canShowEnd&&!1===this.endScreenOn){var t=0<this.electronLossThreshold&&this.electronsLost>=this.electronLossThreshold;if(0===this.electrons.length||t&&!1===this.continued){for(var e=!1,i=0;i<this.batteries.length;i++)if(this.batteries[i].HasChargesLeft()){e=!0;break}(!e||t&&!1===this.continued)&&(this.pause=!0,(0,s.consoleLog)("Game over!"),this.QueueSound(s.SFX.defeat,.5),this.endScreen.ShowScreen(!1,this.electrons.length),this.endScreenOn=!0)}else this.AllBulbsLit()&&((0,s.consoleLog)("You Win!"),this.QueueSound(s.SFX.victory,.5),this.endScreen.ShowScreen(!0),this.endScreenOn=!0)}}},{key:"AllBulbsLit",value:function(){for(var t=!0,e=0;e<this.bulbs.length;e++)if(!this.bulbs[e].IsLit()){t=!1;break}return t}},{key:"AddBattery",value:function(t){this.batteries.push(t)}},{key:"SortRenders",value:function(){this.renderers.sort(function(t,e){return t.z-e.z})}},{key:"AddRender",value:function(t){this.renderers.push(t),this.SortRenders()}},{key:"RemoveRender",value:function(t,e){for(var i=0;i<this.renderers.length;i++)if(this.renderers[i]===t){this.renderers.splice(i,1),e&&((0,s.consoleLog)("Renderer removed!"),(0,s.consoleLog)(t));break}this.SortRenders()}},{key:"AddUpdate",value:function(t){this.updates.push(t)}},{key:"RemoveUpdate",value:function(t){for(var e=0;e<this.updates.length;e++)if(this.updates[e]===t){this.updates.splice(e,1);break}}},{key:"AddAnimateFunctions",value:function(i){i.Animate=function(t){i.currentAnimation&&(i.frameTimer+=t,i.frameTimer>=i.currentAnimation.frameTime&&(i.frameTimer-=i.currentAnimation.frameTime,i.currentFrame=(i.currentFrame+1)%i.currentAnimation.frames.length,0===i.currentFrame&&!1===i.loopAnimation?i.AnimationFinished(i.currentAnimation):i.UpdateFrame()))},i.SetAnimation=function(t,e){i.loopAnimation=e,i.currentAnimation=(0,s.getAnimation)(t),i.currentFrame=0,i.frameTimer=0,i.UpdateFrame()}}},{key:"Render",value:function(){paper(this.bgColour),cls(),this.map&&this.map.draw(0,0);for(var t=0;t<this.renderers.length;t++)this.renderers[t].hide||this.renderers[t].Draw()}},{key:"UpdateLoop",value:function(t){for(var e=0;e<this.updates.length;e++)this.updates[e].Update(t)}},{key:"Update",value:function(t){this.pause||(this.deltaTime=t,this.phys?this.phys.step(t,t,20):this.UpdateLoop(t)),0<this.soundQueue.length&&(this.soundQueue[0].delay-=t,this.soundQueue[0].delay<=0&&(sfx(this.soundQueue[0].sound),this.soundQueue.splice(0,1)))}}])&&a(t.prototype,i),o&&a(t,o),e}();i.default=l},{"./EndScreen.js":89,"./PauseMenu.js":92,"./main.js":100}],91:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./main");function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function o(t,e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.pos=t,this.text=e,this.colour=i,this.z=200,r.em.AddRender(this)}var t,e,i;return t=o,(e=[{key:"Draw",value:function(){locate(0,0),pen(this.colour),print(this.text,this.pos.tileX*r.PIXEL_SCALE,this.pos.tileY*r.PIXEL_SCALE)}}])&&n(t.prototype,e),i&&n(t,i),o}();i.default=o},{"./main":100}],92:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,s=(o=t("./Label.js"))&&o.__esModule?o:{default:o},a=t("./main.js");function r(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var n=function(){function n(t,e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.displayRect=t,this.textLines=e,this.colours=i,this.labels=[];for(var o=0;o<this.textLines.length;o++){var r=new s.default(this.textLines[o].pos,this.textLines[o].text,4);r.z=1010,this.labels.push(r)}a.em.AddRender(this),this.Hide(),this.z=1e3}var t,e,i;return t=n,(e=[{key:"Show",value:function(t){null==t&&(t=!0);for(var e=0;e<this.labels.length;e++)this.labels[e].hide=!t;this.hide=!t}},{key:"Hide",value:function(){this.Show(!1)}},{key:"Draw",value:function(){paper(this.colours.background),rectf((this.displayRect.tileX-.25)*a.PIXEL_SCALE,(this.displayRect.tileY+.5)*a.PIXEL_SCALE,this.displayRect.tileW*a.PIXEL_SCALE,this.displayRect.tileH*a.PIXEL_SCALE),paper(this.colours.foreground),rectf(this.displayRect.tileX*a.PIXEL_SCALE,this.displayRect.tileY*a.PIXEL_SCALE,this.displayRect.tileW*a.PIXEL_SCALE,this.displayRect.tileH*a.PIXEL_SCALE)}}])&&r(t.prototype,e),i&&r(t,i),n}();i.default=n},{"./Label.js":91,"./main.js":100}],93:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./main");function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.rect=t,this.colours=e,this.SetValue(.5),this.flip=!1,t.flip&&(this.flip=t.flip),(0,r.consoleLog)("PROGRESS BAR CONSTRUCTED"),(0,r.consoleLog)(this)}var t,e,o;return t=i,(e=[{key:"SetValue",value:function(t){if(this.value!==t){this.value=t;var e=this.flip?this.rect.h:this.rect.w;this.filledWidth=clamp(e*this.value,0,e)}}},{key:"CalculateValue",value:function(t,e){0!==e?this.SetValue(t/e):(0,r.consoleLog)("Progress Bar Went wrong: "+t+" / "+e)}},{key:"Draw",value:function(){paper(this.colours.background),rectf(this.rect.x,this.rect.y,this.rect.w,this.rect.h),0<this.value&&(paper(this.colours.foreground),this.flip?rectf(this.rect.x,Math.floor(this.rect.y+this.rect.h-this.filledWidth),this.rect.w,Math.ceil(this.filledWidth)):rectf(this.rect.x,this.rect.y,this.filledWidth,this.rect.h))}}])&&n(t.prototype,e),o&&n(t,o),i}();i.default=o},{"./main":100}],94:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./main");function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.tilePos=t,this.dirMap=e,this.z=2,r.em.AddPhys(this,{mass:1,position:[(this.tilePos.x+.5)*r.PIXEL_SCALE,-(this.tilePos.y+.5)*r.PIXEL_SCALE],isSensor:!0,tag:"POINTS",isKinematic:!0,colliderRect:{width:r.PIXEL_SCALE,height:r.PIXEL_SCALE}})}var t,e,o;return t=i,(e=[{key:"GetVert",value:function(){for(var t="",e=0;e<this.dirMap.dir.length;e++)if("U"===this.dirMap.dir[e]||"D"===this.dirMap.dir[e]){t=this.dirMap.dir[e];break}return t}},{key:"GetHoriz",value:function(){for(var t="",e=0;e<this.dirMap.dir.length;e++)if("L"===this.dirMap.dir[e]||"R"===this.dirMap.dir[e]){t=this.dirMap.dir[e];break}return t}},{key:"GetFlippedDirection",value:function(t){var e=this.GetHoriz(),i=this.GetVert();return Math.abs(t[0])>Math.abs(t[1])?(0<t[0]&&"R"===e||t[0]<0&&"L"===e?t[1]="U"===i?1:-1:(0<t[0]&&"L"===e||t[0]<0&&"R"===e)&&(t[1]="U"===i?-1:1),t[0]=0):Math.abs(t[1])>Math.abs(t[0])&&(0<t[1]&&"U"===i||t[1]<0&&"D"===i||0<t[1]&&"D"===i||t[1]<0&&"U"===i?t[0]="R"===e?-1:1:(0,r.consoleLog)("X NOT SET!"),t[1]=0),t}}])&&n(t.prototype,e),o&&n(t,o),i}();i.default=o},{"./main":100}],95:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./main.js");function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.spriteIndex=t,this.position={x:0,y:0},this.isActive=!1,this.z=100,r.em.AddRender(this)}var t,i,o;return t=e,(i=[{key:"Draw",value:function(){this.isActive&&sprite(this.spriteIndex,this.position.x,this.position.y)}}])&&n(t.prototype,i),o&&n(t,o),e}();i.default=o},{"./main.js":100}],96:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./main");function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.spriteInfo=e,this.pos=t,this.soundOn=!0,audioManager.channels.sfx.volume=5}var t,e,o;return t=i,(e=[{key:"SetOn",value:function(t){(0,r.consoleLog)("SWITCH SOUND: "+t),this.soundOn=t,(0,r.consoleLog)(audioManager),audioManager.muted=!t}},{key:"Toggle",value:function(){this.SetOn(!this.soundOn)}},{key:"Draw",value:function(){sprite(this.spriteInfo.speakerIndex,this.pos.tileX*r.PIXEL_SCALE,this.pos.tileY*r.PIXEL_SCALE),sprite(this.soundOn?this.spriteInfo.speakerOnIndex:this.spriteInfo.speakerOffIndex,(this.pos.tileX+1)*r.PIXEL_SCALE,this.pos.tileY*r.PIXEL_SCALE)}}])&&n(t.prototype,e),o&&n(t,o),i}();i.default=o},{"./main":100}],97:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o=t("./main"),s=r(t("./Component")),a=r(t("./TransistorEffect"));function r(t){return t&&t.__esModule?t:{default:t}}function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function p(t,e,i){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(n){return function(){var t,e,i,o=f(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=f(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return e=this,!(i=t)||"object"!==l(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var n=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(n,s["default"]);var t,e,i,r=h(n);function n(t,e,i){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(o=r.call(this,t,e,"POWERED")).chargesRequired=i.chargesRequired,o.connections=i.connections,o.resetOnFullyCharged=!0,o.SetBarDirections(i),o.logging=!0,o.logName="TRANSISTOR",o.chargeProgress=o.AddProgressBar(o.chargeBarDir,{bg:4,fg:15}),o.ResetProgressBars(),o}return t=n,(e=[{key:"AddCharge",value:function(){var t=p(f(n.prototype),"AddCharge",this).call(this);return console.log("TRANSISTOR CHARGE:"+this.currentCharges+" / "+this.chargesRequired),t}},{key:"Charged",value:function(){(0,o.consoleLog)("Pulse to "+this.connections.length+" connections"),o.em.QueueSound(o.SFX.transistor),new a.default({x:this.tilePos.x,y:this.tilePos.y});for(var t=0;t<this.connections.length;t++)this.connections[t].AddCharge(),new a.default({x:this.connections[t].tilePos.x,y:this.connections[t].tilePos.y})}}])&&c(t.prototype,e),i&&c(t,i),n}();i.default=n},{"./Component":85,"./TransistorEffect":98,"./main":100}],98:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./main");function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r.em.AddAnimateFunctions(this),this.centreTile=t,this.allSides=[],this.allCorners=[],this.coreAnim=(0,r.getAnimation)("TRANSISTOR_ANIM"),this.z=200,this.spriteInfo={corner:this.coreAnim.frames[0].corner,side:this.coreAnim.frames[0].side},this.tl=this.AddEffectTile(t.x-1,t.y-1,"TL"),this.tm=this.AddEffectTile(t.x,t.y-1,"TM"),this.tr=this.AddEffectTile(t.x+1,t.y-1,"TR"),this.ml=this.AddEffectTile(t.x-1,t.y,"ML"),this.mr=this.AddEffectTile(t.x+1,t.y,"MR"),this.bl=this.AddEffectTile(t.x-1,t.y+1,"BL"),this.bm=this.AddEffectTile(t.x,t.y+1,"BM"),this.br=this.AddEffectTile(t.x+1,t.y+1,"BR"),r.em.AddRender(this),r.em.AddUpdate(this),this.SetAnimation("TRANSISTOR_ANIM",!1)}var t,i,o;return t=e,(i=[{key:"UpdateFrame",value:function(){var t=this.currentAnimation.frames[this.currentFrame];this.spriteInfo.corner=t.corner,this.spriteInfo.side=t.side}},{key:"AnimationFinished",value:function(){r.em.RemoveRender(this),r.em.RemoveRender(this)}},{key:"AddEffectTile",value:function(t,e,i){var o={x:t,y:e,flipX:!1,flipY:!1,flipR:!1},r=!1;"TL"===i?r=o.flipX=!0:"TM"===i?(o.flipY=!0,o.flipR=!0):"TR"===i?r=!0:"ML"===i?o.flipX=!0:"MR"===i||("BL"===i?(r=!0,o.flipX=!0,o.flipY=!0):"BM"===i?o.flipR=!0:"BR"===i&&(r=!0,o.flipY=!0)),r?this.allCorners.push(o):this.allSides.push(o)}},{key:"Update",value:function(t){this.Animate(t)}},{key:"Draw",value:function(){for(var t=0;t<this.allSides.length;t++)sprite(this.spriteInfo.side,this.allSides[t].x*r.PIXEL_SCALE,this.allSides[t].y*r.PIXEL_SCALE,this.allSides[t].flipX,this.allSides[t].flipY,this.allSides[t].flipR);for(t=0;t<this.allCorners.length;t++)sprite(this.spriteInfo.corner,this.allCorners[t].x*r.PIXEL_SCALE,this.allCorners[t].y*r.PIXEL_SCALE,this.allCorners[t].flipX,this.allCorners[t].flipY,this.allCorners[t].flipR)}}])&&n(t.prototype,i),o&&n(t,o),e}();i.default=o},{"./main":100}],99:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o,r=(o=t("./Component"))&&o.__esModule?o:{default:o},a=t("./main");function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(n){return function(){var t,e,i,o=u(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=u(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return e=this,!(i=t)||"object"!==s(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var n=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(s,r["default"]);var t,e,i,n=p(s);function s(t,e,i){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(o=n.call(this,t,e,"WIRE_SWITCH")).z=3,o.dirs=["H","V"],o.chargesRequired=i.chargesRequired,o.resetOnFullyCharged=!0;var r=(0,a.GetWireSwitchDirFromFlips)(e.flipX,e.flipY,e.flipR);return o.currentDirIndex=o.GetDirectionIndex(r.dir),o}return t=s,(e=[{key:"CurrentDirection",value:function(){return this.dirs[this.currentDirIndex]}},{key:"GetDirectionIndex",value:function(t){for(var e=-1,i=0;i<this.dirs.length;i++)if(this.dirs[i]===t){e=i;break}return e<0&&(0,a.consoleLog)("Something bad has happened in WireSwitch"),e}},{key:"AllowPassage",value:function(t){var e=!1;return"H"===this.CurrentDirection()?e=0<Math.abs(t.phys.velocity[0]):"V"===this.CurrentDirection()&&(e=0<Math.abs(t.phys.velocity[1])),e}},{key:"ChangeDirection",value:function(){this.currentDirIndex=(this.currentDirIndex+1)%this.dirs.length;var t=(0,a.GetWireSwitchDirFromDir)(this.CurrentDirection());this.spriteInfo.flipX=t.flipX,this.spriteInfo.flipY=t.flipY,this.spriteInfo.flipR=t.flipR}},{key:"Charged",value:function(){this.ChangeDirection()}}])&&l(t.prototype,e),i&&l(t,i),s}();i.default=n},{"./Component":85,"./main":100}],100:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.consoleLog=H,i.GetArrowDirMapFromDir=function(t){for(var e=null,i=0;i<V.length;i++)if(V[i].dir===t){e=V[i];break}return e},i.GetArrowDirMapFromFlips=function(t,e,i){for(var o=null,r=0;r<V.length;r++)if(V[r].flipX===t&&V[r].flipY===e&&V[r].flipR===i){o=V[r];break}return console.log("Flips - X:"+t+", Y: "+e+", R: "+i),console.log(o),o},i.GetArrowDirMapFromName=function(t){for(var e=null,i=0;i<V.length;i++)if(V[i].name===t){e=V[i];break}return e},i.LoadLevel=z,i.GetAltSwitchDirMapFromDir=function(t){for(var e=null,i=0;i<X.length;i++)if(X[i].dir===t){e=X[i];break}return e},i.GetDirectionFromString=function(t){var e=0;"UP"===t?e=C:"DOWN"===t?e=D:"RIGHT"===t?e=P:"LEFT"===t&&(e=_);return e},i.GetWireSwitchDirFromFlips=function(t,e,i){for(var o=null,r=0;r<F.length;r++)if(F[r].flipX===t&&F[r].flipY===e&&F[r].flipR===i){o=F[r];break}return o},i.GetWireSwitchDirFromDir=function(t){for(var e=null,i=0;i<F.length;i++)if(F[i].dir===t){e=F[i];break}return e},i.GetDiodeDirMapFromFlips=function(t,e,i){for(var o=null,r=0;r<q.length;r++)if(q[r].flipX===t&&q[r].flipY===e&&q[r].flipR===i){o=q[r];break}null===o&&(console.log("DIODE: Flips - X:"+t+", Y: "+e+", R: "+i),console.log(o));return o},i.ToggleGameSize=function(){(function(t){h=t;var e=document.getElementsByTagName("canvas")[0];e.style.width=y[t].windowDims,e.style.height=y[t].windowDims,u=y[t].mouseScale})((h+1)%y.length),z("title",!0)},i.ToggleGameSpeed=function(){d=(d+1)%f.length,z("title",!0)},i.getGameSpeed=function(){return f[d]},i.getGameSize=function(){return y[h]},i.getAnimation=function(t){H(assets.animations.anims);for(var e=assets.animations.anims,i=null,o=0;o<e.length;o++)if(e[o].name===t){i=e[o];break}return i},i.SOUND=i.VOL=i.SFX=i.COLOURS=i.LEFT=i.DOWN=i.RIGHT=i.UP=i.PIXEL_SCALE=i.TOTAL_SPRITES=i.CURRENT_LVL=i.HOVER_SPRITE=i.p2=i.em=void 0;var o=s(t("./EntityManager.js")),g=s(t("./Battery.js")),m=s(t("./Button.js")),b=s(t("./RailPoint.js")),S=s(t("./DirectionSwitcher.js")),r=s(t("./Selector.js")),A=s(t("./Bulb.js")),E=s(t("./Label.js")),w=s(t("./AltSwitch.js")),x=s(t("./Transistor.js")),R=s(t("./WireSwitch.js")),B=s(t("./Diode.js")),n=s(t("./SoundSettings.js"));function s(t){return t&&t.__esModule?t:{default:t}}var a=t("pixelbox/pointerEvents"),l=t("p2");i.p2=l;var c,p,u=1,h=2,f=[{name:"Slow",speed:.5},{name:"Normal",speed:1},{name:"Fast",speed:2}],d=1,y=[{name:"Small",windowDims:512,mouseScale:2},{name:"Medium",windowDims:768,mouseScale:4/3},{name:"Large",windowDims:1024,mouseScale:1}];i.COLOURS=c,i.SFX=p;var v,L={tileX:.25,tileY:.25};i.SOUND=v;var C=i.VOL=0;i.UP=C;var P=1;i.RIGHT=P;var D=2;i.DOWN=D;var _=3;i.LEFT=_;var T=!(i.HOVER_SPRITE=36),I="";i.CURRENT_LVL=I;i.TOTAL_SPRITES=255;var O;i.PIXEL_SCALE=16,i.em=O;var M=!0,q=[{dir:C,flipX:!0,flipY:!1,flipR:!0},{dir:C,flipX:!1,flipY:!1,flipR:!0},{dir:P,flipX:!0,flipY:!1,flipR:!1},{dir:P,flipX:!0,flipY:!0,flipR:!1},{dir:D,flipX:!0,flipY:!0,flipR:!0},{dir:D,flipX:!1,flipY:!0,flipR:!0},{dir:_,flipX:!1,flipY:!1,flipR:!1},{dir:_,flipX:!1,flipY:!0,flipR:!1}],F=[{dir:"H",flipX:!1,flipY:!1,flipR:!1},{dir:"V",flipX:!1,flipY:!1,flipR:!0}],X=[{name:"LD",dir:"LD",setDir:_,flipX:!0,flipY:!1,flipR:!0},{name:"DL",dir:"DL",setDir:D,flipX:!0,flipY:!0,flipR:!1},{name:"UR",dir:"UR",setDir:C,flipX:!1,flipY:!1,flipR:!1},{name:"UL",dir:"UL",setDir:C,flipX:!0,flipY:!1,flipR:!1},{name:"DR",dir:"DR",setDir:D,flipX:!1,flipY:!0,flipR:!1},{name:"RD",dir:"RD",setDir:_,flipX:!1,flipY:!1,flipR:!0},{name:"RU",dir:"RU",setDir:_,flipX:!1,flipY:!0,flipR:!0},{name:"LU",dir:"LU",setDir:_,flipX:!0,flipY:!0,flipR:!0},{name:"RL",dir:"RL",setDir:P,flipX:!1,flipY:!1,flipR:!0},{name:"LR",dir:"LR",setDir:_,flipX:!0,flipY:!0,flipR:!0},{name:"UD",dir:"UD",setDir:C,flipX:!1,flipY:!1,flipR:!1},{name:"DU",dir:"DU",setDir:D,flipX:!0,flipY:!0,flipR:!1}],V=[{name:"UP",dir:C,flipX:!1,flipY:!1,flipR:!1},{name:"RIGHT",dir:P,flipX:!1,flipY:!1,flipR:!0},{name:"DOWN",dir:D,flipX:!1,flipY:!0,flipR:!1},{name:"LEFT",dir:_,flipX:!0,flipY:!1,flipR:!0}],k=[{dir:"RD",flipX:!1,flipY:!1,flipR:!1},{dir:"RU",flipX:!1,flipY:!0,flipR:!1},{dir:"RU",flipX:!1,flipY:!1,flipR:!0},{dir:"LD",flipX:!0,flipY:!1,flipR:!1},{dir:"LD",flipX:!0,flipY:!0,flipR:!0},{dir:"LU",flipX:!0,flipY:!1,flipR:!0},{dir:"LU",flipX:!0,flipY:!0,flipR:!1}],Y=[{spriteId:0},{spriteId:1},{spriteId:2},{spriteId:3},{spriteId:4},{spriteId:5},{spriteId:9},{spriteId:16},{spriteId:23},{spriteId:24},{spriteId:32},{spriteId:33}],N=[{type:"Battery",index:0},{type:"Direction",index:5,replaceSprite:6},{type:"AltSwitch",index:9},{type:"Corner",index:2},{type:"Bulb",index:16},{type:"Switch",index:23,replaceSprite:39},{type:"Diode",index:33},{type:"Transistor",index:32}];function G(t,e,i){for(var o=null,r=0;r<k.length;r++){var n=k[r];if(n.flipX===t&&n.flipY===e&&n.flipR===i){o=n;break}}return null===o&&(H("DIR MAP NOT FOUND!"),H("GET DIR MAP: X: "+t+", Y:"+e+", R: "+i)),o}function H(t){M&&console.log(t)}function j(t){for(var e=!1,i=0;i<Y.length;i++)if(Y[i].spriteId===t.sprite){e=!0;break}return e}function U(t,e){var i=[],o=[];H(e),H("GETTING ADJACENT TILES"),o.push({x:e.x,y:e.y-1,dir:C}),o.push({x:e.x+1,y:e.y,dir:P}),o.push({x:e.x,y:e.y+1,dir:D}),o.push({x:e.x-1,y:e.y,dir:_});for(var r=0;r<o.length;r++){var n=t.get(o[r].x,o[r].y);null!==n&&(H("Adjacent Tile:"),H(n),j(n)&&i.push({dir:o[r].dir}))}return i}function W(t){for(var e=getMap(t),i=[],o=[],r=function(){for(var t=0,e=0;e<N.length;e++)if("Corner"===N[e].type){t=N[e].index;break}return t}(),n=0;n<N.length;n++)for(var s=e.find(N[n].index),a=0;a<s.length;a++){var l=s[a];N[n].index===r?o.push(l):i.push({tileX:l.x,tileY:l.y,type:N[n].type,tileSprite:l.sprite,tileData:l})}O.map=e,H("=== MAP DEFINITIONS ==="),H(JSON.stringify(i)),H("=======================");var c=function(t){var e=assets.mapDefs.mapDefs;H("GET MAP: "+t),H(e);for(var i=null,o=0;o<e.length;o++)if(e[o].name===t){i=e[o];break}return i}(t);c.electronLossThreshold&&(O.electronLossThreshold=c.electronLossThreshold),H("=== ADDITIONAL MAP DEF ==="),H(c),H("==========================");var p=[];for(n=0;n<c.components.length;n++){var u=c.components[n];if(u.tileData){var h={x:u.tileX,y:u.tileY},f={index:u.tileSprite,flipX:u.tileData.flipH,flipY:u.tileData.flipV,flipR:u.tileData.flipR},d=null;if("Direction"===u.type){H("NEW DIRECTION SWITCHER");var y=U(e,h);d=new S.default(h,f,u.direction,y)}else if("Bulb"===u.type)d=new A.default(h,f,u.bulb);else if("Battery"===u.type)d=new g.default(h,f,u.battery.charges,u.battery.pulseTime,u.battery.pulseSpeed);else if("AltSwitch"===u.type)d=new w.default(h,f,u.altSwitch);else if("Switch"===u.type)H("Add wire Switch"),d=new R.default(h,f,u.wireSwitch);else if("Diode"===u.type)H("Add diode"),d=new B.default(h,f);else if("Transistor"===u.type){H("Add transistor"),H("Added components:"),H(p),u.transistor.connections=[];for(n=0;n<p.length;n++)p[n].src.transistorId===u.transistor.transistorId&&u.transistor.connections.push(p[n].obj);d=new x.default(h,f,u.transistor)}p.push({src:u,obj:d})}else if("Label"===u.type)new E.default(u.position,u.text,u.colour);else if("Button"===u.type){var v={};u.btn_type?v.type=u.btn_type:(v.value=u.value,v.type="LVL");new m.default(u.tileRect,u.text,v,u.colours)}}for(n=0;n<o.length;n++)new b.default({x:o[n].x,y:o[n].y},G(o[n].flipH,o[n].flipV,o[n].flipR))}function $(t,e){return{x:t*u,y:e*u}}function z(t,e){I===t&&!e||(i.CURRENT_LVL=I=t,H("LOADING: "+t),i.em=O=new o.default,O.Initialise(),O.selector=new r.default(20),W(t))}a.onPress(function(t,e,i,o){var r=$(t,e);O.MouseClick(r.x,r.y,o.button)}),a.onMove(function(t,e,i,o){var r=$(t,e);O.MouseMove(r.x,r.y)}),i.update=function(){T||(paper(1),i.COLOURS=c=assets.colourMap,i.SFX=p=assets.soundMap,i.SOUND=v=new n.default(L,{speakerIndex:13,speakerOffIndex:14,speakerOnIndex:15}),z("title"),T=!0),O.Input(),O.Update(1/60),O.Render()}},{"./AltSwitch.js":81,"./Battery.js":82,"./Bulb.js":83,"./Button.js":84,"./Diode.js":86,"./DirectionSwitcher.js":87,"./EntityManager.js":90,"./Label.js":91,"./RailPoint.js":94,"./Selector.js":95,"./SoundSettings.js":96,"./Transistor.js":97,"./WireSwitch.js":99,p2:38,"pixelbox/pointerEvents":75}],101:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],102:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],103:[function(t,e,f){var a=/%[sdj%]/g;f.format=function(t){if(!A(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(l(arguments[i]));return e.join(" ")}i=1;for(var o=arguments,r=o.length,n=String(t).replace(a,function(t){if("%%"===t)return"%";if(r<=i)return t;switch(t){case"%s":return String(o[i++]);case"%d":return Number(o[i++]);case"%j":try{return JSON.stringify(o[i++])}catch(t){return"[Circular]"}default:return t}}),s=o[i];i<r;s=o[++i])b(s)||!c(s)?n+=" "+s:n+=" "+l(s);return n},f.deprecate=function(t,e){if(E(global.process))return function(){return f.deprecate(t,e).apply(this,arguments)};if(!0===process.noDeprecation)return t;var i=!1;return function(){if(!i){if(process.throwDeprecation)throw new Error(e);process.traceDeprecation?console.trace(e):console.error(e),i=!0}return t.apply(this,arguments)}};var o,r={};function l(t,e){var i={seen:[],stylize:s};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),m(e)?i.showHidden=e:e&&f._extend(i,e),E(i.showHidden)&&(i.showHidden=!1),E(i.depth)&&(i.depth=2),E(i.colors)&&(i.colors=!1),E(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=n),d(i,t,i.depth)}function n(t,e){var i=l.styles[e];return i?"["+l.colors[i][0]+"m"+t+"["+l.colors[i][1]+"m":t}function s(t,e){return t}function d(e,i,o){if(e.customInspect&&i&&B(i.inspect)&&i.inspect!==f.inspect&&(!i.constructor||i.constructor.prototype!==i)){var t=i.inspect(o,e);return A(t)||(t=d(e,t,o)),t}var r=function(t,e){if(E(e))return t.stylize("undefined","undefined");if(A(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(S(e))return t.stylize(""+e,"number");if(m(e))return t.stylize(""+e,"boolean");if(b(e))return t.stylize("null","null")}(e,i);if(r)return r;var n,s=Object.keys(i),a=(n={},s.forEach(function(t,e){n[t]=!0}),n);if(e.showHidden&&(s=Object.getOwnPropertyNames(i)),R(i)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return y(i);if(0===s.length){if(B(i)){var l=i.name?": "+i.name:"";return e.stylize("[Function"+l+"]","special")}if(w(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(x(i))return e.stylize(Date.prototype.toString.call(i),"date");if(R(i))return y(i)}var c,p="",u=!1,h=["{","}"];g(i)&&(u=!0,h=["[","]"]),B(i)&&(p=" [Function"+(i.name?": "+i.name:"")+"]");return w(i)&&(p=" "+RegExp.prototype.toString.call(i)),x(i)&&(p=" "+Date.prototype.toUTCString.call(i)),R(i)&&(p=" "+y(i)),0!==s.length||u&&0!=i.length?o<0?w(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),c=u?function(e,i,o,r,t){for(var n=[],s=0,a=i.length;s<a;++s)L(i,String(s))?n.push(v(e,i,o,r,String(s),!0)):n.push("");return t.forEach(function(t){t.match(/^\d+$/)||n.push(v(e,i,o,r,t,!0))}),n}(e,i,o,a,s):s.map(function(t){return v(e,i,o,a,t,u)}),e.seen.pop(),function(t,e,i){if(60<t.reduce(function(t,e){return 0<=e.indexOf("\n")&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(c,p,h)):h[0]+p+h[1]}function y(t){return"["+Error.prototype.toString.call(t)+"]"}function v(t,e,i,o,r,n){var s,a,l;if((l=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?a=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(a=t.stylize("[Setter]","special")),L(o,r)||(s="["+r+"]"),a||(t.seen.indexOf(l.value)<0?-1<(a=b(i)?d(t,l.value,null):d(t,l.value,i-1)).indexOf("\n")&&(a=n?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),E(s)){if(n&&r.match(/^\d+$/))return a;s=(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(s,"string"))}return s+": "+a}function g(t){return Array.isArray(t)}function m(t){return"boolean"==typeof t}function b(t){return null===t}function S(t){return"number"==typeof t}function A(t){return"string"==typeof t}function E(t){return void 0===t}function w(t){return c(t)&&"[object RegExp]"===i(t)}function c(t){return"object"==typeof t&&null!==t}function x(t){return c(t)&&"[object Date]"===i(t)}function R(t){return c(t)&&("[object Error]"===i(t)||t instanceof Error)}function B(t){return"function"==typeof t}function i(t){return Object.prototype.toString.call(t)}function p(t){return t<10?"0"+t.toString(10):t.toString(10)}f.debuglog=function(e){if(E(o)&&(o=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!r[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var i=process.pid;r[e]=function(){var t=f.format.apply(f,arguments);console.error("%s %d: %s",e,i,t)}}else r[e]=function(){};return r[e]},(f.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},f.isArray=g,f.isBoolean=m,f.isNull=b,f.isNullOrUndefined=function(t){return null==t},f.isNumber=S,f.isString=A,f.isSymbol=function(t){return"symbol"==typeof t},f.isUndefined=E,f.isRegExp=w,f.isObject=c,f.isDate=x,f.isError=R,f.isFunction=B,f.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},f.isBuffer=t("./support/isBuffer");var u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function L(t,e){return Object.prototype.hasOwnProperty.call(t,e)}f.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[p(t.getHours()),p(t.getMinutes()),p(t.getSeconds())].join(":"),[t.getDate(),u[t.getMonth()],e].join(" ")),f.format.apply(f,arguments))},f.inherits=t("inherits"),f._extend=function(t,e){if(!e||!c(e))return t;for(var i=Object.keys(e),o=i.length;o--;)t[i[o]]=e[i[o]];return t}},{"./support/isBuffer":102,inherits:101}],104:[function(d,t,e){"use strict";var i,o,u=d("."),r={dat:{palette:null,tilesheet:null,animations:{anims:[{name:"ELECTRON_TRAVEL_",frameTime:.08,frames:[{sprite:34,flipX:!1,flipY:!1,flipR:!1},{sprite:50,flipX:!1,flipY:!1,flipR:!1},{sprite:34,flipX:!1,flipY:!1,flipR:!0},{sprite:50,flipX:!1,flipY:!1,flipR:!0},{sprite:34,flipX:!1,flipY:!1,flipR:!1},{sprite:50,flipX:!0,flipY:!1,flipR:!0},{sprite:34,flipX:!1,flipY:!1,flipR:!0},{sprite:50,flipX:!0,flipY:!1,flipR:!1}]},{name:"ELECTRON_TRAVEL",frameTime:.12,frames:[{sprite:18,flipX:!1,flipY:!1,flipR:!1},{sprite:34,flipX:!1,flipY:!1,flipR:!1},{sprite:18,flipX:!1,flipY:!1,flipR:!1},{sprite:34,flipX:!1,flipY:!1,flipR:!0}]},{name:"CHARGED_ELECTRON_DESTROY_H",frameTime:.08,frames:[{sprite:18,flipX:!1,flipY:!1,flipR:!1},{sprite:34,flipX:!1,flipY:!1,flipR:!1},{sprite:66,flipX:!1,flipY:!1,flipR:!1},{sprite:66,flipX:!1,flipY:!1,flipR:!1},{sprite:18,flipX:!1,flipY:!1,flipR:!1},{sprite:34,flipX:!1,flipY:!1,flipR:!1},{sprite:82,flipX:!1,flipY:!1,flipR:!1},{sprite:98,flipX:!1,flipY:!1,flipR:!1},{sprite:114,flipX:!1,flipY:!1,flipR:!1}]},{name:"UNCHARGED_ELECTRON_DESTROY_H",frameTime:.12,frames:[{sprite:19,flipX:!1,flipY:!1,flipR:!1},{sprite:35,flipX:!1,flipY:!1,flipR:!1},{sprite:51,flipX:!1,flipY:!1,flipR:!1},{sprite:67,flipX:!1,flipY:!1,flipR:!1},{sprite:83,flipX:!1,flipY:!1,flipR:!1}]},{name:"CHARGED_ELECTRON_DESTROY_V",frameTime:.08,frames:[{sprite:18,flipX:!1,flipY:!1,flipR:!0},{sprite:34,flipX:!1,flipY:!1,flipR:!0},{sprite:66,flipX:!1,flipY:!1,flipR:!0},{sprite:66,flipX:!1,flipY:!1,flipR:!0},{sprite:18,flipX:!1,flipY:!1,flipR:!0},{sprite:34,flipX:!1,flipY:!1,flipR:!0},{sprite:82,flipX:!1,flipY:!1,flipR:!0},{sprite:98,flipX:!1,flipY:!1,flipR:!0},{sprite:114,flipX:!1,flipY:!1,flipR:!0}]},{name:"UNCHARGED_ELECTRON_DESTROY_V",frameTime:.12,frames:[{sprite:19,flipX:!1,flipY:!1,flipR:!0},{sprite:35,flipX:!1,flipY:!1,flipR:!0},{sprite:51,flipX:!1,flipY:!1,flipR:!0},{sprite:83,flipX:!1,flipY:!1,flipR:!0}]},{name:"TRANSISTOR_ANIM",frameTime:.16,frames:[{corner:56,side:72},{corner:57,side:73},{corner:58,side:74},{corner:59,side:75},{corner:56,side:72},{corner:57,side:73}]}]},bleeper:{_type:"Bleeper program",v:1,s:[{n:"changeArDir",i:[26,0,127,0],s:")W*)[*)`*)`()`&"},{n:"invArrDir",i:[26,0,127,0],s:")G()A()=%);$):$"},{n:"bulbOn_A",i:[26,0,127,0],s:"'L('Y('`('e('h&'h&'h%"},{n:"bulbOff_A",i:[26,0,127,0],s:"'h('e('`('Z('K&'K&'K%"},{n:"selectArr",i:[20,0,127,0],s:")Z()Z()U')U'"},{n:"hoverArr",i:[20,0,127,0],s:")[()[("},{n:"bulbOn_B",i:[29,0,127,0],s:"&X)&X)&X)&l)&l)&l&&l%"},{n:"bulbOff_B",i:[30,0,127,0],s:"&l)&l)&l)&X)&X)&X&&X&"},{n:"Victory",i:[53,0,127,0],s:"(a*(a*(a*(a*(Y*(Y*(a*(a*(a*(a*(f*(f*(f*(f*(j*(j*(j*(j'(j&"},{n:"Defeat",i:[53,0,127,0],s:"(I)(I)(I)(I)(H)(H)(H)(H)(G)(G)(G)(G)(F)(F)(F)(F)(F)(F)(F((F&"},{n:"electColl",i:[20,0,127,0],s:"*@)*>)*<)*:(*7(*5(*0'*-%"},{n:"chargeSpent",i:[20,0,127,0],s:"(b'(Y'(T'(L'(B'(=&(8&(5&(4&"},{n:"transistor",i:[44,0,127,0],s:"&H'&H'&P'&P'&^'&^'&P'&P'"},{n:"electLost",i:[37,0,127,0],s:"(B*(B*(B*(B*(;*(;*(;)(;&"},{n:"chargedUp",i:[20,0,127,0],s:"(F'(G'(J'(Q'(V&([&(a&(d&(f&(j&(k&"},{n:"transistorB",i:[20,0,127,0],s:")H&)H&)H#)H#)H#)H#)H%)H%)H#)H#)H$)H$)H#)H#)H#)H#)H$)H$)H#)H#)H$)H$)H#)H#)H#)H#)H$)H$)H#)H#)H$)H$"}]},colourMap:{barBg:4,chargeBarFg:15,decayBarFg:9},mapDefs:{mapDefs:[{name:"map",components:[{tileX:7,tileY:0,type:"Battery",tileSprite:0,tileData:{x:7,y:0,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:4,pulseTime:2,pulseSpeed:60}},{tileX:0,tileY:7,type:"Direction",tileSprite:6,isControllable:!0,tileData:{x:0,y:7,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:13,tileY:7,type:"Direction",tileSprite:6,isControllable:!0,tileData:{x:13,y:7,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:7,tileY:7,type:"Bulb",tileSprite:16,tileData:{x:7,y:7,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17}}]},{name:"title",components:[{type:"Button",text:"Toggle Sound",btn_type:"SFX_TOGGLE",tileRect:{x:.25,y:1.375,w:3.5,h:.75},colours:{shadow:13,top:14,hover:15},colour:4},{type:"Label",text:"Game Speed:",position:{tileX:.25,tileY:2.5},colour:4},{type:"Button",text:"Normal",btn_type:"SPEED_TOGGLE",tileRect:{x:.25,y:3,w:3.5,h:.75},colours:{shadow:13,top:14,hover:15},colour:4},{type:"Label",text:"Game Size:",position:{tileX:.25,tileY:4.125},colour:4},{type:"Button",text:"Large",btn_type:"SIZE_TOGGLE",tileRect:{x:.25,y:4.625,w:3.5,h:.75},colours:{shadow:13,top:14,hover:15},colour:4},{type:"Label",text:"Circuit Game!",position:{tileX:6.3,tileY:2.5},colour:4},{type:"Label",text:"Stuck in a Loop",position:{tileX:6,tileY:3.2},colour:4},{type:"Button",text:"Level 1",value:"map",tileRect:{x:1.25,y:6,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 2",value:"alternatorLevel",tileRect:{x:1.25,y:7.5,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 3",value:"decayTest",tileRect:{x:1.25,y:9,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 4",value:"transistorTest",tileRect:{x:1.25,y:10.5,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 5",value:"switchTest",tileRect:{x:1.25,y:12,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 6",value:"doubleSwitch",tileRect:{x:1.25,y:13.5,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 7",value:"parallel",tileRect:{x:5,y:6,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 8",value:"transistorSwitchedAlt",tileRect:{x:5,y:7.5,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 9",value:"splitterAlternatorTest",tileRect:{x:5,y:9,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 10",value:"diode1",tileRect:{x:5,y:10.5,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 11",value:"diode2",tileRect:{x:5,y:12,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Button",text:"Level 12",value:"synchronise",tileRect:{x:5,y:13.5,w:3,h:1},colours:{shadow:13,top:14,hover:15}},{type:"Label",text:"L-Click:",position:{tileX:9.25,tileY:6},colour:4},{type:"Label",text:"Select Arrow",position:{tileX:9.5,tileY:6.5},colour:4},{type:"Label",text:"Turn Arrow Clockwise",position:{tileX:9.5,tileY:7},colour:4},{type:"Label",text:"R-Click:",position:{tileX:9.25,tileY:8},colour:4},{type:"Label",text:"Turn Arrow Anti-Clockwise",position:{tileX:9.5,tileY:8.5},colour:4},{type:"Label",text:"Arrow Keys / WASD:",position:{tileX:9.25,tileY:9.5},colour:4},{type:"Label",text:"Change Arrow Direction",position:{tileX:9.5,tileY:10},colour:4},{type:"Label",text:"Goal:",position:{tileX:9.25,tileY:11},colour:4},{type:"Label",text:"- Point the electrons ",position:{tileX:9.5,tileY:11.5},colour:4},{type:"Label",text:"  in the right direction",position:{tileX:9.5,tileY:12},colour:4},{type:"Label",text:"- Light all the bulbs in ",position:{tileX:9.5,tileY:12.5},colour:4},{type:"Label",text:"  each level",position:{tileX:9.5,tileY:13},colour:4},{type:"Label",text:"Made with:",position:{tileX:10.75,tileY:14},colour:4},{type:"Label",text:"Cstoquer's PixelBox",position:{tileX:11.25,tileY:14.5},colour:4},{type:"Label",text:"schteppe's p2.js",position:{tileX:11.25,tileY:15},colour:4},{type:"Label",text:"Game by:",position:{tileX:10.75,tileY:.25},colour:4},{type:"Label",text:"Josh Haxell +",position:{tileX:11.25,tileY:.75},colour:4},{type:"Label",text:"Sammy El-Bahrawy",position:{tileX:11.25,tileY:1.25},colour:4},{tileX:7,tileY:4,type:"Battery",tileSprite:0,tileData:{x:6,y:4,sprite:0,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:4,pulseTime:2,pulseSpeed:60}},{tileX:7,tileY:1,type:"Bulb",tileSprite:16,tileData:{x:7,y:1,sprite:16,flipH:!0,flipV:!1,flipR:!0,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17}}]},{name:"alternatorLevel",components:[{tileX:2,tileY:1,type:"Battery",tileSprite:0,tileData:{x:2,y:1,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:4,pulseTime:2,pulseSpeed:60}},{tileX:0,tileY:4,type:"Direction",tileSprite:6,tileData:{x:0,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:6,tileY:1,type:"Direction",tileSprite:6,tileData:{x:6,y:1,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:6,tileY:4,type:"Direction",tileSprite:6,tileData:{x:6,y:4,sprite:5,flipH:!1,flipV:!0,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:10,tileY:4,type:"AltSwitch",tileSprite:7,tileData:{x:10,y:4,sprite:5,flipH:!1,flipV:!0,flipR:!1,flagA:!1,flagB:!1},altSwitch:{dir:"LD",alt:"DL",chargesRequired:3,chargeDecayTime:8,decayWhenFull:!0,chargeBarDir:"RIGHT",decayBarDir:"RIGHT",chargeResetsDecay:!1,decayToZero:!0,overrideDecayColour:7}},{tileX:3,tileY:6,type:"Bulb",tileSprite:16,tileData:{x:3,y:6,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17}},{tileX:1,tileY:6,type:"Diode",tileSprite:33,tileData:{x:1,y:6,sprite:33,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1}},{tileX:4,tileY:1,type:"Diode",tileSprite:33,tileData:{x:4,y:1,sprite:33,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1}}]},{name:"decayTest",components:[{tileX:5,tileY:1,type:"Battery",tileSprite:0,tileData:{x:5,y:1,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:1,pulseTime:2,pulseSpeed:60}},{tileX:6,tileY:3,type:"Direction",tileSprite:6,tileData:{x:6,y:3,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:9,tileY:1,type:"Direction",tileSprite:6,tileData:{x:9,y:1,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"RIGHT"}},{tileX:7,tileY:1,type:"Bulb",tileSprite:16,tileData:{x:7,y:1,sprite:16,flipH:!0,flipV:!0,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:3,chargedSprite:17,chargeDecayTime:5}}]},{name:"transistorTest",components:[{tileX:3,tileY:1,type:"Battery",tileSprite:0,tileData:{x:3,y:1,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:3,pulseTime:3,pulseSpeed:50}},{tileX:5,tileY:1,type:"Direction",tileSprite:6,tileData:{x:5,y:1,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"RIGHT"}},{tileX:5,tileY:5,type:"Direction",tileSprite:6,tileData:{x:5,y:5,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:7,tileY:1,type:"Direction",tileSprite:6,tileData:{x:7,y:1,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:7,tileY:5,type:"Direction",tileSprite:6,tileData:{x:7,y:5,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:5,tileY:3,type:"Bulb",tileSprite:16,tileData:{x:5,y:3,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:3,chargedSprite:17,chargeDecayTime:5,chargeBarDir:"LEFT",decayBarDir:"LEFT"}},{tileX:9,tileY:1,type:"Bulb",tileSprite:16,tileData:{x:9,y:1,sprite:16,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},bulb:{chargesRequired:1,chargedSprite:17,chargeDecayTime:5},transistorId:0},{tileX:7,tileY:3,type:"Transistor",tileSprite:32,tileData:{x:7,y:3,sprite:32,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistor:{transistorId:0,chargesRequired:3,chargeBarDir:"LEFT"}}]},{name:"switchTest",components:[{tileX:4,tileY:1,type:"Battery",tileSprite:0,tileData:{x:4,y:1,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:3,pulseTime:3,pulseSpeed:50}},{tileX:1,tileY:3,type:"Direction",tileSprite:6,tileData:{x:1,y:3,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:1,tileY:6,type:"Direction",tileSprite:6,tileData:{x:1,y:6,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:8,tileY:3,type:"Direction",tileSprite:6,tileData:{x:8,y:3,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:8,tileY:6,type:"Direction",tileSprite:6,tileData:{x:8,y:6,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:5,tileY:3,type:"Switch",tileSprite:39,tileData:{x:5,y:3,sprite:23,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},transistorId:0,wireSwitch:{chargesRequired:1}},{tileX:3,tileY:3,type:"Bulb",tileSprite:16,tileData:{x:3,y:3,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17,chargeBarDir:"UP"}},{tileX:5,tileY:9,type:"Transistor",tileSprite:32,tileData:{x:5,y:9,sprite:32,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistor:{transistorId:0,chargesRequired:3,chargeBarDir:"DOWN"}}]},{name:"doubleSwitch",components:[{tileX:7,tileY:1,type:"Battery",tileSprite:0,tileData:{x:7,y:1,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:3,pulseTime:3,pulseSpeed:50}},{tileX:2,tileY:2,type:"Direction",tileSprite:6,tileData:{x:2,y:2,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:2,tileY:4,type:"Direction",tileSprite:6,tileData:{x:2,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:2,tileY:6,type:"Direction",tileSprite:6,tileData:{x:2,y:6,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:12,tileY:2,type:"Direction",tileSprite:6,tileData:{x:12,y:2,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:12,tileY:4,type:"Direction",tileSprite:6,tileData:{x:12,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:12,tileY:6,type:"Direction",tileSprite:6,tileData:{x:12,y:6,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:6,tileY:4,type:"Bulb",tileSprite:16,tileData:{x:6,y:4,sprite:16,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17,chargeBarDir:"UP",chargeDecayTime:2,decayWhenFull:!0,overrideDecayColour:7}},{tileX:8,tileY:4,type:"Bulb",tileSprite:16,tileData:{x:8,y:4,sprite:16,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17,chargeBarDir:"UP",chargeDecayTime:2}},{tileX:4,tileY:4,type:"Switch",tileSprite:39,tileData:{x:4,y:4,sprite:23,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},transistorId:0,wireSwitch:{chargesRequired:1}},{tileX:10,tileY:4,type:"Switch",tileSprite:39,tileData:{x:10,y:4,sprite:23,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},transistorId:1,wireSwitch:{chargesRequired:1}},{tileX:0,tileY:4,type:"Transistor",tileSprite:32,tileData:{x:0,y:4,sprite:32,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistor:{transistorId:0,chargesRequired:3,chargeBarDir:"UP"}},{tileX:14,tileY:4,type:"Transistor",tileSprite:32,tileData:{x:14,y:4,sprite:32,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistor:{transistorId:1,chargesRequired:3,chargeBarDir:"DOWN"}}]},{name:"parallel",components:[{tileX:2,tileY:1,type:"Battery",tileSprite:0,tileData:{x:2,y:1,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:3,pulseTime:3,pulseSpeed:50}},{tileX:7,tileY:1,type:"Battery",tileSprite:0,tileData:{x:7,y:1,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:3,pulseTime:3,pulseSpeed:50}},{tileX:12,tileY:1,type:"Battery",tileSprite:0,tileData:{x:12,y:1,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:3,pulseTime:3,pulseSpeed:50}},{tileX:1,tileY:4,type:"Direction",tileSprite:6,tileData:{x:1,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:3,tileY:4,type:"Direction",tileSprite:6,tileData:{x:3,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:5,tileY:7,type:"Direction",tileSprite:6,tileData:{x:5,y:7,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:9,tileY:7,type:"Direction",tileSprite:6,tileData:{x:9,y:7,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:11,tileY:4,type:"Direction",tileSprite:6,tileData:{x:11,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:13,tileY:4,type:"Direction",tileSprite:6,tileData:{x:13,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:7,tileY:13,type:"Bulb",tileSprite:16,tileData:{x:7,y:13,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17,chargeBarDir:"UP"}},{tileX:5,tileY:10,type:"Switch",tileSprite:39,tileData:{x:5,y:10,sprite:23,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistorId:0,wireSwitch:{chargesRequired:1}},{tileX:9,tileY:10,type:"Switch",tileSprite:39,tileData:{x:9,y:10,sprite:23,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistorId:1,wireSwitch:{chargesRequired:1}},{tileX:2,tileY:7,type:"Transistor",tileSprite:32,tileData:{x:2,y:7,sprite:32,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistor:{transistorId:0,chargesRequired:3,chargeBarDir:"DOWN"}},{tileX:12,tileY:7,type:"Transistor",tileSprite:32,tileData:{x:12,y:7,sprite:32,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistor:{transistorId:1,chargesRequired:3,chargeBarDir:"DOWN"}}]},{name:"transistorSwitchedAlt",components:[{tileX:3,tileY:6,type:"Battery",tileSprite:0,tileData:{x:3,y:6,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:6,pulseTime:1,pulseSpeed:60}},{tileX:7,tileY:12,type:"Battery",tileSprite:0,tileData:{x:7,y:12,sprite:0,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:0,pulseTime:3,pulseSpeed:50}},{tileX:1,tileY:6,type:"Direction",tileSprite:6,tileData:{x:1,y:6,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"RIGHT"}},{tileX:1,tileY:10,type:"Direction",tileSprite:6,tileData:{x:1,y:10,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:5,tileY:6,type:"Direction",tileSprite:6,tileData:{x:5,y:6,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"RIGHT"}},{tileX:7,tileY:6,type:"Direction",tileSprite:6,tileData:{x:7,y:6,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"RIGHT"}},{tileX:9,tileY:6,type:"Direction",tileSprite:6,tileData:{x:9,y:6,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:9,tileY:10,type:"AltSwitch",tileSprite:7,tileData:{x:9,y:10,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},altSwitch:{dir:"LD",alt:"DL",chargesRequired:2,chargeDecayTime:8,decayWhenFull:!0,chargeBarDir:"RIGHT",decayBarDir:"RIGHT",chargeResetsDecay:!1,decayToZero:!0,overrideDecayColour:7},transistorId:1},{tileX:4,tileY:12,type:"Bulb",tileSprite:16,tileData:{x:4,y:12,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17,chargeBarDir:"UP"}},{tileX:11,tileY:6,type:"Switch",tileSprite:39,tileData:{x:11,y:6,sprite:23,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},transistorId:0,wireSwitch:{chargesRequired:1}},{tileX:2,tileY:12,type:"Diode",tileSprite:33,tileData:{x:2,y:12,sprite:33,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1}},{tileX:9,tileY:8,type:"Diode",tileSprite:33,tileData:{x:9,y:8,sprite:33,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1}},{tileX:6,tileY:4,type:"Transistor",tileSprite:32,tileData:{x:6,y:4,sprite:32,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistor:{transistorId:0,chargesRequired:3,chargeBarDir:"DOWN"}},{tileX:13,tileY:6,type:"Transistor",tileSprite:32,tileData:{x:13,y:6,sprite:32,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistor:{transistorId:1,chargesRequired:3,chargeBarDir:"DOWN"}}]},{name:"diode2",components:[{tileX:3,tileY:0,type:"Battery",tileSprite:0,tileData:{x:3,y:0,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:5,pulseTime:1,pulseSpeed:50}},{tileX:6,tileY:0,type:"Direction",tileSprite:6,tileData:{x:6,y:0,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:6,tileY:4,type:"Direction",tileSprite:6,tileData:{x:6,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:6,tileY:8,type:"Direction",tileSprite:6,tileData:{x:6,y:8,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:10,tileY:0,type:"Direction",tileSprite:6,tileData:{x:10,y:0,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"RIGHT"}},{tileX:10,tileY:8,type:"Direction",tileSprite:6,tileData:{x:10,y:8,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:14,tileY:0,type:"Direction",tileSprite:6,tileData:{x:14,y:0,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:14,tileY:4,type:"Direction",tileSprite:6,tileData:{x:14,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:14,tileY:8,type:"Direction",tileSprite:6,tileData:{x:14,y:8,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:10,tileY:4,type:"Bulb",tileSprite:16,tileData:{x:10,y:4,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17,chargeBarDir:"UP"}},{tileX:8,tileY:4,type:"Diode",tileSprite:33,tileData:{x:8,y:4,sprite:33,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1}},{tileX:10,tileY:2,type:"Diode",tileSprite:33,tileData:{x:10,y:2,sprite:33,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1}},{tileX:10,tileY:6,type:"Diode",tileSprite:33,tileData:{x:10,y:6,sprite:33,flipH:!1,flipV:!0,flipR:!0,flagA:!1,flagB:!1}},{tileX:12,tileY:4,type:"Diode",tileSprite:33,tileData:{x:12,y:4,sprite:33,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1}}]},{name:"diode1",components:[{tileX:3,tileY:0,type:"Battery",tileSprite:0,tileData:{x:3,y:0,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:5,pulseTime:1,pulseSpeed:50}},{tileX:0,tileY:3,type:"Direction",tileSprite:6,tileData:{x:0,y:3,sprite:5,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!1,dir:"UP"}},{tileX:5,tileY:7,type:"Direction",tileSprite:6,tileData:{x:5,y:7,sprite:5,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!1,dir:"LEFT"}},{tileX:7,tileY:0,type:"Direction",tileSprite:6,tileData:{x:7,y:0,sprite:5,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:9,tileY:5,type:"Direction",tileSprite:6,tileData:{x:9,y:5,sprite:5,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:2,tileY:7,type:"Bulb",tileSprite:16,tileData:{x:2,y:7,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17,chargeBarDir:"UP"}},{tileX:2,tileY:3,type:"Diode",tileSprite:33,tileData:{x:2,y:3,sprite:33,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1}},{tileX:5,tileY:3,type:"Diode",tileSprite:33,tileData:{x:5,y:3,sprite:33,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1}},{tileX:7,tileY:5,type:"Diode",tileSprite:33,tileData:{x:7,y:5,sprite:33,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1}},{tileX:11,tileY:5,type:"Diode",tileSprite:33,tileData:{x:11,y:5,sprite:33,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1}}]},{name:"synchronise",components:[{tileX:2,tileY:0,type:"Battery",tileSprite:0,tileData:{x:2,y:0,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:6,pulseTime:.75,pulseSpeed:50}},{tileX:8,tileY:0,type:"Battery",tileSprite:0,tileData:{x:8,y:0,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:1,pulseTime:1,pulseSpeed:250}},{tileX:6,tileY:3,type:"Direction",tileSprite:6,tileData:{x:6,y:3,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!1,dir:"UP"}},{tileX:10,tileY:3,type:"Direction",tileSprite:6,tileData:{x:10,y:3,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:6,tileY:5,type:"Bulb",tileSprite:16,tileData:{x:6,y:5,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:1,chargedSprite:17,chargeBarDir:"RIGHT"}},{tileX:8,tileY:7,type:"Switch",tileSprite:39,tileData:{x:8,y:7,sprite:23,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},transistorId:0,wireSwitch:{chargesRequired:1}},{tileX:4,tileY:12,type:"Transistor",tileSprite:32,tileData:{x:4,y:12,sprite:32,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},transistor:{transistorId:0,chargesRequired:3,chargeBarDir:"LEFT"}}]},{name:"splitterAlternatorTest",components:[{tileX:6,tileY:1,type:"Battery",tileSprite:0,tileData:{x:6,y:1,sprite:0,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},battery:{charges:9,pulseTime:1.5,pulseSpeed:50}},{tileX:3,tileY:1,type:"Direction",tileSprite:6,tileData:{x:3,y:1,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"RIGHT"}},{tileX:3,tileY:10,type:"Direction",tileSprite:6,tileData:{x:3,y:10,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:3,tileY:12,type:"Direction",tileSprite:6,tileData:{x:3,y:12,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:6,tileY:7,type:"Direction",tileSprite:6,tileData:{x:6,y:7,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:6,tileY:10,type:"Direction",tileSprite:6,tileData:{x:6,y:10,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:6,tileY:12,type:"Direction",tileSprite:6,tileData:{x:6,y:12,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:6,tileY:14,type:"Direction",tileSprite:6,tileData:{x:6,y:14,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:10,tileY:1,type:"Direction",tileSprite:6,tileData:{x:10,y:1,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:10,tileY:4,type:"Direction",tileSprite:6,tileData:{x:10,y:4,sprite:5,flipH:!0,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"DOWN"}},{tileX:10,tileY:10,type:"Direction",tileSprite:6,tileData:{x:10,y:10,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:10,tileY:12,type:"Direction",tileSprite:6,tileData:{x:10,y:12,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:10,tileY:14,type:"Direction",tileSprite:6,tileData:{x:10,y:14,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:13,tileY:1,type:"Direction",tileSprite:6,tileData:{x:13,y:1,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:13,tileY:4,type:"Direction",tileSprite:6,tileData:{x:13,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"RIGHT"}},{tileX:13,tileY:10,type:"Direction",tileSprite:6,tileData:{x:13,y:10,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:13,tileY:12,type:"Direction",tileSprite:6,tileData:{x:13,y:12,sprite:5,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"LEFT"}},{tileX:15,tileY:4,type:"Direction",tileSprite:6,tileData:{x:15,y:4,sprite:5,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},direction:{isControllable:!0,dir:"UP"}},{tileX:3,tileY:7,type:"AltSwitch",tileSprite:8,tileData:{x:3,y:7,sprite:9,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},altSwitch:{dir:"UD",alt:"DU",chargesRequired:1,chargeDecayTime:20,decayWhenFull:!0,chargeBarDir:"RIGHT",decayBarDir:"RIGHT",chargeResetsDecay:!1,decayToZero:!0,overrideDecayColour:7}},{tileX:10,tileY:7,type:"AltSwitch",tileSprite:8,tileData:{x:10,y:7,sprite:9,flipH:!1,flipV:!1,flipR:!0,flagA:!1,flagB:!1},altSwitch:{dir:"RL",alt:"LR",chargesRequired:1,chargeDecayTime:20,decayWhenFull:!0,chargeBarDir:"RIGHT",decayBarDir:"RIGHT",chargeResetsDecay:!1,decayToZero:!0,overrideDecayColour:7}},{tileX:13,tileY:7,type:"AltSwitch",tileSprite:8,tileData:{x:13,y:7,sprite:9,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},altSwitch:{dir:"UD",alt:"DU",chargesRequired:1,chargeDecayTime:20,decayWhenFull:!0,chargeBarDir:"RIGHT",decayBarDir:"RIGHT",chargeResetsDecay:!1,decayToZero:!0,overrideDecayColour:7}},{tileX:8,tileY:14,type:"Bulb",tileSprite:16,tileData:{x:8,y:14,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17,chargeBarDir:"UP"}},{tileX:12,tileY:14,type:"Bulb",tileSprite:16,tileData:{x:12,y:14,sprite:16,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1},bulb:{chargesRequired:5,chargedSprite:17,chargeBarDir:"UP"}},{tileX:12,tileY:1,type:"Diode",tileSprite:33,tileData:{x:12,y:1,sprite:33,flipH:!1,flipV:!1,flipR:!1,flagA:!1,flagB:!1}}]}]},maps:{_type:"maps",maps:[{w:16,h:16,name:"map",sheet:"tilesheet",data:"%l#$|0###$|/#%!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,#(#$|0#3#$|/#(!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,0l!!|60l!!|,+=#$|6(T!!|<"},{w:16,h:16,name:"title",sheet:"tilesheet",data:"!!|>%l#$|,0{#$|,#%!!|3~%!!|/~%!!|3~%!!|/~%!!|3+=#$|,%j#$|,~&!!|t$F$G|~'/!!|4)v)w|~,_!!}#"},{w:16,h:16,name:"alternatorLevel",sheet:"",data:"!!|:%l%k###$&-#$#(%k|-#%!!|/~%!!|/~%!!|-~%!!|/~%!!|/~%!!|-~%!!|/#(#$|/(W(S|-#,!!|/~%!!|3~%!!|/+=#D#$#3#$|~(S|,(T!!}c"},{w:16,h:16,name:"decayTest",sheet:"tilesheet",data:"!!|>%l##+<+K+<#(#%!!|3~%!!|~~%|,!!|3+=+<#(#$|,~&~%!!|5~%!!|-~%!!|5~%!!|-~%!!|5+=+<(S|,(T!!}c"},{w:16,h:16,name:"transistorTest",sheet:"",data:"!!|;6>#$###$#(#$#(!!~4!!|1~%!!|-~%!!~%!!~9!!|1~%!!|-#3!!#C#8(i!!|1~%!!|-~%!!~%!!|3+=#$|-#(#$#(!!}v"},{w:16,h:16,name:"switchTest",sheet:"tilesheet",data:"!!|;%l#$|,###$|-#%!!|2~%!!|0~%!!|2#(#$#3#$~;#$|,~)!!|2~%!!|-~9!!|,~%!!|2~%!!|-~9!!|,~%!!|2~)#$|-#;#$|,~)!!|2~%!!|-~9!!|,~%!!|2~%!!|-~9!!|,~%!!|2+=#$|-#C#$|,(T!!}4"},{w:16,h:16,name:"doubleSwitch",sheet:"",data:"!!|<%l#$|~###$|~#%!!|-%l#$~)!!|3#(#$#%!!~%%!1%#8#9!!|1~%!!~%!!&,~:~)#$~;#$~4#$~4#$~;#$#(%!&,!!~%!!~%!!|11##8~<~:~%!!+=#$~)!!|3#(#$~&!!|-+=#$|3(T!!}P"},{w:16,h:16,name:"parallel",sheet:"tilesheet",data:"!!|;%l###$#%%l#$###$#%!!%l###$#%!!|,~%!!|,~%|,!!|-~%!!~%!!|,~%!!|,~%!!|,~%|,!!|-~%!!~%!!|,~%!!|,~)#$~)~&~%!!|-~%!!#(#$#(~&!!|,~%!!~%!!~%!!|-~%!!~%!!~%!!|-~%!!~%!!~%!!|-~%!!~%!!~%!!|-0m#C~&!!#(#$|-#(!!0m#C~&!!|~~9!!|,~%!!|-~%!!|,~9!!|/~9!!|,~%!!|-~%!!|,~9!!|/1##8|,#:!!|-#:#8|,~:!!|2~%!!|-~%!!|5~%!!|-~%!!|50m#$#3#$~&!!|P"},{w:16,h:16,name:"transistorSwitchedAlt",sheet:"tilesheet",data:"!!|[%l#$|1#%!!|1~%!!|-%l&,#%!!0m#$|/#%!!~%!!|-~%+Q~<#8|-#9!!|-~%!!~)#$###$#(#$#(#$#(#$~;#$#C#$(T!!~%!!|1~%!!|-~9!!|-~%!!|1~E!!|-~9!!|-~%!!|1~%!!|-~9!!|-#(#$|1#,#8|-(i!!|-~%!!|1~%!!|1+=#D#$#3#$|,%j#$~&!!|a"},{w:16,h:16,name:"diode2",sheet:"",data:"%l#$|,###$|,#(#$|-#(#$|-#(!!~%!!|/~%!!|-~%!!|-~%!!~%!!|/~%!!|-~E!!|-~%!!~%!!|/~%!!|-~%!!|-~%!!~%!!|/#(#$#D#$#3#$#D#$#(!!~%!!|/~%!!|-~%!!|-~%!!~%!!|/~%!!|-3u!!|-~%!!~%!!|/~%!!|-~%!!|-~%!!+=#$|/#(#$|-#(#$|-#(!!}>"},{w:16,h:16,name:"diode1",sheet:"",data:"%l#$|,###$|-%o#$#%!!|0~%!!|0~%!!~%!!|0~%!!|0~%!!~%!!|0%o#$&-#$|,#D#$(T!!~%!!|0~%!!|2~%!!|0~%!!|~%l#$&-#$%o#$&-#$#%!!|,~%!!|~~%!!|1~%!!|,+=#$#3#$|,%o#$|1(T!!}O"},{w:16,h:16,name:"synchronise",sheet:"",data:"!!%l###$#%!!%l#$###$#%!!|0~%!!|,~%!!~%!!|-~%!!|0~%!!|,~%!!~%!!|-~%!!|0~%!!|,~%!!#(#$|-#(!!|0~%!!|,~%!!~%!!|-~%!!|0~%!!|,~%!!#3!!|-~%!!|0~%!!|,~%!!~%!!|-~%!!|0~%!!|,~%!!+=#$~;#$(T!!|0~%!!|,~%!!|-~9!!|2~%!!|,~%!!|-~9!!|2~%!!|,~%!!|-~9!!|2~%!!|,~%!!|-~9!!|2~%!!|,#C#8|-(i!!|2~%!!|,~%!!|6+=#$|,(T!!|E"},{w:16,h:16,name:"splitterAlternatorTest",sheet:"",data:"!!|;%l#$#(#$&-###$|-#(#$#D#(#$#%!!~%!!~%!!|0~%!!|,~%!!~%!!~%!!~%!!|0~%!!|,~%!!~%!!~%!!~%!!|,%l#$|-%o#$|,~)#$#(!!~%!!~%!!|,~%!!|-~%!!|,~%!!|-~%!!~%!!|,~%!!|-~%!!|,~%!!|-~%!!~-#$|,#(#$|-~-#$|,#,!!|-~%!!~%!!|3~%!!|-~%!!~%!!|3~%!!|-~%!!#(#$|,#(#$|-~)#$|,~)!!|-~%!!~%!!|,~%!!|-~%!!|,~%!!|-+=#$#(#$|,#(#$|-~)#$|,~)!!|/~%!!|,~%!!|-~%!!|,~%!!|/+=#$|,#(#$#3#$#(#$#3(T!!|<"}]},soundMap:{arrowChange:"changeArDir",arrowDirectionInvalid:"invArrDir",bulbOn:"bulbOn_A",bulbOff:"bulbOff_A",selectArrow:"selectArr",hoverArrow:"hoverArr",victory:"Victory",defeat:"Defeat",electronCollision:"electColl",electronLost:"electLost",electronCharged:"chargedUp",chargeSpent:"chargeSpent",transistor:"transistorB"}},root:"assets/",img:["palette.png","tilesheet.png"],snd:[],settings:{name:"LD47",version:"2.0.2",appid:"NcimdFsF2f2kAzBq",screen:{fullscreen:!1,resizable:!0,keepAspectRatio:!1,width:256,height:256,pixelSize:{width:4,height:4}},tileSize:{width:16,height:16},palette:{name:"db16",file:"palette",colors:["#140c1c","#deeed6","#d2aa99","#346524","#4e4a4e","#757161","#8595a1","#6daa2c","#854c30","#d04648","#d27d2c","#dad45e","#442434","#30346d","#597dce","#6dc2ca"]},controls:{up:38,down:40,left:37,right:39,up_alt:87,down_alt:83,left_alt:65,right_alt:68,esc:27,reset:82,space:32},touchEvent:{multiTouch:!1,disableContextMenu:!0,hideMousePointer:!1},gamepad:{analogToDpad:!0,deadZone:.5},loader:{colors:["#140C1C","#DEEED6"],custom:""}}},y=u.settings=r.settings,n=d("./assetLoader");function s(){i.resume(),document.body.removeEventListener("mousedown",s),document.body.removeEventListener("touchstart",s)}u.inherits=d("./inherits"),u.setFullScreen=function(){},i=null,o=window.AudioContext||window.webkitAudioContext,window.AudioContext=window.webkitAudioContext=function(){return i||(i=new o,document.body.addEventListener("mousedown",s),document.body.addEventListener("touchstart",s),i)};var a=d("audio-manager"),l=u.audioManager=new a(["sfx"]);l.settings.audioPath="audio/",l.settings.defaultFade=.3,l.init(),l.setVolume("sfx",1),u.sfx=function(t,e,i,o){l.playSound("sfx",t,e,i,o)},u.music=function(t,e,i,o){t?l.playLoopSound("sfx",t,e,0,0,i,o):l.stopLoopSound("sfx")};var c=u.btn={},p=u.btnp={},h=u.btnr={},f={},v=[],g=0;function m(){for(var t=0;t<g;t++)p[v[t]]=!1,h[v[t]]=!1}function b(t,e){var i=f[t];i&&(e&&!c[i]&&(p[i]=!0),!e&&c[i]&&(h[i]=!0),c[i]=e)}!function(){var t=y.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var e in t)f[t[e]]=e,c[e]=!1,p[e]=!1,h[e]=!1,v.push(e);g=v.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),t.repeat||b(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),b(t.keyCode,!1)}),u.chr$=function(t){return String.fromCharCode(t)},u.clamp=function(t,e,i){return Math.max(e,Math.min(i,t))},u.random=function(t,e){return void 0===e?~~(t*Math.random()):~~(t+Math.random()*(e-t))};var S=d("./Texture"),A=d("./TileMap");d("./Texture/canvas2D"),d("./Texture/textCanvas2D");var E=y.tileSize.width,w=y.tileSize.height;S.setTileSize(E,w),A.setTileSize(E,w),u.texture=function(t){var e=new S(t.width,t.height);return e.clear().draw(t,0,0),e},u.tilesheet=function(t){return S.prototype.setGlobalTilesheet(t)};var x=function(){var t=y.screen,l=t.width,c=t.height,p=t.pixelSize,e=u.$screen=new S(l,c),i=e.canvas,o=i.style;if(document.body.appendChild(i),t.fullscreen)if(t.keepAspectRatio){var r=function(){var t=window.innerWidth,e=window.innerHeight,i=l*p.width,o=c*p.height,r=Math.min(t/i,e/o),n=i*r,s=o*r,a=u.$screen.canvas.style;a.width=n+"px",a.height=s+"px",a.left=(t-n)/2+"px",a.top=(e-s)/2+"px"};addEventListener("resize",r),r()}else o.width=o.height="100%";else o.width=l*p.width+"px",o.height=c*p.height+"px";return e}();u.cls=function(){return x.cls()},u.sprite=function(t,e,i,o,r,n){return x.sprite(t,e,i,o,r,n)},u.draw=function(t,e,i,o,r,n){return x.draw(t,e,i,o,r,n)},u.rect=function(t,e,i,o){return x.rect(t,e,i,o)},u.rectf=function(t,e,i,o){return x.rectf(t,e,i,o)},u.camera=function(t,e){return x.setCamera(t,e)},u.pen=function(t){return x.pen(t)},u.paper=function(t){return x.paper(t)},u.locate=function(t,e){return x.locate(t,e)},u.print=function(t,e,i){return x.print(t,e,i)},u.println=function(t){return x.println(t)},u.getMap=A.getMap,u.rectfill=u.rectf,x.canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1});var R=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1/60)};window.frameId=0;var B=~~(y.screen.width/2),L=~~(y.screen.width/4),C=~~(y.screen.height/2);var P=["#000","#FFF"],D=y.loader&&y.loader.colors||y.loaderColors||P;Array.isArray(D)||(D=P);var _=d("./Color");x.setPalette([(new _).fromString(D[0]),(new _).fromString(D[1])]),x.paper(0).cls().paper(1).pen(1).rect(B-L-2,C-4,2*L+4,8),n.preloadStaticAssets(r,function(t,f){if(x.paper(0).pen(1).cls(),t)return console.error(t),void print(t);for(var e in u.assets=f,u)window[e]=u[e];var i=u.bleeper=d("./bleeper");window.bleeper=i,f.bleeper&&i.loadProgram(f.bleeper),function(){var t=d("./Color"),e=y.palette;if(e.file){for(var i=e.file.split("/"),o=f;o&&i.length;)o=o[i.shift()];if(!o)return;var r=o.width,n=o.height,s=o.x||0,a=o.y||0;o._isSprite&&(o=o.img);var l=d("./domUtils/createCanvas")(r,n).getContext("2d");l.drawImage(o,s,a,r,n,0,0,r,n);for(var c=l.getImageData(0,0,r,n).data,p=[],u=0;u<c.length;u+=4)c[u+3]<=1||p.push((new t).fromPixel(c,u));x.setPalette(p)}else{var h;for(h=e.colors?e.colors:e,p=[],u=0;u<h.length;u++)p.push((new t).fromString(h[u]));x.setPalette(p)}}(),f.tilesheet&&u.tilesheet(f.tilesheet),A.loadBank(f.maps);var o=d("./gamepad"),r=y.gamepad||{};r.analogToDpad&&o.mapAnalogStickToDpad(r.deadZone);var n=d("../../src/main.js");n.update&&(m(),function t(){window.frameId+=1,o.update(),n.update(),m(),R(t)}())},function(t,e,i,o){x.rect(B-L-2,C-4,2*L+4,8).rectf(B-L,C-2,~~(o*L*2),4)})},{".":73,"../../src/main.js":100,"./Color":64,"./Texture":66,"./Texture/canvas2D":65,"./Texture/textCanvas2D":67,"./TileMap":68,"./assetLoader":69,"./bleeper":70,"./domUtils/createCanvas":71,"./gamepad":72,"./inherits":74,"audio-manager":2}]},{},[104]);